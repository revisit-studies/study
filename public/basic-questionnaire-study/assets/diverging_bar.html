<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v7.js"></script>
    <script src="../../revisitUtilities/revisit-communicate.js"></script>
</head>

<body>
    <svg>
    </svg>
</body>

<script>
    Revisit.onDataReceive((data) => {
    height = 500;
    width = 500;
    padding = 25;
    svg = d3.select("svg");
    svg.attr("width", width + 2 * padding)
        .attr("height", height + 2 * padding);

    const barData = data['barData']
    const selectedIndices =  data['indices']
    var visible = [];

    var dataObj = [];
    for(var i = 0; i < barData.length; i++){
        if (selectedIndices.includes(i)){
            visible[i] = "visible"
        } else{
            visible[i] = "hidden"
        }
        dataObj[i] = {bars:barData[i], visible:visible[i]}
    }

    let spacing = height / barData.length;

    let min = -2;
    let max = 2;

    let yScale = d3.scaleLinear()
    .domain([min, max])
    .range([height-padding, padding])
    .nice();

    let color = "white";

    svg.selectAll(".bar")
        .data(dataObj)
        .join("rect")
            .classed("bar", true)
            .attr("transform", "translate(" + padding + "," + padding + ")")
            .attr("x", (d, i) => i * spacing + 5)
            .attr("y", d => yScale(Math.max(0,d.bars)))
            .attr("width", 50)
            .attr("height", d => Math.abs(yScale(0)-yScale(d.bars)))
            .style("fill", 'white')
            .style("stroke", "black");

    svg.selectAll(".barlabel")
        .data(dataObj)
        .join("circle")
        .classed("barlabel", true)
        .attr("transform", "translate(" + padding + "," + padding + ")")
        .attr("cx", (d, i) => (i * spacing + 5)+25)
        .attr("cy",d => yScale(0.2 * Math.sign(d.bars)))
        .attr("r", 10)
        .attr("visibility",d => d.visible)
        .attr("stroke", "white")
        .attr("fill", "black");


    svg.append("g")
        .attr("transform", "translate(" + padding + "," + (height + padding) + ")")
        //.call(xAxis);

    svg.append("line")
        .attr("x1",padding)
        .attr("x2",width)
        .attr("y1",height/2+padding)
        .attr("y2",height/2+padding)
        .attr("stroke","black");
    });
</script>
</html>