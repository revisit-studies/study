!function(t,e){'object'==typeof exports&&'object'==typeof module?module.exports=e():'function'==typeof define&&define.amd?define([],e):'object'==typeof exports?exports.Trrack=e():t.Trrack=e();}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports;}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r});},n.r=function(t){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(t,'__esModule',{value:!0});},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&'object'==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,'default',{enumerable:!0,value:t}),2&e&&'string'!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e];}.bind(null,i));return r;},n.n=function(t){var e=t&&t.__esModule?function(){return t.default;}:function(){return t;};return n.d(e,'a',e),e;},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e);},n.p='',n(n.s=13);}([function(t,e,n){'use strict';n.r(e),n.d(e,'__extends',(function(){return i;})),n.d(e,'__assign',(function(){return o;})),n.d(e,'__rest',(function(){return s;})),n.d(e,'__decorate',(function(){return a;})),n.d(e,'__param',(function(){return u;})),n.d(e,'__metadata',(function(){return c;})),n.d(e,'__awaiter',(function(){return h;})),n.d(e,'__generator',(function(){return l;})),n.d(e,'__createBinding',(function(){return f;})),n.d(e,'__exportStar',(function(){return p;})),n.d(e,'__values',(function(){return d;})),n.d(e,'__read',(function(){return y;})),n.d(e,'__spread',(function(){return v;})),n.d(e,'__spreadArrays',(function(){return g;})),n.d(e,'__await',(function(){return m;})),n.d(e,'__asyncGenerator',(function(){return _;})),n.d(e,'__asyncDelegator',(function(){return w;})),n.d(e,'__asyncValues',(function(){return b;})),n.d(e,'__makeTemplateObject',(function(){return E;})),n.d(e,'__importStar',(function(){return C;})),n.d(e,'__importDefault',(function(){return I;})),n.d(e,'__classPrivateFieldGet',(function(){return T;})),n.d(e,'__classPrivateFieldSet',(function(){return S;}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);})(t,e);};function i(t,e){function n(){this.constructor=t;}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n);}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t;}).apply(this,arguments);};function s(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&'function'==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);}return n;}function a(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s;}function u(t,e){return function(n,r){e(n,r,t);};}function c(t,e){if('object'==typeof Reflect&&'function'==typeof Reflect.metadata)return Reflect.metadata(t,e);}function h(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t));}catch(t){o(t);}}function a(t){try{u(r.throw(t));}catch(t){o(t);}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e);}))).then(s,a);}u((r=r.apply(t,e||[])).next());}));}function l(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1];},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},'function'==typeof Symbol&&(o[Symbol.iterator]=function(){return this;}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError('Generator is already executing.');for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue;}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break;}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break;}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break;}i[2]&&s.ops.pop(),s.trys.pop();continue;}o=e.call(t,s);}catch(t){o=[6,t],r=0;}finally{n=i=0;}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0};}([o,a]);};}}function f(t,e,n,r){void 0===r&&(r=n),t[r]=e[n];}function p(t,e){for(var n in t)'default'===n||e.hasOwnProperty(n)||(e[n]=t[n]);}function d(t){var e='function'==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&'number'==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t};}};throw new TypeError(e?'Object is not iterable.':'Symbol.iterator is not defined.');}function y(t,e){var n='function'==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value);}catch(t){i={error:t};}finally{try{r&&!r.done&&(n=o.return)&&n.call(o);}finally{if(i)throw i.error;}}return s;}function v(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(y(arguments[e]));return t;}function g(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r;}function m(t){return this instanceof m?(this.v=t,this):new m(t);}function _(t,e,n){if(!Symbol.asyncIterator)throw new TypeError('Symbol.asyncIterator is not defined.');var r,i=n.apply(t,e||[]),o=[];return r={},s('next'),s('throw'),s('return'),r[Symbol.asyncIterator]=function(){return this;},r;function s(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||a(t,e);}));});}function a(t,e){try{(n=i[t](e)).value instanceof m?Promise.resolve(n.value.v).then(u,c):h(o[0][2],n);}catch(t){h(o[0][3],t);}var n;}function u(t){a('next',t);}function c(t){a('throw',t);}function h(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1]);}}function w(t){var e,n;return e={},r('next'),r('throw',(function(t){throw t;})),r('return'),e[Symbol.iterator]=function(){return this;},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:m(t[r](e)),done:'return'===r}:i?i(e):e;}:i;}}function b(t){if(!Symbol.asyncIterator)throw new TypeError('Symbol.asyncIterator is not defined.');var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=d(t),e={},r('next'),r('throw'),r('return'),e[Symbol.asyncIterator]=function(){return this;},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n});}),e);})(r,i,(e=t[n](e)).done,e.value);}));};}}function E(t,e){return Object.defineProperty?Object.defineProperty(t,'raw',{value:e}):t.raw=e,t;}function C(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e;}function I(t){return t&&t.__esModule?t:{default:t};}function T(t,e){if(!e.has(t))throw new TypeError('attempted to get private field on non-instance');return e.get(t);}function S(t,e,n){if(!e.has(t))throw new TypeError('attempted to set private field on non-instance');return e.set(t,n),n;}},function(t,e,n){'use strict';var r,i=(r=n(4))&&'object'==typeof r&&'default'in r?r.default:r;
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
i.registerVersion('firebase','7.16.1','app'),t.exports=i;},function(t,e,n){var r,i;i=function(t){var e=['N','E','A','D'];function n(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});}function r(t,e){Object.defineProperty(this,'kind',{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,'path',{value:e,enumerable:!0});}function i(t,e,n){i.super_.call(this,'E',t),Object.defineProperty(this,'lhs',{value:e,enumerable:!0}),Object.defineProperty(this,'rhs',{value:n,enumerable:!0});}function o(t,e){o.super_.call(this,'N',t),Object.defineProperty(this,'rhs',{value:e,enumerable:!0});}function s(t,e){s.super_.call(this,'D',t),Object.defineProperty(this,'lhs',{value:e,enumerable:!0});}function a(t,e,n){a.super_.call(this,'A',t),Object.defineProperty(this,'index',{value:e,enumerable:!0}),Object.defineProperty(this,'item',{value:n,enumerable:!0});}function u(t,e,n){var r=t.slice((n||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,r),t;}function c(t){var e=typeof t;return'object'!==e?e:t===Math?'math':null===t?'null':Array.isArray(t)?'array':'[object Date]'===Object.prototype.toString.call(t)?'date':'function'==typeof t.toString&&/^\/.*\//.test(t.toString())?'regexp':'object';}function h(t){var e=0;if(0===t.length)return e;for(var n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return e;}function l(t){var e=0,n=c(t);if('array'===n)return t.forEach((function(t){e+=l(t);})),e+h('[type: array, hash: '+e+']');if('object'===n){for(var r in t)if(t.hasOwnProperty(r)){var i='[ type: object, key: '+r+', value hash: '+l(t[r])+']';e+=h(i);}return e;}return e+h('[ type: '+n+' ; value: '+t+']');}function f(t,e,n,r,u,h,p,d){n=n||[],p=p||[];var y=(u=u||[]).slice(0);if(null!=h){if(r){if('function'==typeof r&&r(y,h))return;if('object'==typeof r){if(r.prefilter&&r.prefilter(y,h))return;if(r.normalize){var v=r.normalize(y,h,t,e);v&&(t=v[0],e=v[1]);}}}y.push(h);}'regexp'===c(t)&&'regexp'===c(e)&&(t=t.toString(),e=e.toString());var g,m,_,w,b=typeof t,E=typeof e,C='undefined'!==b||p&&p.length>0&&p[p.length-1].lhs&&Object.getOwnPropertyDescriptor(p[p.length-1].lhs,h),I='undefined'!==E||p&&p.length>0&&p[p.length-1].rhs&&Object.getOwnPropertyDescriptor(p[p.length-1].rhs,h);if(!C&&I)n.push(new o(y,e));else if(!I&&C)n.push(new s(y,t));else if(c(t)!==c(e))n.push(new i(y,t,e));else if('date'===c(t)&&t-e!=0)n.push(new i(y,t,e));else if('object'===b&&null!==t&&null!==e){for(g=p.length-1;g>-1;--g)if(p[g].lhs===t){w=!0;break;}if(w)t!==e&&n.push(new i(y,t,e));else{if(p.push({lhs:t,rhs:e}),Array.isArray(t)){for(d&&(t.sort((function(t,e){return l(t)-l(e);})),e.sort((function(t,e){return l(t)-l(e);}))),g=e.length-1,m=t.length-1;g>m;)n.push(new a(y,g,new o(void 0,e[g--])));for(;m>g;)n.push(new a(y,m,new s(void 0,t[m--])));for(;g>=0;--g)f(t[g],e[g],n,r,y,g,p,d);}else{var T=Object.keys(t),S=Object.keys(e);for(g=0;g<T.length;++g)_=T[g],(w=S.indexOf(_))>=0?(f(t[_],e[_],n,r,y,_,p,d),S[w]=null):f(t[_],void 0,n,r,y,_,p,d);for(g=0;g<S.length;++g)(_=S[g])&&f(void 0,e[_],n,r,y,_,p,d);}p.length=p.length-1;}}else t!==e&&('number'===b&&isNaN(t)&&isNaN(e)||n.push(new i(y,t,e)));}function p(t,e,n,r,i){var o=[];if(f(t,e,o,r,null,null,null,i),n)for(var s=0;s<o.length;++s)n(o[s]);return o;}function d(t,e,n,r){var i=p(t,e,r?function(t){t&&r.push(t);}:void 0,n);return r||(i.length?i:void 0);}function y(t,n,r){if(void 0===r&&n&&~e.indexOf(n.kind)&&(r=n),t&&r&&r.kind){for(var i=t,o=-1,s=r.path?r.path.length-1:0;++o<s;)void 0===i[r.path[o]]&&(i[r.path[o]]=void 0!==r.path[o+1]&&'number'==typeof r.path[o+1]?[]:{}),i=i[r.path[o]];switch(r.kind){case'A':r.path&&void 0===i[r.path[o]]&&(i[r.path[o]]=[]),function t(e,n,r){if(r.path&&r.path.length){var i,o=e[n],s=r.path.length-1;for(i=0;i<s;i++)o=o[r.path[i]];switch(r.kind){case'A':t(o[r.path[i]],r.index,r.item);break;case'D':delete o[r.path[i]];break;case'E':case'N':o[r.path[i]]=r.rhs;}}else switch(r.kind){case'A':t(e[n],r.index,r.item);break;case'D':e=u(e,n);break;case'E':case'N':e[n]=r.rhs;}return e;}(r.path?i[r.path[o]]:i,r.index,r.item);break;case'D':delete i[r.path[o]];break;case'E':case'N':i[r.path[o]]=r.rhs;}}}return n(i,r),n(o,r),n(s,r),n(a,r),Object.defineProperties(d,{diff:{value:d,enumerable:!0},orderIndependentDiff:{value:function(t,e,n,r){var i=r?function(t){t&&r.push(t);}:void 0,o=p(t,e,i,n,!0);return r||(o.length?o:void 0);},enumerable:!0},observableDiff:{value:p,enumerable:!0},orderIndependentObservableDiff:{value:function(t,e,n,r,i,o,s){return f(t,e,n,r,i,o,s,!0);},enumerable:!0},orderIndepHash:{value:l,enumerable:!0},applyDiff:{value:function(t,e,n){t&&e&&p(t,e,(function(r){n&&!n(t,e,r)||y(t,e,r);}));},enumerable:!0},applyChange:{value:y,enumerable:!0},revertChange:{value:function(t,e,n){if(t&&e&&n&&n.kind){var r,i,o=t;for(i=n.path.length-1,r=0;r<i;r++)void 0===o[n.path[r]]&&(o[n.path[r]]={}),o=o[n.path[r]];switch(n.kind){case'A':!function t(e,n,r){if(r.path&&r.path.length){var i,o=e[n],s=r.path.length-1;for(i=0;i<s;i++)o=o[r.path[i]];switch(r.kind){case'A':t(o[r.path[i]],r.index,r.item);break;case'D':case'E':o[r.path[i]]=r.lhs;break;case'N':delete o[r.path[i]];}}else switch(r.kind){case'A':t(e[n],r.index,r.item);break;case'D':case'E':e[n]=r.lhs;break;case'N':e=u(e,n);}return e;}(o[n.path[r]],n.index,n.item);break;case'D':case'E':o[n.path[r]]=n.lhs;break;case'N':delete o[n.path[r]];}}},enumerable:!0},isConflict:{value:function(){return'undefined'!=typeof $conflict;},enumerable:!0}}),d.DeepDiff=d,t&&(t.DeepDiff=d),d;}(this),void 0===(r=function(){return i;}.call(e,n,e,t))||(t.exports=r);},function(t,e,n){'use strict';(function(t){Object.defineProperty(e,'__esModule',{value:!0});var r=n(0),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:'${JSCORE_VERSION}'},o=function(t,e){if(!t)throw s(e);},s=function(t){return new Error('Firebase Database ('+i.SDK_VERSION+') INTERNAL ASSERT FAILED: '+t);},a=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128);}return e;},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',get ENCODED_VALS(){return this.ENCODED_VALS_BASE+'+/=';},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+'-_.';},HAS_NATIVE_SUPPORT:'function'==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error('encodeByteArray takes an array as a parameter');this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|a>>4,f=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p]);}return r.join('');},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(a(t),e);},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o);}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s));}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a);}}return e.join('');}(this.decodeStringToByteArray(t,e));},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!==a){var h=s<<4&240|a>>2;if(r.push(h),64!==u){var l=a<<6&192|u;r.push(l);}}}return r;},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t);}}},c=function(t){try{return u.decodeString(t,!0);}catch(t){console.error('base64Decode failed: ',t);}return null;};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e;}for(var n in e)e.hasOwnProperty(n)&&(t[n]=h(t[n],e[n]));return t;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var l=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n;}));}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),'function'==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r));};},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f(){return'undefined'!=typeof navigator&&'string'==typeof navigator.userAgent?navigator.userAgent:'';}function p(){try{return'[object process]'===Object.prototype.toString.call(t.process);}catch(t){return!1;}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var d='FirebaseError',y=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=d,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,v.prototype.create),i;}return r.__extends(e,t),e;}(Error),v=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n;}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+'/'+t,o=this.errors[t],s=o?g(o,r):'Error',a=this.serviceName+': '+s+' ('+i+').',u=new y(i,a),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];'_'!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l]);}return u;},t;}();function g(t,e){return t.replace(m,(function(t,n){var r=e[n];return null!=r?String(r):'<'+n+'?>';}));}var m=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _(t){return JSON.parse(t);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var w=function(t){var e={},n={},r={},i='';try{var o=t.split('.');e=_(c(o[0])||''),n=_(c(o[1])||''),i=o[2],r=n.d||{},delete n.d;}catch(t){}return{header:e,claims:n,data:r,signature:i};};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var b=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset();}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0;},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if('string'==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31);}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782);i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i;}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295;},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if('string'==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break;}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break;}}this.inbuf_=o,this.total_+=e;}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t;},t;}();var E=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n);})).catch((function(t){n.error(t);}));}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t);}));},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t);})),this.close(t);},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete();})),this.close();},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error('Missing Observer.');void 0===(r=function(t,e){if('object'!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&'function'==typeof t[i])return!0;}return!1;}(t,['next','error','complete'])?t:{next:t,error:e,complete:n}).next&&(r.next=C),void 0===r.error&&(r.error=C),void 0===r.complete&&(r.complete=C);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete();}catch(t){}})),this.observers.push(r),o;},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this));},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t);},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t]);}catch(t){'undefined'!=typeof console&&console.error&&console.error(t);}}));},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0;})));},t;}();function C(){}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I(t,e,n){var r='';switch(e){case 1:r=n?'first':'First';break;case 2:r=n?'second':'Second';break;case 3:r=n?'third':'Third';break;case 4:r=n?'fourth':'Fourth';break;default:throw new Error('errorPrefix called with argumentNumber > 4.  Need to update it?');}var i=t+' failed: ';return i+=r+' argument ';}e.CONSTANTS=i,e.Deferred=l,e.ErrorFactory=v,e.FirebaseError=y,e.Sha1=b,e.assert=o,e.assertionError=s,e.async=function(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];Promise.resolve(!0).then((function(){t.apply(void 0,n);})).catch((function(t){e&&e(t);}));};},e.base64=u,e.base64Decode=c,e.base64Encode=function(t){var e=a(t);return u.encodeByteArray(e,!0);},e.contains=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e){return Object.prototype.hasOwnProperty.call(t,e);},e.createSubscribe=function(t,e){var n=new E(t,e);return n.subscribe.bind(n);},e.decode=w,e.deepCopy=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){return h(void 0,t);},e.deepExtend=h,e.errorPrefix=I,e.getUA=f,e.isAdmin=function(t){var e=w(t).claims;return'object'==typeof e&&!0===e.admin;},e.isBrowser=function(){return'object'==typeof self&&self.self===self;},e.isBrowserExtension=function(){var t='object'==typeof chrome?chrome.runtime:'object'==typeof browser?browser.runtime:void 0;return'object'==typeof t&&void 0!==t.id;},e.isElectron=function(){return f().indexOf('Electron/')>=0;},e.isEmpty=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0;},e.isIE=function(){var t=f();return t.indexOf('MSIE ')>=0||t.indexOf('Trident/')>=0;},e.isMobileCordova=function(){return'undefined'!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f());},e.isNode=p,e.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN;},e.isReactNative=function(){return'object'==typeof navigator&&'ReactNative'===navigator.product;},e.isSafari=function(){return!p()&&navigator.userAgent.includes('Safari')&&!navigator.userAgent.includes('Chrome');},e.isUWP=function(){return f().indexOf('MSAppHost/')>=0;},e.isValidFormat=function(t){var e=w(t).claims;return!!e&&'object'==typeof e&&e.hasOwnProperty('iat');},e.isValidTimestamp=function(t){var e=w(t).claims,n=Math.floor((new Date).getTime()/1e3),r=0,i=0;return'object'==typeof e&&(e.hasOwnProperty('nbf')?r=e.nbf:e.hasOwnProperty('iat')&&(r=e.iat),i=e.hasOwnProperty('exp')?e.exp:r+86400),!!n&&!!r&&!!i&&n>=r&&n<=i;},e.issuedAtTime=function(t){var e=w(t).claims;return'object'==typeof e&&e.hasOwnProperty('iat')?e.iat:null;},e.jsonEval=_,e.map=function(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */,e.querystring=function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+'='+encodeURIComponent(n));})):e.push(encodeURIComponent(t)+'='+encodeURIComponent(n));},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1]);}return e.length?'&'+e.join('&'):'';},e.querystringDecode=function(t){var e={};return t.replace(/^\?/,'').split('&').forEach((function(t){if(t){var n=t.split('=');e[n[0]]=n[1];}})),e;},e.safeGet=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;},e.stringLength=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3;}return e;},e.stringToByteArray=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var s=i-55296;o(++r<t.length,'Surrogate pair missing trail surrogate.'),i=65536+(s<<10)+(t.charCodeAt(r)-56320);}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128);}return e;},e.stringify=function(t){return JSON.stringify(t);},e.validateArgCount=function(t,e,n,r){var i;if(r<e?i='at least '+e:r>n&&(i=0===n?'none':'no more than '+n),i)throw new Error(t+' failed: Was called with '+r+(1===r?' argument.':' arguments.')+' Expects '+i+'.');},e.validateCallback=function(t,e,n,r){if((!r||n)&&'function'!=typeof n)throw new Error(I(t,e,r)+'must be a valid function.');},e.validateContextObject=function(t,e,n,r){if((!r||n)&&('object'!=typeof n||null===n))throw new Error(I(t,e,r)+'must be a valid context object.');}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */,e.validateNamespace=function(t,e,n,r){if((!r||n)&&'string'!=typeof n)throw new Error(I(t,e,r)+'must be a valid firebase namespace.');};}).call(this,n(8));},function(t,e,n){'use strict';Object.defineProperty(e,'__esModule',{value:!0});var r,i,o=n(0),s=n(3),a=n(5),u=n(6),c=((r={})['no-app']='No Firebase App \'{$appName}\' has been created - call Firebase App.initializeApp()',r['bad-app-name']='Illegal App name: \'{$appName}',r['duplicate-app']='Firebase App named \'{$appName}\' already exists',r['app-deleted']='Firebase App named \'{$appName}\' already deleted',r['invalid-app-argument']='firebase.{$appName}() takes either no argument or a Firebase App instance.',r['invalid-log-argument']='First argument to `onLog` must be null or a function.',r),h=new s.ErrorFactory('app','Firebase',c),l='@firebase/app',f='0.6.8',p='[DEFAULT]',d=((i={})[l]='fire-core',i['@firebase/analytics']='fire-analytics',i['@firebase/auth']='fire-auth',i['@firebase/database']='fire-rtdb',i['@firebase/functions']='fire-fn',i['@firebase/installations']='fire-iid',i['@firebase/messaging']='fire-fcm',i['@firebase/performance']='fire-perf',i['@firebase/remote-config']='fire-rc',i['@firebase/storage']='fire-gcs',i['@firebase/firestore']='fire-fst',i['fire-js']='fire-js',i['firebase-wrapper']='fire-js-all',i),y=new u.Logger('@firebase/app'),v=function(){function t(t,e,n){var r,i,u=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=s.deepCopy(t),this.container=new a.ComponentContainer(e.name),this._addComponent(new a.Component('app',(function(){return u;}),'PUBLIC'));try{for(var c=o.__values(this.firebase_.INTERNAL.components.values()),h=c.next();!h.done;h=c.next()){var l=h.value;this._addComponent(l);}}catch(t){r={error:t};}finally{try{h&&!h.done&&(i=c.return)&&i.call(c);}finally{if(r)throw r.error;}}}return Object.defineProperty(t.prototype,'automaticDataCollectionEnabled',{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_;},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'name',{get:function(){return this.checkDestroyed_(),this.name_;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'options',{get:function(){return this.checkDestroyed_(),this.options_;},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e();})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete();})));})).then((function(){t.isDeleted_=!0;}));},t.prototype._getService=function(t,e){return void 0===e&&(e=p),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e});},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=p),this.container.getProvider(t).clearInstance(e);},t.prototype._addComponent=function(t){try{this.container.addComponent(t);}catch(e){y.debug('Component '+t.name+' failed to register with FirebaseApp '+this.name,e);}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t);},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw h.create('app-deleted',{appName:this.name_});},t;}();v.prototype.name&&v.prototype.options||v.prototype.delete||console.log('dc');var g='7.16.0';
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var m=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if('object'!=typeof i||null===i){i={name:i};}var o=i;void 0===o.name&&(o.name=p);var a=o.name;if('string'!=typeof a||!a)throw h.create('bad-app-name',{appName:String(a)});if(s.contains(e,a))throw h.create('duplicate-app',{appName:a});var u=new t(n,o,r);return e[a]=u,u;},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=d[t])&&void 0!==r?r:t;n&&(i+='-'+n);var o=i.match(/\s|\//),s=e.match(/\s|\//);if(o||s){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&s&&u.push('and'),s&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void y.warn(u.join(' '));}c(new a.Component(i+'-version',(function(){return{library:i,version:e};}),'VERSION'));},setLogLevel:u.setLogLevel,onLog:function(t,e){if(null!==t&&'function'!=typeof t)throw h.create('invalid-log-argument',{appName:name});u.setUserLogHandler(t,e);},apps:null,SDK_VERSION:g,INTERNAL:{registerComponent:c,removeApp:function(t){delete e[t];},components:n,useAsService:function(t,e){if('serverAuth'===e)return null;return e;}}};function i(t){if(t=t||p,!s.contains(e,t))throw h.create('no-app',{appName:t});return e[t];}function c(a){var u,c,l=a.name;if(n.has(l))return y.debug('There were multiple attempts to register component '+l+'.'),'PUBLIC'===a.type?r[l]:null;if(n.set(l,a),'PUBLIC'===a.type){var f=function(t){if(void 0===t&&(t=i()),'function'!=typeof t[l])throw h.create('invalid-app-argument',{appName:l});return t[l]();};void 0!==a.serviceProps&&s.deepExtend(f,a.serviceProps),r[l]=f,t.prototype[l]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,l);return n.apply(this,a.multipleInstances?t:[]);};}try{for(var p=o.__values(Object.keys(e)),d=p.next();!d.done;d=p.next()){var v=d.value;e[v]._addComponent(a);}}catch(t){u={error:t};}finally{try{d&&!d.done&&(c=p.return)&&c.call(p);}finally{if(u)throw u.error;}}return'PUBLIC'===a.type?r[l]:null;}return r.default=r,Object.defineProperty(r,'apps',{get:function(){return Object.keys(e).map((function(t){return e[t];}));}}),i.App=t,r;}(v);return e.INTERNAL=o.__assign(o.__assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){s.deepExtend(e,t);},createSubscribe:s.createSubscribe,ErrorFactory:s.ErrorFactory,deepExtend:s.deepExtend}),e;}(),_=function(){function t(t){this.container=t;}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return'VERSION'===(null==e?void 0:e.type);}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+'/'+e.version;}return null;})).filter((function(t){return t;})).join(' ');},t;}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(s.isBrowser()&&void 0!==self.firebase){y.warn('\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ');var w=self.firebase.SDK_VERSION;w&&w.indexOf('LITE')>=0&&y.warn('\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ');}var b=m.initializeApp;m.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return s.isNode()&&y.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),b.apply(void 0,t);};var E=m;!function(t,e){t.INTERNAL.registerComponent(new a.Component('platform-logger',(function(t){return new _(t);}),'PRIVATE')),t.registerVersion(l,f,e),t.registerVersion('fire-js','');}(E),e.default=E,e.firebase=E;},function(t,e,n){'use strict';Object.defineProperty(e,'__esModule',{value:!0});var r=n(0),i=n(3),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode='LAZY';}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this;},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this;},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this;},t;}(),s='[DEFAULT]',a=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map;}return t.prototype.get=function(t){void 0===t&&(t=s);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new i.Deferred;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r);}catch(t){}}return this.instancesDeferred.get(e).promise;},t.prototype.getImmediate=function(t){var e=r.__assign({identifier:s,optional:!1},t),n=e.identifier,i=e.optional,o=this.normalizeInstanceIdentifier(n);try{var a=this.getOrInitializeService(o);if(!a){if(i)return null;throw Error('Service '+this.name+' is not available');}return a;}catch(t){if(i)return null;throw t;}},t.prototype.getComponent=function(){return this.component;},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error('Mismatching Component '+t.name+' for Provider '+this.name+'.');if(this.component)throw Error('Component for '+this.name+' has already been provided');if(this.component=t,function(t){return'EAGER'===t.instantiationMode;}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService(s);}catch(t){}try{for(var i=r.__values(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=r.__read(o.value,2),u=a[0],c=a[1],h=this.normalizeInstanceIdentifier(u);try{var l=this.getOrInitializeService(h);c.resolve(l);}catch(t){}}}catch(t){e={error:t};}finally{try{o&&!o.done&&(n=i.return)&&n.call(i);}finally{if(e)throw e.error;}}},t.prototype.clearInstance=function(t){void 0===t&&(t=s),this.instancesDeferred.delete(t),this.instances.delete(t);},t.prototype.delete=function(){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return'INTERNAL'in t;})).map((function(t){return t.INTERNAL.delete();})))];case 1:return e.sent(),[2];}}));}));},t.prototype.isComponentSet=function(){return null!=this.component;},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return t===s?void 0:t;}(t)),this.instances.set(t,e)),e||null;},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:s:t;},t;}();var u=function(){function t(t){this.name=t,this.providers=new Map;}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error('Component '+t.name+' has already been registered with '+this.name);e.setComponent(t);},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t);},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new a(t,this);return this.providers.set(t,e),e;},t.prototype.getProviders=function(){return Array.from(this.providers.values());},t;}();e.Component=o,e.ComponentContainer=u,e.Provider=a;},function(t,e,n){'use strict';
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i;n.r(e),n.d(e,'LogLevel',(function(){return o;})),n.d(e,'Logger',(function(){return l;})),n.d(e,'setLogLevel',(function(){return f;})),n.d(e,'setUserLogHandler',(function(){return p;}));var o,s=[];!function(t){t[t.DEBUG=0]='DEBUG',t[t.VERBOSE=1]='VERBOSE',t[t.INFO=2]='INFO',t[t.WARN=3]='WARN',t[t.ERROR=4]='ERROR',t[t.SILENT=5]='SILENT';}(o||(o={}));var a={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},u=o.INFO,c=((i={})[o.DEBUG]='log',i[o.VERBOSE]='log',i[o.INFO]='info',i[o.WARN]='warn',i[o.ERROR]='error',i),h=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var o=(new Date).toISOString(),s=c[e];if(!s)throw new Error('Attempted to log a message with an invalid logType (value: '+e+')');console[s].apply(console,r(['['+o+']  '+t.name+':'],n));}},l=function(){function t(t){this.name=t,this._logLevel=u,this._logHandler=h,this._userLogHandler=null,s.push(this);}return Object.defineProperty(t.prototype,'logLevel',{get:function(){return this._logLevel;},set:function(t){if(!(t in o))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t;},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel='string'==typeof t?a[t]:t;},Object.defineProperty(t.prototype,'logHandler',{get:function(){return this._logHandler;},set:function(t){if('function'!=typeof t)throw new TypeError('Value assigned to `logHandler` must be a function');this._logHandler=t;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'userLogHandler',{get:function(){return this._userLogHandler;},set:function(t){this._userLogHandler=t;},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.DEBUG],t)),this._logHandler.apply(this,r([this,o.DEBUG],t));},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.VERBOSE],t)),this._logHandler.apply(this,r([this,o.VERBOSE],t));},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.INFO],t)),this._logHandler.apply(this,r([this,o.INFO],t));},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.WARN],t)),this._logHandler.apply(this,r([this,o.WARN],t));},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.ERROR],t)),this._logHandler.apply(this,r([this,o.ERROR],t));},t;}();function f(t){s.forEach((function(e){e.setLogLevel(t);}));}function p(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=a[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=i.map((function(t){if(null==t)return null;if('string'==typeof t)return t;if('number'==typeof t||'boolean'==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t);}catch(t){return null;}})).filter((function(t){return t;})).join(' ');n>=(null!=r?r:e.logLevel)&&t({level:o[n].toLowerCase(),message:a,args:i,type:e.name});};},r=0,i=s;r<i.length;r++){n(i[r]);}}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error('setTimeout has not been defined');}function s(){throw new Error('clearTimeout has not been defined');}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0);}catch(e){try{return n.call(null,t,0);}catch(e){return n.call(this,t,0);}}}!function(){try{n='function'==typeof setTimeout?setTimeout:o;}catch(t){n=o;}try{r='function'==typeof clearTimeout?clearTimeout:s;}catch(t){r=s;}}();var u,c=[],h=!1,l=-1;function f(){h&&u&&(h=!1,u.length?c=u.concat(c):l=-1,c.length&&p());}function p(){if(!h){var t=a(f);h=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length;}u=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t);}catch(e){try{return r.call(null,t);}catch(e){return r.call(this,t);}}}(t);}}function d(t,e){this.fun=t,this.array=e;}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||h||a(p);},d.prototype.run=function(){this.fun.apply(null,this.array);},i.title='browser',i.browser=!0,i.env={},i.argv=[],i.version='',i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[];},i.binding=function(t){throw new Error('process.binding is not supported');},i.cwd=function(){return'/';},i.chdir=function(t){throw new Error('process.chdir is not supported');},i.umask=function(){return 0;};},function(t,e){var n;n=function(){return this;}();try{n=n||new Function('return this')();}catch(t){'object'==typeof window&&(n=window);}t.exports=n;},function(t,e,n){var r,i=function(){var t=String.fromCharCode,e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',n='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$',r={};function i(t,e){if(!r[t]){r[t]={};for(var n=0;n<t.length;n++)r[t][t.charAt(n)]=n;}return r[t][e];}var o={compressToBase64:function(t){if(null==t)return'';var n=o._compress(t,6,(function(t){return e.charAt(t);}));switch(n.length%4){default:case 0:return n;case 1:return n+'===';case 2:return n+'==';case 3:return n+'=';}},decompressFromBase64:function(t){return null==t?'':''==t?null:o._decompress(t.length,32,(function(n){return i(e,t.charAt(n));}));},compressToUTF16:function(e){return null==e?'':o._compress(e,15,(function(e){return t(e+32);}))+' ';},decompressFromUTF16:function(t){return null==t?'':''==t?null:o._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32;}));},compressToUint8Array:function(t){for(var e=o.compress(t),n=new Uint8Array(2*e.length),r=0,i=e.length;r<i;r++){var s=e.charCodeAt(r);n[2*r]=s>>>8,n[2*r+1]=s%256;}return n;},decompressFromUint8Array:function(e){if(null==e)return o.decompress(e);for(var n=new Array(e.length/2),r=0,i=n.length;r<i;r++)n[r]=256*e[2*r]+e[2*r+1];var s=[];return n.forEach((function(e){s.push(t(e));})),o.decompress(s.join(''));},compressToEncodedURIComponent:function(t){return null==t?'':o._compress(t,6,(function(t){return n.charAt(t);}));},decompressFromEncodedURIComponent:function(t){return null==t?'':''==t?null:(t=t.replace(/ /g,'+'),o._decompress(t.length,32,(function(e){return i(n,t.charAt(e));})));},compress:function(e){return o._compress(e,16,(function(e){return t(e);}));},_compress:function(t,e,n){if(null==t)return'';var r,i,o,s={},a={},u='',c='',h='',l=2,f=3,p=2,d=[],y=0,v=0;for(o=0;o<t.length;o+=1)if(u=t.charAt(o),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,a[u]=!0),c=h+u,Object.prototype.hasOwnProperty.call(s,c))h=c;else{if(Object.prototype.hasOwnProperty.call(a,h)){if(h.charCodeAt(0)<256){for(r=0;r<p;r++)y<<=1,v==e-1?(v=0,d.push(n(y)),y=0):v++;for(i=h.charCodeAt(0),r=0;r<8;r++)y=y<<1|1&i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i>>=1;}else{for(i=1,r=0;r<p;r++)y=y<<1|i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i=0;for(i=h.charCodeAt(0),r=0;r<16;r++)y=y<<1|1&i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i>>=1;}0==--l&&(l=Math.pow(2,p),p++),delete a[h];}else for(i=s[h],r=0;r<p;r++)y=y<<1|1&i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i>>=1;0==--l&&(l=Math.pow(2,p),p++),s[c]=f++,h=String(u);}if(''!==h){if(Object.prototype.hasOwnProperty.call(a,h)){if(h.charCodeAt(0)<256){for(r=0;r<p;r++)y<<=1,v==e-1?(v=0,d.push(n(y)),y=0):v++;for(i=h.charCodeAt(0),r=0;r<8;r++)y=y<<1|1&i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i>>=1;}else{for(i=1,r=0;r<p;r++)y=y<<1|i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i=0;for(i=h.charCodeAt(0),r=0;r<16;r++)y=y<<1|1&i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i>>=1;}0==--l&&(l=Math.pow(2,p),p++),delete a[h];}else for(i=s[h],r=0;r<p;r++)y=y<<1|1&i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i>>=1;0==--l&&(l=Math.pow(2,p),p++);}for(i=2,r=0;r<p;r++)y=y<<1|1&i,v==e-1?(v=0,d.push(n(y)),y=0):v++,i>>=1;for(;;){if(y<<=1,v==e-1){d.push(n(y));break;}v++;}return d.join('');},decompress:function(t){return null==t?'':''==t?null:o._decompress(t.length,32768,(function(e){return t.charCodeAt(e);}));},_decompress:function(e,n,r){var i,o,s,a,u,c,h,l=[],f=4,p=4,d=3,y='',v=[],g={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)l[i]=i;for(s=0,u=Math.pow(2,2),c=1;c!=u;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*c,c<<=1;switch(s){case 0:for(s=0,u=Math.pow(2,8),c=1;c!=u;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*c,c<<=1;h=t(s);break;case 1:for(s=0,u=Math.pow(2,16),c=1;c!=u;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*c,c<<=1;h=t(s);break;case 2:return'';}for(l[3]=h,o=h,v.push(h);;){if(g.index>e)return'';for(s=0,u=Math.pow(2,d),c=1;c!=u;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*c,c<<=1;switch(h=s){case 0:for(s=0,u=Math.pow(2,8),c=1;c!=u;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*c,c<<=1;l[p++]=t(s),h=p-1,f--;break;case 1:for(s=0,u=Math.pow(2,16),c=1;c!=u;)a=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=r(g.index++)),s|=(a>0?1:0)*c,c<<=1;l[p++]=t(s),h=p-1,f--;break;case 2:return v.join('');}if(0==f&&(f=Math.pow(2,d),d++),l[h])y=l[h];else{if(h!==p)return null;y=o+o.charAt(0);}v.push(y),l[p++]=o+y.charAt(0),o=y,0==--f&&(f=Math.pow(2,d),d++);}}};return o;}();void 0===(r=function(){return i;}.call(e,n,e,t))||(t.exports=r);},function(t,e,n){'use strict';(function(r){Object.defineProperty(e,'__esModule',{value:!0});var i,o,s=(i=n(4))&&'object'==typeof i&&'default'in i?i.default:i,a=n(0),u=n(3),c=n(6),h=n(5),l=function(){function t(t){this.domStorage_=t,this.prefix_='firebase:';}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),u.stringify(e));},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:u.jsonEval(e);},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t));},t.prototype.prefixedName_=function(t){return this.prefix_+t;},t.prototype.toString=function(){return this.domStorage_.toString();},t;}(),f=function(){function t(){this.cache_={},this.isInMemoryStorage=!0;}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e;},t.prototype.get=function(t){return u.contains(this.cache_,t)?this.cache_[t]:null;},t.prototype.remove=function(t){delete this.cache_[t];},t;}(),p=function(t){try{if('undefined'!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem('firebase:sentinel','cache'),e.removeItem('firebase:sentinel'),new l(e);}}catch(t){}return new f;},d=p('localStorage'),y=p('sessionStorage'),v=new c.Logger('@firebase/database'),g=(o=1,function(){return o++;}),m=function(t){var e=u.stringToByteArray(t),n=new u.Sha1;n.update(e);var r=n.digest();return u.base64.encodeByteArray(r);},_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n='',r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&'object'==typeof i&&'number'==typeof i.length?n+=_.apply(null,i):n+='object'==typeof i?u.stringify(i):i,n+=' ';}return n;},w=null,b=!0,E=function(t,e){u.assert(!e||!0===t||!1===t,'Can\'t turn on custom loggers persistently.'),!0===t?(v.logLevel=c.LogLevel.VERBOSE,w=v.log.bind(v),e&&y.set('logging_enabled',!0)):'function'==typeof t?w=t:(w=null,y.remove('logging_enabled'));},C=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===b&&(b=!1,null===w&&!0===y.get('logging_enabled')&&E(!0)),w){var n=_.apply(null,t);w(n);}},I=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];C.apply(void 0,a.__spread([t],e));};},T=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n='FIREBASE INTERNAL ERROR: '+_.apply(void 0,a.__spread(t));v.error(n);},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n='FIREBASE FATAL ERROR: '+_.apply(void 0,a.__spread(t));throw v.error(n),new Error(n);},N=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n='FIREBASE WARNING: '+_.apply(void 0,a.__spread(t));v.warn(n);},A=function(t){return'number'==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY);},x='[MIN_NAME]',P='[MAX_NAME]',D=function(t,e){if(t===e)return 0;if(t===x||e===P)return-1;if(e===x||t===P)return 1;var n=V(t),r=V(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1;},O=function(t,e){return t===e?0:t<e?-1:1;},R=function(t,e){if(e&&t in e)return e[t];throw new Error('Missing required key ('+t+') in object: '+u.stringify(e));},k=function(t){if('object'!=typeof t||null===t)return u.stringify(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r='{',i=0;i<e.length;i++)0!==i&&(r+=','),r+=u.stringify(e[i]),r+=':',r+=k(t[e[i]]);return r+='}';},L=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r;};function F(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n]);}var M=function(t){u.assert(!A(t),'Invalid JSON number');var e,n,r,i,o;0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074))));var s=[];for(o=52;o;o-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(e?1:0),s.reverse();var a=s.join(''),c='';for(o=0;o<64;o+=8){var h=parseInt(a.substr(o,8),2).toString(16);1===h.length&&(h='0'+h),c+=h;}return c.toLowerCase();},U=new RegExp('^-?(0*)\\d{1,10}$'),V=function(t){if(U.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e;}return null;},j=function(t){try{t();}catch(t){setTimeout((function(){var e=t.stack||'';throw N('Exception was thrown by user callback.',e),t;}),Math.floor(0));}},q=function(){return('object'==typeof window&&window.navigator&&window.navigator.userAgent||'').search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0;},B=function(t,e){var n=setTimeout(t,e);return'object'==typeof n&&n.unref&&n.unref(),n;},W=function(){function t(t,e){if(void 0===e){this.pieces_=t.split('/');for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0;}else this.pieces_=t,this.pieceNum_=e;}return Object.defineProperty(t,'Empty',{get:function(){return new t('');},enumerable:!1,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_];},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_;},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e);},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null;},t.prototype.toString=function(){for(var t='',e=this.pieceNum_;e<this.pieces_.length;e++)''!==this.pieces_[e]&&(t+='/'+this.pieces_[e]);return t||'/';},t.prototype.toUrlEncodedString=function(){for(var t='',e=this.pieceNum_;e<this.pieces_.length;e++)''!==this.pieces_[e]&&(t+='/'+encodeURIComponent(String(this.pieces_[e])));return t||'/';},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t);},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0);},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split('/');for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r]);}return new t(n,0);},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length;},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error('INTERNAL ERROR: innerPath ('+n+') is not within outerPath ('+e+')');},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=D(n[i],r[i]);if(0!==o)return o;}return n.length===r.length?0:n.length<r.length?-1:1;},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0;},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n;}return!0;},t;}(),Q=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=u.stringLength(this.parts_[n]);this.checkValid_();}return Object.defineProperty(t,'MAX_PATH_DEPTH',{get:function(){return 32;},enumerable:!1,configurable:!0}),Object.defineProperty(t,'MAX_PATH_LENGTH_BYTES',{get:function(){return 768;},enumerable:!1,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=u.stringLength(t),this.checkValid_();},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=u.stringLength(t),this.parts_.length>0&&(this.byteLength_-=1);},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+'has a key path longer than '+t.MAX_PATH_LENGTH_BYTES+' bytes ('+this.byteLength_+').');if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+'path specified exceeds the maximum depth that can be written ('+t.MAX_PATH_DEPTH+') or object contains a cycle '+this.toErrorString());},t.prototype.toErrorString=function(){return 0===this.parts_.length?'':'in property \''+this.parts_.join('.')+'\'';},t;}(),z='long_polling',G=function(){function t(t,e,n,r,i,o){void 0===i&&(i=''),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf('.')+1),this.internalHost=d.get('host:'+t)||this.host;}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams;},t.prototype.isCacheableHost=function(){return's-'===this.internalHost.substr(0,2);},t.prototype.isDemoHost=function(){return'firebaseio-demo.com'===this.domain;},t.prototype.isCustomHost=function(){return'firebaseio.com'!==this.domain&&'firebaseio-demo.com'!==this.domain;},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&d.set('host:'+this.host,this.internalHost));},t.prototype.connectionURL=function(t,e){var n;if(u.assert('string'==typeof t,'typeof type must == string'),u.assert('object'==typeof e,'typeof params must == object'),'websocket'===t)n=(this.secure?'wss://':'ws://')+this.internalHost+'/.ws?';else{if(t!==z)throw new Error('Unknown connection type: '+t);n=(this.secure?'https://':'http://')+this.internalHost+'/.lp?';}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return F(e,(function(t,e){r.push(t+'='+e);})),n+r.join('&');},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+='<'+this.persistenceKey+'>'),t;},t.prototype.toURLString=function(){return(this.secure?'https://':'http://')+this.host;},t;}();var H,K,Y,$,X,J=function(t){var e=Z(t),n=e.namespace;'firebase.com'===e.domain&&S(e.host+' is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead'),n&&'undefined'!==n||'localhost'===e.domain||S('Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com'),e.secure||'undefined'!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf('https:')&&N('Insecure Firebase access from a secure page. Please use https in calls to new Firebase().');var r='ws'===e.scheme||'wss'===e.scheme;return{repoInfo:new G(e.host,e.secure,n,r,'',n!==e.subdomain),path:new W(e.pathString)};},Z=function(t){var e='',n='',r='',i='',o='',s=!0,u='https',c=443;if('string'==typeof t){var h=t.indexOf('//');h>=0&&(u=t.substring(0,h-1),t=t.substring(h+2));var l=t.indexOf('/');-1===l&&(l=t.length);var f=t.indexOf('?');-1===f&&(f=t.length),e=t.substring(0,Math.min(l,f)),l<f&&(i=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){for(var e='',n=t.split('/'),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g,' '));}catch(t){}e+='/'+i;}return e;}(t.substring(l,f)));var p=function(t){var e,n,r={};'?'===t.charAt(0)&&(t=t.substring(1));try{for(var i=a.__values(t.split('&')),o=i.next();!o.done;o=i.next()){var s=o.value;if(0!==s.length){var u=s.split('=');2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):N('Invalid query segment \''+s+'\' in query \''+t+'\'');}}}catch(t){e={error:t};}finally{try{o&&!o.done&&(n=i.return)&&n.call(i);}finally{if(e)throw e.error;}}return r;}(t.substring(Math.min(t.length,f)));(h=e.indexOf(':'))>=0?(s='https'===u||'wss'===u,c=parseInt(e.substring(h+1),10)):h=e.length;var d=e.slice(0,h);if('localhost'===d.toLowerCase())n='localhost';else if(d.split('.').length<=2)n=d;else{var y=e.indexOf('.');r=e.substring(0,y).toLowerCase(),n=e.substring(y+1),o=r;}'ns'in p&&(o=p.ns);}return{host:e,port:c,domain:n,subdomain:r,secure:s,scheme:u,pathString:i,namespace:o};},tt=/[\[\].#$\/\u0000-\u001F\u007F]/,et=/[\[\].#$\u0000-\u001F\u007F]/,nt=function(t){return'string'==typeof t&&0!==t.length&&!tt.test(t);},rt=function(t){return'string'==typeof t&&0!==t.length&&!et.test(t);},it=function(t){return null===t||'string'==typeof t||'number'==typeof t&&!A(t)||t&&'object'==typeof t&&u.contains(t,'.sv');},ot=function(t,e,n,r,i){i&&void 0===n||st(u.errorPrefix(t,e,i),n,r);},st=function(t,e,n){var r=n instanceof W?new Q(n,t):n;if(void 0===e)throw new Error(t+'contains undefined '+r.toErrorString());if('function'==typeof e)throw new Error(t+'contains a function '+r.toErrorString()+' with contents = '+e.toString());if(A(e))throw new Error(t+'contains '+e.toString()+' '+r.toErrorString());if('string'==typeof e&&e.length>10485760/3&&u.stringLength(e)>10485760)throw new Error(t+'contains a string greater than 10485760 utf8 bytes '+r.toErrorString()+' (\''+e.substring(0,50)+'...\')');if(e&&'object'==typeof e){var i=!1,o=!1;if(F(e,(function(e,n){if('.value'===e)i=!0;else if('.priority'!==e&&'.sv'!==e&&(o=!0,!nt(e)))throw new Error(t+' contains an invalid key ('+e+') '+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),st(t,n,r),r.pop();})),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+' in addition to actual children.');}},at=function(t,e,n,r,i){if(!i||void 0!==n){var o=u.errorPrefix(t,e,i);if(!n||'object'!=typeof n||Array.isArray(n))throw new Error(o+' must be an object containing the children to replace.');var s=[];F(n,(function(t,e){var n=new W(t);if(st(o,e,r.child(n)),'.priority'===n.getBack()&&!it(e))throw new Error(o+'contains an invalid value for \''+n.toString()+'\', which must be a valid Firebase priority (a string, finite number, server value, or null).');s.push(n);})),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if('.priority'===i[o]&&o===i.length-1);else if(!nt(i[o]))throw new Error(t+'contains an invalid key ('+i[o]+') in path '+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(W.comparePaths);var s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&s.contains(r))throw new Error(t+'contains a path '+s.toString()+' that is ancestor of another path '+r.toString());s=r;}}(o,s);}},ut=function(t,e,n,r){if(!r||void 0!==n){if(A(n))throw new Error(u.errorPrefix(t,e,r)+'is '+n.toString()+', but must be a valid Firebase priority (a string, finite number, server value, or null).');if(!it(n))throw new Error(u.errorPrefix(t,e,r)+'must be a valid Firebase priority (a string, finite number, server value, or null).');}},ct=function(t,e,n,r){if(!r||void 0!==n)switch(n){case'value':case'child_added':case'child_removed':case'child_changed':case'child_moved':break;default:throw new Error(u.errorPrefix(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".');}},ht=function(t,e,n,r){if(!(r&&void 0===n||nt(n)))throw new Error(u.errorPrefix(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").');},lt=function(t,e,n,r){if(!(r&&void 0===n||rt(n)))throw new Error(u.errorPrefix(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"');},ft=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,'/')),lt(t,e,n,r);},pt=function(t,e){if('.info'===e.getFront())throw new Error(t+' failed = Can\'t modify data under /.info/');},dt=function(t,e,n){var r=n.path.toString();if('string'!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!nt(n.repoInfo.namespace)&&'localhost'!==n.repoInfo.host.split(':')[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,'/')),rt(t);}(r))throw new Error(u.errorPrefix(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".');},yt=function(t,e,n,r){if((!r||void 0!==n)&&'boolean'!=typeof n)throw new Error(u.errorPrefix(t,e,r)+'must be a boolean.');},vt=function(){function t(t,e){this.repo_=t,this.path_=e;}return t.prototype.cancel=function(t){u.validateArgCount('OnDisconnect.cancel',0,1,arguments.length),u.validateCallback('OnDisconnect.cancel',1,t,!0);var e=new u.Deferred;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise;},t.prototype.remove=function(t){u.validateArgCount('OnDisconnect.remove',0,1,arguments.length),pt('OnDisconnect.remove',this.path_),u.validateCallback('OnDisconnect.remove',1,t,!0);var e=new u.Deferred;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise;},t.prototype.set=function(t,e){u.validateArgCount('OnDisconnect.set',1,2,arguments.length),pt('OnDisconnect.set',this.path_),ot('OnDisconnect.set',1,t,this.path_,!1),u.validateCallback('OnDisconnect.set',2,e,!0);var n=new u.Deferred;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise;},t.prototype.setWithPriority=function(t,e,n){u.validateArgCount('OnDisconnect.setWithPriority',2,3,arguments.length),pt('OnDisconnect.setWithPriority',this.path_),ot('OnDisconnect.setWithPriority',1,t,this.path_,!1),ut('OnDisconnect.setWithPriority',2,e,!1),u.validateCallback('OnDisconnect.setWithPriority',3,n,!0);var r=new u.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise;},t.prototype.update=function(t,e){if(u.validateArgCount('OnDisconnect.update',1,2,arguments.length),pt('OnDisconnect.update',this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[''+r]=t[r];t=n,N('Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.');}at('OnDisconnect.update',1,t,this.path_,!1),u.validateCallback('OnDisconnect.update',2,e,!0);var i=new u.Deferred;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise;},t;}(),gt=function(){function t(t,e){this.committed=t,this.snapshot=e;}return t.prototype.toJSON=function(){return u.validateArgCount('TransactionResult.toJSON',0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()};},t;}(),mt=(H='-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz',K=0,Y=[],function(t){var e,n=t===K;K=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=H.charAt(t%64),t=Math.floor(t/64);u.assert(0===t,'Cannot push at time == 0');var i=r.join('');if(n){for(e=11;e>=0&&63===Y[e];e--)Y[e]=0;Y[e]++;}else for(e=0;e<12;e++)Y[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=H.charAt(Y[e]);return u.assert(20===i.length,'nextPushId: Length should be 20.'),i;}),_t=function(){function t(t,e){this.name=t,this.node=e;}return t.Wrap=function(e,n){return new t(e,n);},t;}(),wt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this);},t.prototype.indexedValueChanged=function(t,e){var n=new _t(x,t),r=new _t(x,e);return 0!==this.compare(n,r);},t.prototype.minPost=function(){return _t.MIN;},t;}(),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return a.__extends(e,t),Object.defineProperty(e,'__EMPTY_NODE',{get:function(){return $;},set:function(t){$=t;},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,e){return D(t.name,e.name);},e.prototype.isDefinedOn=function(t){throw u.assertionError('KeyIndex.isDefinedOn not expected to be called.');},e.prototype.indexedValueChanged=function(t,e){return!1;},e.prototype.minPost=function(){return _t.MIN;},e.prototype.maxPost=function(){return new _t(P,$);},e.prototype.makePost=function(t,e){return u.assert('string'==typeof t,'KeyIndex indexValue must always be a string.'),new _t(t,$);},e.prototype.toString=function(){return'.key';},e;}(wt),Et=new bt;var Ct,It,Tt,St=function(t){return'number'==typeof t?'number:'+M(t):'string:'+t;},Nt=function(t){if(t.isLeafNode()){var e=t.val();u.assert('string'==typeof e||'number'==typeof e||'object'==typeof e&&u.contains(e,'.sv'),'Priority must be a string or number.');}else u.assert(t===X||t.isEmpty(),'priority of unexpected type.');u.assert(t===X||t.getPriority().isEmpty(),'Priority nodes can\'t have a priority of their own.');},At=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,u.assert(void 0!==this.value_&&null!==this.value_,'LeafNode shouldn\'t be created with null/undefined value.'),Nt(this.priorityNode_);}return Object.defineProperty(t,'__childrenNodeConstructor',{get:function(){return Ct;},set:function(t){Ct=t;},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!0;},t.prototype.getPriority=function(){return this.priorityNode_;},t.prototype.updatePriority=function(e){return new t(this.value_,e);},t.prototype.getImmediateChild=function(e){return'.priority'===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE;},t.prototype.getChild=function(e){return e.isEmpty()?this:'.priority'===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE;},t.prototype.hasChild=function(){return!1;},t.prototype.getPredecessorChildName=function(t,e){return null;},t.prototype.updateImmediateChild=function(e,n){return'.priority'===e?this.updatePriority(n):n.isEmpty()&&'.priority'!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_);},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&'.priority'!==r?this:(u.assert('.priority'!==r||1===e.getLength(),'.priority must be the last token in a path'),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)));},t.prototype.isEmpty=function(){return!1;},t.prototype.numChildren=function(){return 0;},t.prototype.forEachChild=function(t,e){return!1;},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{'.value':this.getValue(),'.priority':this.getPriority().val()}:this.getValue();},t.prototype.hash=function(){if(null===this.lazyHash_){var t='';this.priorityNode_.isEmpty()||(t+='priority:'+St(this.priorityNode_.val())+':');var e=typeof this.value_;t+=e+':',t+='number'===e?M(this.value_):this.value_,this.lazyHash_=m(t);}return this.lazyHash_;},t.prototype.getValue=function(){return this.value_;},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(u.assert(e.isLeafNode(),'Unknown node type'),this.compareToLeafNode_(e));},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(n),o=t.VALUE_TYPE_ORDER.indexOf(r);return u.assert(i>=0,'Unknown leaf type: '+n),u.assert(o>=0,'Unknown leaf type: '+r),i===o?'object'===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i;},t.prototype.withIndex=function(){return this;},t.prototype.isIndexed=function(){return!0;},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_);}return!1;},t.VALUE_TYPE_ORDER=['object','boolean','number','string'],t;}();var xt,Pt,Dt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return a.__extends(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?D(t.name,e.name):i;},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty();},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority());},e.prototype.minPost=function(){return _t.MIN;},e.prototype.maxPost=function(){return new _t(P,new At('[PRIORITY-POST]',Tt));},e.prototype.makePost=function(t,e){var n=It(t);return new _t(e,new At('[PRIORITY-POST]',n));},e.prototype.toString=function(){return'.priority';},e;}(wt)),Ot=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break;}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left;}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t;},t.prototype.hasNext=function(){return this.nodeStack_.length>0;},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value};},t;}(),Rt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:Lt.EMPTY_NODE,this.right=null!=o?o:Lt.EMPTY_NODE;}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right);},t.prototype.count=function(){return this.left.count()+1+this.right.count();},t.prototype.isEmpty=function(){return!1;},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t);},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t);},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_();},t.prototype.minKey=function(){return this.min_().key;},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey();},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_();},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Lt.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_();},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Lt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_());}n=n.copy(null,null,null,null,n.right.remove(t,e));}return n.fixUp_();},t.prototype.isRed_=function(){return this.color;},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t;},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t;},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t;},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null);},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e);},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e);},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1;},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error('Red node has red child('+this.key+','+this.value+')');if(this.right.isRed_())throw new Error('Right child of ('+this.key+','+this.value+') is red');var t=this.left.check_();if(t!==this.right.check_())throw new Error('Black depths differ');return t+(this.isRed_()?0:1);},t.RED=!0,t.BLACK=!1,t;}(),kt=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this;},t.prototype.insert=function(t,e,n){return new Rt(t,e,null);},t.prototype.remove=function(t,e){return this;},t.prototype.count=function(){return 0;},t.prototype.isEmpty=function(){return!0;},t.prototype.inorderTraversal=function(t){return!1;},t.prototype.reverseTraversal=function(t){return!1;},t.prototype.minKey=function(){return null;},t.prototype.maxKey=function(){return null;},t.prototype.check_=function(){return 0;},t.prototype.isRed_=function(){return!1;},t;}(),Lt=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n;}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Rt.BLACK,null,null));},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Rt.BLACK,null,null));},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right);}return null;},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key;}e<0?n=n.left:e>0&&(r=n,n=n.right);}throw new Error('Attempted to find predecessor key for a nonexistent key.  What gives?');},t.prototype.isEmpty=function(){return this.root_.isEmpty();},t.prototype.count=function(){return this.root_.count();},t.prototype.minKey=function(){return this.root_.minKey();},t.prototype.maxKey=function(){return this.root_.maxKey();},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t);},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t);},t.prototype.getIterator=function(t){return new Ot(this.root_,null,this.comparator_,!1,t);},t.prototype.getIteratorFrom=function(t,e){return new Ot(this.root_,t,this.comparator_,!1,e);},t.prototype.getReverseIteratorFrom=function(t,e){return new Ot(this.root_,t,this.comparator_,!0,e);},t.prototype.getReverseIterator=function(t){return new Ot(this.root_,null,this.comparator_,!0,t);},t.EMPTY_NODE=new kt,t;}(),Ft=Math.log(2),Mt=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Ft,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join('1'),2));this.bits_=t+1&r;}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t;},t;}(),Ut=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,s,a=r-e;if(0===a)return null;if(1===a)return o=t[e],s=n?n(o):o,new Rt(s,o.node,Rt.BLACK,null,null);var u=parseInt(a/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],s=n?n(o):o,new Rt(s,o.node,Rt.BLACK,c,h);},o=function(e){for(var r=null,o=null,s=t.length,a=function(e,r){var o=s-e,a=s;s-=e;var c=i(o+1,a),h=t[o],l=n?n(h):h;u(new Rt(l,h.node,r,null,c));},u=function(t){r?(r.left=t,r=t):(o=t,r=t);},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?a(l,Rt.BLACK):(a(l,Rt.BLACK),a(l,Rt.RED));}return o;}(new Mt(t.length));return new Lt(r||e,o);},Vt={},jt=function(){function t(t,e){this.indexes_=t,this.indexSet_=e;}return Object.defineProperty(t,'Default',{get:function(){return u.assert(Vt&&Dt,'ChildrenNode.ts has not been loaded'),xt=xt||new t({'.priority':Vt},{'.priority':Dt});},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=u.safeGet(this.indexes_,t);if(!e)throw new Error('No index defined for '+t);return e instanceof Lt?e:null;},t.prototype.hasIndex=function(t){return u.contains(this.indexSet_,t.toString());},t.prototype.addIndex=function(e,n){u.assert(e!==Et,'KeyIndex always exists and isn\'t meant to be added to the IndexMap.');for(var r,i=[],o=!1,s=n.getIterator(_t.Wrap),c=s.getNext();c;)o=o||e.isDefinedOn(c.node),i.push(c),c=s.getNext();r=o?Ut(i,e.getCompare()):Vt;var h=e.toString(),l=a.__assign({},this.indexSet_);l[h]=e;var f=a.__assign({},this.indexes_);return f[h]=r,new t(f,l);},t.prototype.addToIndexes=function(e,n){var r=this;return new t(u.map(this.indexes_,(function(t,i){var o=u.safeGet(r.indexSet_,i);if(u.assert(o,'Missing index implementation for '+i),t===Vt){if(o.isDefinedOn(e.node)){for(var s=[],a=n.getIterator(_t.Wrap),c=a.getNext();c;)c.name!==e.name&&s.push(c),c=a.getNext();return s.push(e),Ut(s,o.getCompare());}return Vt;}var h=n.get(e.name),l=t;return h&&(l=l.remove(new _t(e.name,h))),l.insert(e,e.node);})),this.indexSet_);},t.prototype.removeFromIndexes=function(e,n){return new t(u.map(this.indexes_,(function(t){if(t===Vt)return t;var r=n.get(e.name);return r?t.remove(new _t(e.name,r)):t;})),this.indexSet_);},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function qt(t,e){return D(t.name,e.name);}function Bt(t,e){return D(t,e);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wt=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Nt(this.priorityNode_),this.children_.isEmpty()&&u.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),'An empty node cannot have a priority');}return Object.defineProperty(t,'EMPTY_NODE',{get:function(){return Pt||(Pt=new t(new Lt(Bt),null,jt.Default));},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!1;},t.prototype.getPriority=function(){return this.priorityNode_||Pt;},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_);},t.prototype.getImmediateChild=function(t){if('.priority'===t)return this.getPriority();var e=this.children_.get(t);return null===e?Pt:e;},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront());},t.prototype.hasChild=function(t){return null!==this.children_.get(t);},t.prototype.updateImmediateChild=function(e,n){if(u.assert(n,'We should always be passing snapshot nodes'),'.priority'===e)return this.updatePriority(n);var r=new _t(e,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),o=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?Pt:this.priorityNode_;return new t(i,s,o);},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;u.assert('.priority'!==t.getFront()||1===t.getLength(),'.priority must be the last token in a path');var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r);},t.prototype.isEmpty=function(){return this.children_.isEmpty();},t.prototype.numChildren=function(){return this.children_.count();},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Dt,(function(s,a){n[s]=a.val(e),r++,o&&t.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1;})),!e&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s;}return e&&!this.getPriority().isEmpty()&&(n['.priority']=this.getPriority().val()),n;},t.prototype.hash=function(){if(null===this.lazyHash_){var t='';this.getPriority().isEmpty()||(t+='priority:'+St(this.getPriority().val())+':'),this.forEachChild(Dt,(function(e,n){var r=n.hash();''!==r&&(t+=':'+e+':'+r);})),this.lazyHash_=''===t?'':m(t);}return this.lazyHash_;},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new _t(t,e));return i?i.name:null;}return this.children_.getPredecessorKey(t);},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name;}return this.children_.minKey();},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new _t(e,this.children_.get(e)):null;},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name;}return this.children_.maxKey();},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new _t(e,this.children_.get(e)):null;},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal((function(t){return e(t.name,t.node);})):this.children_.inorderTraversal(e);},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t);},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(function(t){return t;}));for(var r=this.children_.getIteratorFrom(t.name,_t.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r;},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t);},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(function(t){return t;}));for(var r=this.children_.getReverseIteratorFrom(t.name,_t.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r;},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Qt?-1:0;},t.prototype.withIndex=function(e){if(e===Et||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n);},t.prototype.isIndexed=function(t){return t===Et||this.indexMap_.hasIndex(t);},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(Dt),r=e.getIterator(Dt),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext();}return null===i&&null===o;}return!1;}return!1;},t.prototype.resolveIndex_=function(t){return t===Et?null:this.indexMap_.get(t.toString());},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t;}(),Qt=new(function(t){function e(){return t.call(this,new Lt(Bt),Wt.EMPTY_NODE,jt.Default)||this;}return a.__extends(e,t),e.prototype.compareTo=function(t){return t===this?0:1;},e.prototype.equals=function(t){return t===this;},e.prototype.getPriority=function(){return this;},e.prototype.getImmediateChild=function(t){return Wt.EMPTY_NODE;},e.prototype.isEmpty=function(){return!1;},e;}(Wt));Object.defineProperties(_t,{MIN:{value:new _t(x,Wt.EMPTY_NODE)},MAX:{value:new _t(P,Qt)}}),bt.__EMPTY_NODE=Wt.EMPTY_NODE,At.__childrenNodeConstructor=Wt,X=Qt,function(t){Tt=t;}(Qt);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var zt=!0;function Gt(t,e){if(void 0===e&&(e=null),null===t)return Wt.EMPTY_NODE;if('object'==typeof t&&'.priority'in t&&(e=t['.priority']),u.assert(null===e||'string'==typeof e||'number'==typeof e||'object'==typeof e&&'.sv'in e,'Invalid priority type found: '+typeof e),'object'==typeof t&&'.value'in t&&null!==t['.value']&&(t=t['.value']),'object'!=typeof t||'.sv'in t)return new At(t,Gt(e));if(t instanceof Array||!zt){var n=Wt.EMPTY_NODE;return F(t,(function(e,r){if(u.contains(t,e)&&'.'!==e.substring(0,1)){var i=Gt(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i));}})),n.updatePriority(Gt(e));}var r=[],i=!1;if(F(t,(function(t,e){if('.'!==t.substring(0,1)){var n=Gt(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new _t(t,n)));}})),0===r.length)return Wt.EMPTY_NODE;var o=Ut(r,qt,(function(t){return t.name;}),Bt);if(i){var s=Ut(r,Dt.getCompare());return new Wt(o,Gt(e),new jt({'.priority':s},{'.priority':Dt}));}return new Wt(o,Gt(e),jt.Default);}!function(t){It=t;}(Gt);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ht,Kt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return a.__extends(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?D(t.name,e.name):n;},e.prototype.isDefinedOn=function(t){return!0;},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e);},e.prototype.minPost=function(){return _t.MIN;},e.prototype.maxPost=function(){return _t.MAX;},e.prototype.makePost=function(t,e){var n=Gt(t);return new _t(e,n);},e.prototype.toString=function(){return'.value';},e;}(wt)),Yt=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,u.assert(!e.isEmpty()&&'.priority'!==e.getFront(),'Can\'t create PathIndex with empty path or .priority key'),n;}return a.__extends(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_);},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty();},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?D(t.name,e.name):i;},e.prototype.makePost=function(t,e){var n=Gt(t),r=Wt.EMPTY_NODE.updateChild(this.indexPath_,n);return new _t(e,r);},e.prototype.maxPost=function(){var t=Wt.EMPTY_NODE.updateChild(this.indexPath_,Qt);return new _t(P,t);},e.prototype.toString=function(){return this.indexPath_.slice().join('/');},e;}(wt),$t=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n;}return t.prototype.val=function(){return u.validateArgCount('DataSnapshot.val',0,0,arguments.length),this.node_.val();},t.prototype.exportVal=function(){return u.validateArgCount('DataSnapshot.exportVal',0,0,arguments.length),this.node_.val(!0);},t.prototype.toJSON=function(){return u.validateArgCount('DataSnapshot.toJSON',0,1,arguments.length),this.exportVal();},t.prototype.exists=function(){return u.validateArgCount('DataSnapshot.exists',0,0,arguments.length),!this.node_.isEmpty();},t.prototype.child=function(e){u.validateArgCount('DataSnapshot.child',0,1,arguments.length),e=String(e),lt('DataSnapshot.child',1,e,!1);var n=new W(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,Dt);},t.prototype.hasChild=function(t){u.validateArgCount('DataSnapshot.hasChild',1,1,arguments.length),lt('DataSnapshot.hasChild',1,t,!1);var e=new W(t);return!this.node_.getChild(e).isEmpty();},t.prototype.getPriority=function(){return u.validateArgCount('DataSnapshot.getPriority',0,0,arguments.length),this.node_.getPriority().val();},t.prototype.forEach=function(e){var n=this;if(u.validateArgCount('DataSnapshot.forEach',1,1,arguments.length),u.validateCallback('DataSnapshot.forEach',1,e,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return e(new t(i,n.ref_.child(r),Dt));}));},t.prototype.hasChildren=function(){return u.validateArgCount('DataSnapshot.hasChildren',0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty();},Object.defineProperty(t.prototype,'key',{get:function(){return this.ref_.getKey();},enumerable:!1,configurable:!0}),t.prototype.numChildren=function(){return u.validateArgCount('DataSnapshot.numChildren',0,0,arguments.length),this.node_.numChildren();},t.prototype.getRef=function(){return u.validateArgCount('DataSnapshot.ref',0,0,arguments.length),this.ref_;},Object.defineProperty(t.prototype,'ref',{get:function(){return this.getRef();},enumerable:!1,configurable:!0}),t;}(),Xt=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r;}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return'value'===this.eventType?t.path:t.getParent().path;},t.prototype.getEventType=function(){return this.eventType;},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this);},t.prototype.toString=function(){return this.getPath().toString()+':'+this.eventType+':'+u.stringify(this.snapshot.exportVal());},t;}(),Jt=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n;}return t.prototype.getPath=function(){return this.path;},t.prototype.getEventType=function(){return'cancel';},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this);},t.prototype.toString=function(){return this.path.toString()+':cancel';},t;}(),Zt=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n;}return t.prototype.respondsTo=function(t){return'value'===t;},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Xt('value',this,new $t(t.snapshotNode,e.getRef(),n));},t.prototype.getEventRunner=function(t){var e=this.context_;if('cancel'===t.getEventType()){u.assert(this.cancelCallback_,'Raising a cancel event on a listener with no cancel callback');var n=this.cancelCallback_;return function(){n.call(e,t.error);};}var r=this.callback_;return function(){r.call(e,t.snapshot);};},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Jt(this,t,e):null;},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_);},t.prototype.hasAnyCallback=function(){return null!==this.callback_;},t;}(),te=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n;}return t.prototype.respondsTo=function(t){var e='children_added'===t?'child_added':t;return e='children_removed'===e?'child_removed':e,u.contains(this.callbacks_,e);},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Jt(this,t,e):null;},t.prototype.createEvent=function(t,e){u.assert(null!=t.childName,'Child events should have a childName.');var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Xt(t.type,this,new $t(t.snapshotNode,n,r),t.prevName);},t.prototype.getEventRunner=function(t){var e=this.context_;if('cancel'===t.getEventType()){u.assert(this.cancelCallback_,'Raising a cancel event on a listener with no cancel callback');var n=this.cancelCallback_;return function(){n.call(e,t.error);};}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName);};},t.prototype.matches=function(e){var n=this;if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var r=Object.keys(e.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var s=r[0],a=i[0];return!(a!==s||e.callbacks_[s]&&this.callbacks_[a]&&e.callbacks_[s]!==this.callbacks_[a]);}return i.every((function(t){return e.callbacks_[t]===n.callbacks_[t];}));}}}return!1;},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_;},t;}(),ee=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r;}return Object.defineProperty(t,'__referenceConstructor',{get:function(){return u.assert(Ht,'Reference.ts has not been loaded'),Ht;},set:function(t){Ht=t;},enumerable:!1,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Et){var r='Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().',i='Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.';if(t.hasStart()){if(t.getIndexStartName()!==x)throw new Error(r);if('string'!=typeof e)throw new Error(i);}if(t.hasEnd()){if(t.getIndexEndName()!==P)throw new Error(r);if('string'!=typeof n)throw new Error(i);}}else if(t.getIndex()===Dt){if(null!=e&&!it(e)||null!=n&&!it(n))throw new Error('Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).');}else if(u.assert(t.getIndex()instanceof Yt||t.getIndex()===Kt,'unknown index type.'),null!=e&&'object'==typeof e||null!=n&&'object'==typeof n)throw new Error('Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.');},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error('Query: Can\'t combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.');},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+': You can\'t combine multiple orderBy calls.');},t.prototype.getQueryParams=function(){return this.queryParams_;},t.prototype.getRef=function(){return u.validateArgCount('Query.ref',0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path);},t.prototype.on=function(e,n,r,i){u.validateArgCount('Query.on',2,4,arguments.length),ct('Query.on',1,e,!1),u.validateCallback('Query.on',2,n,!1);var o=t.getCancelAndContextArgs_('Query.on',r,i);if('value'===e)this.onValueEvent(n,o.cancel,o.context);else{var s={};s[e]=n,this.onChildEvent(s,o.cancel,o.context);}return n;},t.prototype.onValueEvent=function(t,e,n){var r=new Zt(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r);},t.prototype.onChildEvent=function(t,e,n){var r=new te(t,e,n);this.repo.addEventCallbackForQuery(this,r);},t.prototype.off=function(t,e,n){u.validateArgCount('Query.off',0,3,arguments.length),ct('Query.off',1,t,!0),u.validateCallback('Query.off',2,e,!0),u.validateContextObject('Query.off',3,n,!0);var r=null,i=null;if('value'===t){var o=e||null;r=new Zt(o,null,n||null);}else t&&(e&&((i={})[t]=e),r=new te(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r);},t.prototype.once=function(e,n,r,i){var o=this;u.validateArgCount('Query.once',1,4,arguments.length),ct('Query.once',1,e,!1),u.validateCallback('Query.once',2,n,!0);var s=t.getCancelAndContextArgs_('Query.once',r,i),a=!0,c=new u.Deferred;c.promise.catch((function(){}));var h=function(t){a&&(a=!1,o.off(e,h),n&&n.bind(s.context)(t),c.resolve(t));};return this.on(e,h,(function(t){o.off(e,h),s.cancel&&s.cancel.bind(s.context)(t),c.reject(t);})),c.promise;},t.prototype.limitToFirst=function(e){if(u.validateArgCount('Query.limitToFirst',1,1,arguments.length),'number'!=typeof e||Math.floor(e)!==e||e<=0)throw new Error('Query.limitToFirst: First argument must be a positive integer.');if(this.queryParams_.hasLimit())throw new Error('Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).');return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_);},t.prototype.limitToLast=function(e){if(u.validateArgCount('Query.limitToLast',1,1,arguments.length),'number'!=typeof e||Math.floor(e)!==e||e<=0)throw new Error('Query.limitToLast: First argument must be a positive integer.');if(this.queryParams_.hasLimit())throw new Error('Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).');return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_);},t.prototype.orderByChild=function(e){if(u.validateArgCount('Query.orderByChild',1,1,arguments.length),'$key'===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if('$priority'===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if('$value'===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');lt('Query.orderByChild',1,e,!1),this.validateNoPreviousOrderByCall_('Query.orderByChild');var n=new W(e);if(n.isEmpty())throw new Error('Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.');var r=new Yt(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0);},t.prototype.orderByKey=function(){u.validateArgCount('Query.orderByKey',0,0,arguments.length),this.validateNoPreviousOrderByCall_('Query.orderByKey');var e=this.queryParams_.orderBy(Et);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0);},t.prototype.orderByPriority=function(){u.validateArgCount('Query.orderByPriority',0,0,arguments.length),this.validateNoPreviousOrderByCall_('Query.orderByPriority');var e=this.queryParams_.orderBy(Dt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0);},t.prototype.orderByValue=function(){u.validateArgCount('Query.orderByValue',0,0,arguments.length),this.validateNoPreviousOrderByCall_('Query.orderByValue');var e=this.queryParams_.orderBy(Kt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0);},t.prototype.startAt=function(e,n){void 0===e&&(e=null),u.validateArgCount('Query.startAt',0,2,arguments.length),ot('Query.startAt',1,e,this.path,!0),ht('Query.startAt',2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error('Query.startAt: Starting point was already set (by another call to startAt or equalTo).');return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_);},t.prototype.endAt=function(e,n){void 0===e&&(e=null),u.validateArgCount('Query.endAt',0,2,arguments.length),ot('Query.endAt',1,e,this.path,!0),ht('Query.endAt',2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error('Query.endAt: Ending point was already set (by another call to endAt or equalTo).');return new t(this.repo,this.path,r,this.orderByCalled_);},t.prototype.equalTo=function(t,e){if(u.validateArgCount('Query.equalTo',1,2,arguments.length),ot('Query.equalTo',1,t,this.path,!1),ht('Query.equalTo',2,e,!0),this.queryParams_.hasStart())throw new Error('Query.equalTo: Starting point was already set (by another call to startAt or equalTo).');if(this.queryParams_.hasEnd())throw new Error('Query.equalTo: Ending point was already set (by another call to endAt or equalTo).');return this.startAt(t,e).endAt(t,e);},t.prototype.toString=function(){return u.validateArgCount('Query.toString',0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString();},t.prototype.toJSON=function(){return u.validateArgCount('Query.toJSON',0,1,arguments.length),this.toString();},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject();},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=k(t);return'{}'===e?'default':e;},t.prototype.isEqual=function(e){if(u.validateArgCount('Query.isEqual',1,1,arguments.length),!(e instanceof t)){var n='Query.isEqual failed: First argument must be an instance of firebase.database.Query.';throw new Error(n);}var r=this.repo===e.repo,i=this.path.equals(e.path),o=this.queryIdentifier()===e.queryIdentifier();return r&&i&&o;},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,u.validateCallback(t,3,r.cancel,!0),r.context=n,u.validateContextObject(t,4,r.context,!0);else if(e)if('object'==typeof e&&null!==e)r.context=e;else{if('function'!=typeof e)throw new Error(u.errorPrefix(t,3,!0)+' must either be a cancel callback or a context object.');r.cancel=e;}return r;},Object.defineProperty(t.prototype,'ref',{get:function(){return this.getRef();},enumerable:!1,configurable:!0}),t;}(),ne=function(){function t(t){this.node_=t;}return t.prototype.getImmediateChild=function(e){return new t(this.node_.getImmediateChild(e));},t.prototype.node=function(){return this.node_;},t;}(),re=function(){function t(t,e){this.syncTree_=t,this.path_=e;}return t.prototype.getImmediateChild=function(e){var n=this.path_.child(e);return new t(this.syncTree_,n);},t.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_);},t;}(),ie=function(t,e,n){return t&&'object'==typeof t?(u.assert('.sv'in t,'Unexpected leaf node or priority contents'),'string'==typeof t['.sv']?oe(t['.sv'],e,n):'object'==typeof t['.sv']?se(t['.sv'],e):void u.assert(!1,'Unexpected server value: '+JSON.stringify(t,null,2))):t;},oe=function(t,e,n){switch(t){case'timestamp':return n.timestamp;default:u.assert(!1,'Unexpected server value: '+t);}},se=function(t,e,n){t.hasOwnProperty('increment')||u.assert(!1,'Unexpected server value: '+JSON.stringify(t,null,2));var r=t.increment;'number'!=typeof r&&u.assert(!1,'Unexpected increment value: '+r);var i=e.node();if(u.assert(null!=i,'Expected ChildrenNode.EMPTY_NODE for nulls'),!i.isLeafNode())return r;var o=i.getValue();return'number'!=typeof o?r:o+r;},ae=function(t,e,n,r){return ce(e,new re(n,t),r);},ue=function(t,e,n){return ce(t,new ne(e),n);};function ce(t,e,n){var r,i=t.getPriority().val(),o=ie(i,e.getImmediateChild('.priority'),n);if(t.isLeafNode()){var s=t,a=ie(s.getValue(),e,n);return a!==s.getValue()||o!==s.getPriority().val()?new At(a,Gt(o)):t;}var u=t;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new At(o))),u.forEachChild(Dt,(function(t,i){var o=ce(i,e.getImmediateChild(t),n);o!==i&&(r=r.updateImmediateChild(t,o));})),r;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var he,le=function(){function t(){this.value=null,this.children=new Map;}return t.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&this.children.size>0){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null;}return null;},t.prototype.remember=function(e,n){if(e.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,n);else{var r=e.getFront();this.children.has(r)||this.children.set(r,new t);var i=this.children.get(r);e=e.popFront(),i.remember(e,n);}},t.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Dt,(function(t,e){n.remember(new W(t),e);})),this.forget(t);}if(this.children.size>0){var r=t.getFront();if(t=t.popFront(),this.children.has(r))this.children.get(r).forget(t)&&this.children.delete(r);return 0===this.children.size;}return!0;},t.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,r){var i=new W(t.toString()+'/'+n);r.forEachTree(i,e);}));},t.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e);}));},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.OVERWRITE=0]='OVERWRITE',t[t.MERGE=1]='MERGE',t[t.ACK_USER_WRITE=2]='ACK_USER_WRITE',t[t.LISTEN_COMPLETE=3]='LISTEN_COMPLETE';}(he||(he={}));var fe,pe,de=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,u.assert(!r||e,'Tagged queries must be from server.');}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0);},t;}(),ye=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=he.ACK_USER_WRITE,this.source=de.User;}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return u.assert(this.affectedTree.children.isEmpty(),'affectedTree should not have overlapping affected paths.'),this;var n=this.affectedTree.subtree(new W(e));return new t(W.Empty,n,this.revert);}return u.assert(this.path.getFront()===e,'operationForChild called for unrelated child.'),new t(this.path.popFront(),this.affectedTree,this.revert);},t;}(),ve=function(){return fe||(fe=new Lt(O)),fe;},ge=function(){function t(t,e){void 0===e&&(e=ve()),this.value=t,this.children=e;}return t.fromObject=function(e){var n=t.Empty;return F(e,(function(t,e){n=n.set(new W(t),e);})),n;},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty();},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:W.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new W(n).child(i.path),value:i.value}:null;}return null;},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0;}));},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty;},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o);},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o);}return this;},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null;},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r=e.getFront(),i=(this.children.get(r)||t.Empty).setTree(e.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new t(this.value,o);},t.prototype.fold=function(t){return this.fold_(W.Empty,t);},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(t.child(r),e);})),e(t,this.value,n);},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,W.Empty,e);},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null;},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,W.Empty,e);},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty;},t.prototype.foreach=function(t){this.foreach_(W.Empty,t);},t.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,r){r.foreach_(t.child(n),e);})),this.value&&e(t,this.value);},t.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value);}));},t.Empty=new t(null),t;}(),me=function(){function t(t,e){this.source=t,this.path=e,this.type=he.LISTEN_COMPLETE;}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,W.Empty):new t(this.source,this.path.popFront());},t;}(),_e=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=he.OVERWRITE;}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,W.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap);},t;}(),we=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=he.MERGE;}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new W(e));return n.isEmpty()?null:n.value?new _e(this.source,W.Empty,n.value):new t(this.source,W.Empty,n);}return u.assert(this.path.getFront()===e,'Can\'t get a merge for a child not on the path of the operation'),new t(this.source,this.path.popFront(),this.children);},t.prototype.toString=function(){return'Operation('+this.path+': '+this.source.toString()+' merge: '+this.children.toString()+')';},t;}(),be=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n;}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_;},t.prototype.isFiltered=function(){return this.filtered_;},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e);},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t);},t.prototype.getNode=function(){return this.node_;},t;}(),Ee=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e;}return t.prototype.updateEventSnap=function(e,n,r){return new t(new be(e,n,r),this.serverCache_);},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new be(e,n,r));},t.prototype.getEventCache=function(){return this.eventCache_;},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null;},t.prototype.getServerCache=function(){return this.serverCache_;},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null;},t.Empty=new t(new be(Wt.EMPTY_NODE,!1,!1),new be(Wt.EMPTY_NODE,!1,!1)),t;}(),Ce=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i;}return t.valueChange=function(e){return new t(t.VALUE,e);},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e);},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e);},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r);},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e);},t.CHILD_ADDED='child_added',t.CHILD_REMOVED='child_removed',t.CHILD_CHANGED='child_changed',t.CHILD_MOVED='child_moved',t.VALUE='value',t;}(),Ie=function(){function t(t){this.index_=t;}return t.prototype.updateChild=function(t,e,n,r,i,o){u.assert(t.isIndexed(this.index_),'A node must be indexed if only a child is updated');var s=t.getImmediateChild(e);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(Ce.childRemovedChange(e,s)):u.assert(t.isLeafNode(),'A child remove without an old child only makes sense on a leaf node'):s.isEmpty()?o.trackChildChange(Ce.childAddedChange(e,n)):o.trackChildChange(Ce.childChangedChange(e,n,s))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_));},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Dt,(function(t,r){e.hasChild(t)||n.trackChildChange(Ce.childRemovedChange(t,r));})),e.isLeafNode()||e.forEachChild(Dt,(function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(Ce.childChangedChange(e,r,i));}else n.trackChildChange(Ce.childAddedChange(e,r));}))),e.withIndex(this.index_);},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Wt.EMPTY_NODE:t.updatePriority(e);},t.prototype.filtersNodes=function(){return!1;},t.prototype.getIndexedFilter=function(){return this;},t.prototype.getIndex=function(){return this.index_;},t;}(),Te=function(){function t(){this.changeMap=new Map;}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;u.assert(e===Ce.CHILD_ADDED||e===Ce.CHILD_CHANGED||e===Ce.CHILD_REMOVED,'Only child changes supported for tracking'),u.assert('.priority'!==n,'Only non-priority child changes can be tracked.');var r=this.changeMap.get(n);if(r){var i=r.type;if(e===Ce.CHILD_ADDED&&i===Ce.CHILD_REMOVED)this.changeMap.set(n,Ce.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e===Ce.CHILD_REMOVED&&i===Ce.CHILD_ADDED)this.changeMap.delete(n);else if(e===Ce.CHILD_REMOVED&&i===Ce.CHILD_CHANGED)this.changeMap.set(n,Ce.childRemovedChange(n,r.oldSnap));else if(e===Ce.CHILD_CHANGED&&i===Ce.CHILD_ADDED)this.changeMap.set(n,Ce.childAddedChange(n,t.snapshotNode));else{if(e!==Ce.CHILD_CHANGED||i!==Ce.CHILD_CHANGED)throw u.assertionError('Illegal combination of changes: '+t+' occurred after '+r);this.changeMap.set(n,Ce.childChangedChange(n,t.snapshotNode,r.oldSnap));}}else this.changeMap.set(n,t);},t.prototype.getChanges=function(){return Array.from(this.changeMap.values());},t;}(),Se=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null;},t.prototype.getChildAfterChild=function(t,e,n){return null;},t;}()),Ne=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n;}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new be(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n);},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0];},t;}(),Ae=function(t,e){this.viewCache=t,this.changes=e;},xe=function(){function t(t){this.filter_=t;}return t.prototype.assertIndexed=function(t){u.assert(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),'Event snap not indexed'),u.assert(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),'Server snap not indexed');},t.prototype.applyOperation=function(e,n,r,i){var o,s,a=new Te;if(n.type===he.OVERWRITE){var c=n;c.source.fromUser?o=this.applyUserOverwrite_(e,c.path,c.snap,r,i,a):(u.assert(c.source.fromServer,'Unknown source.'),s=c.source.tagged||e.getServerCache().isFiltered()&&!c.path.isEmpty(),o=this.applyServerOverwrite_(e,c.path,c.snap,r,i,s,a));}else if(n.type===he.MERGE){var h=n;h.source.fromUser?o=this.applyUserMerge_(e,h.path,h.children,r,i,a):(u.assert(h.source.fromServer,'Unknown source.'),s=h.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,h.path,h.children,r,i,s,a));}else if(n.type===he.ACK_USER_WRITE){var l=n;o=l.revert?this.revertUserWrite_(e,l.path,r,i,a):this.ackUserWrite_(e,l.path,l.affectedTree,r,i,a);}else{if(n.type!==he.LISTEN_COMPLETE)throw u.assertionError('Unknown operation type: '+n.type);o=this.listenComplete_(e,n.path,r,a);}var f=a.getChanges();return t.maybeAddValueEvent_(e,o,f),new Ae(o,f);},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Ce.valueChange(e.getCompleteEventSnap()));}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var s=void 0,a=void 0;if(e.isEmpty())if(u.assert(t.getServerCache().isFullyInitialized(),'If change path is empty, we must have complete server data'),t.getServerCache().isFiltered()){var c=t.getCompleteServerSnap(),h=c instanceof Wt?c:Wt.EMPTY_NODE,l=n.calcCompleteEventChildren(h);s=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i);}else{var f=n.calcCompleteEventCache(t.getCompleteServerSnap());s=this.filter_.updateFullNode(t.getEventCache().getNode(),f,i);}else{var p=e.getFront();if('.priority'===p){u.assert(1===e.getLength(),'Can\'t have a priority with additional path components');var d=o.getNode();a=t.getServerCache().getNode();var y=n.calcEventCacheAfterServerOverwrite(e,d,a);s=null!=y?this.filter_.updatePriority(d,y):o.getNode();}else{var v=e.popFront(),g=void 0;if(o.isCompleteForChild(p)){a=t.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),a);g=null!=m?o.getNode().getImmediateChild(p).updateChild(v,m):o.getNode().getImmediateChild(p);}else g=n.calcCompleteChild(p,t.getServerCache());s=null!=g?this.filter_.updateChild(o.getNode(),p,g,v,r,i):o.getNode();}}return t.updateEventSnap(s,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes());},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,s){var a,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())a=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);a=c.updateFullNode(u.getNode(),h,null);}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&e.getLength()>1)return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);a='.priority'===l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,Se,null);}var d=t.updateServerSnap(a,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new Ne(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,s);},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var s,a,u=t.getEventCache(),c=new Ne(r,t,i);if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),s=t.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var h=e.getFront();if('.priority'===h)a=this.filter_.updatePriority(t.getEventCache().getNode(),n),s=t.updateEventSnap(a,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?'.priority'===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Wt.EMPTY_NODE;}if(f.equals(p))s=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);s=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes());}}}return s;},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e);},t.prototype.applyUserMerge_=function(e,n,r,i,o,s){var a=this,u=e;return r.foreach((function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())&&(u=a.applyUserOverwrite_(u,h,c,i,o,s));})),r.foreach((function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())||(u=a.applyUserOverwrite_(u,h,c,i,o,s));})),u;},t.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n);})),t;},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,s){var a=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:ge.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal((function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=a.applyMerge_(u,n);c=a.applyServerOverwrite_(c,new W(e),l,r,i,o,s);}})),u.children.inorderTraversal((function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=a.applyMerge_(l,n);c=a.applyServerOverwrite_(c,new W(e),f,r,i,o,s);}})),c;},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var s=t.getServerCache().isFiltered(),a=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),r,i,s,o);if(e.isEmpty()){var u=ge.Empty;return a.getNode().forEachChild(Et,(function(t,e){u=u.set(new W(t),e);})),this.applyServerMerge_(t,e,u,r,i,s,o);}return t;}var c=ge.Empty;return n.foreach((function(t,n){var r=e.child(t);a.isCompleteForPath(r)&&(c=c.set(t,a.getNode().getChild(r)));})),this.applyServerMerge_(t,e,c,r,i,s,o);},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,Se,r);},t.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var s=new Ne(n,t,r),a=t.getEventCache().getNode(),c=void 0;if(e.isEmpty()||'.priority'===e.getFront()){var h=void 0;if(t.getServerCache().isFullyInitialized())h=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var l=t.getServerCache().getNode();u.assert(l instanceof Wt,'serverChildren would be complete if leaf node'),h=n.calcCompleteEventChildren(l);}h=h,c=this.filter_.updateFullNode(a,h,i);}else{var f=e.getFront(),p=n.calcCompleteChild(f,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(f)&&(p=a.getImmediateChild(f)),(c=null!=p?this.filter_.updateChild(a,f,p,e.popFront(),s,i):t.getEventCache().getNode().hasChild(f)?this.filter_.updateChild(a,f,Wt.EMPTY_NODE,e.popFront(),s,i):a).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(c=this.filter_.updateFullNode(c,o,i));}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(W.Empty),t.updateEventSnap(c,o,this.filter_.filtersNodes());},t;}(),Pe=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex();}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach((function(t){t.type===Ce.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(Ce.childMovedChange(t.childName,t.snapshotNode));})),this.generateEventsForType_(i,Ce.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,Ce.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,Ce.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,Ce.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,Ce.VALUE,t,n,e),i;},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,s=n.filter((function(t){return t.type===e;}));s.sort(this.compareChanges_.bind(this)),s.forEach((function(e){var n=o.materializeSingleChange_(e,i);r.forEach((function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_));}));}));},t.prototype.materializeSingleChange_=function(t,e){return'value'===t.type||'child_removed'===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t);},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw u.assertionError('Should only compare child_ events.');var n=new _t(t.childName,t.snapshotNode),r=new _t(e.childName,e.snapshotNode);return this.index_.compare(n,r);},t;}(),De=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new Ie(n.getIndex()),i=n.getNodeFilter();this.processor_=new xe(i);var o=e.getServerCache(),s=e.getEventCache(),a=r.updateFullNode(Wt.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Wt.EMPTY_NODE,s.getNode(),null),c=new be(a,o.isFullyInitialized(),r.filtersNodes()),h=new be(u,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Ee(h,c),this.eventGenerator_=new Pe(this.query_);}return t.prototype.getQuery=function(){return this.query_;},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode();},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null;},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length;},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t);},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){u.assert(null==t,'A cancel should cancel all event registrations.');var r=this.query_.path;this.eventRegistrations_.forEach((function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i);}));}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break;}}else i.push(s);}this.eventRegistrations_=i;}else this.eventRegistrations_=[];return n;},t.prototype.applyOperation=function(t,e,n){t.type===he.MERGE&&null!==t.source.queryId&&(u.assert(this.viewCache_.getCompleteServerSnap(),'We should always have a full cache before handling merges'),u.assert(this.viewCache_.getCompleteEventSnap(),'Missing event cache, even though we have a server cache'));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),u.assert(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),'Once a server snap is complete, it should never go back'),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null);},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Dt,(function(t,e){n.push(Ce.childAddedChange(t,e));}));return e.isFullyInitialized()&&n.push(Ce.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t);},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r);},t;}(),Oe=function(){function t(){this.views=new Map;}return Object.defineProperty(t,'__referenceConstructor',{get:function(){return u.assert(pe,'Reference.ts has not been loaded'),pe;},set:function(t){u.assert(!pe,'__referenceConstructor has already been defined'),pe=t;},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.views.size;},t.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var s=this.views.get(o);return u.assert(null!=s,'SyncTree gave us an op for an invalid query.'),s.applyOperation(t,e,n);}var c=[];try{for(var h=a.__values(this.views.values()),l=h.next();!l.done;l=h.next()){s=l.value;c=c.concat(s.applyOperation(t,e,n));}}catch(t){r={error:t};}finally{try{l&&!l.done&&(i=h.return)&&i.call(h);}finally{if(r)throw r.error;}}return c;},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),s=this.views.get(o);if(!s){var a=n.calcCompleteEventCache(i?r:null),u=!1;a?u=!0:r instanceof Wt?(a=n.calcCompleteEventChildren(r),u=!1):(a=Wt.EMPTY_NODE,u=!1);var c=new Ee(new be(a,u,!1),new be(r,i,!1));s=new De(t,c),this.views.set(o,s);}return s.addEventRegistration(e),s.getInitialEvents(e);},t.prototype.removeEventRegistration=function(e,n,r){var i,o,s=e.queryIdentifier(),u=[],c=[],h=this.hasCompleteView();if('default'===s)try{for(var l=a.__values(this.views.entries()),f=l.next();!f.done;f=l.next()){var p=a.__read(f.value,2),d=p[0],y=p[1];c=c.concat(y.removeEventRegistration(n,r)),y.isEmpty()&&(this.views.delete(d),y.getQuery().getQueryParams().loadsAllData()||u.push(y.getQuery()));}}catch(t){i={error:t};}finally{try{f&&!f.done&&(o=l.return)&&o.call(l);}finally{if(i)throw i.error;}}else(y=this.views.get(s))&&(c=c.concat(y.removeEventRegistration(n,r)),y.isEmpty()&&(this.views.delete(s),y.getQuery().getQueryParams().loadsAllData()||u.push(y.getQuery())));return h&&!this.hasCompleteView()&&u.push(new t.__referenceConstructor(e.repo,e.path)),{removed:u,events:c};},t.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=a.__values(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o);}}catch(e){t={error:e};}finally{try{i&&!i.done&&(e=r.return)&&e.call(r);}finally{if(t)throw t.error;}}return n;},t.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=a.__values(this.views.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r||s.getCompleteServerCache(t);}}catch(t){e={error:t};}finally{try{o&&!o.done&&(n=i.return)&&n.call(i);}finally{if(e)throw e.error;}}return r;},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e);},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t);},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView();},t.prototype.getCompleteView=function(){var t,e;try{for(var n=a.__values(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i;}}catch(e){t={error:e};}finally{try{r&&!r.done&&(e=n.return)&&e.call(n);}finally{if(t)throw t.error;}}return null;},t;}(),Re=function(){function t(t){this.writeTree_=t;}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new ge(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,s=W.relativePath(i,e);return o=o.updateChild(s,n),new t(this.writeTree_.set(i,o));}var a=new ge(n);return new t(this.writeTree_.setTree(e,a));},t.prototype.addWrites=function(t,e){var n=this;return F(e,(function(e,r){n=n.addWrite(t.child(e),r);})),n;},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,ge.Empty));},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t);},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(W.relativePath(e.path,t)):null;},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Dt,(function(e,n){t.push(new _t(e,n));})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new _t(e,n.value));})),t;},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new ge(n):this.writeTree_.subtree(e));},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty();},t.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal((function(n,o){'.priority'===n?(u.assert(null!==o.value,'Priority writes must always be leaf nodes'),i=o.value):r=t(e.child(n),o,r);})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child('.priority'),i)),r;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(W.Empty,this.writeTree_,t);},t.Empty=new t(new ge(null)),t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ke=function(){function t(){this.visibleWrites_=Re.Empty,this.allWrites_=[],this.lastWriteId_=-1;}return t.prototype.childWrites=function(t){return new Le(t,this);},t.prototype.addOverwrite=function(t,e,n,r){u.assert(n>this.lastWriteId_,'Stacking an older write on top of newer ones'),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n;},t.prototype.addMerge=function(t,e,n){u.assert(n>this.lastWriteId_,'Stacking an older merge on top of newer ones'),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n;},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n;}return null;},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t;}));u.assert(n>=0,'removeWrite called with nonexistent writeId.');var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&s>=0;){var a=this.allWrites_[s];a.visible&&(s>=n&&this.recordContainsPath_(a,r.path)?i=!1:r.path.contains(a.path)&&(o=!0)),s--;}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):F(r.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t));}));return!0;}return!1;},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t);},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(W.Empty)){var s=t.layerTree_(this.allWrites_,(function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path));}),e);c=n||Wt.EMPTY_NODE;return s.apply(c);}return null;}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var u=this.visibleWrites_.childCompoundWrite(e);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(W.Empty)){var c=n||Wt.EMPTY_NODE;return u.apply(c);}return null;},t.prototype.calcCompleteEventChildren=function(t,e){var n=Wt.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Dt,(function(t,e){n=n.updateImmediateChild(t,e);})),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Dt,(function(t,e){var r=i.childCompoundWrite(new W(t)).apply(e);n=n.updateImmediateChild(t,r);})),i.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node);})),n;}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node);})),n;},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){u.assert(n||r,'Either existingEventSnap or existingServerSnap must exist');var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e));},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null;},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t);},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(t),u=a.getCompleteNode(W.Empty);if(null!=u)s=u;else{if(null==e)return[];s=a.apply(e);}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c;},t.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1;},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,W.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1;},t.DefaultFilter_=function(t){return t.visible;},t.layerTree_=function(t,e,n){for(var r=Re.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var s=o.path,a=void 0;if(o.snap)n.contains(s)?(a=W.relativePath(n,s),r=r.addWrite(a,o.snap)):s.contains(n)&&(a=W.relativePath(s,n),r=r.addWrite(W.Empty,o.snap.getChild(a)));else{if(!o.children)throw u.assertionError('WriteRecord should have .snap or .children');if(n.contains(s))a=W.relativePath(n,s),r=r.addWrites(a,o.children);else if(s.contains(n))if((a=W.relativePath(s,n)).isEmpty())r=r.addWrites(W.Empty,o.children);else{var c=u.safeGet(o.children,a.getFront());if(c){var h=c.getChild(a.popFront());r=r.addWrite(W.Empty,h);}}}}}return r;},t;}(),Le=function(){function t(t,e){this.treePath_=t,this.writeTree_=e;}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n);},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t);},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n);},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t));},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i);},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e);},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_);},t;}(),Fe=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=ge.Empty,this.pendingWriteTree_=new ke,this.tagToQueryMap=new Map,this.queryToTagMap=new Map;}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new _e(de.User,t,e)):[];},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=ge.fromObject(e);return this.applyOperationToSyncPoints_(new we(de.User,t,r));},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=ge.Empty;return null!=n.snap?r=r.set(W.Empty,!0):F(n.children,(function(t,e){r=r.set(new W(t),e);})),this.applyOperationToSyncPoints_(new ye(n.path,r,e));}return[];},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new _e(de.Server,t,e));},t.prototype.applyServerMerge=function(t,e){var n=ge.fromObject(e);return this.applyOperationToSyncPoints_(new we(de.Server,t,n));},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new me(de.Server,t));},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=W.relativePath(s,e),c=new _e(de.forServerTaggedQuery(a),u,n);return this.applyTaggedOperation_(s,c);}return[];},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=W.relativePath(s,e),c=ge.fromObject(n),h=new we(de.forServerTaggedQuery(a),u,c);return this.applyTaggedOperation_(s,h);}return[];},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,s=i.queryId,a=W.relativePath(o,e),u=new me(de.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,u);}return[];},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,(function(t,e){var n=W.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView();}));var s,a=this.syncPointTree_.get(r);(a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(W.Empty)):(a=new Oe,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i)?s=!0:(s=!1,i=Wt.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(t,e){var n=e.getCompleteServerCache(W.Empty);n&&(i=i.updateImmediateChild(t,n));})));var c=a.viewExistsForQuery(e);if(!c&&!e.getQueryParams().loadsAllData()){var h=t.makeQueryKey_(e);u.assert(!this.queryToTagMap.has(h),'View does not exist, but we have a tag');var l=t.getNextQueryTag_();this.queryToTagMap.set(h,l),this.tagToQueryMap.set(l,h);}var f=this.pendingWriteTree_.childWrites(r),p=a.addEventRegistration(e,n,f,i,s);if(!c&&!o){var d=a.viewForQuery(e);p=p.concat(this.setupListener_(e,d));}return p;},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,s=this.syncPointTree_.get(o),a=[];if(s&&('default'===e.queryIdentifier()||s.viewExistsForQuery(e))){var u=s.removeEventRegistration(e,n,r);s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;a=u.events;var h=-1!==c.findIndex((function(t){return t.getQueryParams().loadsAllData();})),l=this.syncPointTree_.findOnPath(o,(function(t,e){return e.hasCompleteView();}));if(h&&!l){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var y=p[d],v=y.getQuery(),g=this.createListenerForView_(y);this.listenProvider_.startListening(t.queryForListening_(v),this.tagForQuery_(v),g.hashFn,g.onComplete);}}if(!l&&c.length>0&&!r)if(h){this.listenProvider_.stopListening(t.queryForListening_(e),null);}else c.forEach((function(e){var n=i.queryToTagMap.get(t.makeQueryKey_(e));i.listenProvider_.stopListening(t.queryForListening_(e),n);}));this.removeTags_(c);}return a;},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,(function(e,n){var r=W.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i;}));return n.calcCompleteEventCache(t,r,e,!0);},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),F(n,(function(t,e){r=r.concat(e);})),r;}));},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o);}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t;},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(n),s=this.listenProvider_.startListening(t.queryForListening_(e),i,o.hashFn,o.onComplete),a=this.syncPointTree_.subtree(r);if(i)u.assert(!a.value.hasCompleteView(),'If we\'re adding a query, it shouldn\'t be shadowed');else for(var c=a.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map((function(t){return t.getQuery();})))),F(n,(function(t,e){r=r.concat(e);})),r;})),h=0;h<c.length;++h){var l=c[h];this.listenProvider_.stopListening(t.queryForListening_(l),this.tagForQuery_(l));}return s;},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Wt.EMPTY_NODE).hash();},onComplete:function(t){if('ok'===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n='Unknown Error';'too_big'===t?n='The data requested exceeds the maximum size that can be accessed with a single request.':'permission_denied'===t?n='Client doesn\'t have permission to access the desired data.':'unavailable'===t&&(n='The service is unavailable');var r=new Error(t+' at '+e.path.toString()+': '+n);return r.code=t.toUpperCase(),r;}(t,n);return e.removeEventRegistration(n,null,i);}};},t.makeQueryKey_=function(t){return t.path.toString()+'$'+t.queryIdentifier();},t.parseQueryKey_=function(t){var e=t.indexOf('$');return u.assert(-1!==e&&e<t.length-1,'Bad queryKey.'),{queryId:t.substr(e+1),path:new W(t.substr(0,e))};},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t);},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return this.queryToTagMap.get(n);},t.getNextQueryTag_=function(){return t.nextQueryTag_++;},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);u.assert(n,'Missing sync point for query tag that we\'re tracking');var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null);},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(W.Empty));},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(W.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(W.Empty));var o=[],s=t.path.getFront(),a=t.operationForChild(s),u=e.children.get(s);if(u&&a){var c=n?n.getImmediateChild(s):null,h=r.child(s);o=o.concat(this.applyOperationHelper_(a,u,c,h));}return i&&(o=o.concat(i.applyOperation(t,r,n))),o;},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(W.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(W.Empty));var s=[];return e.children.inorderTraversal((function(e,o){var a=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(s=s.concat(i.applyOperationDescendantsHelper_(c,o,a,u)));})),o&&(s=s.concat(o.applyOperation(t,r,n))),s;},t.nextQueryTag_=1,t;}(),Me=function(){function t(){this.rootNode_=Wt.EMPTY_NODE;}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t);},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e);},t;}(),Ue=function(){function t(){this.counters_={};}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),u.contains(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e;},t.prototype.get=function(){return u.deepCopy(this.counters_);},t;}(),Ve=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Ue),this.collections_[e];},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n];},t.collections_={},t.reporters_={},t;}(),je=function(){function t(t){this.collection_=t,this.last_=null;}return t.prototype.get=function(){var t=this.collection_.get(),e=a.__assign({},t);return this.last_&&F(this.last_,(function(t,n){e[t]=e[t]-n;})),this.last_=t,e;},t;}(),qe=1e4,Be=3e4,We=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new je(t);var n=qe+(Be-qe)*Math.random();B(this.reportStats_.bind(this),Math.floor(n));}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0;},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;F(e,(function(e,i){i>0&&u.contains(t.statsToReport_,e)&&(n[e]=i,r=!0);})),r&&this.server_.reportStats(n),B(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5));},t;}(),Qe=function(){function t(){this.eventLists_=[],this.recursionDepth_=0;}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new ze(i)),e.add(r);}e&&this.eventLists_.push(e);},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t);}));},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e);}));},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1;}e&&(this.eventLists_=[]),this.recursionDepth_--;},t;}(),ze=function(){function t(t){this.path_=t,this.events_=[];}return t.prototype.add=function(t){this.events_.push(t);},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();w&&C('event: '+e.toString()),j(n);}}},t.prototype.getPath=function(){return this.path_;},t;}(),Ge=function(){function t(t){this.allowedEvents_=t,this.listeners_={},u.assert(Array.isArray(t)&&t.length>0,'Requires a non-empty array');}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=a.__spread(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e);},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r);},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1);},t.prototype.validateEventType_=function(t){u.assert(this.allowedEvents_.find((function(e){return e===t;})),'Unknown event: '+t);},t;}(),He=function(t){function e(){var e,n,r=t.call(this,['visible'])||this;return'undefined'!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n='visibilitychange',e='hidden'):void 0!==document.mozHidden?(n='mozvisibilitychange',e='mozHidden'):void 0!==document.msHidden?(n='msvisibilitychange',e='msHidden'):void 0!==document.webkitHidden&&(n='webkitvisibilitychange',e='webkitHidden')),r.visible_=!0,n&&document.addEventListener(n,(function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger('visible',t));}),!1),r;}return a.__extends(e,t),e.getInstance=function(){return new e;},e.prototype.getInitialEvent=function(t){return u.assert('visible'===t,'Unknown event type: '+t),[this.visible_];},e;}(Ge),Ke=function(t){function e(){var e=t.call(this,['online'])||this;return e.online_=!0,'undefined'==typeof window||void 0===window.addEventListener||u.isMobileCordova()||(window.addEventListener('online',(function(){e.online_||(e.online_=!0,e.trigger('online',!0));}),!1),window.addEventListener('offline',(function(){e.online_&&(e.online_=!1,e.trigger('online',!1));}),!1)),e;}return a.__extends(e,t),e.getInstance=function(){return new e;},e.prototype.getInitialEvent=function(t){return u.assert('online'===t,'Unknown event type: '+t),[this.online_];},e.prototype.currentlyOnline=function(){return this.online_;},e;}(Ge),Ye=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null;}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null);},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&j((function(){n.onMessage_(t[e]);}));},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),'break';i.currentResponseNum++;},i=this;this.pendingResponses[this.currentResponseNum];){if('break'===r())break;}},t;}(),$e='pLPCommand',Xe='pRTLPCB',Je=function(){function t(t,e,n,r,i){this.connId=t,this.repoInfo=e,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=I(t),this.stats_=Ve.getCollection(e),this.urlFn=function(t){return e.connectionURL(z,t);};}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Ye(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_('Timed out trying to connect.'),n.onClosed_(),n.connectTimeoutTimer_=null;}),Math.floor(3e4)),function(t){if(u.isNodeSdk()||'complete'===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10));};document.addEventListener?(document.addEventListener('DOMContentLoaded',n,!1),window.addEventListener('load',n,!1)):document.attachEvent&&(document.attachEvent('onreadystatechange',(function(){'complete'===document.readyState&&n();})),window.attachEvent('onload',n));}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Ze((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=a.__read(t,5),i=r[0],o=r[1],s=r[2];r[3],r[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,'start'===i)n.id=o,n.password=s;else{if('close'!==i)throw new Error('Unrecognized command received: '+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_();}))):n.onClosed_();}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=a.__read(t,2),i=r[0],o=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o);}),(function(){n.onClosed_();}),n.urlFn);var t={start:'t'};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v='5',n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),n.applicationId&&(t.p=n.applicationId),'undefined'!=typeof location&&location.href&&-1!==location.href.indexOf('firebaseio.com')&&(t.r='f');var e=n.urlFn(t);n.log_('Connecting via long-poll to '+e),n.scriptTagHolder.addTag(e,(function(){}));}}));},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password);},t.forceAllow=function(){t.forceAllow_=!0;},t.forceDisallow=function(){t.forceDisallow_=!0;},t.isAvailable=function(){return!u.isNodeSdk()&&(!!t.forceAllow_||!(t.forceDisallow_||'undefined'==typeof document||null==document.createElement||'object'==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||'object'==typeof Windows&&'object'==typeof Windows.UI));},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null);},t.prototype.onClosed_=function(){this.isClosed_||(this.log_('Longpoll is closing itself'),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null));},t.prototype.close=function(){this.isClosed_||(this.log_('Longpoll is being closed.'),this.shutdown_());},t.prototype.send=function(t){var e=u.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter('bytes_sent',e.length);for(var n=u.base64Encode(e),r=L(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++;},t.prototype.addDisconnectPingFrame=function(t,e){if(!u.isNodeSdk()){this.myDisconnFrame=document.createElement('iframe');var n={dframe:'t'};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display='none',document.body.appendChild(this.myDisconnFrame);}},t.prototype.incrementIncomingBytes_=function(t){var e=u.stringify(t).length;this.bytesReceived+=e,this.stats_.incrementCounter('bytes_received',e);},t;}(),Ze=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,u.isNodeSdk())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=g(),window[$e+this.uniqueCallbackIdentifier]=e,window[Xe+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var o='';if(this.myIFrame.src&&'javascript:'===this.myIFrame.src.substr(0,'javascript:'.length))o='<script>document.domain="'+document.domain+'";<\/script>';var s='<html><body>'+o+'</body></html>';try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close();}catch(t){C('frame writing exception'),t.stack&&C(t.stack),C(t);}}}return t.createIFrame_=function(){var t=document.createElement('iframe');if(t.style.display='none',!document.body)throw'Document body has not initialized. Wait to initialize Firebase until after the document is ready.';document.body.appendChild(t);try{t.contentWindow.document||C('No IE domain setting required');}catch(n){var e=document.domain;t.src='javascript:void((function(){document.open();document.domain=\''+e+'\';document.close();})())';}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t;},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML='',setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null);}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e());},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n='',r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+'&seg'+r+'='+i.seg+'&ts'+r+'='+i.ts+'&d'+r+'='+i.d,r++;}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0;}return!1;},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_();},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_();},i=setTimeout(r,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(i),r();}));},t.prototype.addTag=function(t,e){var n=this;u.isNodeSdk()?this.doNodeLongPoll(t,e):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement('script');r.type='text/javascript',r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&'loaded'!==t&&'complete'!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e());},r.onerror=function(){C('Long-poll script failed to load: '+t),n.sendNewPolls=!1,n.close();},n.myIFrame.doc.body.appendChild(r);}catch(t){}}),Math.floor(1));},t;}(),tn='';
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var en=null;'undefined'!=typeof MozWebSocket?en=MozWebSocket:'undefined'!=typeof WebSocket&&(en=WebSocket);var nn=function(){function t(e,n,r,i,o){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=I(this.connId),this.stats_=Ve.getCollection(n),this.connURL=t.connectionURL_(n,i,o);}return t.connectionURL_=function(t,e,n){var r={v:'5'};return!u.isNodeSdk()&&'undefined'!=typeof location&&location.href&&-1!==location.href.indexOf('firebaseio.com')&&(r.r='f'),e&&(r.s=e),n&&(r.ls=n),t.connectionURL('websocket',r);},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_('Websocket connecting to '+this.connURL),this.everConnected_=!1,d.set('previous_websocket_failure',!0);try{if(u.isNodeSdk()){var i=u.CONSTANTS.NODE_ADMIN?'AdminNode':'Node',o={headers:{'User-Agent':'Firebase/5/'+tn+'/'+r.platform+'/'+i,'X-Firebase-GMPID':this.applicationId||''}},s=r.env,a=0===this.connURL.indexOf('wss://')?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;a&&(o.proxy={origin:a}),this.mySock=new en(this.connURL,[],o);}else{o={headers:{'X-Firebase-GMPID':this.applicationId||''}};this.mySock=new en(this.connURL,[],o);}}catch(t){this.log_('Error instantiating WebSocket.');var c=t.message||t.data;return c&&this.log_(c),void this.onClosed_();}this.mySock.onopen=function(){n.log_('Websocket connected.'),n.everConnected_=!0;},this.mySock.onclose=function(){n.log_('Websocket connection was disconnected.'),n.mySock=null,n.onClosed_();},this.mySock.onmessage=function(t){n.handleIncomingFrame(t);},this.mySock.onerror=function(t){n.log_('WebSocket error.  Closing connection.');var e=t.message||t.data;e&&n.log_(e),n.onClosed_();};},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0;},t.isAvailable=function(){var e=!1;if('undefined'!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0);}return!e&&null!==en&&!t.forceDisallow_;},t.previouslyFailed=function(){return d.isInMemoryStorage||!0===d.get('previous_websocket_failure');},t.prototype.markConnectionHealthy=function(){d.remove('previous_websocket_failure');},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join('');this.frames=null;var n=u.jsonEval(e);this.onMessage(n);}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[];},t.prototype.extractFrameCount_=function(t){if(u.assert(null===this.frames,'We already have a frame buffer'),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null;}return this.handleNewFrameCount_(1),t;},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter('bytes_received',e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n);}}},t.prototype.send=function(t){this.resetKeepAlive();var e=u.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter('bytes_sent',e.length);var n=L(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r]);},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null);},t.prototype.onClosed_=function(){this.isClosed_||(this.log_('WebSocket is closing itself'),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null));},t.prototype.close=function(){this.isClosed_||(this.log_('WebSocket is being closed'),this.shutdown_());},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_('0'),t.resetKeepAlive();}),Math.floor(45e3));},t.prototype.sendString_=function(t){try{this.mySock.send(t);}catch(t){this.log_('Exception thrown from WebSocket.send():',t.message||t.data,'Closing connection.'),setTimeout(this.onClosed_.bind(this),0);}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t;}(),rn=function(){function t(t){this.initTransports_(t);}return Object.defineProperty(t,'ALL_TRANSPORTS',{get:function(){return[Je,nn];},enumerable:!1,configurable:!0}),t.prototype.initTransports_=function(e){var n,r,i=nn&&nn.isAvailable(),o=i&&!nn.previouslyFailed();if(e.webSocketOnly&&(i||N('wss:// URL used, but browser isn\'t known to support websockets.  Trying anyway.'),o=!0),o)this.transports_=[nn];else{var s=this.transports_=[];try{for(var u=a.__values(t.ALL_TRANSPORTS),c=u.next();!c.done;c=u.next()){var h=c.value;h&&h.isAvailable()&&s.push(h);}}catch(t){n={error:t};}finally{try{c&&!c.done&&(r=u.return)&&r.call(u);}finally{if(n)throw n.error;}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error('No transports available');},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null;},t;}(),on=function(){function t(t,e,n,r,i,o,s,a){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=s,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=I('c:'+this.id+':'),this.transportManager_=new rn(e),this.log_('Connection created'),this.start_();}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,r);}),Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=B((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_('Connection exceeded healthy timeout but has received '+t.conn_.bytesReceived+' bytes.  Marking connection healthy.'),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_('Connection exceeded healthy timeout but has sent '+t.conn_.bytesSent+' bytes.  Leaving connection alive.'):(t.log_('Closing unhealthy connection after timeout.'),t.close()));}),Math.floor(i)));},t.prototype.nextTransportId_=function(){return'c:'+this.id+':'+this.connectionCount++;},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_('Secondary connection lost.'),e.onSecondaryConnectionLost_()):e.log_('closing an old connection');};},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_('message on old connection'));};},t.prototype.sendRequest=function(t){var e={t:'d',d:t};this.sendData_(e);},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_('cleaning up and promoting a connection: '+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null);},t.prototype.onSecondaryControl_=function(t){if('t'in t){var e=t.t;'a'===e?this.upgradeIfSecondaryHealthy_():'r'===e?(this.log_('Got a reset on secondary, closing it'),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):'o'===e&&(this.log_('got pong on secondary.'),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_());}},t.prototype.onSecondaryMessageReceived_=function(t){var e=R('t',t),n=R('d',t);if('c'===e)this.onSecondaryControl_(n);else{if('d'!==e)throw new Error('Unknown protocol layer: '+e);this.pendingDataMessages.push(n);}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_('Secondary connection is healthy.'),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_('sending ping on secondary.'),this.secondaryConn_.send({t:'c',d:{t:'p',d:{}}}));},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_('sending client ack on secondary'),this.secondaryConn_.send({t:'c',d:{t:'a',d:{}}}),this.log_('Ending transmission on primary'),this.conn_.send({t:'c',d:{t:'n',d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection();},t.prototype.onPrimaryMessageReceived_=function(t){var e=R('t',t),n=R('d',t);'c'===e?this.onControl_(n):'d'===e&&this.onDataMessage_(n);},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t);},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_('Primary connection is healthy.'),this.isHealthy_=!0,this.conn_.markConnectionHealthy()));},t.prototype.onControl_=function(t){var e=R('t',t);if('d'in t){var n=t.d;if('h'===e)this.onHandshake_(n);else if('n'===e){this.log_('recvd end transmission on primary'),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection();}else's'===e?this.onConnectionShutdown_(n):'r'===e?this.onReset_(n):'e'===e?T('Server Error: '+n):'o'===e?(this.log_('got pong on primary.'),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):T('Unknown control packet command: '+e);}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),'5'!==n&&N('Protocol version mismatch detected'),this.tryStartUpgrade_());},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t);},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),B((function(){e.secondaryConn_&&(e.log_('Timed out trying to upgrade.'),e.secondaryConn_.close());}),Math.floor(6e4));},t.prototype.onReset_=function(t){this.log_('Reset packet received.  New host: '+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_());},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_('Realtime connection established.'),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_('Primary connection is healthy.'),this.isHealthy_=!0):B((function(){n.sendPingOnPrimaryIfNecessary_();}),Math.floor(5e3));},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_('sending ping on primary.'),this.sendData_({t:'c',d:{t:'p',d:{}}}));},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close();},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_('Realtime connection lost.'):(this.log_('Realtime connection failed.'),this.repoInfo_.isCacheableHost()&&(d.remove('host:'+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close();},t.prototype.onConnectionShutdown_=function(t){this.log_('Connection shutdown command received. Shutting down...'),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close();},t.prototype.sendData_=function(t){if(1!==this.state_)throw'Connection is not connected';this.tx_.send(t);},t.prototype.close=function(){2!==this.state_&&(this.log_('Closing realtime connection.'),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null));},t.prototype.closeConnections_=function(){this.log_('Shutting down all connections'),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null);},t;}(),sn=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t;}(),an=1e3,un=3e5,cn=function(t){function e(n,r,i,o,s,a,c){var h=t.call(this)||this;if(h.repoInfo_=n,h.applicationId_=r,h.onDataUpdate_=i,h.onConnectStatus_=o,h.onServerInfoUpdate_=s,h.authTokenProvider_=a,h.authOverride_=c,h.id=e.nextPersistentConnectionId_++,h.log_=I('p:'+h.id+':'),h.interruptReasons_={},h.listens=new Map,h.outstandingPuts_=[],h.outstandingPutCount_=0,h.onDisconnectRequestQueue_=[],h.connected_=!1,h.reconnectDelay_=an,h.maxReconnectDelay_=un,h.securityDebugCallback_=null,h.lastSessionId=null,h.establishConnectionTimer_=null,h.visible_=!1,h.requestCBHash_={},h.requestNumber_=0,h.realtime_=null,h.authToken_=null,h.forceTokenRefresh_=!1,h.invalidAuthTokenCount_=0,h.firstConnection_=!0,h.lastConnectionAttemptTime_=null,h.lastConnectionEstablishedTime_=null,c&&!u.isNodeSdk())throw new Error('Auth override specified in options, but not supported on non Node.js platforms');return h.scheduleConnect_(0),He.getInstance().on('visible',h.onVisible_,h),-1===n.host.indexOf('fblocal')&&Ke.getInstance().on('online',h.onOnline_,h),h;}return a.__extends(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(u.stringify(i)),u.assert(this.connected_,'sendRequest call when we\'re not connected not allowed.'),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n);},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_('Listen called for '+o+' '+i),this.listens.has(o)||this.listens.set(o,new Map),u.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),'listen() called for non-default but complete query'),u.assert(!this.listens.get(o).has(i),'listen() called twice for same path/queryId.');var s={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s);},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier();this.log_('Listen on '+i+' for '+o);var s={p:i};t.tag&&(s.q=r.queryObject(),s.t=t.tag),s.h=t.hashFn(),this.sendRequest('q',s,(function(s){var a=s.d,u=s.s;e.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===t&&(n.log_('listen response',s),'ok'!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,a));}));},e.warnOnListenWarnings_=function(t,e){if(t&&'object'==typeof t&&u.contains(t,'w')){var n=u.safeGet(t,'w');if(Array.isArray(n)&&~n.indexOf('no_index')){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();N('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding '+r+' at '+i+' to your security rules for better performance.');}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_('Auth token refreshed'),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest('unauth',{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t);},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||u.isAdmin(t))&&(this.log_('Admin auth credential detected.  Reducing max reconnect time.'),this.maxReconnectDelay_=3e4);},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=u.isValidFormat(e)?'auth':'gauth',r={cred:e};null===this.authOverride_?r.noauth=!0:'object'==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||'error';t.authToken_===e&&('ok'===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i));}));}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_('Unlisten called for '+n+' '+r),u.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),'unlisten() called for non-default but complete query'),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e);},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_('Unlisten on '+t+' for '+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest('n',i);},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_('o',t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:'o',data:e,onComplete:n});},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_('om',t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:'om',data:e,onComplete:n});},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_('oc',t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:'oc',data:null,onComplete:e});},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_('onDisconnect '+t,i),this.sendRequest(t,i,(function(t){r&&setTimeout((function(){r(t.s,t.d);}),Math.floor(0));}));},e.prototype.put=function(t,e,n,r){this.putInternal('p',t,e,n,r);},e.prototype.merge=function(t,e,n,r){this.putInternal('m',t,e,n,r);},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_('Buffering put: '+e);},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,(function(r){e.log_(n+' response',r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d);}));},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_('reportStats',n),this.sendRequest('s',n,(function(t){if('ok'!==t.s){var n=t.d;e.log_('reportStats','Error sending stats: '+n);}}));}},e.prototype.onDataMessage_=function(t){if('r'in t){this.log_('from server: '+u.stringify(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b));}else{if('error'in t)throw'A server-side error has occurred: '+t.error;'a'in t&&this.onDataPush_(t.a,t.b);}},e.prototype.onDataPush_=function(t,e){this.log_('handleServerMessage',t,e),'d'===t?this.onDataUpdate_(e.p,e.d,!1,e.t):'m'===t?this.onDataUpdate_(e.p,e.d,!0,e.t):'c'===t?this.onListenRevoked_(e.p,e.q):'ac'===t?this.onAuthRevoked_(e.s,e.d):'sd'===t?this.onSecurityDebugPacket_(e):T('Unrecognized action received from server: '+u.stringify(t)+'\nAre you using the latest client?');},e.prototype.onReady_=function(t,e){this.log_('connection ready'),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0);},e.prototype.scheduleConnect_=function(t){var e=this;u.assert(!this.realtime_,'Scheduling a connect when we\'re already connected/ing?'),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_();}),Math.floor(t));},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_('Window became visible.  Reducing delay.'),this.reconnectDelay_=an,this.realtime_||this.scheduleConnect_(0)),this.visible_=t;},e.prototype.onOnline_=function(t){t?(this.log_('Browser went online.'),this.reconnectDelay_=an,this.realtime_||this.scheduleConnect_(0)):(this.log_('Browser went offline.  Killing connection.'),this.realtime_&&this.realtime_.close());},e.prototype.onRealtimeDisconnect_=function(){if(this.log_('data client disconnected'),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=an),this.lastConnectionEstablishedTime_=null;}}else this.log_('Window isn\'t visible.  Delaying reconnect.'),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_('Trying to reconnect in '+e+'ms'),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_);}this.onConnectStatus_(!1);},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_('Making a connection attempt'),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+':'+e.nextConnectionId_++,o=this,s=this.lastSessionId,a=!1,c=null,h=function(){c?c.close():(a=!0,r());};this.realtime_={close:h,sendRequest:function(t){u.assert(c,'sendRequest call when we\'re not connected not allowed.'),c.sendRequest(t);}};var l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(l).then((function(e){a?C('getToken() completed but was canceled'):(C('getToken() completed. Creating connection.'),o.authToken_=e&&e.accessToken,c=new on(i,o.repoInfo_,o.applicationId_,t,n,r,(function(t){N(t+' ('+o.repoInfo_.toString()+')'),o.interrupt('server_kill');}),s));})).then(null,(function(t){o.log_('Failed to get token: '+t),a||(u.CONSTANTS.NODE_ADMIN&&N(t),h());}));}},e.prototype.interrupt=function(t){C('Interrupting connection for reason: '+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_());},e.prototype.resume=function(t){C('Resuming connection for reason: '+t),delete this.interruptReasons_[t],u.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=an,this.realtime_||this.scheduleConnect_(0));},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e});},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&'h'in e.request&&e.queued&&(e.onComplete&&e.onComplete('disconnect'),delete this.outstandingPuts_[t],this.outstandingPutCount_--);}0===this.outstandingPutCount_&&(this.outstandingPuts_=[]);},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map((function(t){return k(t);})).join('$'):'default';var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete('permission_denied');},e.prototype.removeListen_=function(t,e){var n,r=new W(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r);}else n=void 0;return n;},e.prototype.onAuthRevoked_=function(t,e){C('Auth token revoked: '+t+'/'+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),'invalid_token'!==t&&'permission_denied'!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()));},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):'msg'in t&&console.log('FIREBASE: '+t.msg.replace('\n','\nFIREBASE: '));},e.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var i=a.__values(this.listens.values()),o=i.next();!o.done;o=i.next()){var s=o.value;try{for(var u=(n=void 0,a.__values(s.values())),c=u.next();!c.done;c=u.next()){var h=c.value;this.sendListen_(h);}}catch(t){n={error:t};}finally{try{c&&!c.done&&(r=u.return)&&r.call(u);}finally{if(n)throw n.error;}}}}catch(e){t={error:e};}finally{try{o&&!o.done&&(e=i.return)&&e.call(i);}finally{if(t)throw t.error;}}for(var l=0;l<this.outstandingPuts_.length;l++)this.outstandingPuts_[l]&&this.sendPut_(l);for(;this.onDisconnectRequestQueue_.length;){var f=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(f.action,f.pathString,f.data,f.onComplete);}},e.prototype.sendConnectStats_=function(){var t={},e='js';u.CONSTANTS.NODE_ADMIN?e='admin_node':u.CONSTANTS.NODE_CLIENT&&(e='node'),t['sdk.'+e+'.'+tn.replace(/\./g,'-')]=1,u.isMobileCordova()?t['framework.cordova']=1:u.isReactNative()&&(t['framework.reactnative']=1),this.reportStats(t);},e.prototype.shouldReconnect_=function(){var t=Ke.getInstance().currentlyOnline();return u.isEmpty(this.interruptReasons_)&&t;},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e;}(sn),hn=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=I('p:rest:'),i.listens_={},i;}return a.__extends(e,t),e.prototype.reportStats=function(t){throw new Error('Method not implemented.');},e.getListenId_=function(t,e){return void 0!==e?'tag$'+e:(u.assert(t.getQueryParams().isDefault(),'should have a tag if it\'s not a default query.'),t.path.toString());},e.prototype.listen=function(t,n,r,i){var o=this,s=t.path.toString();this.log_('Listen called for '+s+' '+t.queryIdentifier());var a=e.getListenId_(t,r),c={};this.listens_[a]=c;var h=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+'.json',h,(function(t,e){var n=e;(404===t&&(n=null,t=null),null===t&&o.onDataUpdate_(s,n,!1,r),u.safeGet(o.listens_,a)===c)&&i(t?401===t?'permission_denied':'rest_error:'+t:'ok',null);}));},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r];},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format='export',this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(e.auth=o);var s=(r.repoInfo_.secure?'https://':'http://')+r.repoInfo_.host+t+'?ns='+r.repoInfo_.namespace+u.querystring(e);r.log_('Sending REST request for '+s);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(n&&4===a.readyState){r.log_('REST Response for '+s+' received. status:',a.status,'response:',a.responseText);var t=null;if(a.status>=200&&a.status<300){try{t=u.jsonEval(a.responseText);}catch(t){N('Failed to parse JSON response for '+s+': '+a.responseText);}n(null,t);}else 401!==a.status&&404!==a.status&&N('Got unsuccessful REST response for '+s+' Status: '+a.status),n(a.status);n=null;}},a.open('GET',s,!0),a.send();}));},e;}(sn),ln=function(){function t(t,e,n,r){var i=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Qe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new le,this.persistentConnection_=null,this.stats_=Ve.getCollection(t),e||q())this.server_=new hn(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(null!=o){if('object'!=typeof o)throw new Error('Only objects are supported for option databaseAuthVariableOverride');try{u.stringify(o);}catch(t){throw new Error('Invalid authOverride provided: '+t);}}this.persistentConnection_=new cn(this.repoInfo_,n.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,o),this.server_=this.persistentConnection_;}r.addTokenChangeListener((function(t){i.server_.refreshAuthToken(t);})),this.statsReporter_=Ve.getOrCreateReporter(t,(function(){return new We(i.stats_,i.server_);})),this.transactionsInit_(),this.infoData_=new Me,this.infoSyncTree_=new Fe({startListening:function(t,e,n,r){var o=[],s=i.infoData_.getNode(t.path);return s.isEmpty()||(o=i.infoSyncTree_.applyServerOverwrite(t.path,s),setTimeout((function(){r('ok');}),0)),o;},stopListening:function(){}}),this.updateInfo_('connected',!1),this.serverSyncTree_=new Fe({startListening:function(t,e,n,r){return i.server_.listen(t,n,e,(function(e,n){var o=r(e,n);i.eventQueue_.raiseEventsForChangedPath(t.path,o);})),[];},stopListening:function(t,e){i.server_.unlisten(t,e);}});}return t.prototype.toString=function(){return(this.repoInfo_.secure?'https://':'http://')+this.repoInfo_.host;},t.prototype.name=function(){return this.repoInfo_.namespace;},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new W('.info/serverTimeOffset')).val()||0;return(new Date).getTime()+t;},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t;},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new W(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var s=u.map(e,(function(t){return Gt(t);}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r);}else{var a=Gt(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,a,r);}else if(n){var c=u.map(e,(function(t){return Gt(t);}));o=this.serverSyncTree_.applyServerMerge(i,c);}else{var h=Gt(e);o=this.serverSyncTree_.applyServerOverwrite(i,h);}var l=i;o.length>0&&(l=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(l,o);},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t;},t.prototype.onConnectStatus_=function(t){this.updateInfo_('connected',t),!1===t&&this.runOnDisconnectEvents_();},t.prototype.onServerInfoUpdate_=function(t){var e=this;F(t,(function(t,n){e.updateInfo_(t,n);}));},t.prototype.updateInfo_=function(t,e){var n=new W('/.info/'+t),r=Gt(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i);},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++;},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_('set',{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),s=Gt(e,n),a=this.serverSyncTree_.calcCompleteEventCache(t),u=ue(s,a,o),c=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserOverwrite(t,u,c,!0);this.eventQueue_.queueEvents(h),this.server_.put(t.toString(),s.val(!0),(function(e,n){var o='ok'===e;o||N('set at '+t+' failed: '+e);var s=i.serverSyncTree_.ackUserWrite(c,!o);i.eventQueue_.raiseEventsForChangedPath(t,s),i.callOnCompleteCallback(r,e,n);}));var l=this.abortTransactions_(t);this.rerunTransactions_(l),this.eventQueue_.raiseEventsForChangedPath(l,[]);},t.prototype.update=function(t,e,n){var r=this;this.log_('update',{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),s={};if(F(e,(function(e,n){i=!1,s[e]=ae(t.child(e),Gt(n),r.serverSyncTree_,o);})),i)C('update() called with empty data.  Don\'t do anything.'),this.callOnCompleteCallback(n,'ok');else{var a=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,s,a);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,(function(e,i){var o='ok'===e;o||N('update at '+t+' failed: '+e);var s=r.serverSyncTree_.ackUserWrite(a,!o),u=s.length>0?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,s),r.callOnCompleteCallback(n,e,i);})),F(e,(function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n);})),this.eventQueue_.raiseEventsForChangedPath(t,[]);}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_('onDisconnectEvents');var e=this.generateServerValues(),n=new le;this.onDisconnect_.forEachTree(W.Empty,(function(r,i){var o=ae(r,i,t.serverSyncTree_,e);n.remember(r,o);}));var r=[];n.forEachTree(W.Empty,(function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i);})),this.onDisconnect_=new le,this.eventQueue_.raiseEventsForChangedPath(W.Empty,r);},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),(function(r,i){'ok'===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i);}));},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Gt(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),(function(e,o){'ok'===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o);}));},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Gt(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,n){'ok'===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n);}));},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(u.isEmpty(e))return C('onDisconnect().update() called with empty data.  Don\'t do anything.'),void this.callOnCompleteCallback(n,'ok');this.server_.onDisconnectMerge(t.toString(),e,(function(i,o){'ok'===i&&F(e,(function(e,n){var i=Gt(n);r.onDisconnect_.remember(t.child(e),i);})),r.callOnCompleteCallback(n,i,o);}));},t.prototype.addEventCallbackForQuery=function(t,e){var n;n='.info'===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n);},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n='.info'===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n);},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt('repo_interrupt');},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume('repo_interrupt');},t.prototype.stats=function(t){if(void 0===t&&(t=!1),'undefined'!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new je(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t);}),0);F(e,(function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=' ';console.log(r+e);}));}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t);},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n='';this.persistentConnection_&&(n=this.persistentConnection_.id+':'),C.apply(void 0,a.__spread([n],t));},t.prototype.callOnCompleteCallback=function(t,e,n){t&&j((function(){if('ok'===e)t(null);else{var r=(e||'error').toUpperCase(),i=r;n&&(i+=': '+n);var o=new Error(i);o.code=r,t(o);}}));},Object.defineProperty(t.prototype,'database',{get:function(){return this.__database||(this.__database=new Cn(this));},enumerable:!1,configurable:!0}),t;}(),fn=function(){function t(e){this.indexedFilter_=new Ie(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e);}return t.prototype.getStartPost=function(){return this.startPost_;},t.prototype.getEndPost=function(){return this.endPost_;},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0;},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new _t(e,n))||(n=Wt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o);},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Wt.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Wt.EMPTY_NODE);var i=this;return e.forEachChild(Dt,(function(t,e){i.matches(new _t(t,e))||(r=r.updateImmediateChild(t,Wt.EMPTY_NODE));})),this.indexedFilter_.updateFullNode(t,r,n);},t.prototype.updatePriority=function(t,e){return t;},t.prototype.filtersNodes=function(){return!0;},t.prototype.getIndexedFilter=function(){return this.indexedFilter_;},t.prototype.getIndex=function(){return this.index_;},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e);}return t.getIndex().minPost();},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e);}return t.getIndex().maxPost();},t;}(),pn=function(){function t(t){this.rangedFilter_=new fn(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft();}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new _t(e,n))||(n=Wt.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o);},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Wt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Wt.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++;}}else{r=(r=e.withIndex(this.index_)).updatePriority(Wt.EMPTY_NODE);var a=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t);};}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();){s=i.getNext();!l&&c(a,s)<=0&&(l=!0),l&&o<this.limit_&&c(s,u)<=0?o++:r=r.updateImmediateChild(s.name,Wt.EMPTY_NODE);}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n);},t.prototype.updatePriority=function(t,e){return t;},t.prototype.filtersNodes=function(){return!0;},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter();},t.prototype.getIndex=function(){return this.index_;},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(t,e){return s(e,t);};}else o=this.index_.getCompare();var a=t;u.assert(a.numChildren()===this.limit_,'');var c=new _t(e,n),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(a.hasChild(e)){for(var f=a.getImmediateChild(e),p=r.getChildAfterChild(this.index_,h,this.reverse_);null!=p&&(p.name===e||a.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:o(p,c);if(l&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(Ce.childChangedChange(e,n,f)),a.updateImmediateChild(e,n);null!=i&&i.trackChildChange(Ce.childRemovedChange(e,f));var y=a.updateImmediateChild(e,Wt.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(Ce.childAddedChange(p.name,p.node)),y.updateImmediateChild(p.name,p.node)):y;}return n.isEmpty()?t:l&&o(h,c)>=0?(null!=i&&(i.trackChildChange(Ce.childRemovedChange(h.name,h.node)),i.trackChildChange(Ce.childAddedChange(e,n))),a.updateImmediateChild(e,n).updateImmediateChild(h.name,Wt.EMPTY_NODE)):t;},t;}(),dn=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_='',this.indexStartValue_=null,this.indexStartName_='',this.indexEndValue_=null,this.indexEndName_='',this.index_=Dt;}return t.prototype.hasStart=function(){return this.startSet_;},t.prototype.isViewFromLeft=function(){return''===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;},t.prototype.getIndexStartValue=function(){return u.assert(this.startSet_,'Only valid if start has been set'),this.indexStartValue_;},t.prototype.getIndexStartName=function(){return u.assert(this.startSet_,'Only valid if start has been set'),this.startNameSet_?this.indexStartName_:x;},t.prototype.hasEnd=function(){return this.endSet_;},t.prototype.getIndexEndValue=function(){return u.assert(this.endSet_,'Only valid if end has been set'),this.indexEndValue_;},t.prototype.getIndexEndName=function(){return u.assert(this.endSet_,'Only valid if end has been set'),this.endNameSet_?this.indexEndName_:P;},t.prototype.hasLimit=function(){return this.limitSet_;},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&''!==this.viewFrom_;},t.prototype.getLimit=function(){return u.assert(this.limitSet_,'Only valid if limit has been set'),this.limit_;},t.prototype.getIndex=function(){return this.index_;},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e;},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_='',e;},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n;},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n;},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=''),n;},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=''),n;},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e;},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;''===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r;}return this.index_!==Dt&&(n[e.INDEX]=this.index_.toString()),n;},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_);},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Dt;},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new Ie(this.getIndex()):this.hasLimit()?new pn(this):new fn(this);},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===Dt?e=n.PRIORITY_INDEX:this.index_===Kt?e=n.VALUE_INDEX:this.index_===Et?e=n.KEY_INDEX:(u.assert(this.index_ instanceof Yt,'Unrecognized index type!'),e=this.index_.toString()),r[n.ORDER_BY]=u.stringify(e),this.startSet_&&(r[n.START_AT]=u.stringify(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=','+u.stringify(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=u.stringify(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=','+u.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r);},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:'sp',INDEX_START_NAME:'sn',INDEX_END_VALUE:'ep',INDEX_END_NAME:'en',LIMIT:'l',VIEW_FROM:'vf',VIEW_FROM_LEFT:'l',VIEW_FROM_RIGHT:'r',INDEX:'i'},t.REST_QUERY_CONSTANTS_={ORDER_BY:'orderBy',PRIORITY_INDEX:'$priority',VALUE_INDEX:'$value',KEY_INDEX:'$key',START_AT:'startAt',END_AT:'endAt',LIMIT_TO_FIRST:'limitToFirst',LIMIT_TO_LAST:'limitToLast'},t.DEFAULT=new t,t;}(),yn=function(t){function e(e,n){if(!(e instanceof ln))throw new Error('new Reference() no longer supported - use app.database().');return t.call(this,e,n,dn.DEFAULT,!1)||this;}return a.__extends(e,t),e.prototype.getKey=function(){return u.validateArgCount('Reference.key',0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack();},e.prototype.child=function(t){return u.validateArgCount('Reference.child',1,1,arguments.length),'number'==typeof t?t=String(t):t instanceof W||(null===this.path.getFront()?ft('Reference.child',1,t,!1):lt('Reference.child',1,t,!1)),new e(this.repo,this.path.child(t));},e.prototype.getParent=function(){u.validateArgCount('Reference.parent',0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t);},e.prototype.getRoot=function(){u.validateArgCount('Reference.root',0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t;},e.prototype.databaseProp=function(){return this.repo.database;},e.prototype.set=function(t,e){u.validateArgCount('Reference.set',1,2,arguments.length),pt('Reference.set',this.path),ot('Reference.set',1,t,this.path,!1),u.validateCallback('Reference.set',2,e,!0);var n=new u.Deferred;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise;},e.prototype.update=function(t,e){if(u.validateArgCount('Reference.update',1,2,arguments.length),pt('Reference.update',this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[''+r]=t[r];t=n,N('Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.');}at('Reference.update',1,t,this.path,!1),u.validateCallback('Reference.update',2,e,!0);var i=new u.Deferred;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise;},e.prototype.setWithPriority=function(t,e,n){if(u.validateArgCount('Reference.setWithPriority',2,3,arguments.length),pt('Reference.setWithPriority',this.path),ot('Reference.setWithPriority',1,t,this.path,!1),ut('Reference.setWithPriority',2,e,!1),u.validateCallback('Reference.setWithPriority',3,n,!0),'.length'===this.getKey()||'.keys'===this.getKey())throw'Reference.setWithPriority failed: '+this.getKey()+' is a read-only object.';var r=new u.Deferred;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise;},e.prototype.remove=function(t){return u.validateArgCount('Reference.remove',0,1,arguments.length),pt('Reference.remove',this.path),u.validateCallback('Reference.remove',1,t,!0),this.set(null,t);},e.prototype.transaction=function(t,e,n){if(u.validateArgCount('Reference.transaction',1,3,arguments.length),pt('Reference.transaction',this.path),u.validateCallback('Reference.transaction',1,t,!1),u.validateCallback('Reference.transaction',2,e,!0),yt('Reference.transaction',3,n,!0),'.length'===this.getKey()||'.keys'===this.getKey())throw'Reference.transaction failed: '+this.getKey()+' is a read-only object.';void 0===n&&(n=!0);var r=new u.Deferred;'function'==typeof e&&r.promise.catch((function(){}));var i=function(t,n,i){t?r.reject(t):r.resolve(new gt(n,i)),'function'==typeof e&&e(t,n,i);};return this.repo.startTransaction(this.path,t,i,n),r.promise;},e.prototype.setPriority=function(t,e){u.validateArgCount('Reference.setPriority',1,2,arguments.length),pt('Reference.setPriority',this.path),ut('Reference.setPriority',1,t,!1),u.validateCallback('Reference.setPriority',2,e,!0);var n=new u.Deferred;return this.repo.setWithPriority(this.path.child('.priority'),t,null,n.wrapCallback(e)),n.promise;},e.prototype.push=function(t,e){u.validateArgCount('Reference.push',0,2,arguments.length),pt('Reference.push',this.path),ot('Reference.push',1,t,this.path,!0),u.validateCallback('Reference.push',2,e,!0);var n,r=this.repo.serverTime(),i=mt(r),o=this.child(i),s=this.child(i);return n=null!=t?o.set(t,e).then((function(){return s;})):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),'function'==typeof e&&n.catch((function(){})),o;},e.prototype.onDisconnect=function(){return pt('Reference.onDisconnect',this.path),new vt(this.repo,this.path);},Object.defineProperty(e.prototype,'database',{get:function(){return this.databaseProp();},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,'key',{get:function(){return this.getKey();},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,'parent',{get:function(){return this.getParent();},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,'root',{get:function(){return this.getRoot();},enumerable:!1,configurable:!0}),e;}(ee);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ee.__referenceConstructor=yn,Oe.__referenceConstructor=yn;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var vn,gn=function(){this.children={},this.childCount=0,this.value=null;},mn=function(){function t(t,e,n){void 0===t&&(t=''),void 0===e&&(e=null),void 0===n&&(n=new gn),this.name_=t,this.parent_=e,this.node_=n;}return t.prototype.subTree=function(e){for(var n=e instanceof W?e:new W(e),r=this,i=n.getFront();null!==i;){r=new t(i,r,u.safeGet(r.node_.children,i)||new gn),i=(n=n.popFront()).getFront();}return r;},t.prototype.getValue=function(){return this.node_.value;},t.prototype.setValue=function(t){u.assert(void 0!==t,'Cannot set value to undefined'),this.node_.value=t,this.updateParents_();},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_();},t.prototype.hasChildren=function(){return this.node_.childCount>0;},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren();},t.prototype.forEachChild=function(e){var n=this;F(this.node_.children,(function(r,i){e(new t(r,n,i));}));},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n);})),e&&n&&t(this);},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent();}return!1;},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t);}));},t.prototype.path=function(){return new W(null===this.parent_?this.name_:this.parent_.path()+'/'+this.name_);},t.prototype.name=function(){return this.name_;},t.prototype.parent=function(){return this.parent_;},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this);},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=u.contains(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_());},t;}();!function(t){t[t.RUN=0]='RUN',t[t.SENT=1]='SENT',t[t.COMPLETED=2]='COMPLETED',t[t.SENT_NEEDS_ABORT=3]='SENT_NEEDS_ABORT',t[t.NEEDS_ABORT=4]='NEEDS_ABORT';}(vn||(vn={})),ln.MAX_TRANSACTION_RETRIES_=25,ln.prototype.transactionsInit_=function(){this.transactionQueueTree_=new mn;},ln.prototype.startTransaction=function(t,e,n,r){this.log_('transaction on '+t);var i=function(){},o=new yn(this,t);o.on('value',i);var s={path:t,update:e,onComplete:n,status:null,order:g(),applyLocally:r,retryCount:0,unwatcher:function(){o.off('value',i);},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=this.getLatestState_(t);s.currentInputSnapshot=a;var c=s.update(a.val());if(void 0===c){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var h=new $t(s.currentInputSnapshot,new yn(this,s.path),Dt);s.onComplete(null,!1,h);}}else{st('transaction failed: Data returned ',c,s.path),s.status=vn.RUN;var l=this.transactionQueueTree_.subTree(t),f=l.getValue()||[];f.push(s),l.setValue(f);var p=void 0;if('object'==typeof c&&null!==c&&u.contains(c,'.priority'))p=u.safeGet(c,'.priority'),u.assert(it(p),'Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.');else p=(this.serverSyncTree_.calcCompleteEventCache(t)||Wt.EMPTY_NODE).getPriority().val();p=p;var d=this.generateServerValues(),y=Gt(c,p),v=ue(y,a,d);s.currentOutputSnapshotRaw=y,s.currentOutputSnapshotResolved=v,s.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,v,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_();}},ln.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Wt.EMPTY_NODE;},ln.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);u.assert(n.length>0,'Sending zero length transaction queue'),n.every((function(t){return t.status===vn.RUN;}))&&this.sendTransactionQueue_(t.path(),n);}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t);}));},ln.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map((function(t){return t.currentWriteId;})),i=this.getLatestState_(t,r),o=i,s=i.hash(),a=0;a<e.length;a++){var c=e[a];u.assert(c.status===vn.RUN,'tryToSendTransactionQueue_: items in queue should all be run.'),c.status=vn.SENT,c.retryCount++;var h=W.relativePath(t,c.path);o=o.updateChild(h,c.currentOutputSnapshotRaw);}var l=o.val(!0),f=t;this.server_.put(f.toString(),l,(function(r){n.log_('transaction put response',{path:f.toString(),status:r});var i=[];if('ok'===r){for(var o=[],s=0;s<e.length;s++){if(e[s].status=vn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[s].currentWriteId)),e[s].onComplete){var a=e[s].currentOutputSnapshotResolved,u=new yn(n,e[s].path),c=new $t(a,u,Dt);o.push(e[s].onComplete.bind(null,null,!0,c));}e[s].unwatcher();}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i);for(s=0;s<o.length;s++)j(o[s]);}else{if('datastale'===r)for(s=0;s<e.length;s++)e[s].status===vn.SENT_NEEDS_ABORT?e[s].status=vn.NEEDS_ABORT:e[s].status=vn.RUN;else{N('transaction at '+f.toString()+' failed: '+r);for(s=0;s<e.length;s++)e[s].status=vn.NEEDS_ABORT,e[s].abortReason=r;}n.rerunTransactions_(t);}}),s);},ln.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n;},ln.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter((function(t){return t.status===vn.RUN;})).map((function(t){return t.currentWriteId;})),s=0;s<t.length;s++){var a=t[s],c=W.relativePath(e,a.path),h=!1,l=void 0;if(u.assert(null!==c,'rerunTransactionsUnderNode_: relativePath should not be null.'),a.status===vn.NEEDS_ABORT)h=!0,l=a.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===vn.RUN)if(a.retryCount>=ln.MAX_TRANSACTION_RETRIES_)h=!0,l='maxretry',i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var f=this.getLatestState_(a.path,o);a.currentInputSnapshot=f;var p=t[s].update(f.val());if(void 0!==p){st('transaction failed: Data returned ',p,a.path);var d=Gt(p);'object'==typeof p&&null!=p&&u.contains(p,'.priority')||(d=d.updatePriority(f.getPriority()));var y=a.currentWriteId,v=this.generateServerValues(),g=ue(d,f,v);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=g,a.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(y),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(a.path,g,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(y,!0));}else h=!0,l='nodata',i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],h&&(t[s].status=vn.COMPLETED,n=t[s].unwatcher,setTimeout(n,Math.floor(0)),t[s].onComplete))if('nodata'===l){var m=new yn(this,t[s].path),_=t[s].currentInputSnapshot,w=new $t(_,m,Dt);r.push(t[s].onComplete.bind(null,null,!1,w));}else r.push(t[s].onComplete.bind(null,new Error(l),!1,null));}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<r.length;s++)j(r[s]);this.sendReadyTransactions_();}},ln.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n;},ln.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order;})),e;},ln.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e);}));},ln.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==vn.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(n.length>0?n:null);}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t);}));},ln.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor((function(t){e.abortTransactionsOnNode_(t);})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(t){e.abortTransactionsOnNode_(t);})),n;},ln.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===vn.SENT_NEEDS_ABORT);else if(e[o].status===vn.SENT)u.assert(i===o-1,'All SENT items should be at beginning of queue.'),i=o,e[o].status=vn.SENT_NEEDS_ABORT,e[o].abortReason='set';else if(u.assert(e[o].status===vn.RUN,'Unexpected transaction status in abort'),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error('set'),!1,null));}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)j(n[o]);}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _n,wn=function(){function t(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return n.auth_=t;}));}return t.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&'auth/token-not-initialized'===t.code?(C('Got auth/token-not-initialized error.  Treating as null token.'),null):Promise.reject(t);})):Promise.resolve(null);},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null);}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t);})));},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t);}));},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';'credential'in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'serviceAccount'in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',N(t);},t;}(),bn=function(){function t(){}return t.prototype.getToken=function(e){return Promise.resolve({accessToken:t.EMULATOR_AUTH_TOKEN});},t.prototype.addTokenChangeListener=function(e){e(t.EMULATOR_AUTH_TOKEN);},t.prototype.removeTokenChangeListener=function(t){},t.prototype.notifyForInvalidToken=function(){},t.EMULATOR_AUTH_TOKEN='owner',t;}(),En=function(){function t(){this.repos_={},this.useRestClient_=!1;}return t.getInstance=function(){return _n||(_n=new t),_n;},t.prototype.interrupt=function(){var t,e,n,r;try{for(var i=a.__values(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var s=o.value;try{for(var u=(n=void 0,a.__values(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next()){var h=c.value;this.repos_[s][h].interrupt();}}catch(t){n={error:t};}finally{try{c&&!c.done&&(r=u.return)&&r.call(u);}finally{if(n)throw n.error;}}}}catch(e){t={error:e};}finally{try{o&&!o.done&&(e=i.return)&&e.call(i);}finally{if(t)throw t.error;}}},t.prototype.resume=function(){var t,e,n,r;try{for(var i=a.__values(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var s=o.value;try{for(var u=(n=void 0,a.__values(Object.keys(this.repos_[s]))),c=u.next();!c.done;c=u.next()){var h=c.value;this.repos_[s][h].resume();}}catch(t){n={error:t};}finally{try{c&&!c.done&&(r=u.return)&&r.call(u);}finally{if(n)throw n.error;}}}}catch(e){t={error:e};}finally{try{o&&!o.done&&(e=i.return)&&e.call(i);}finally{if(t)throw t.error;}}},t.prototype.databaseFromApp=function(t,e,n){var i=n||t.options.databaseURL;void 0===i&&S('Can\'t determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().');var o,s=J(i),a=s.repoInfo,c=void 0;void 0!==r&&(c=r.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(o=!0,i='http://'+c+'?ns='+a.namespace,a=(s=J(i)).repoInfo):o=!s.repoInfo.secure;var h=u.CONSTANTS.NODE_ADMIN&&o?new bn:new wn(t,e);return dt('Invalid Firebase Database URL',1,s),s.path.isEmpty()||S('Database URL must point to the root of a Firebase Database (not including a child path).'),this.createRepo(a,t,h).database;},t.prototype.deleteRepo=function(t){var e=u.safeGet(this.repos_,t.app.name);e&&u.safeGet(e,t.repoInfo_.toURLString())===t||S('Database '+t.app.name+'('+t.repoInfo_+') has already been deleted.'),t.interrupt(),delete e[t.repoInfo_.toURLString()];},t.prototype.createRepo=function(t,e,n){var r=u.safeGet(this.repos_,e.name);r||(r={},this.repos_[e.name]=r);var i=u.safeGet(r,t.toURLString());return i&&S('Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.'),i=new ln(t,this.useRestClient_,e,n),r[t.toURLString()]=i,i;},t.prototype.forceRestClient=function(t){this.useRestClient_=t;},t;}(),Cn=function(){function t(t){this.repo_=t,t instanceof ln||S('Don\'t call new Database() directly - please use firebase.database().'),this.root_=new yn(t,W.Empty),this.INTERNAL=new In(this);}return Object.defineProperty(t.prototype,'app',{get:function(){return this.repo_.app;},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_('ref'),u.validateArgCount('database.ref',0,1,arguments.length),t instanceof yn?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_;},t.prototype.refFromURL=function(t){var e='database.refFromURL';this.checkDeleted_(e),u.validateArgCount(e,1,1,arguments.length);var n=J(t);dt(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&S(e+': Host name does not match the current database: (found '+r.host+' but expected '+this.repo_.repoInfo_.host+')'),this.ref(n.path.toString());},t.prototype.checkDeleted_=function(t){null===this.repo_&&S('Cannot call '+t+' on a deleted database.');},t.prototype.goOffline=function(){u.validateArgCount('database.goOffline',0,0,arguments.length),this.checkDeleted_('goOffline'),this.repo_.interrupt();},t.prototype.goOnline=function(){u.validateArgCount('database.goOnline',0,0,arguments.length),this.checkDeleted_('goOnline'),this.repo_.resume();},t.ServerValue={TIMESTAMP:{'.sv':'timestamp'},increment:function(t){return{'.sv':{increment:t}};}},t;}(),In=function(){function t(t){this.database=t;}return t.prototype.delete=function(){return a.__awaiter(this,void 0,void 0,(function(){return a.__generator(this,(function(t){return this.database.checkDeleted_('delete'),En.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2];}));}));},t;}(),Tn=Object.freeze({__proto__:null,forceLongPolling:function(){nn.forceDisallow(),Je.forceAllow();},forceWebSockets:function(){Je.forceDisallow();},isWebSocketsAvailable:function(){return nn.isAvailable();},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e;},stats:function(t,e){t.repo.stats(e);},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e);},dataUpdateCount:function(t){return t.repo.dataUpdateCount;},interceptServerData:function(t,e){return t.repo.interceptServerData_(e);}}),Sn=cn;cn.prototype.simpleListen=function(t,e){this.sendRequest('q',{p:t},e);},cn.prototype.echo=function(t,e){this.sendRequest('echo',{d:t},e);};var Nn=on,An=G,xn=Object.freeze({__proto__:null,DataConnection:Sn,RealTimeConnection:Nn,hijackHash:function(t){var e=cn.prototype.put;return cn.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o);},function(){cn.prototype.put=e;};},ConnectionTarget:An,queryIdentifier:function(t){return t.queryIdentifier();},forceRestClient:function(t){En.getInstance().forceRestClient(t);}}),Pn='@firebase/database',Dn='0.6.8',On=Cn.ServerValue;function Rn(e){!function(t){tn=t;}(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new h.Component('database',(function(t,e){var n=t.getProvider('app').getImmediate(),r=t.getProvider('auth-internal');return En.getInstance().databaseFromApp(n,r,e);}),'PUBLIC').setServiceProps({Reference:yn,Query:ee,Database:Cn,DataSnapshot:$t,enableLogging:E,INTERNAL:Tn,ServerValue:On,TEST_ACCESS:xn}).setMultipleInstances(!0));e.registerVersion(Pn,Dn),u.isNodeSdk()&&(t.exports=n);}Rn(s),e.DataSnapshot=$t,e.Database=Cn,e.OnDisconnect=vt,e.Query=ee,e.Reference=yn,e.ServerValue=On,e.enableLogging=E,e.registerDatabase=Rn;}).call(this,n(7));},function(t,e,n){'use strict';(function(t){Object.defineProperty(e,'__esModule',{value:!0});var r,i=n(0),o=(r=n(4))&&'object'==typeof r&&'default'in r?r.default:r,s=n(6),a=n(3),u=n(12),c=n(5),h=o.SDK_VERSION,l=new s.Logger('@firebase/firestore');function f(){return l.logLevel;}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=s.LogLevel.DEBUG){var r=e.map(y);l.debug.apply(l,i.__spreadArrays(['Firestore ('+h+'): '+t],r));}}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=s.LogLevel.ERROR){var r=e.map(y);l.error.apply(l,i.__spreadArrays(['Firestore ('+h+'): '+t],r));}}function y(t){if('string'==typeof t)return t;try{return e=t,JSON.stringify(e);}catch(e){return t;}var e;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v(t){void 0===t&&(t='Unexpected state');var e='FIRESTORE ('+h+') INTERNAL ASSERTION FAILED: '+t;throw d(e),new Error(e);}function g(t,e){t||v();}function m(t,e){return t;}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _(t){var e='undefined'!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var w=function(){function t(){}return t.t=function(){for(var t='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',e=Math.floor(256/t.length)*t.length,n='';n.length<20;)for(var r=_(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n;},t;}();function b(t,e){return t<e?-1:t>e?1:0;}function E(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r]);}));}function C(t){return t+'\0';}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var I=function(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i;},T=function(){function t(t,e){this.projectId=t,this.database=e||'(default)';}return Object.defineProperty(t.prototype,'i',{get:function(){return'(default)'===this.database;},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database;},t.prototype.o=function(t){return b(this.projectId,t.projectId)||b(this.database,t.database);},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e;}function N(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n]);}function A(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var x=function(){function t(t,e){this.h=t,this.u=e,this.l={};}return t.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.u(s,t))return a;}},t.prototype.has=function(t){return void 0!==this.get(t);},t.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e]);}else this.l[n]=[[t,e]];},t.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1;},t.prototype.forEach=function(t){N(this.l,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a);}}));},t.prototype._=function(){return A(this.l);},t;}(),P={OK:'ok',CANCELLED:'cancelled',UNKNOWN:'unknown',INVALID_ARGUMENT:'invalid-argument',DEADLINE_EXCEEDED:'deadline-exceeded',NOT_FOUND:'not-found',ALREADY_EXISTS:'already-exists',PERMISSION_DENIED:'permission-denied',UNAUTHENTICATED:'unauthenticated',RESOURCE_EXHAUSTED:'resource-exhausted',FAILED_PRECONDITION:'failed-precondition',ABORTED:'aborted',OUT_OF_RANGE:'out-of-range',UNIMPLEMENTED:'unimplemented',INTERNAL:'internal',UNAVAILABLE:'unavailable',DATA_LOSS:'data-loss'},D=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name='FirebaseError',r.toString=function(){return r.name+': [code='+r.code+']: '+r.message;},r;}return i.__extends(e,t),e;}(Error),O=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new D(P.INVALID_ARGUMENT,'Timestamp nanoseconds out of range: '+e);if(e>=1e9)throw new D(P.INVALID_ARGUMENT,'Timestamp nanoseconds out of range: '+e);if(t<-62135596800)throw new D(P.INVALID_ARGUMENT,'Timestamp seconds out of range: '+t);if(t>=253402300800)throw new D(P.INVALID_ARGUMENT,'Timestamp seconds out of range: '+t);}return t.now=function(){return t.fromMillis(Date.now());},t.fromDate=function(e){return t.fromMillis(e.getTime());},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n));},t.prototype.toDate=function(){return new Date(this.toMillis());},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6;},t.prototype.T=function(t){return this.seconds===t.seconds?b(this.nanoseconds,t.nanoseconds):b(this.seconds,t.seconds);},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds;},t.prototype.toString=function(){return'Timestamp(seconds='+this.seconds+', nanoseconds='+this.nanoseconds+')';},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,'0')+'.'+String(this.nanoseconds).padStart(9,'0');},t;}(),R=function(){function t(t){this.timestamp=t;}return t.I=function(e){return new t(e);},t.min=function(){return new t(new O(0,0));},t.prototype.o=function(t){return this.timestamp.T(t.timestamp);},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp);},t.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3;},t.prototype.toString=function(){return'SnapshotVersion('+this.timestamp.toString()+')';},t.prototype.A=function(){return this.timestamp;},t;}(),k=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&v(),void 0===n?n=t.length-e:n>t.length-e&&v(),this.segments=t,this.offset=e,this.R=n;}return Object.defineProperty(t.prototype,'length',{get:function(){return this.R;},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.P(this,e);},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t);})):n.push(e),this.V(n);},t.prototype.limit=function(){return this.offset+this.length;},t.prototype.g=function(t){return t=void 0===t?1:t,this.V(this.segments,this.offset+t,this.length-t);},t.prototype.p=function(){return this.V(this.segments,this.offset,this.length-1);},t.prototype.v=function(){return this.segments[this.offset];},t.prototype.S=function(){return this.get(this.length-1);},t.prototype.get=function(t){return this.segments[this.offset+t];},t.prototype._=function(){return 0===this.length;},t.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0;},t.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0;},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e]);},t.prototype.F=function(){return this.segments.slice(this.offset,this.limit());},t.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1;}return t.length<e.length?-1:t.length>e.length?1:0;},t;}(),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return i.__extends(e,t),e.prototype.V=function(t,n,r){return new e(t,n,r);},e.prototype.N=function(){return this.F().join('/');},e.prototype.toString=function(){return this.N();},e.$=function(t){if(t.indexOf('//')>=0)throw new D(P.INVALID_ARGUMENT,'Invalid path ('+t+'). Paths must not contain // in them.');return new e(t.split('/').filter((function(t){return t.length>0;})));},e.k=function(){return new e([]);},e;}(k),F=/^[_a-zA-Z][_a-zA-Z0-9]*$/,M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return i.__extends(e,t),e.prototype.V=function(t,n,r){return new e(t,n,r);},e.M=function(t){return F.test(t);},e.prototype.N=function(){return this.F().map((function(t){return t=t.replace('\\','\\\\').replace('`','\\`'),e.M(t)||(t='`'+t+'`'),t;})).join('.');},e.prototype.toString=function(){return this.N();},e.prototype.O=function(){return 1===this.length&&'__name__'===this.get(0);},e.L=function(){return new e(['__name__']);},e.B=function(t){for(var n=[],r='',i=0,o=function(){if(0===r.length)throw new D(P.INVALID_ARGUMENT,'Invalid field path ('+t+'). Paths must not be empty, begin with \'.\', end with \'.\', or contain \'..\'');n.push(r),r='';},s=!1;i<t.length;){var a=t[i];if('\\'===a){if(i+1===t.length)throw new D(P.INVALID_ARGUMENT,'Path has trailing escape character: '+t);var u=t[i+1];if('\\'!==u&&'.'!==u&&'`'!==u)throw new D(P.INVALID_ARGUMENT,'Path has invalid escape sequence: '+t);r+=u,i+=2;}else'`'===a?(s=!s,i++):'.'!==a||s?(r+=a,i++):(o(),i++);}if(o(),s)throw new D(P.INVALID_ARGUMENT,'Unterminated ` in path: '+t);return new e(n);},e.k=function(){return new e([]);},e;}(k),U=function(){function t(t){this.path=t;}return t.q=function(e){return new t(L.$(e).g(5));},t.prototype.U=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t;},t.prototype.isEqual=function(t){return null!==t&&0===L.P(this.path,t.path);},t.prototype.toString=function(){return this.path.toString();},t.P=function(t,e){return L.P(t.path,e.path);},t.W=function(t){return t.length%2==0;},t.j=function(e){return new t(new L(e.slice()));},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V(t){return null==t;}function j(t){return-0===t&&1/t==-1/0;}function q(t){return'number'==typeof t&&Number.isInteger(t)&&!j(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER;}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var B=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null;};function W(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new B(t,e,n,r,i,o,s);}function Q(t){var e=m(t);if(null===e.K){var n=e.path.N();null!==e.collectionGroup&&(n+='|cg:'+e.collectionGroup),n+='|f:',n+=e.filters.map((function(t){return function(t){return t.field.N()+t.op.toString()+Lt(t.value);}(t);})).join(','),n+='|ob:',n+=e.orderBy.map((function(t){return(e=t).field.N()+e.dir;var e;})).join(','),V(e.limit)||(n+='|l:',n+=e.limit),e.startAt&&(n+='|lb:',n+=wn(e.startAt)),e.endAt&&(n+='|ub:',n+=wn(e.endAt)),e.K=n;}return e.K;}function z(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Tn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],!(i instanceof pn&&o instanceof pn&&i.op===o.op&&i.field.isEqual(o.field)&&Dt(i.value,o.value)))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!En(t.startAt,e.startAt)&&En(t.endAt,e.endAt);}function G(t){return U.W(t.path)&&null===t.collectionGroup&&0===t.filters.length;}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var H=function(){function t(t){this.G=t;}return t.fromBase64String=function(e){return new t(atob(e));},t.fromUint8Array=function(e){return new t(function(t){for(var e='',n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e;}(e));},t.prototype.toBase64=function(){return t=this.G,btoa(t);var t;},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e;}(this.G);},t.prototype.H=function(){return 2*this.G.length;},t.prototype.o=function(t){return b(this.G,t.G);},t.prototype.isEqual=function(t){return this.G===t.G;},t;}();H.Y=new H('');var K,Y,$=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=R.min()),void 0===o&&(o=R.min()),void 0===s&&(s=H.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s;}return t.prototype.Z=function(e){return new t(this.target,this.targetId,this.J,e,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken);},t.prototype.tt=function(e,n){return new t(this.target,this.targetId,this.J,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e);},t.prototype.et=function(e){return new t(this.target,this.targetId,this.J,this.sequenceNumber,this.X,e,this.resumeToken);},t;}(),X=function(t){this.count=t;};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J(t){switch(t){case P.OK:return v();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return v();}}function Z(t){if(void 0===t)return d('GRPC error has no .code'),P.UNKNOWN;switch(t){case K.OK:return P.OK;case K.CANCELLED:return P.CANCELLED;case K.UNKNOWN:return P.UNKNOWN;case K.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case K.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case K.INTERNAL:return P.INTERNAL;case K.UNAVAILABLE:return P.UNAVAILABLE;case K.UNAUTHENTICATED:return P.UNAUTHENTICATED;case K.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case K.NOT_FOUND:return P.NOT_FOUND;case K.ALREADY_EXISTS:return P.ALREADY_EXISTS;case K.PERMISSION_DENIED:return P.PERMISSION_DENIED;case K.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case K.ABORTED:return P.ABORTED;case K.OUT_OF_RANGE:return P.OUT_OF_RANGE;case K.UNIMPLEMENTED:return P.UNIMPLEMENTED;case K.DATA_LOSS:return P.DATA_LOSS;default:return v();}}(Y=K||(K={}))[Y.OK=0]='OK',Y[Y.CANCELLED=1]='CANCELLED',Y[Y.UNKNOWN=2]='UNKNOWN',Y[Y.INVALID_ARGUMENT=3]='INVALID_ARGUMENT',Y[Y.DEADLINE_EXCEEDED=4]='DEADLINE_EXCEEDED',Y[Y.NOT_FOUND=5]='NOT_FOUND',Y[Y.ALREADY_EXISTS=6]='ALREADY_EXISTS',Y[Y.PERMISSION_DENIED=7]='PERMISSION_DENIED',Y[Y.UNAUTHENTICATED=16]='UNAUTHENTICATED',Y[Y.RESOURCE_EXHAUSTED=8]='RESOURCE_EXHAUSTED',Y[Y.FAILED_PRECONDITION=9]='FAILED_PRECONDITION',Y[Y.ABORTED=10]='ABORTED',Y[Y.OUT_OF_RANGE=11]='OUT_OF_RANGE',Y[Y.UNIMPLEMENTED=12]='UNIMPLEMENTED',Y[Y.INTERNAL=13]='INTERNAL',Y[Y.UNAVAILABLE=14]='UNAVAILABLE',Y[Y.DATA_LOSS=15]='DATA_LOSS';
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var tt=function(){function t(t,e){this.P=t,this.root=e||nt.EMPTY;}return t.prototype.nt=function(e,n){return new t(this.P,this.root.nt(e,n,this.P).copy(null,null,nt.st,null,null));},t.prototype.remove=function(e){return new t(this.P,this.root.remove(e,this.P).copy(null,null,nt.st,null,null));},t.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right);}return null;},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right);}return-1;},t.prototype._=function(){return this.root._();},Object.defineProperty(t.prototype,'size',{get:function(){return this.root.size;},enumerable:!1,configurable:!0}),t.prototype.it=function(){return this.root.it();},t.prototype.rt=function(){return this.root.rt();},t.prototype.ot=function(t){return this.root.ot(t);},t.prototype.forEach=function(t){this.ot((function(e,n){return t(e,n),!1;}));},t.prototype.toString=function(){var t=[];return this.ot((function(e,n){return t.push(e+':'+n),!1;})),'{'+t.join(', ')+'}';},t.prototype.ht=function(t){return this.root.ht(t);},t.prototype.at=function(){return new et(this.root,null,this.P,!1);},t.prototype.ut=function(t){return new et(this.root,t,this.P,!1);},t.prototype.ct=function(){return new et(this.root,null,this.P,!0);},t.prototype.lt=function(t){return new et(this.root,t,this.P,!0);},t;}(),et=function(){function t(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break;}this.ft.push(t),t=this._t?t.right:t.left;}}return t.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e;},t.prototype.wt=function(){return this.ft.length>0;},t.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value};},t;}(),nt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size;}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right);},t.prototype._=function(){return!1;},t.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t);},t.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t);},t.prototype.min=function(){return this.left._()?this:this.left.min();},t.prototype.it=function(){return this.min().key;},t.prototype.rt=function(){return this.right._()?this.key:this.right.rt();},t.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et();},t.prototype.It=function(){if(this.left._())return t.EMPTY;var e=this;return e.left.At()||e.left.left.At()||(e=e.Rt()),(e=e.copy(null,null,null,e.left.It(),null)).Et();},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left._()||i.left.At()||i.left.left.At()||(i=i.Rt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.At()&&(i=i.Pt()),i.right._()||i.right.At()||i.right.left.At()||(i=i.Vt()),0===n(e,i.key)){if(i.right._())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.It());}i=i.copy(null,null,null,null,i.right.remove(e,n));}return i.Et();},t.prototype.At=function(){return this.color;},t.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.gt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t;},t.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).gt()).yt()),t;},t.prototype.Vt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t;},t.prototype.gt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null);},t.prototype.Pt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e);},t.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e);},t.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1;},t.prototype.bt=function(){if(this.At()&&this.left.At())throw v();if(this.right.At())throw v();var t=this.left.bt();if(t!==this.right.bt())throw v();return t+(this.At()?0:1);},t;}();nt.EMPTY=null,nt.RED=!0,nt.st=!1,nt.EMPTY=new(function(){function t(){this.size=0;}return Object.defineProperty(t.prototype,'key',{get:function(){throw v();},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'value',{get:function(){throw v();},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'color',{get:function(){throw v();},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'left',{get:function(){throw v();},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'right',{get:function(){throw v();},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this;},t.prototype.nt=function(t,e,n){return new nt(t,e);},t.prototype.remove=function(t,e){return this;},t.prototype._=function(){return!0;},t.prototype.ot=function(t){return!1;},t.prototype.ht=function(t){return!1;},t.prototype.it=function(){return null;},t.prototype.rt=function(){return null;},t.prototype.At=function(){return!1;},t.prototype.pt=function(){return!0;},t.prototype.bt=function(){return 0;},t;}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var rt=function(){function t(t){this.P=t,this.data=new tt(this.P);}return t.prototype.has=function(t){return null!==this.data.get(t);},t.prototype.first=function(){return this.data.it();},t.prototype.last=function(){return this.data.rt();},Object.defineProperty(t.prototype,'size',{get:function(){return this.data.size;},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t);},t.prototype.forEach=function(t){this.data.ot((function(e,n){return t(e),!1;}));},t.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(this.P(r.key,t[1])>=0)return;e(r.key);}},t.prototype.St=function(t,e){var n;for(n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return;},t.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null;},t.prototype.at=function(){return new it(this.data.at());},t.prototype.ut=function(t){return new it(this.data.ut(t));},t.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0));},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this;},t.prototype._=function(){return this.data._();},t.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t);})),e;},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.at(),r=e.data.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(0!==this.P(i,o))return!1;}return!0;},t.prototype.F=function(){var t=[];return this.forEach((function(e){t.push(e);})),t;},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e);})),'SortedSet('+t.toString()+')';},t.prototype.copy=function(e){var n=new t(this.P);return n.data=e,n;},t;}(),it=function(){function t(t){this.Ft=t;}return t.prototype.dt=function(){return this.Ft.dt().key;},t.prototype.wt=function(){return this.Ft.wt();},t;}(),ot=new tt(U.P);function st(){return ot;}function at(){return st();}var ut=new tt(U.P);function ct(){return ut;}var ht=new tt(U.P),lt=new rt(U.P);function ft(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=lt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o);}return n;}var pt=new rt(b);function dt(){return pt;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yt=function(){function t(t){this.P=t?function(e,n){return t(e,n)||U.P(e.key,n.key);}:function(t,e){return U.P(t.key,e.key);},this.Nt=ct(),this.$t=new tt(this.P);}return t.kt=function(e){return new t(e.P);},t.prototype.has=function(t){return null!=this.Nt.get(t);},t.prototype.get=function(t){return this.Nt.get(t);},t.prototype.first=function(){return this.$t.it();},t.prototype.last=function(){return this.$t.rt();},t.prototype._=function(){return this.$t._();},t.prototype.indexOf=function(t){var e=this.Nt.get(t);return e?this.$t.indexOf(e):-1;},Object.defineProperty(t.prototype,'size',{get:function(){return this.$t.size;},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.$t.ot((function(e,n){return t(e),!1;}));},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Nt.nt(t.key,t),e.$t.nt(t,null));},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Nt.remove(t),this.$t.remove(e)):this;},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.$t.at(),r=e.$t.at();n.wt();){var i=n.dt().key,o=r.dt().key;if(!i.isEqual(o))return!1;}return!0;},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString());})),0===t.length?'DocumentSet ()':'DocumentSet (\n  '+t.join('  \n')+'\n)';},t.prototype.copy=function(e,n){var r=new t;return r.P=this.P,r.Nt=e,r.$t=n,r;},t;}(),vt=function(){function t(){this.xt=new tt(U.P);}return t.prototype.track=function(t){var e=t.doc.key,n=this.xt.get(e);n?0!==t.type&&3===n.type?this.xt=this.xt.nt(e,t):3===t.type&&1!==n.type?this.xt=this.xt.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.xt=this.xt.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.xt=this.xt.remove(e):1===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):v():this.xt=this.xt.nt(e,t);},t.prototype.Mt=function(){var t=[];return this.xt.ot((function(e,n){t.push(n);})),t;},t;}(),gt=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.Bt=s,this.qt=a;}return t.Ut=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t});})),new t(e,n,yt.kt(n),o,r,i,!0,!1);},Object.defineProperty(t.prototype,'hasPendingWrites',{get:function(){return!this.Lt._();},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.Lt.isEqual(t.Lt)&&un(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0;},t;}(),mt=function(){function t(t,e,n,r,i){this.X=t,this.Qt=e,this.Wt=n,this.jt=r,this.Kt=i;}return t.Gt=function(e,n){var r=new Map;return r.set(e,_t.zt(e,n)),new t(R.min(),r,dt(),st(),ft());},t;}(),_t=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i;}return t.zt=function(e,n){return new t(H.Y,n,ft(),ft(),ft());},t;}(),wt=function(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r;},bt=function(t,e){this.targetId=t,this.ee=e;},Et=function(t,e,n,r){void 0===n&&(n=H.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r;},Ct=function(){function t(){this.ne=0,this.se=St(),this.ie=H.Y,this.re=!1,this.oe=!0;}return Object.defineProperty(t.prototype,'Ht',{get:function(){return this.re;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'resumeToken',{get:function(){return this.ie;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'he',{get:function(){return 0!==this.ne;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'ae',{get:function(){return this.oe;},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){t.H()>0&&(this.oe=!0,this.ie=t);},t.prototype.ce=function(){var t=ft(),e=ft(),n=ft();return this.se.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:v();}})),new _t(this.ie,this.re,t,e,n);},t.prototype.le=function(){this.oe=!1,this.se=St();},t.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e);},t.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t);},t.prototype.de=function(){this.ne+=1;},t.prototype.we=function(){this.ne-=1;},t.prototype.Te=function(){this.oe=!0,this.re=!0;},t;}(),It=function(){function t(t){this.Ee=t,this.Ie=new Map,this.me=st(),this.Ae=Tt(),this.Re=new rt(b);}return t.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof rn?this.Ve(r,t.te):t.te instanceof on&&this.ge(r,t.key,t.te);}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ge(s,t.key,t.te);}},t.prototype.ye=function(t){var e=this;this.pe(t,(function(n){var r=e.be(n);switch(t.state){case 0:e.ve(n)&&r.ue(t.resumeToken);break;case 1:r.we(),r.he||r.le(),r.ue(t.resumeToken);break;case 2:r.we(),r.he||e.removeTarget(n);break;case 3:e.ve(n)&&(r.Te(),r.ue(t.resumeToken));break;case 4:e.ve(n)&&(e.Se(n),r.ue(t.resumeToken));break;default:v();}}));},t.prototype.pe=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Ie.forEach((function(t,r){n.ve(r)&&e(r);}));},t.prototype.De=function(t){var e=t.targetId,n=t.ee.count,r=this.Ce(e);if(r){var i=r.target;if(G(i))if(0===n){var o=new U(i.path);this.ge(e,o,new on(o,R.min()));}else g(1===n);else this.Fe(e)!==n&&(this.Se(e),this.Re=this.Re.add(e));}},t.prototype.Ne=function(t){var e=this,n=new Map;this.Ie.forEach((function(r,i){var o=e.Ce(i);if(o){if(r.Ht&&G(o.target)){var s=new U(o.target.path);null!==e.me.get(s)||e.$e(i,s)||e.ge(i,s,new on(s,t));}r.ae&&(n.set(i,r.ce()),r.le());}}));var r=ft();this.Ae.forEach((function(t,n){var i=!0;n.St((function(t){var n=e.Ce(t);return!n||2===n.J||(i=!1,!1);})),i&&(r=r.add(t));}));var i=new mt(t,n,this.Re,this.me,r);return this.me=st(),this.Ae=Tt(),this.Re=new rt(b),i;},t.prototype.Ve=function(t,e){if(this.ve(t)){var n=this.$e(t,e.key)?2:0;this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.ke(e.key).add(t));}},t.prototype.ge=function(t,e,n){if(this.ve(t)){var r=this.be(t);this.$e(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.ke(e).delete(t)),n&&(this.me=this.me.nt(e,n));}},t.prototype.removeTarget=function(t){this.Ie.delete(t);},t.prototype.Fe=function(t){var e=this.be(t).ce();return this.Ee.xe(t).size+e.Yt.size-e.Xt.size;},t.prototype.de=function(t){this.be(t).de();},t.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new Ct,this.Ie.set(t,e)),e;},t.prototype.ke=function(t){var e=this.Ae.get(t);return e||(e=new rt(b),this.Ae=this.Ae.nt(t,e)),e;},t.prototype.ve=function(t){var e=null!==this.Ce(t);return e||p('WatchChangeAggregator','Detected inactive target',t),e;},t.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t);},t.prototype.Se=function(t){var e=this;this.Ie.set(t,new Ct),this.Ee.xe(t).forEach((function(n){e.ge(t,n,null);}));},t.prototype.$e=function(t,e){return this.Ee.xe(t).has(e);},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tt(){return new tt(U.P);}function St(){return new tt(U.P);}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nt(t){var e,n;return'server_timestamp'===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue);}function At(t){var e=Ft(t.mapValue.fields.__local_write_time__.timestampValue);return new O(e.seconds,e.nanos);}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(t){return'nullValue'in t?0:'booleanValue'in t?1:'integerValue'in t||'doubleValue'in t?2:'timestampValue'in t?3:'stringValue'in t?5:'bytesValue'in t?6:'referenceValue'in t?7:'geoPointValue'in t?8:'arrayValue'in t?9:'mapValue'in t?Nt(t)?4:10:v();}function Dt(t,e){var n=Pt(t);if(n!==Pt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return At(t).isEqual(At(e));case 3:return function(t,e){if('string'==typeof t.timestampValue&&'string'==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ft(t.timestampValue),r=Ft(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos;}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ut(t.bytesValue).isEqual(Ut(e.bytesValue));}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Mt(t.geoPointValue.latitude)===Mt(e.geoPointValue.latitude)&&Mt(t.geoPointValue.longitude)===Mt(e.geoPointValue.longitude);}(t,e);case 2:return function(t,e){if('integerValue'in t&&'integerValue'in e)return Mt(t.integerValue)===Mt(e.integerValue);if('doubleValue'in t&&'doubleValue'in e){var n=Mt(t.doubleValue),r=Mt(e.doubleValue);return n===r?j(n)===j(r):isNaN(n)&&isNaN(r);}return!1;}(t,e);case 9:return E(t.arrayValue.values||[],e.arrayValue.values||[],Dt);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(S(n)!==S(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Dt(n[i],r[i])))return!1;return!0;}(t,e);default:return v();}}function Ot(t,e){return void 0!==(t.values||[]).find((function(t){return Dt(t,e);}));}function Rt(t,e){var n=Pt(t),r=Pt(e);if(n!==r)return b(n,r);switch(n){case 0:return 0;case 1:return b(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Mt(t.integerValue||t.doubleValue),r=Mt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1;}(t,e);case 3:return kt(t.timestampValue,e.timestampValue);case 4:return kt(At(t),At(e));case 5:return b(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Ut(t),r=Ut(e);return n.o(r);}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split('/'),r=e.split('/'),i=0;i<n.length&&i<r.length;i++){var o=b(n[i],r[i]);if(0!==o)return o;}return b(n.length,r.length);}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=b(Mt(t.latitude),Mt(e.latitude));return 0!==n?n:b(Mt(t.longitude),Mt(e.longitude));}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Rt(n[i],r[i]);if(o)return o;}return b(n.length,r.length);}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=b(r[s],o[s]);if(0!==a)return a;var u=Rt(n[r[s]],i[o[s]]);if(0!==u)return u;}return b(r.length,o.length);}(t.mapValue,e.mapValue);default:throw v();}}function kt(t,e){if('string'==typeof t&&'string'==typeof e&&t.length===e.length)return b(t,e);var n=Ft(t),r=Ft(e),i=b(n.seconds,r.seconds);return 0!==i?i:b(n.nanos,r.nanos);}function Lt(t){return function t(e){return'nullValue'in e?'null':'booleanValue'in e?''+e.booleanValue:'integerValue'in e?''+e.integerValue:'doubleValue'in e?''+e.doubleValue:'timestampValue'in e?function(t){var e=Ft(t);return'time('+e.seconds+','+e.nanos+')';}(e.timestampValue):'stringValue'in e?e.stringValue:'bytesValue'in e?Ut(e.bytesValue).toBase64():'referenceValue'in e?(r=e.referenceValue,U.q(r).toString()):'geoPointValue'in e?'geo('+(n=e.geoPointValue).latitude+','+n.longitude+')':'arrayValue'in e?function(e){for(var n='[',r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=',',n+=t(s);}return n+']';}(e.arrayValue):'mapValue'in e?function(e){for(var n='{',r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=',',n+=s+':'+t(e.fields[s]);}return n+'}';}(e.mapValue):v();var n,r;}(t);}function Ft(t){if(g(!!t),'string'==typeof t){var e=0,n=xt.exec(t);if(g(!!n),n[1]){var r=n[1];r=(r+'000000000').substr(0,9),e=Number(r);}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e};}return{seconds:Mt(t.seconds),nanos:Mt(t.nanos)};}function Mt(t){return'number'==typeof t?t:'string'==typeof t?Number(t):0;}function Ut(t){return'string'==typeof t?H.fromBase64String(t):H.fromUint8Array(t);}function Vt(t,e){return{referenceValue:'projects/'+t.projectId+'/databases/'+t.database+'/documents/'+e.path.N()};}function jt(t){return!!t&&'integerValue'in t;}function qt(t){return!!t&&'arrayValue'in t;}function Bt(t){return!!t&&'nullValue'in t;}function Wt(t){return!!t&&'doubleValue'in t&&isNaN(Number(t.doubleValue));}function Qt(t){return!!t&&'mapValue'in t;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zt={asc:'ASCENDING',desc:'DESCENDING'},Gt={'<':'LESS_THAN','<=':'LESS_THAN_OR_EQUAL','>':'GREATER_THAN','>=':'GREATER_THAN_OR_EQUAL','==':'EQUAL','array-contains':'ARRAY_CONTAINS',in:'IN','array-contains-any':'ARRAY_CONTAINS_ANY'},Ht=function(t,e){this.s=t,this.Oe=e;};function Kt(t){return{integerValue:''+t};}function Yt(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:'NaN'};if(e===1/0)return{doubleValue:'Infinity'};if(e===-1/0)return{doubleValue:'-Infinity'};}return{doubleValue:j(e)?'-0':e};}function $t(t,e){return q(e)?Kt(e):Yt(t,e);}function Xt(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,'').replace('Z','')+'.'+('000000000'+e.nanoseconds).slice(-9)+'Z':{seconds:''+e.seconds,nanos:e.nanoseconds};}function Jt(t,e){return t.Oe?e.toBase64():e.toUint8Array();}function Zt(t,e){return Xt(t,e.A());}function te(t){return g(!!t),R.I(function(t){var e=Ft(t);return new O(e.seconds,e.nanos);}(t));}function ee(t,e){return function(t){return new L(['projects',t.projectId,'databases',t.database]);}(t).child('documents').child(e).N();}function ne(t){var e=L.$(t);return g(be(e)),e;}function re(t,e){return ee(t.s,e.path);}function ie(t,e){var n=ne(e);return g(n.get(1)===t.s.projectId),g(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new U(ue(n));}function oe(t,e){return ee(t.s,e);}function se(t){var e=ne(t);return 4===e.length?L.k():ue(e);}function ae(t){return new L(['projects',t.s.projectId,'databases',t.s.database]).N();}function ue(t){return g(t.length>4&&'documents'===t.get(4)),t.g(5);}function ce(t,e,n){return{name:re(t,e),fields:n.proto.mapValue.fields};}function he(t,e){var n;if(e instanceof ze)n={update:ce(t,e.key,e.value)};else if(e instanceof Xe)n={delete:re(t,e.key)};else if(e instanceof Ge)n={update:ce(t,e.key,e.data),updateMask:we(e.Le)};else if(e instanceof Ke)n={transform:{document:re(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Se)return{fieldPath:e.field.N(),setToServerValue:'REQUEST_TIME'};if(n instanceof Ne)return{fieldPath:e.field.N(),appendMissingElements:{values:n.elements}};if(n instanceof xe)return{fieldPath:e.field.N(),removeAllFromArray:{values:n.elements}};if(n instanceof De)return{fieldPath:e.field.N(),increment:n.Be};throw v();}(0,t);}))}};else{if(!(e instanceof Je))return v();n={verify:re(t,e.key)};}return e.Ue.qe||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Zt(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:v();}(t,e.Ue)),n;}function le(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Me.updateTime(te(t.updateTime)):void 0!==t.exists?Me.exists(t.exists):Me.Qe();}(e.currentDocument):Me.Qe();if(e.update){e.update.name;var r=ie(t,e.update.name),i=new Ze({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new ke(e.map((function(t){return M.B(t);})));}(e.updateMask);return new Ge(r,i,o,n);}return new ze(r,i,n);}if(e.delete){var s=ie(t,e.delete);return new Xe(s,n);}if(e.transform){var a=ie(t,e.transform.document),u=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if('setToServerValue'in e)g('REQUEST_TIME'===e.setToServerValue),n=new Se;else if('appendMissingElements'in e){var r=e.appendMissingElements.values||[];n=new Ne(r);}else if('removeAllFromArray'in e){var i=e.removeAllFromArray.values||[];n=new xe(i);}else'increment'in e?n=new De(t,e.increment):v();var o=M.B(e.fieldPath);return new Le(o,n);}(t,e);}));return g(!0===n.exists),new Ke(a,u);}if(e.verify){var c=ie(t,e.verify);return new Je(c,n);}return v();}function fe(t,e){return{documents:[oe(t,e.path)]};}function pe(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=oe(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=oe(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return t instanceof pn?function(t){if('=='===t.op){if(Wt(t.value))return{unaryFilter:{field:ve(t.field),op:'IS_NAN'}};if(Bt(t.value))return{unaryFilter:{field:ve(t.field),op:'IS_NULL'}};}return{fieldFilter:{field:ve(t.field),op:(e=t.op,Gt[e]),value:t.value}};var e;}(t):v();}));return 1===e.length?e[0]:{compositeFilter:{op:'AND',filters:e}};}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:ve((e=t).field),direction:(n=e.dir,zt[n])};var e,n;}));}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Oe||V(e)?e:{value:e};}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=de(e.startAt)),e.endAt&&(n.structuredQuery.endAt=de(e.endAt)),n;}function de(t){return{before:t.before,values:t.position};}function ye(t){var e=!!t.before,n=t.values||[];return new _n(n,e);}function ve(t){return{fieldPath:t.N()};}function ge(t){return M.B(t.fieldPath);}function me(t){return pn.create(ge(t.fieldFilter.field),function(t){switch(t){case'EQUAL':return'==';case'GREATER_THAN':return'>';case'GREATER_THAN_OR_EQUAL':return'>=';case'LESS_THAN':return'<';case'LESS_THAN_OR_EQUAL':return'<=';case'ARRAY_CONTAINS':return'array-contains';case'IN':return'in';case'ARRAY_CONTAINS_ANY':return'array-contains-any';case'OPERATOR_UNSPECIFIED':default:return v();}}(t.fieldFilter.op),t.fieldFilter.value);}function _e(t){switch(t.unaryFilter.op){case'IS_NAN':var e=ge(t.unaryFilter.field);return pn.create(e,'==',{doubleValue:NaN});case'IS_NULL':var n=ge(t.unaryFilter.field);return pn.create(n,'==',{nullValue:'NULL_VALUE'});case'OPERATOR_UNSPECIFIED':default:return v();}}function we(t){var e=[];return t.fields.forEach((function(t){return e.push(t.N());})),{fieldPaths:e};}function be(t){return t.length>=4&&'projects'===t.get(0)&&'databases'===t.get(2);}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ee=function(){this.je=void 0;};function Ce(t,e,n){return t instanceof Se?function(t,e){var n={fields:{__type__:{stringValue:'server_timestamp'},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n};}(n,e):t instanceof Ne?Ae(t,e):t instanceof xe?Pe(t,e):function(t,e){var n=Te(t,e),r=Oe(n)+Oe(t.Be);return jt(n)&&jt(t.Be)?Kt(r):Yt(t.serializer,r);}(t,e);}function Ie(t,e,n){return t instanceof Ne?Ae(t,e):t instanceof xe?Pe(t,e):n;}function Te(t,e){return t instanceof De?jt(n=e)||function(t){return!!t&&'doubleValue'in t;}(n)?e:{integerValue:0}:null;var n;}var Se=function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return i.__extends(e,t),e;}(Ee),Ne=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n;}return i.__extends(e,t),e;}(Ee);function Ae(t,e){for(var n=Re(e),r=function(t){n.some((function(e){return Dt(e,t);}))||n.push(t);},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}};}var xe=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n;}return i.__extends(e,t),e;}(Ee);function Pe(t,e){for(var n=Re(e),r=function(t){n=n.filter((function(e){return!Dt(e,t);}));},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}};}var De=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.Be=n,r;}return i.__extends(e,t),e;}(Ee);function Oe(t){return Mt(t.integerValue||t.doubleValue);}function Re(t){return qt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[];}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ke=function(){function t(t){this.fields=t,t.sort(M.P);}return t.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1;},t.prototype.isEqual=function(t){return E(this.fields,t.fields,(function(t,e){return t.isEqual(e);}));},t;}(),Le=function(t,e){this.field=t,this.transform=e;},Fe=function(t,e){this.version=t,this.transformResults=e;},Me=function(){function t(t,e){this.updateTime=t,this.exists=e;}return t.Qe=function(){return new t;},t.exists=function(e){return new t(void 0,e);},t.updateTime=function(e){return new t(e);},Object.defineProperty(t.prototype,'qe',{get:function(){return void 0===this.updateTime&&void 0===this.exists;},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime);},t;}();function Ue(t,e){return void 0!==t.updateTime?e instanceof rn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof rn;}var Ve=function(){};function je(t,e,n){return t instanceof ze?function(t,e,n){return new rn(t.key,n.version,t.value,{hasCommittedMutations:!0});}(t,0,n):t instanceof Ge?function(t,e,n){if(!Ue(t.Ue,e))return new sn(t.key,n.version);var r=He(t,e);return new rn(t.key,n.version,r,{hasCommittedMutations:!0});}(t,e,n):t instanceof Ke?function(t,e,n){if(g(null!=n.transformResults),!Ue(t.Ue,e))return new sn(t.key,n.version);var r=Ye(t,e),i=function(t,e,n){var r=[];g(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=null;e instanceof rn&&(a=e.field(o.field)),r.push(Ie(s,a,n[i]));}return r;}(t.fieldTransforms,e,n.transformResults),o=n.version,s=$e(t,r.data(),i);return new rn(t.key,o,s,{hasCommittedMutations:!0});}(t,e,n):function(t,e,n){return new on(t.key,n.version,{hasCommittedMutations:!0});}(t,0,n);}function qe(t,e,n,r){return t instanceof ze?function(t,e){if(!Ue(t.Ue,e))return e;var n=Qe(e);return new rn(t.key,n,t.value,{Ge:!0});}(t,e):t instanceof Ge?function(t,e){if(!Ue(t.Ue,e))return e;var n=Qe(e),r=He(t,e);return new rn(t.key,n,r,{Ge:!0});}(t,e):t instanceof Ke?function(t,e,n,r){if(!Ue(t.Ue,e))return e;var i=Ye(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=null;n instanceof rn&&(c=n.field(a.field)),null===c&&r instanceof rn&&(c=r.field(a.field)),i.push(Ce(u,c,e));}return i;}(t.fieldTransforms,n,e,r),s=$e(t,i.data(),o);return new rn(t.key,i.version,s,{Ge:!0});}(t,e,r,n):function(t,e){return Ue(t.Ue,e)?new on(t.key,R.min()):e;}(t,e);}function Be(t,e){return t instanceof Ke?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof rn?e.field(o.field):void 0,a=Te(o.transform,s||null);null!=a&&(n=null==n?(new tn).set(o.field,a):n.set(o.field,a));}return n?n.ze():null;}(t,e):null;}function We(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||E(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ne&&e instanceof Ne||t instanceof xe&&e instanceof xe?E(t.elements,e.elements,Dt):t instanceof De&&e instanceof De?Dt(t.Be,e.Be):t instanceof Se&&e instanceof Se;}(t.transform,e.transform);}(t,e);})));}function Qe(t){return t instanceof rn?t.version:R.min();}var ze=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ue=r,i.type=0,i;}return i.__extends(e,t),e;}(Ve),Ge=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Le=r,o.Ue=i,o.type=1,o;}return i.__extends(e,t),e;}(Ve);function He(t,e){return function(t,e){var n=new tn(e);return t.Le.fields.forEach((function(e){if(!e._()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e);}})),n.ze();}(t,e instanceof rn?e.data():Ze.empty());}var Ke=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ue=Me.exists(!0),r;}return i.__extends(e,t),e;}(Ve);function Ye(t,e){return e;}function $e(t,e,n){for(var r=new tn(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i]);}return r.ze();}var Xe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=3,r;}return i.__extends(e,t),e;}(Ve),Je=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ue=n,r.type=4,r;}return i.__extends(e,t),e;}(Ve),Ze=function(){function t(t){this.proto=t;}return t.empty=function(){return new t({mapValue:{}});},t.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Qt(e=e.mapValue.fields[t.get(n)]))return null;}return(e=(e.mapValue.fields||{})[t.S()])||null;},t.prototype.isEqual=function(t){return Dt(this.proto,t.proto);},t;}(),tn=function(){function t(t){void 0===t&&(t=Ze.empty()),this.He=t,this.Ye=new Map;}return t.prototype.set=function(t,e){return this.Je(t,e),this;},t.prototype.delete=function(t){return this.Je(t,null),this;},t.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Pt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o);}n.set(t.S(),e);},t.prototype.ze=function(){var t=this.Xe(M.k(),this.Ye);return null!=t?new Ze(t):this.He;},t.prototype.Xe=function(t,e){var n=this,r=!1,i=this.He.field(t),o=Qt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.Xe(t.child(i),e);null!=s&&(o[i]=s,r=!0);}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0);})),r?{mapValue:{fields:o}}:null;},t;}();function en(t){var e=[];return N(t.fields||{},(function(t,n){var r=new M([t]);if(Qt(n)){var i=en(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a));}}else e.push(r);})),new ke(e);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var nn=function(t,e){this.key=t,this.version=e;},rn=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).Ze=r,o.Ge=!!i.Ge,o.hasCommittedMutations=!!i.hasCommittedMutations,o;}return i.__extends(e,t),e.prototype.field=function(t){return this.Ze.field(t);},e.prototype.data=function(){return this.Ze;},e.prototype.tn=function(){return this.Ze.proto;},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze);},e.prototype.toString=function(){return'Document('+this.key+', '+this.version+', '+this.Ze.toString()+', {hasLocalMutations: '+this.Ge+'}), {hasCommittedMutations: '+this.hasCommittedMutations+'})';},Object.defineProperty(e.prototype,'hasPendingWrites',{get:function(){return this.Ge||this.hasCommittedMutations;},enumerable:!1,configurable:!0}),e;}(nn),on=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i;}return i.__extends(e,t),e.prototype.toString=function(){return'NoDocument('+this.key+', '+this.version+')';},Object.defineProperty(e.prototype,'hasPendingWrites',{get:function(){return this.hasCommittedMutations;},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key);},e;}(nn),sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return i.__extends(e,t),e.prototype.toString=function(){return'UnknownDocument('+this.key+', '+this.version+')';},Object.defineProperty(e.prototype,'hasPendingWrites',{get:function(){return!0;},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key);},e;}(nn),an=function(){function t(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o='F'),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=a,this.sn=null,this.rn=null,this.startAt&&this.on(this.startAt),this.endAt&&this.on(this.endAt);}return t.hn=function(e){return new t(e);},Object.defineProperty(t.prototype,'orderBy',{get:function(){if(null===this.sn){this.sn=[];var t=this.an(),e=this.un();if(null!==t&&null===e)t.O()||this.sn.push(new Cn(t)),this.sn.push(new Cn(M.L(),'asc'));else{for(var n=!1,r=0,i=this.en;r<i.length;r++){var o=i[r];this.sn.push(o),o.field.O()&&(n=!0);}if(!n){var s=this.en.length>0?this.en[this.en.length-1].dir:'asc';this.sn.push(new Cn(M.L(),s));}}}return this.sn;},enumerable:!1,configurable:!0}),t.prototype.cn=function(e){var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.en.slice(),n,this.limit,this.nn,this.startAt,this.endAt);},t.prototype.ln=function(e){var n=this.en.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt);},t.prototype._n=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),e,'F',this.startAt,this.endAt);},t.prototype.fn=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),e,'L',this.startAt,this.endAt);},t.prototype.dn=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,e,this.endAt);},t.prototype.wn=function(e){return new t(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,e);},t.prototype.Tn=function(e){return new t(e,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt);},t.prototype.En=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.O());},t.prototype.In=function(){return!V(this.limit)&&'F'===this.nn;},t.prototype.mn=function(){return!V(this.limit)&&'L'===this.nn;},t.prototype.un=function(){return this.en.length>0?this.en[0].field:null;},t.prototype.an=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof pn&&n.An())return n.field;}return null;},t.prototype.Rn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof pn&&t.indexOf(r.op)>=0)return r.op;}return null;},t.prototype.Pn=function(){return G(this.We());},t.prototype.Vn=function(){return null!==this.collectionGroup;},t.prototype.We=function(){if(!this.rn)if('F'===this.nn)this.rn=W(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i='desc'===r.dir?'asc':'desc';t.push(new Cn(r.field,i));}var o=this.endAt?new _n(this.endAt.position,!this.endAt.before):null,s=this.startAt?new _n(this.startAt.position,!this.startAt.before):null;this.rn=W(this.path,this.collectionGroup,t,this.filters,this.limit,o,s);}return this.rn;},t.prototype.on=function(t){},t;}();function un(t,e){return z(t.We(),e.We())&&t.nn===e.nn;}function cn(t){return Q(t.We())+'|lt:'+t.nn;}function hn(t){return'Query(target='+function(t){var e=t.path.N();return null!==t.collectionGroup&&(e+=' collectionGroup='+t.collectionGroup),t.filters.length>0&&(e+=', filters: ['+t.filters.map((function(t){return(e=t).field.N()+' '+e.op+' '+Lt(e.value);var e;})).join(', ')+']'),V(t.limit)||(e+=', limit: '+t.limit),t.orderBy.length>0&&(e+=', orderBy: ['+t.orderBy.map((function(t){return(e=t).field.N()+' ('+e.dir+')';var e;})).join(', ')+']'),t.startAt&&(e+=', startAt: '+wn(t.startAt)),t.endAt&&(e+=', endAt: '+wn(t.endAt)),'Target('+e+')';}(t.We())+'; limitType='+t.nn+')';}function ln(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.U(t.collectionGroup)&&t.path.D(n):U.W(t.path)?t.path.isEqual(n):t.path.C(n);}(t,e)&&function(t,e){for(var n=0,r=t.en;n<r.length;n++){var i=r[n];if(!i.field.O()&&null===e.field(i.field))return!1;}return!0;}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0;}(t,e)&&function(t,e){return!(t.startAt&&!bn(t.startAt,t.orderBy,e)||t.endAt&&bn(t.endAt,t.orderBy,e));}(t,e);}function fn(t){return function(e,n){for(var r=!1,i=0,o=t.orderBy;i<o.length;i++){var s=o[i],a=In(s,e,n);if(0!==a)return a;r=r||s.field.O();}return 0;};}var pn=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i;}return i.__extends(e,t),e.create=function(t,n,r){if(t.O())return'in'===n?new yn(t,r):new dn(t,n,r);if(Bt(r)){if('=='!==n)throw new D(P.INVALID_ARGUMENT,'Invalid query. Null supports only equality comparisons.');return new e(t,n,r);}if(Wt(r)){if('=='!==n)throw new D(P.INVALID_ARGUMENT,'Invalid query. NaN supports only equality comparisons.');return new e(t,n,r);}return'array-contains'===n?new vn(t,r):'in'===n?new gn(t,r):'array-contains-any'===n?new mn(t,r):new e(t,n,r);},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Pt(this.value)===Pt(e)&&this.gn(Rt(e,this.value));},e.prototype.gn=function(t){switch(this.op){case'<':return t<0;case'<=':return t<=0;case'==':return 0===t;case'>':return t>0;case'>=':return t>=0;default:return v();}},e.prototype.An=function(){return['<','<=','>','>='].indexOf(this.op)>=0;},e;}((function(){})),dn=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=U.q(r.referenceValue),i;}return i.__extends(e,t),e.prototype.matches=function(t){var e=U.P(t.key,this.key);return this.gn(e);},e;}(pn),yn=function(t){function e(e,n){var r=this;return(r=t.call(this,e,'in',n)||this).keys=(n.arrayValue.values||[]).map((function(t){return U.q(t.referenceValue);})),r;}return i.__extends(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key);}));},e;}(pn),vn=function(t){function e(e,n){return t.call(this,e,'array-contains',n)||this;}return i.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return qt(e)&&Ot(e.arrayValue,this.value);},e;}(pn),gn=function(t){function e(e,n){return t.call(this,e,'in',n)||this;}return i.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Ot(this.value.arrayValue,e);},e;}(pn),mn=function(t){function e(e,n){return t.call(this,e,'array-contains-any',n)||this;}return i.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!qt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Ot(e.value.arrayValue,t);}));},e;}(pn),_n=function(t,e){this.position=t,this.before=e;};function wn(t){return(t.before?'b':'a')+':'+t.position.map((function(t){return Lt(t);})).join(',');}function bn(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.O()?U.P(U.q(s.referenceValue),n.key):Rt(s,n.field(o.field)),'desc'===o.dir&&(r*=-1),0!==r)break;}return t.before?r<=0:r<0;}function En(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Dt(t.position[n],e.position[n]))return!1;return!0;}var Cn=function(t,e){void 0===e&&(e='asc'),this.field=t,this.dir=e;};function In(t,e,n){var r=t.field.O()?U.P(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Rt(r,i):v();}(t.field,e,n);switch(t.dir){case'asc':return r;case'desc':return-1*r;default:return v();}}function Tn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sn=function(){function t(t,e,n,r){this.batchId=t,this.yn=e,this.baseMutations=n,this.mutations=r;}return t.prototype.pn=function(t,e,n){for(var r=n.bn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=je(o,e,r[i]));}return e;},t.prototype.vn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=qe(i,e,e,this.yn));}for(var o=e,s=0,a=this.mutations;s<a.length;s++){var u=a[s];u.key.isEqual(t)&&(e=qe(u,e,o,this.yn));}return e;},t.prototype.Sn=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.vn(r.key,t.get(r.key));i&&(n=n.nt(r.key,i));})),n;},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key);}),ft());},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&E(this.mutations,t.mutations,(function(t,e){return We(t,e);}))&&E(this.baseMutations,t.baseMutations,(function(t,e){return We(t,e);}));},t;}(),Nn=function(){function t(t,e,n,r){this.batch=t,this.Dn=e,this.bn=n,this.Cn=r;}return t.from=function(e,n,r){g(e.mutations.length===r.length);for(var i=ht,o=e.mutations,s=0;s<o.length;s++)i=i.nt(o[s].key,r[s].version);return new t(e,n,r,i);},t;}(),An=function(){function t(t){var e=this;this.Fn=null,this.Nn=null,this.result=void 0,this.error=void 0,this.$n=!1,this.kn=!1,t((function(t){e.$n=!0,e.result=t,e.Fn&&e.Fn(t);}),(function(t){e.$n=!0,e.error=t,e.Nn&&e.Nn(t);}));}return t.prototype.catch=function(t){return this.next(void 0,t);},t.prototype.next=function(e,n){var r=this;return this.kn&&v(),this.kn=!0,this.$n?this.error?this.xn(n,this.error):this.Mn(e,this.result):new t((function(t,i){r.Fn=function(n){r.Mn(e,n).next(t,i);},r.Nn=function(e){r.xn(n,e).next(t,i);};}));},t.prototype.On=function(){var t=this;return new Promise((function(e,n){t.next(e,n);}));},t.prototype.Ln=function(e){try{var n=e();return n instanceof t?n:t.resolve(n);}catch(e){return t.reject(e);}},t.prototype.Mn=function(e,n){return e?this.Ln((function(){return e(n);})):t.resolve(n);},t.prototype.xn=function(e,n){return e?this.Ln((function(){return e(n);})):t.reject(n);},t.resolve=function(e){return new t((function(t,n){t(e);}));},t.reject=function(e){return new t((function(t,n){n(e);}));},t.Bn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t();}),(function(t){return n(t);}));})),o=!0,i===r&&t();}));},t.qn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e();}));},i=0,o=e;i<o.length;i++)r(o[i]);return n;},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i));})),this.Bn(r);},t;}(),xn=function(){function t(){this.Un=new x((function(t){return t.toString();}),(function(t,e){return t.isEqual(e);})),this.Qn=!1;}return Object.defineProperty(t.prototype,'readTime',{get:function(){return this.Wn;},set:function(t){this.Wn=t;},enumerable:!1,configurable:!0}),t.prototype.jn=function(t,e){this.Kn(),this.readTime=e,this.Un.set(t.key,t);},t.prototype.Gn=function(t,e){this.Kn(),e&&(this.readTime=e),this.Un.set(t,null);},t.prototype.zn=function(t,e){this.Kn();var n=this.Un.get(e);return void 0!==n?An.resolve(n):this.Hn(t,e);},t.prototype.getEntries=function(t,e){return this.Yn(t,e);},t.prototype.apply=function(t){return this.Kn(),this.Qn=!0,this.Jn(t);},t.prototype.Kn=function(){},t;}(),Pn='The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.',Dn=function(){function t(){this.Xn=[];}return t.prototype.Zn=function(t){this.Xn.push(t);},t.prototype.ts=function(){this.Xn.forEach((function(t){return t();}));},t;}(),On=function(){function t(t,e,n){this.es=t,this.ns=e,this.ss=n;}return t.prototype.rs=function(t,e){var n=this;return this.ns.os(t,e).next((function(r){return n.hs(t,e,r);}));},t.prototype.hs=function(t,e,n){return this.es.zn(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].vn(e,t);return t;}));},t.prototype.as=function(t,e,n){var r=at();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].vn(t,e);r=r.nt(t,e);})),r;},t.prototype.us=function(t,e){var n=this;return this.es.getEntries(t,e).next((function(e){return n.cs(t,e);}));},t.prototype.cs=function(t,e){var n=this;return this.ns.ls(t,e).next((function(r){var i=n.as(t,e,r),o=st();return i.forEach((function(t,e){e||(e=new on(t,R.min())),o=o.nt(t,e);})),o;}));},t.prototype._s=function(t,e,n){return e.Pn()?this.fs(t,e.path):e.Vn()?this.ds(t,e,n):this.ws(t,e,n);},t.prototype.fs=function(t,e){return this.rs(t,new U(e)).next((function(t){var e=ct();return t instanceof rn&&(e=e.nt(t.key,t)),e;}));},t.prototype.ds=function(t,e,n){var r=this,i=e.collectionGroup,o=ct();return this.ss.Ts(t,i).next((function(s){return An.forEach(s,(function(s){var a=e.Tn(s.child(i));return r.ws(t,a,n).next((function(t){t.forEach((function(t,e){o=o.nt(t,e);}));}));})).next((function(){return o;}));}));},t.prototype.ws=function(t,e,n){var r,i,o=this;return this.es._s(t,e,n).next((function(n){return r=n,o.ns.Es(t,e);})).next((function(e){return i=e,o.Is(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c),l=qe(u,h,h,o.yn);r=l instanceof rn?r.nt(c,l):r.remove(c);}}));})).next((function(){return r.forEach((function(t,n){ln(e,n)||(r=r.remove(t));})),r;}));},t.prototype.Is=function(t,e,n){for(var r=ft(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Ge&&null===n.get(u.key)&&(r=r.add(u.key));}var c=n;return this.es.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof rn&&(c=c.nt(t,e));})),c;}));},t;}(),Rn=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.ms=n,this.As=r;}return t.Rs=function(e,n){for(var r=ft(),i=ft(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key);}}return new t(e,n.fromCache,r,i);},t;}(),kn=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.Ps=function(t){return n.Vs(t);},this.gs=function(t){return e.ys(t);});}return t.prototype.Vs=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue;},t.prototype.next=function(){var t=++this.previousValue;return this.gs&&this.gs(t),t;},t;}();kn.ps=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ln=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n;}));},Fn=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.bs=t,this.vs=e,this.Ss=n,this.Ds=r,this.Cs=i,this.Fs=0,this.Ns=null,this.$s=Date.now(),this.reset();}return t.prototype.reset=function(){this.Fs=0;},t.prototype.ks=function(){this.Fs=this.Cs;},t.prototype.xs=function(t){var e=this;this.cancel();var n=Math.floor(this.Fs+this.Ms()),r=Math.max(0,Date.now()-this.$s),i=Math.max(0,n-r);i>0&&p('ExponentialBackoff','Backing off for '+i+' ms (base delay: '+this.Fs+' ms, delay with jitter: '+n+' ms, last attempt: '+r+' ms ago)'),this.Ns=this.bs.Os(this.vs,i,(function(){return e.$s=Date.now(),t();})),this.Fs*=this.Ds,this.Fs<this.Ss&&(this.Fs=this.Ss),this.Fs>this.Cs&&(this.Fs=this.Cs);},t.prototype.Ls=function(){null!==this.Ns&&(this.Ns.Bs(),this.Ns=null);},t.prototype.cancel=function(){null!==this.Ns&&(this.Ns.cancel(),this.Ns=null);},t.prototype.Ms=function(){return(Math.random()-.5)*this.Fs;},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(t){for(var e='',n=0;n<t.length;n++)e.length>0&&(e=Vn(e)),e=Un(t.get(n),e);return Vn(e);}function Un(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case'\0':n+='';break;case'':n+='';break;default:n+=o;}}return n;}function Vn(t){return t+'';}function jn(t){var e=t.length;if(g(e>=2),2===e)return g(''===t.charAt(0)&&''===t.charAt(1)),L.k();for(var n=e-2,r=[],i='',o=0;o<e;){var s=t.indexOf('',o);switch((s<0||s>n)&&v(),t.charAt(s+1)){case'':var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=''),r.push(u);break;case'':i+=t.substring(o,s),i+='\0';break;case'':i+=t.substring(o,s+1);break;default:v();}o=s+2;}return new L(r);}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qn=function(){function t(){this.qs=new Bn;}return t.prototype.Us=function(t,e){return this.qs.add(e),An.resolve();},t.prototype.Ts=function(t,e){return An.resolve(this.qs.getEntries(e));},t;}(),Bn=function(){function t(){this.index={};}return t.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new rt(L.P),i=!r.has(n);return this.index[e]=r.add(n),i;},t.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n);},t.prototype.getEntries=function(t){return(this.index[t]||new rt(L.P)).F();},t;}(),Wn=function(){function t(){this.Qs=new Bn;}return t.prototype.Us=function(t,e){var n=this;if(!this.Qs.has(e)){var r=e.S(),i=e.p();t.Zn((function(){n.Qs.add(e);}));var o={collectionId:r,parent:Mn(i)};return Qn(t).put(o);}return An.resolve();},t.prototype.Ts=function(t,e){var n=[],r=IDBKeyRange.bound([e,''],[C(e),''],!1,!0);return Qn(t).Ws(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(jn(o.parent));}return n;}));},t;}();function Qn(t){return pr.js(t,Vr.store);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zn=function(t){this.Ks=t;};function Gn(t,e){if(e.document)return function(t,e,n){var r=ie(t,e.name),i=te(e.updateTime),o=new Ze({mapValue:{fields:e.fields}});return new rn(r,i,o,{hasCommittedMutations:!!n});}(t.Ks,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=U.j(e.noDocument.path),r=Xn(e.noDocument.readTime);return new on(n,r,{hasCommittedMutations:!!e.hasCommittedMutations});}if(e.unknownDocument){var i=U.j(e.unknownDocument.path),o=Xn(e.unknownDocument.version);return new sn(i,o);}return v();}function Hn(t,e,n){var r=Kn(n),i=e.key.path.p().F();if(e instanceof rn){var o=function(t,e){return{name:re(t,e.key),fields:e.tn().mapValue.fields,updateTime:Xt(t,e.version.A())};}(t.Ks,e),s=e.hasCommittedMutations;return new kr(null,null,o,s,r,i);}if(e instanceof on){var a=e.key.path.F(),u=$n(e.version),c=e.hasCommittedMutations;return new kr(null,new Or(a,u),null,c,r,i);}if(e instanceof sn){var h=e.key.path.F(),l=$n(e.version);return new kr(new Rr(h,l),null,null,!0,r,i);}return v();}function Kn(t){var e=t.A();return[e.seconds,e.nanoseconds];}function Yn(t){var e=new O(t[0],t[1]);return R.I(e);}function $n(t){var e=t.A();return new Nr(e.seconds,e.nanoseconds);}function Xn(t){var e=new O(t.seconds,t.nanoseconds);return R.I(e);}function Jn(t,e){var n=(e.baseMutations||[]).map((function(e){return le(t.Ks,e);})),r=e.mutations.map((function(e){return le(t.Ks,e);})),i=O.fromMillis(e.localWriteTimeMs);return new Sn(e.batchId,i,n,r);}function Zn(t){var e,n=Xn(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?Xn(t.lastLimboFreeSnapshotVersion):R.min();return e=void 0!==t.query.documents?function(t){g(1===t.documents.length);var e=t.documents[0];return an.hn(se(e)).We();}(t.query):function(t){var e=se(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){g(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId);}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[_e(e)]:void 0!==e.fieldFilter?[me(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e);})).reduce((function(t,e){return t.concat(e);})):v():[];}(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return new Cn(ge((e=t).field),function(t){switch(t){case'ASCENDING':return'asc';case'DESCENDING':return'desc';default:return;}}(e.direction));var e;})));var u=null;n.limit&&(u=function(t){var e;return V(e='object'==typeof t?t.value:t)?null:e;}(n.limit));var c=null;n.startAt&&(c=ye(n.startAt));var h=null;return n.endAt&&(h=ye(n.endAt)),new an(e,i,a,s,u,'F',c,h).We();}(t.query),new $(e,t.targetId,0,t.lastListenSequenceNumber,n,r,H.fromBase64String(t.resumeToken));}function tr(t,e){var n,r=$n(e.X),i=$n(e.lastLimboFreeSnapshotVersion);n=G(e.target)?fe(t.Ks,e.target):pe(t.Ks,e.target);var o=e.resumeToken.toBase64();return new Fr(e.targetId,Q(e.target),r,o,e.sequenceNumber,i,n);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var er=function(){function t(t,e){this.serializer=t,this.ss=e;}return t.prototype.jn=function(t,e,n){return rr(t).put(ir(e),n);},t.prototype.Gn=function(t,e){var n=rr(t),r=ir(e);return n.delete(r);},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Gs(t,r);}));},t.prototype.zn=function(t,e){var n=this;return rr(t).get(ir(e)).next((function(t){return n.zs(t);}));},t.prototype.Hs=function(t,e){var n=this;return rr(t).get(ir(e)).next((function(t){var e=n.zs(t);return e?{Ys:e,size:or(t)}:null;}));},t.prototype.getEntries=function(t,e){var n=this,r=at();return this.Js(t,e,(function(t,e){var i=n.zs(e);r=r.nt(t,i);})).next((function(){return r;}));},t.prototype.Xs=function(t,e){var n=this,r=at(),i=new tt(U.P);return this.Js(t,e,(function(t,e){var o=n.zs(e);o?(r=r.nt(t,o),i=i.nt(t,or(e))):(r=r.nt(t,null),i=i.nt(t,0));})).next((function(){return{Zs:r,ti:i};}));},t.prototype.Js=function(t,e,n){if(e._())return An.resolve();var r=IDBKeyRange.bound(e.first().path.F(),e.last().path.F()),i=e.at(),o=i.dt();return rr(t).ei({range:r},(function(t,e,r){for(var s=U.j(t);o&&U.P(o,s)<0;)n(o,null),o=i.dt();o&&o.isEqual(s)&&(n(o,e),o=i.wt()?i.dt():null),o?r.ni(o.path.F()):r.done();})).next((function(){for(;o;)n(o,null),o=i.wt()?i.dt():null;}));},t.prototype._s=function(t,e,n){var r=this,i=ct(),o=e.path.length+1,s={};if(n.isEqual(R.min())){var a=e.path.F();s.range=IDBKeyRange.lowerBound(a);}else{var u=e.path.F(),c=Kn(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=kr.collectionReadTimeIndex;}return rr(t).ei(s,(function(t,n,s){if(t.length===o){var a=Gn(r.serializer,n);e.path.D(a.key.path)?a instanceof rn&&ln(e,a)&&(i=i.nt(a.key,a)):s.done();}})).next((function(){return i;}));},t.prototype.si=function(t,e){var n=this,r=st(),i=Kn(e),o=rr(t),s=IDBKeyRange.lowerBound(i,!0);return o.ei({index:kr.readTimeIndex,range:s},(function(t,e){var o=Gn(n.serializer,e);r=r.nt(o.key,o),i=e.readTime;})).next((function(){return{ii:r,readTime:Yn(i)};}));},t.prototype.ri=function(t){var e=rr(t),n=R.min();return e.ei({index:kr.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Yn(e.readTime)),r.done();})).next((function(){return n;}));},t.prototype.oi=function(e){return new t.hi(this,!!e&&e.ai);},t.prototype.ui=function(t){return this.getMetadata(t).next((function(t){return t.byteSize;}));},t.prototype.getMetadata=function(t){return nr(t).get(Lr.key).next((function(t){return g(!!t),t;}));},t.prototype.Gs=function(t,e){return nr(t).put(Lr.key,e);},t.prototype.zs=function(t){if(t){var e=Gn(this.serializer,t);return e instanceof on&&e.version.isEqual(R.min())?null:e;}return null;},t;}();function nr(t){return pr.js(t,Lr.store);}function rr(t){return pr.js(t,kr.store);}function ir(t){return t.path.F();}function or(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw v();e=t.noDocument;}return JSON.stringify(e).length;}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */er.hi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ci=e,r.ai=n,r.li=new x((function(t){return t.toString();}),(function(t,e){return t.isEqual(e);})),r;}return i.__extends(e,t),e.prototype.Jn=function(t){var e=this,n=[],r=0,i=new rt((function(t,e){return b(t.N(),e.N());}));return this.Un.forEach((function(o,s){var a=e.li.get(o);if(s){var u=Hn(e.ci.serializer,s,e.readTime);i=i.add(o.path.p());var c=or(u);r+=c-a,n.push(e.ci.jn(t,o,u));}else if(r-=a,e.ai){var h=Hn(e.ci.serializer,new on(o,R.min()),e.readTime);n.push(e.ci.jn(t,o,h));}else n.push(e.ci.Gn(t,o));})),i.forEach((function(r){n.push(e.ci.ss.Us(t,r));})),n.push(this.ci.updateMetadata(t,r)),An.Bn(n);},e.prototype.Hn=function(t,e){var n=this;return this.ci.Hs(t,e).next((function(t){return null===t?(n.li.set(e,0),null):(n.li.set(e,t.size),t.Ys);}));},e.prototype.Yn=function(t,e){var n=this;return this.ci.Xs(t,e).next((function(t){var e=t.Zs;return t.ti.forEach((function(t,e){n.li.set(t,e);})),e;}));},e;}(xn);var sr=function(){function t(t){this._i=t;}return t.prototype.next=function(){return this._i+=2,this._i;},t.fi=function(){return new t(0);},t.di=function(){return new t(-1);},t;}(),ar=function(){function t(t,e){this.wi=t,this.serializer=e;}return t.prototype.Ti=function(t){var e=this;return this.Ei(t).next((function(n){var r=new sr(n.highestTargetId);return n.highestTargetId=r.next(),e.Ii(t,n).next((function(){return n.highestTargetId;}));}));},t.prototype.mi=function(t){return this.Ei(t).next((function(t){return R.I(new O(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds));}));},t.prototype.Ai=function(t){return this.Ei(t).next((function(t){return t.highestListenSequenceNumber;}));},t.prototype.Ri=function(t,e,n){var r=this;return this.Ei(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.A()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ii(t,i);}));},t.prototype.Pi=function(t,e){var n=this;return this.Vi(t,e).next((function(){return n.Ei(t).next((function(r){return r.targetCount+=1,n.gi(e,r),n.Ii(t,r);}));}));},t.prototype.yi=function(t,e){return this.Vi(t,e);},t.prototype.pi=function(t,e){var n=this;return this.bi(t,e.targetId).next((function(){return ur(t).delete(e.targetId);})).next((function(){return n.Ei(t);})).next((function(e){return g(e.targetCount>0),e.targetCount-=1,n.Ii(t,e);}));},t.prototype.vi=function(t,e,n){var r=this,i=0,o=[];return ur(t).ei((function(s,a){var u=Zn(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.pi(t,u)));})).next((function(){return An.Bn(o);})).next((function(){return i;}));},t.prototype.pe=function(t,e){return ur(t).ei((function(t,n){var r=Zn(n);e(r);}));},t.prototype.Ei=function(t){return cr(t).get(Ur.key).next((function(t){return g(null!==t),t;}));},t.prototype.Ii=function(t,e){return cr(t).put(Ur.key,e);},t.prototype.Vi=function(t,e){return ur(t).put(tr(this.serializer,e));},t.prototype.gi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n;},t.prototype.Si=function(t){return this.Ei(t).next((function(t){return t.targetCount;}));},t.prototype.Di=function(t,e){var n=Q(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return ur(t).ei({range:r,index:Fr.queryTargetsIndexName},(function(t,n,r){var o=Zn(n);z(e,o.target)&&(i=o,r.done());})).next((function(){return i;}));},t.prototype.Ci=function(t,e,n){var r=this,i=[],o=hr(t);return e.forEach((function(e){var s=Mn(e.path);i.push(o.put(new Mr(n,s))),i.push(r.wi.Fi(t,n,e));})),An.Bn(i);},t.prototype.Ni=function(t,e,n){var r=this,i=hr(t);return An.forEach(e,(function(e){var o=Mn(e.path);return An.Bn([i.delete([n,o]),r.wi.$i(t,n,e)]);}));},t.prototype.bi=function(t,e){var n=hr(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r);},t.prototype.ki=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=hr(t),i=ft();return r.ei({range:n,xi:!0},(function(t,e,n){var r=jn(t[1]),o=new U(r);i=i.add(o);})).next((function(){return i;}));},t.prototype.Mi=function(t,e){var n=Mn(e.path),r=IDBKeyRange.bound([n],[C(n)],!1,!0),i=0;return hr(t).ei({index:Mr.documentTargetsIndex,xi:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done());})).next((function(){return i>0;}));},t.prototype.Me=function(t,e){return ur(t).get(e).next((function(t){return t?Zn(t):null;}));},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ur(t){return pr.js(t,Fr.store);}function cr(t){return pr.js(t,Ur.store);}function hr(t){return pr.js(t,Mr.store);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lr='Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.',fr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Oi=e,r.Li=n,r;}return i.__extends(e,t),e;}(Dn),pr=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.bs=o,this.window=s,this.document=a,this.Bi=c,this.qi=h,this.Ui=null,this.Qi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Wi=null,this.inForeground=!1,this.ji=null,this.Ki=null,this.Gi=Number.NEGATIVE_INFINITY,this.zi=function(t){return Promise.resolve();},!t.Hi())throw new D(P.UNIMPLEMENTED,'This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.');this.wi=new vr(this,i),this.Yi=n+'main',this.serializer=new zn(u),this.Ji=new ar(this.wi,this.serializer),this.ss=new Wn,this.es=new er(this.serializer,this.ss),this.window&&this.window.localStorage?this.Xi=this.window.localStorage:(this.Xi=null,!1===h&&d('IndexedDbPersistence','LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page.'));}return t.js=function(t,e){if(t instanceof fr)return Wr.js(t.Oi,e);throw v();},t.prototype.start=function(){var t=this;return Wr.Zi(this.Yi,Tr,new Sr(this.serializer)).then((function(e){return t.tr=e,t.er();})).then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,lr);return t.nr(),t.sr(),t.ir(),t.runTransaction('getHighestListenSequenceNumber','readonly',(function(e){return t.Ji.Ai(e);}));})).then((function(e){t.Ui=new kn(e,t.Bi);})).then((function(){t.Qi=!0;})).catch((function(e){return t.tr&&t.tr.close(),Promise.reject(e);}));},t.prototype.rr=function(t){var e=this;return this.zi=function(n){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(e){return this.or?[2,t(n)]:[2];}));}));},t(this.isPrimary);},t.prototype.hr=function(t){var e=this;this.tr.ar((function(n){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2];}}));}));}));},t.prototype.ur=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.bs.cr((function(){return i.__awaiter(e,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.or?[4,this.er()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2];}}));}));})));},t.prototype.er=function(){var t=this;return this.runTransaction('updateClientMetadataAndTryBecomePrimary','readwrite',(function(e){return yr(e).put(new qr(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.lr(e).next((function(e){e||(t.isPrimary=!1,t.bs._r((function(){return t.zi(!1);})));}));})).next((function(){return t.dr(e);})).next((function(n){return t.isPrimary&&!n?t.wr(e).next((function(){return!1;})):!!n&&t.Tr(e).next((function(){return!0;}));}));})).catch((function(e){if(Gr(e))return p('IndexedDbPersistence','Failed to extend owner lease: ',e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return p('IndexedDbPersistence','Releasing owner lease after error during lease refresh',e),!1;})).then((function(e){t.isPrimary!==e&&t.bs._r((function(){return t.zi(e);})),t.isPrimary=e;}));},t.prototype.lr=function(t){var e=this;return dr(t).get(Ar.key).next((function(t){return An.resolve(e.Er(t));}));},t.prototype.Ir=function(t){return yr(t).delete(this.clientId);},t.prototype.mr=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.Ar(this.Gi,18e5)?[3,2]:(this.Gi=Date.now(),[4,this.runTransaction('maybeGarbageCollectMultiClientState','readwrite-primary',(function(e){var n=t.js(e,qr.store);return n.Ws().next((function(t){var e=s.Rr(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t);}));return An.forEach(r,(function(t){return n.delete(t.clientId);})).next((function(){return r;}));}));})).catch((function(){return[];}))]);case 1:if(e=i.sent(),this.Xi)for(n=0,r=e;n<r.length;n++)o=r[n],this.Xi.removeItem(this.Pr(o.clientId));i.label=2;case 2:return[2];}}));}));},t.prototype.ir=function(){var t=this;this.Ki=this.bs.Os('client_metadata_refresh',4e3,(function(){return t.er().then((function(){return t.mr();})).then((function(){return t.ir();}));}));},t.prototype.Er=function(t){return!!t&&t.ownerId===this.clientId;},t.prototype.dr=function(t){var e=this;return this.qi?An.resolve(!0):dr(t).get(Ar.key).next((function(n){if(null!==n&&e.Ar(n.leaseTimestampMs,5e3)&&!e.Vr(n.ownerId)){if(e.Er(n)&&e.networkEnabled)return!0;if(!e.Er(n)){if(!n.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,lr);return!1;}}return!(!e.networkEnabled||!e.inForeground)||yr(t).Ws().next((function(t){return void 0===e.Rr(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0;}return!1;}));}));})).next((function(t){return e.isPrimary!==t&&p('IndexedDbPersistence','Client '+(t?'is':'is not')+' eligible for a primary lease.'),t;}));},t.prototype.gr=function(){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(e){switch(e.label){case 0:return this.Qi=!1,this.yr(),this.Ki&&(this.Ki.cancel(),this.Ki=null),this.pr(),this.br(),[4,this.runTransaction('shutdown','readwrite',(function(e){return t.wr(e).next((function(){return t.Ir(e);}));})).catch((function(t){p('IndexedDbPersistence','Proceeding with shutdown despite failure: ',t);}))];case 1:return e.sent(),this.tr.close(),this.vr(),[2];}}));}));},t.prototype.Rr=function(t,e){var n=this;return t.filter((function(t){return n.Ar(t.updateTimeMs,e)&&!n.Vr(t.clientId);}));},t.prototype.Sr=function(){var t=this;return this.runTransaction('getActiveClients','readonly',(function(e){return yr(e).Ws().next((function(e){return t.Rr(e,18e5).map((function(t){return t.clientId;}));}));}));},Object.defineProperty(t.prototype,'or',{get:function(){return this.Qi;},enumerable:!1,configurable:!0}),t.prototype.Dr=function(t){return _r.Cr(t,this.serializer,this.ss,this.wi);},t.prototype.Fr=function(){return this.Ji;},t.prototype.Nr=function(){return this.es;},t.prototype.$r=function(){return this.ss;},t.prototype.runTransaction=function(t,e,n){var r=this;p('IndexedDbPersistence','Starting transaction:',t);var i,o='readonly'===e?'readonly':'readwrite';return this.tr.runTransaction(o,Br,(function(o){return i=new fr(o,r.Ui?r.Ui.next():kn.ps),'readwrite-primary'===e?r.lr(i).next((function(t){return!!t||r.dr(i);})).next((function(e){if(!e)throw d('Failed to obtain primary lease for action \''+t+'\'.'),r.isPrimary=!1,r.bs._r((function(){return r.zi(!1);})),new D(P.FAILED_PRECONDITION,Pn);return n(i);})).next((function(t){return r.Tr(i).next((function(){return t;}));})):r.kr(i).next((function(){return n(i);}));})).then((function(t){return i.ts(),t;}));},t.prototype.kr=function(t){var e=this;return dr(t).get(Ar.key).next((function(t){if(null!==t&&e.Ar(t.leaseTimestampMs,5e3)&&!e.Vr(t.ownerId)&&!e.Er(t)&&!(e.qi||e.allowTabSynchronization&&t.allowTabSynchronization))throw new D(P.FAILED_PRECONDITION,lr);}));},t.prototype.Tr=function(t){var e=new Ar(this.clientId,this.allowTabSynchronization,Date.now());return dr(t).put(Ar.key,e);},t.Hi=function(){return Wr.Hi();},t.prototype.wr=function(t){var e=this,n=dr(t);return n.get(Ar.key).next((function(t){return e.Er(t)?(p('IndexedDbPersistence','Releasing primary lease.'),n.delete(Ar.key)):An.resolve();}));},t.prototype.Ar=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(d('Detected an update time that is in the future: '+t+' > '+n),1));},t.prototype.nr=function(){var t=this;null!==this.document&&'function'==typeof this.document.addEventListener&&(this.ji=function(){t.bs.cr((function(){return t.inForeground='visible'===t.document.visibilityState,t.er();}));},this.document.addEventListener('visibilitychange',this.ji),this.inForeground='visible'===this.document.visibilityState);},t.prototype.pr=function(){this.ji&&(this.document.removeEventListener('visibilitychange',this.ji),this.ji=null);},t.prototype.sr=function(){var t,e=this;'function'==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Wi=function(){e.yr(),e.bs.cr((function(){return e.gr();}));},this.window.addEventListener('unload',this.Wi));},t.prototype.br=function(){this.Wi&&(this.window.removeEventListener('unload',this.Wi),this.Wi=null);},t.prototype.Vr=function(t){var e;try{var n=null!==(null===(e=this.Xi)||void 0===e?void 0:e.getItem(this.Pr(t)));return p('IndexedDbPersistence','Client \''+t+'\' '+(n?'is':'is not')+' zombied in LocalStorage'),n;}catch(t){return d('IndexedDbPersistence','Failed to get zombied client id.',t),!1;}},t.prototype.yr=function(){if(this.Xi)try{this.Xi.setItem(this.Pr(this.clientId),String(Date.now()));}catch(t){d('Failed to set zombie client id.',t);}},t.prototype.vr=function(){if(this.Xi)try{this.Xi.removeItem(this.Pr(this.clientId));}catch(t){}},t.prototype.Pr=function(t){return'firestore_zombie_'+this.persistenceKey+'_'+t;},t;}();function dr(t){return pr.js(t,Ar.store);}function yr(t){return pr.js(t,qr.store);}var vr=function(){function t(t,e){this.db=t,this.xr=new ai(this,e);}return t.prototype.Mr=function(t){var e=this.Or(t);return this.db.Fr().Si(t).next((function(t){return e.next((function(e){return t+e;}));}));},t.prototype.Or=function(t){var e=0;return this.Lr(t,(function(t){e++;})).next((function(){return e;}));},t.prototype.pe=function(t,e){return this.db.Fr().pe(t,e);},t.prototype.Lr=function(t,e){return this.Br(t,(function(t,n){return e(n);}));},t.prototype.Fi=function(t,e,n){return gr(t,n);},t.prototype.$i=function(t,e,n){return gr(t,n);},t.prototype.vi=function(t,e,n){return this.db.Fr().vi(t,e,n);},t.prototype.qr=function(t,e){return gr(t,e);},t.prototype.Ur=function(t,e){return function(t,e){var n=!1;return Ir(t).Qr((function(r){return wr(t,r,e).next((function(t){return t&&(n=!0),An.resolve(!t);}));})).next((function(){return n;}));}(t,e);},t.prototype.Wr=function(t,e){var n=this,r=this.db.Nr().oi(),i=[],o=0;return this.Br(t,(function(s,a){if(a<=e){var u=n.Ur(t,s).next((function(e){if(!e)return o++,r.zn(t,s).next((function(){return r.Gn(s),hr(t).delete([0,Mn(s.path)]);}));}));i.push(u);}})).next((function(){return An.Bn(i);})).next((function(){return r.apply(t);})).next((function(){return o;}));},t.prototype.removeTarget=function(t,e){var n=e.Z(t.Li);return this.db.Fr().yi(t,n);},t.prototype.jr=function(t,e){return gr(t,e);},t.prototype.Br=function(t,e){var n,r=hr(t),i=kn.ps;return r.ei({index:Mr.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==kn.ps&&e(new U(jn(n)),i),i=a,n=s):i=kn.ps;})).next((function(){i!==kn.ps&&e(new U(jn(n)),i);}));},t.prototype.Kr=function(t){return this.db.Nr().ui(t);},t;}();function gr(t,e){return hr(t).put(function(t,e){return new Mr(0,Mn(t.path),e);}(e,t.Li));}function mr(t,e){var n=t.projectId;return t.i||(n+='.'+t.database),'firestore/'+e+'/'+n+'/';
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var _r=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.ss=n,this.wi=r,this.Gr={};}return t.Cr=function(e,n,r,i){return g(''!==e.uid),new t(e.zr()?e.uid:'',n,r,i);},t.prototype.Hr=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Er(t).ei({index:Pr.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done();})).next((function(){return e;}));},t.prototype.Yr=function(t,e,n,r){var i=this,o=Cr(t),s=Er(t);return s.add({}).next((function(a){g('number'==typeof a);for(var u=new Sn(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return he(t.Ks,e);})),i=n.mutations.map((function(e){return he(t.Ks,e);}));return new Pr(e,n.batchId,n.yn.toMillis(),r,i);}(i.serializer,i.userId,u),h=[],l=new rt((function(t,e){return b(t.N(),e.N());})),f=0,p=r;f<p.length;f++){var d=p[f],y=Dr.key(i.userId,d.key.path,a);l=l.add(d.key.path.p()),h.push(s.put(c)),h.push(o.put(y,Dr.PLACEHOLDER));}return l.forEach((function(e){h.push(i.ss.Us(t,e));})),t.Zn((function(){i.Gr[a]=u.keys();})),An.Bn(h).next((function(){return u;}));}));},t.prototype.Jr=function(t,e){var n=this;return Er(t).get(e).next((function(t){return t?(g(t.userId===n.userId),Jn(n.serializer,t)):null;}));},t.prototype.Xr=function(t,e){var n=this;return this.Gr[e]?An.resolve(this.Gr[e]):this.Jr(t,e).next((function(t){if(t){var r=t.keys();return n.Gr[e]=r,r;}return null;}));},t.prototype.Zr=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Er(t).ei({index:Pr.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(g(e.batchId>=r),o=Jn(n.serializer,e)),i.done();})).next((function(){return o;}));},t.prototype.to=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Er(t).ei({index:Pr.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done();})).next((function(){return n;}));},t.prototype.eo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Er(t).Ws(Pr.userMutationsIndex,n).next((function(t){return t.map((function(t){return Jn(e.serializer,t);}));}));},t.prototype.os=function(t,e){var n=this,r=Dr.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Cr(t).ei({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=jn(u);if(a===n.userId&&e.path.isEqual(h))return Er(t).get(c).next((function(t){if(!t)throw v();g(t.userId===n.userId),o.push(Jn(n.serializer,t));}));s.done();})).next((function(){return o;}));},t.prototype.ls=function(t,e){var n=this,r=new rt(b),i=[];return e.forEach((function(e){var o=Dr.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Cr(t).ei({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=jn(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done();}));i.push(a);})),An.Bn(i).next((function(){return n.no(t,r);}));},t.prototype.Es=function(t,e){var n=this,r=e.path,i=r.length+1,o=Dr.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new rt(b);return Cr(t).ei({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=jn(u);s===n.userId&&r.D(h)?h.length===i&&(a=a.add(c)):o.done();})).next((function(){return n.no(t,a);}));},t.prototype.no=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Er(t).get(e).next((function(t){if(null===t)throw v();g(t.userId===n.userId),r.push(Jn(n.serializer,t));})));})),An.Bn(i).next((function(){return r;}));},t.prototype.so=function(t,e){var n=this;return br(t.Oi,this.userId,e).next((function(r){return t.Zn((function(){n.io(e.batchId);})),An.forEach(r,(function(e){return n.wi.qr(t,e);}));}));},t.prototype.io=function(t){delete this.Gr[t];},t.prototype.ro=function(t){var e=this;return this.Hr(t).next((function(n){if(!n)return An.resolve();var r=IDBKeyRange.lowerBound(Dr.prefixForUser(e.userId)),i=[];return Cr(t).ei({range:r},(function(t,n,r){if(t[0]===e.userId){var o=jn(t[1]);i.push(o);}else r.done();})).next((function(){g(0===i.length);}));}));},t.prototype.Mi=function(t,e){return wr(t,this.userId,e);},t.prototype.oo=function(t){var e=this;return Ir(t).get(this.userId).next((function(t){return t||new xr(e.userId,-1,'');}));},t;}();function wr(t,e,n){var r=Dr.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Cr(t).ei({range:o,xi:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done();})).next((function(){return s;}));}function br(t,e,n){var r=t.store(Pr.store),i=t.store(Dr.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.ei({range:s},(function(t,e,n){return a++,n.delete();}));o.push(u.next((function(){g(1===a);})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Dr.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key);}return An.Bn(o).next((function(){return c;}));}function Er(t){return pr.js(t,Pr.store);}function Cr(t){return pr.js(t,Dr.store);}function Ir(t){return pr.js(t,xr.store);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tr=10,Sr=function(){function t(t){this.serializer=t;}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;g(n<r&&n>=0&&r<=Tr);var o=new Hr(e);n<1&&r>=1&&(function(t){t.createObjectStore(Ar.store);}(t),function(t){t.createObjectStore(xr.store,{keyPath:xr.keyPath}),t.createObjectStore(Pr.store,{keyPath:Pr.keyPath,autoIncrement:!0}).createIndex(Pr.userMutationsIndex,Pr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Dr.store);}(t),jr(t),function(t){t.createObjectStore(kr.store);}(t));var s=An.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Mr.store),t.deleteObjectStore(Fr.store),t.deleteObjectStore(Ur.store);}(t),jr(t)),s=s.next((function(){return function(t){var e=t.store(Ur.store),n=new Ur(0,0,R.min().A(),0);return e.put(Ur.key,n);}(o);}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Pr.store).Ws().next((function(n){t.deleteObjectStore(Pr.store),t.createObjectStore(Pr.store,{keyPath:Pr.keyPath,autoIncrement:!0}).createIndex(Pr.userMutationsIndex,Pr.userMutationsKeyPath,{unique:!0});var r=e.store(Pr.store),i=n.map((function(t){return r.put(t);}));return An.Bn(i);}));}(t,o);}))),s=s.next((function(){!function(t){t.createObjectStore(qr.store,{keyPath:qr.keyPath});}(t);}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o);}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Lr.store);}(t),i.addDocumentGlobal(o);}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o);}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o);}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains('remoteDocumentChanges')&&t.deleteObjectStore('remoteDocumentChanges');}(t),function(t){var e=t.objectStore(kr.store);e.createIndex(kr.readTimeIndex,kr.readTimeIndexPath,{unique:!1}),e.createIndex(kr.collectionReadTimeIndex,kr.collectionReadTimeIndexPath,{unique:!1});}(e);}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o);}))),s;},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(kr.store).ei((function(t,n){e+=or(n);})).next((function(){var n=new Lr(e);return t.store(Lr.store).put(Lr.key,n);}));},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(xr.store),r=t.store(Pr.store);return n.Ws().next((function(n){return An.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Ws(Pr.userMutationsIndex,i).next((function(r){return An.forEach(r,(function(r){g(r.userId===n.userId);var i=Jn(e.serializer,r);return br(t,n.userId,i).next((function(){}));}));}));}));}));},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Mr.store),n=t.store(kr.store);return t.store(Ur.store).get(Ur.key).next((function(t){var r=[];return n.ei((function(n,i){var o=new L(n),s=function(t){return[0,Mn(t)];}(o);r.push(e.get(s).next((function(n){return n?An.resolve():function(n){return e.put(new Mr(0,Mn(n),t.highestListenSequenceNumber));}(o);})));})).next((function(){return An.Bn(r);}));}));},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Vr.store,{keyPath:Vr.keyPath});var n=e.store(Vr.store),r=new Bn,i=function(t){if(r.add(t)){var e=t.S(),i=t.p();return n.put({collectionId:e,parent:Mn(i)});}};return e.store(kr.store).ei({xi:!0},(function(t,e){var n=new L(t);return i(n.p());})).next((function(){return e.store(Dr.store).ei({xi:!0},(function(t,e){t[0];var n=t[1],r=(t[2],jn(n));return i(r.p());}));}));},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Fr.store);return n.ei((function(t,r){var i=Zn(r),o=tr(e.serializer,i);return n.put(o);}));},t;}(),Nr=function(t,e){this.seconds=t,this.nanoseconds=e;},Ar=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n;};Ar.store='owner',Ar.key='owner';var xr=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n;};xr.store='mutationQueues',xr.keyPath='userId';var Pr=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i;};Pr.store='mutations',Pr.keyPath='batchId',Pr.userMutationsIndex='userMutationsIndex',Pr.userMutationsKeyPath=['userId','batchId'];var Dr=function(){function t(){}return t.prefixForUser=function(t){return[t];},t.prefixForPath=function(t,e){return[t,Mn(e)];},t.key=function(t,e,n){return[t,Mn(e),n];},t;}();Dr.store='documentMutations',Dr.PLACEHOLDER=new Dr;var Or=function(t,e){this.path=t,this.readTime=e;},Rr=function(t,e){this.path=t,this.version=e;},kr=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o;};kr.store='remoteDocuments',kr.readTimeIndex='readTimeIndex',kr.readTimeIndexPath='readTime',kr.collectionReadTimeIndex='collectionReadTimeIndex',kr.collectionReadTimeIndexPath=['parentPath','readTime'];var Lr=function(t){this.byteSize=t;};Lr.store='remoteDocumentGlobal',Lr.key='remoteDocumentGlobalKey';var Fr=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s;};Fr.store='targets',Fr.keyPath='targetId',Fr.queryTargetsIndexName='queryTargetsIndex',Fr.queryTargetsKeyPath=['canonicalId','targetId'];var Mr=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n;};Mr.store='targetDocuments',Mr.keyPath=['targetId','path'],Mr.documentTargetsIndex='documentTargetsIndex',Mr.documentTargetsKeyPath=['path','targetId'];var Ur=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r;};Ur.key='targetGlobalKey',Ur.store='targetGlobal';var Vr=function(t,e){this.collectionId=t,this.parent=e;};function jr(t){t.createObjectStore(Mr.store,{keyPath:Mr.keyPath}).createIndex(Mr.documentTargetsIndex,Mr.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Fr.store,{keyPath:Fr.keyPath}).createIndex(Fr.queryTargetsIndexName,Fr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ur.store);}Vr.store='collectionParents',Vr.keyPath=['collectionId','parent'];var qr=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r;};qr.store='clientMetadata',qr.keyPath='clientId';var Br=i.__spreadArrays(i.__spreadArrays(i.__spreadArrays([xr.store,Pr.store,Dr.store,kr.store,Fr.store,Ar.store,Ur.store,Mr.store],[qr.store]),[Lr.store]),[Vr.store]),Wr=function(){function e(t){this.db=t,12.2===e.ho(a.getUA())&&d('Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.');}return e.Zi=function(t,n,r){return p('SimpleDb','Opening database:',t),new An((function(i,o){var s=indexedDB.open(t,n);s.onsuccess=function(t){var n=t.target.result;i(new e(n));},s.onblocked=function(){o(new D(P.FAILED_PRECONDITION,'Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed.'));},s.onerror=function(t){var e=t.target.error;'VersionError'===e.name?o(new D(P.FAILED_PRECONDITION,'A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.')):o(e);},s.onupgradeneeded=function(e){p('SimpleDb','Database "'+t+'" requires upgrade from version:',e.oldVersion);var n=e.target.result;r.createOrUpgrade(n,s.transaction,e.oldVersion,Tr).next((function(){p('SimpleDb','Database upgrade to version '+Tr+' complete');}));};})).On();},e.delete=function(t){return p('SimpleDb','Removing database:',t),Yr(window.indexedDB.deleteDatabase(t)).On();},e.Hi=function(){if('undefined'==typeof indexedDB)return!1;if(e.ao())return!0;var t=a.getUA(),n=e.ho(t),r=0<n&&n<10,i=e.uo(t),o=0<i&&i<4.5;return!(t.indexOf('MSIE ')>0||t.indexOf('Trident/')>0||t.indexOf('Edge/')>0||r||o);},e.ao=function(){var e;return void 0!==t&&'YES'===(null===(e=t.env)||void 0===e?void 0:e.co);},e.js=function(t,e){return t.store(e);},e.ho=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split('_').slice(0,2).join('.'):'-1';return Number(n);},e.uo=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split('.').slice(0,2).join('.'):'-1';return Number(n);},e.prototype.ar=function(t){this.db.onversionchange=function(e){return t(e);};},e.prototype.runTransaction=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o,s,a,u;return i.__generator(this,(function(c){switch(c.label){case 0:r='readonly'===t,o=0,s=function(){var t,s,u,c,h;return i.__generator(this,(function(i){switch(i.label){case 0:++o,t=Hr.open(a.db,r?'readonly':'readwrite',e),i.label=1;case 1:return i.trys.push([1,3,,4]),s=n(t).catch((function(e){return t.abort(e),An.reject(e);})).On(),u={},s.catch((function(){})),[4,t.lo];case 2:return[2,(u.value=(i.sent(),s),u)];case 3:return c=i.sent(),h='FirebaseError'!==c.name&&o<3,p('SimpleDb','Transaction failed with error: %s. Retrying: %s.',c.message,h),h?[3,4]:[2,{value:Promise.reject(c)}];case 4:return[2];}}));},a=this,c.label=1;case 1:return[5,s()];case 2:if('object'==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2];}}));}));},e.prototype.close=function(){this.db.close();},e;}(),Qr=function(){function t(t){this._o=t,this.fo=!1,this.do=null;}return Object.defineProperty(t.prototype,'$n',{get:function(){return this.fo;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'wo',{get:function(){return this.do;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'cursor',{set:function(t){this._o=t;},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.fo=!0;},t.prototype.ni=function(t){this.do=t;},t.prototype.delete=function(){return Yr(this._o.delete());},t;}(),zr=function(t){function e(e){var n=this;return(n=t.call(this,P.UNAVAILABLE,'IndexedDB transaction failed: '+e)||this).name='IndexedDbTransactionError',n;}return i.__extends(e,t),e;}(D);function Gr(t){return'IndexedDbTransactionError'===t.name;}var Hr=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.To=new Ln,this.transaction.oncomplete=function(){e.To.resolve();},this.transaction.onabort=function(){t.error?e.To.reject(new zr(t.error)):e.To.resolve();},this.transaction.onerror=function(t){var n=Xr(t.target.error);e.To.reject(new zr(n));};}return t.open=function(e,n,r){return new t(e.transaction(r,n));},Object.defineProperty(t.prototype,'lo',{get:function(){return this.To.promise;},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.To.reject(t),this.aborted||(p('SimpleDb','Aborting transaction:',t?t.message:'Client-initiated abort'),this.aborted=!0,this.transaction.abort());},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Kr(e);},t;}(),Kr=function(){function t(t){this.store=t;}return t.prototype.put=function(t,e){var n;return void 0!==e?(p('SimpleDb','PUT',this.store.name,t,e),n=this.store.put(e,t)):(p('SimpleDb','PUT',this.store.name,'<auto-key>',t),n=this.store.put(t)),Yr(n);},t.prototype.add=function(t){return p('SimpleDb','ADD',this.store.name,t,t),Yr(this.store.add(t));},t.prototype.get=function(t){var e=this;return Yr(this.store.get(t)).next((function(n){return void 0===n&&(n=null),p('SimpleDb','GET',e.store.name,t,n),n;}));},t.prototype.delete=function(t){return p('SimpleDb','DELETE',this.store.name,t),Yr(this.store.delete(t));},t.prototype.count=function(){return p('SimpleDb','COUNT',this.store.name),Yr(this.store.count());},t.prototype.Ws=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Eo(n,(function(t,e){r.push(e);})).next((function(){return r;}));},t.prototype.Io=function(t,e){p('SimpleDb','DELETE ALL',this.store.name);var n=this.options(t,e);n.xi=!1;var r=this.cursor(n);return this.Eo(r,(function(t,e,n){return n.delete();}));},t.prototype.ei=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Eo(r,e);},t.prototype.Qr=function(t){var e=this.cursor({});return new An((function(n,r){e.onerror=function(t){var e=Xr(t.target.error);r(e);},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n();})):n();};}));},t.prototype.Eo=function(t,e){var n=[];return new An((function(r,i){t.onerror=function(t){i(t.target.error);},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Qr(i),s=e(i.primaryKey,i.value,o);if(s instanceof An){var a=s.catch((function(t){return o.done(),An.reject(t);}));n.push(a);}o.$n?r():null===o.wo?i.continue():i.continue(o.wo);}else r();};})).next((function(){return An.Bn(n);}));},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&('string'==typeof t?n=t:e=t),{index:n,range:e};},t.prototype.cursor=function(t){var e='next';if(t.reverse&&(e='prev'),t.index){var n=this.store.index(t.index);return t.xi?n.openKeyCursor(t.range,e):n.openCursor(t.range,e);}return this.store.openCursor(t.range,e);},t;}();function Yr(t){return new An((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n);},t.onerror=function(t){var e=Xr(t.target.error);n(e);};}));}var $r=!1;function Xr(t){var e=Wr.ho(a.getUA());if(e>=12.2&&e<13){var n='An internal error was encountered in the Indexed Database server';if(t.message.indexOf(n)>=0){var r=new D('internal','IOS_INDEXEDDB_BUG1: IndexedDb has thrown \''+n+'\'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.');return $r||($r=!0,setTimeout((function(){throw r;}),0)),r;}}return t;}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jr(){return'undefined'!=typeof window?window:null;}var Zr=function(){function t(t,e,n,r,i){this.mo=t,this.vs=e,this.Ao=n,this.op=r,this.Ro=i,this.Po=new Ln,this.then=this.Po.promise.then.bind(this.Po.promise),this.Po.promise.catch((function(t){}));}return t.Vo=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s;},t.prototype.start=function(t){var e=this;this.yo=setTimeout((function(){return e.po();}),t);},t.prototype.Bs=function(){return this.po();},t.prototype.cancel=function(t){null!==this.yo&&(this.clearTimeout(),this.Po.reject(new D(P.CANCELLED,'Operation cancelled'+(t?': '+t:''))));},t.prototype.po=function(){var t=this;this.mo.cr((function(){return null!==t.yo?(t.clearTimeout(),t.op().then((function(e){return t.Po.resolve(e);}))):Promise.resolve();}));},t.prototype.clearTimeout=function(){null!==this.yo&&(this.Ro(this),clearTimeout(this.yo),this.yo=null);},t;}(),ti=function(){function t(){var t=this;this.bo=Promise.resolve(),this.vo=[],this.So=!1,this.Do=[],this.Co=null,this.Fo=!1,this.No=[],this.$o=new Fn(this,'async_queue_retry'),this.ko=function(){return t.$o.Ls();};var e=Jr();e&&'function'==typeof e.addEventListener&&e.addEventListener('visibilitychange',this.ko);}return Object.defineProperty(t.prototype,'xo',{get:function(){return this.So;},enumerable:!1,configurable:!0}),t.prototype.cr=function(t){this.enqueue(t);},t.prototype.Mo=function(t){this.Oo(),this.Lo(t);},t.prototype.Bo=function(t){return this.Oo(),this.Lo(t);},t.prototype.qo=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return this.Oo(),this.So?[3,2]:(this.So=!0,(e=Jr())&&e.removeEventListener('visibilitychange',this.ko),[4,this.Bo(t)]);case 1:n.sent(),n.label=2;case 2:return[2];}}));}));},t.prototype.enqueue=function(t){return this.Oo(),this.So?new Promise((function(t){})):this.Lo(t);},t.prototype._r=function(t){var e=this;this.vo.push(t),this.cr((function(){return e.Uo();}));},t.prototype.Uo=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:if(0===this.vo.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.vo[0]()];case 2:return n.sent(),this.vo.shift(),this.$o.reset(),[3,4];case 3:if(!Gr(t=n.sent()))throw t;return p('AsyncQueue','Operation failed with retryable error: '+t),[3,4];case 4:this.vo.length>0&&this.$o.xs((function(){return e.Uo();})),n.label=5;case 5:return[2];}}));}));},t.prototype.Lo=function(t){var e=this,n=this.bo.then((function(){return e.Fo=!0,t().catch((function(t){throw e.Co=t,e.Fo=!1,d('INTERNAL UNHANDLED ERROR: ',function(t){var e=t.message||'';return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+'\n'+t.stack),e;}(t)),t;})).then((function(t){return e.Fo=!1,t;}));}));return this.bo=n,n;},t.prototype.Os=function(t,e,n){var r=this;this.Oo(),this.No.indexOf(t)>-1&&(e=0);var i=Zr.Vo(this,t,e,n,(function(t){return r.Qo(t);}));return this.Do.push(i),i;},t.prototype.Oo=function(){this.Co&&v();},t.prototype.Wo=function(){},t.prototype.jo=function(){return i.__awaiter(this,void 0,void 0,(function(){var t;return i.__generator(this,(function(e){switch(e.label){case 0:return[4,t=this.bo];case 1:e.sent(),e.label=2;case 2:if(t!==this.bo)return[3,0];e.label=3;case 3:return[2];}}));}));},t.prototype.Ko=function(t){for(var e=0,n=this.Do;e<n.length;e++)if(n[e].vs===t)return!0;return!1;},t.prototype.Go=function(t){var e=this;return this.jo().then((function(){e.Do.sort((function(t,e){return t.Ao-e.Ao;}));for(var n=0,r=e.Do;n<r.length;n++){var i=r[n];if(i.Bs(),'all'!==t&&i.vs===t)break;}return e.jo();}));},t.prototype.zo=function(t){this.No.push(t);},t.prototype.Qo=function(t){var e=this.Do.indexOf(t);this.Do.splice(e,1);},t;}();function ei(t,e){if(d('AsyncQueue',e+': '+t),Gr(t))return new D(P.UNAVAILABLE,e+': '+t);throw t;}function ni(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=b(n,i);return 0===s?b(r,o):s;}var ri=function(){function t(t){this.Ho=t,this.buffer=new rt(ni),this.Yo=0;}return t.prototype.Jo=function(){return++this.Yo;},t.prototype.Xo=function(t){var e=[t,this.Jo()];if(this.buffer.size<this.Ho)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ni(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e));}},Object.defineProperty(t.prototype,'maxValue',{get:function(){return this.buffer.last()[0];},enumerable:!1,configurable:!0}),t;}(),ii={Zo:!1,th:0,eh:0,nh:0},oi=function(){function t(t,e,n){this.sh=t,this.ih=e,this.rh=n;}return t.oh=function(e){return new t(e,t.hh,t.ah);},t;}();oi.uh=-1,oi.lh=1048576,oi._h=41943040,oi.hh=10,oi.ah=1e3,oi.fh=new oi(oi._h,oi.hh,oi.ah),oi.dh=new oi(oi.uh,0,0);var si=function(){function t(t,e){this.xr=t,this.mo=e,this.wh=!1,this.Th=null;}return t.prototype.start=function(t){this.xr.params.sh!==oi.uh&&this.Eh(t);},t.prototype.stop=function(){this.Th&&(this.Th.cancel(),this.Th=null);},Object.defineProperty(t.prototype,'or',{get:function(){return null!==this.Th;},enumerable:!1,configurable:!0}),t.prototype.Eh=function(t){var e=this,n=this.wh?3e5:6e4;p('LruGarbageCollector','Garbage collection scheduled in '+n+'ms'),this.Th=this.mo.Os('lru_garbage_collection',n,(function(){return i.__awaiter(e,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:this.Th=null,this.wh=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Ih(this.xr)];case 2:return n.sent(),[3,7];case 3:return Gr(e=n.sent())?(p('LruGarbageCollector','Ignoring IndexedDB error during garbage collection: ',e),[3,6]):[3,4];case 4:return[4,li(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Eh(t)];case 8:return n.sent(),[2];}}));}));}));},t;}(),ai=function(){function t(t,e){this.mh=t,this.params=e;}return t.prototype.Ah=function(t,e){return this.mh.Mr(t).next((function(t){return Math.floor(e/100*t);}));},t.prototype.Rh=function(t,e){var n=this;if(0===e)return An.resolve(kn.ps);var r=new ri(e);return this.mh.pe(t,(function(t){return r.Xo(t.sequenceNumber);})).next((function(){return n.mh.Lr(t,(function(t){return r.Xo(t);}));})).next((function(){return r.maxValue;}));},t.prototype.vi=function(t,e,n){return this.mh.vi(t,e,n);},t.prototype.Wr=function(t,e){return this.mh.Wr(t,e);},t.prototype.Ph=function(t,e){var n=this;return this.params.sh===oi.uh?(p('LruGarbageCollector','Garbage collection skipped; disabled'),An.resolve(ii)):this.Kr(t).next((function(r){return r<n.params.sh?(p('LruGarbageCollector','Garbage collection skipped; Cache size '+r+' is lower than threshold '+n.params.sh),ii):n.Vh(t,e);}));},t.prototype.Kr=function(t){return this.mh.Kr(t);},t.prototype.Vh=function(t,e){var n,r,i,o,a,u,c,h=this,l=Date.now();return this.Ah(t,this.params.ih).next((function(e){return e>h.params.rh?(p('LruGarbageCollector','Capping sequence numbers to collect down to the maximum of '+h.params.rh+' from '+e),r=h.params.rh):r=e,o=Date.now(),h.Rh(t,r);})).next((function(r){return n=r,a=Date.now(),h.vi(t,n,e);})).next((function(e){return i=e,u=Date.now(),h.Wr(t,n);})).next((function(t){return c=Date.now(),f()<=s.LogLevel.DEBUG&&p('LruGarbageCollector','LRU Garbage Collection\n\tCounted targets in '+(o-l)+'ms\n\tDetermined least recently used '+r+' in '+(a-o)+'ms\n\tRemoved '+i+' targets in '+(u-a)+'ms\n\tRemoved '+t+' documents in '+(c-u)+'ms\nTotal Duration: '+(c-l)+'ms'),An.resolve({Zo:!0,th:r,eh:i,nh:t});}));},t;}(),ui=function(){function t(t,e,n){this.persistence=t,this.gh=e,this.yh=new tt(b),this.ph=new x((function(t){return Q(t);}),z),this.bh=R.min(),this.ns=t.Dr(n),this.vh=t.Nr(),this.Ji=t.Fr(),this.Sh=new On(this.vh,this.ns,this.persistence.$r()),this.gh.Dh(this.Sh);}return t.prototype.start=function(){return Promise.resolve();},t.prototype.Ch=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return e=this.ns,n=this.Sh,[4,this.persistence.runTransaction('Handle user change','readonly',(function(r){var i;return o.ns.eo(r).next((function(s){return i=s,e=o.persistence.Dr(t),n=new On(o.vh,e,o.persistence.$r()),e.eo(r);})).next((function(t){for(var e=[],o=[],s=ft(),a=0,u=i;a<u.length;a++){var c=u[a];e.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key);}}for(var p=0,d=t;p<d.length;p++){var y=d[p];o.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key);}}return n.us(r,s).next((function(t){return{Fh:t,Nh:e,$h:o};}));}));}))];case 1:return r=i.sent(),[2,(this.ns=e,this.Sh=n,this.gh.Dh(this.Sh),r)];}}));}));},t.prototype.kh=function(t){var e,n=this,r=O.now(),i=t.reduce((function(t,e){return t.add(e.key);}),ft());return this.persistence.runTransaction('Locally write mutations','readwrite',(function(o){return n.Sh.us(o,i).next((function(i){e=i;for(var s=[],a=0,u=t;a<u.length;a++){var c=u[a],h=Be(c,e.get(c.key));null!=h&&s.push(new Ge(c.key,h,en(h.proto.mapValue),Me.exists(!0)));}return n.ns.Yr(o,r,s,t);}));})).then((function(t){var n=t.Sn(e);return{batchId:t.batchId,Un:n};}));},t.prototype.xh=function(t){var e=this;return this.persistence.runTransaction('Acknowledge batch','readwrite-primary',(function(n){var r=t.batch.keys(),i=e.vh.oi({ai:!0});return e.Mh(n,t,i).next((function(){return i.apply(n);})).next((function(){return e.ns.ro(n);})).next((function(){return e.Sh.us(n,r);}));}));},t.prototype.Oh=function(t){var e=this;return this.persistence.runTransaction('Reject batch','readwrite-primary',(function(n){var r;return e.ns.Jr(n,t).next((function(t){return g(null!==t),r=t.keys(),e.ns.so(n,t);})).next((function(){return e.ns.ro(n);})).next((function(){return e.Sh.us(n,r);}));}));},t.prototype.to=function(){var t=this;return this.persistence.runTransaction('Get highest unacknowledged batch id','readonly',(function(e){return t.ns.to(e);}));},t.prototype.mi=function(){var t=this;return this.persistence.runTransaction('Get last remote snapshot version','readonly',(function(e){return t.Ji.mi(e);}));},t.prototype.Lh=function(e){var n=this,r=e.X,i=this.yh;return this.persistence.runTransaction('Apply remote event','readwrite-primary',(function(o){var s=n.vh.oi({ai:!0});i=n.yh;var a=[];e.Qt.forEach((function(e,s){var u=i.get(s);if(u){a.push(n.Ji.Ni(o,e.Xt,s).next((function(){return n.Ji.Ci(o,e.Yt,s);})));var c=e.resumeToken;if(c.H()>0){var h=u.tt(c,r).Z(o.Li);i=i.nt(s,h),t.Bh(u,h,e)&&a.push(n.Ji.yi(o,h));}}}));var u=st(),c=ft();if(e.jt.forEach((function(t,e){c=c.add(t);})),a.push(s.getEntries(o,c).next((function(t){e.jt.forEach((function(i,c){var h=t.get(i);c instanceof on&&c.version.isEqual(R.min())?(s.Gn(i,r),u=u.nt(i,c)):null==h||c.version.o(h.version)>0||0===c.version.o(h.version)&&h.hasPendingWrites?(s.jn(c,r),u=u.nt(i,c)):p('LocalStore','Ignoring outdated watch update for ',i,'. Current version:',h.version,' Watch version:',c.version),e.Kt.has(i)&&a.push(n.persistence.wi.jr(o,i));}));}))),!r.isEqual(R.min())){var h=n.Ji.mi(o).next((function(t){return n.Ji.Ri(o,o.Li,r);}));a.push(h);}return An.Bn(a).next((function(){return s.apply(o);})).next((function(){return n.Sh.cs(o,u);}));})).then((function(t){return n.yh=i,t;}));},t.Bh=function(t,e,n){return g(e.resumeToken.H()>0),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.qh||n.Yt.size+n.Jt.size+n.Xt.size>0;},t.prototype.Uh=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,a,u,c,h=this;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.persistence.runTransaction('notifyLocalViewChanges','readwrite',(function(e){return An.forEach(t,(function(t){return An.forEach(t.ms,(function(n){return h.persistence.wi.Fi(e,t.targetId,n);})).next((function(){return An.forEach(t.As,(function(n){return h.persistence.wi.$i(e,t.targetId,n);}));}));}));}))];case 1:return i.sent(),[3,3];case 2:if(!Gr(e=i.sent()))throw e;return p('LocalStore','Failed to update sequence numbers: '+e),[3,3];case 3:for(n=0,r=t;n<r.length;n++)o=r[n],s=o.targetId,o.fromCache||(a=this.yh.get(s),u=a.X,c=a.et(u),this.yh=this.yh.nt(s,c));return[2];}}));}));},t.prototype.Qh=function(t){var e=this;return this.persistence.runTransaction('Get next mutation batch','readonly',(function(n){return void 0===t&&(t=-1),e.ns.Zr(n,t);}));},t.prototype.Wh=function(t){var e=this;return this.persistence.runTransaction('read document','readonly',(function(n){return e.Sh.rs(n,t);}));},t.prototype.jh=function(t){var e=this;return this.persistence.runTransaction('Allocate target','readwrite',(function(n){var r;return e.Ji.Di(n,t).next((function(i){return i?(r=i,An.resolve(r)):e.Ji.Ti(n).next((function(i){return r=new $(t,i,0,n.Li),e.Ji.Pi(n,r).next((function(){return r;}));}));}));})).then((function(n){var r=e.yh.get(n.targetId);return(null===r||n.X.o(r.X)>0)&&(e.yh=e.yh.nt(n.targetId,n),e.ph.set(t,n.targetId)),n;}));},t.prototype.Di=function(t,e){var n=this.ph.get(e);return void 0!==n?An.resolve(this.yh.get(n)):this.Ji.Di(t,e);},t.prototype.Kh=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:n=this.yh.get(t),r=e?'readwrite':'readwrite-primary',i.label=1;case 1:return i.trys.push([1,4,,5]),e?[3,3]:[4,this.persistence.runTransaction('Release target',r,(function(t){return s.persistence.wi.removeTarget(t,n);}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!Gr(o=i.sent()))throw o;return p('LocalStore','Failed to update sequence numbers for target '+t+': '+o),[3,5];case 5:return this.yh=this.yh.remove(t),this.ph.delete(n.target),[2];}}));}));},t.prototype.Gh=function(t,e){var n=this,r=R.min(),i=ft();return this.persistence.runTransaction('Execute query','readonly',(function(o){return n.Di(o,t.We()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.Ji.ki(o,t.targetId).next((function(t){i=t;}));})).next((function(){return n.gh._s(o,t,e?r:R.min(),e?i:ft());})).next((function(t){return{documents:t,zh:i};}));}));},t.prototype.Mh=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=An.resolve();return o.forEach((function(r){s=s.next((function(){return n.zn(t,r);})).next((function(t){var o=t,s=e.Cn.get(r);g(null!==s),(!o||o.version.o(s)<0)&&(o=i.pn(r,o,e))&&n.jn(o,e.Dn);}));})),s.next((function(){return r.ns.so(t,i);}));},t.prototype.Ih=function(t){var e=this;return this.persistence.runTransaction('Collect garbage','readwrite-primary',(function(n){return t.Ph(n,e.yh);}));},t;}();function ci(t,e,n){return new ui(t,e,n);}ui.qh=3e8;var hi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).persistence=e,i.ns=e.Dr(r),i.vh=e.Nr(),i.Ji=e.Fr(),i;}return i.__extends(e,t),e.prototype.start=function(){return this.Hh();},e.prototype.Yh=function(t){var e=this;return this.persistence.runTransaction('Lookup mutation documents','readonly',(function(n){return e.ns.Xr(n,t).next((function(t){return t?e.Sh.us(n,t):An.resolve(null);}));}));},e.prototype.Jh=function(t){this.ns.io(t);},e.prototype.ur=function(t){this.persistence.ur(t);},e.prototype.Sr=function(){return this.persistence.Sr();},e.prototype.Xh=function(t){var e=this,n=this.yh.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction('Get target data','readonly',(function(n){return e.Ji.Me(n,t).next((function(t){return t?t.target:null;}));}));},e.prototype.si=function(){var t=this;return this.persistence.runTransaction('Get new document changes','readonly',(function(e){return t.vh.si(e,t.bh);})).then((function(e){var n=e.ii,r=e.readTime;return t.bh=r,n;}));},e.prototype.Hh=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:return t=this,[4,this.persistence.runTransaction('Synchronize last document change read time','readonly',(function(t){return e.vh.ri(t);}))];case 1:return t.bh=n.sent(),[2];}}));}));},e;}(ui);function li(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){if(t.code!==P.FAILED_PRECONDITION||t.message!==Pn)throw t;return p('LocalStore','Unexpectedly lost primary lease'),[2];}));}));}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fi=function(){function t(){this.Zh=new rt(pi.ta),this.ea=new rt(pi.na);}return t.prototype._=function(){return this.Zh._();},t.prototype.Fi=function(t,e){var n=new pi(t,e);this.Zh=this.Zh.add(n),this.ea=this.ea.add(n);},t.prototype.sa=function(t,e){var n=this;t.forEach((function(t){return n.Fi(t,e);}));},t.prototype.$i=function(t,e){this.ia(new pi(t,e));},t.prototype.ra=function(t,e){var n=this;t.forEach((function(t){return n.$i(t,e);}));},t.prototype.oa=function(t){var e=this,n=new U(new L([])),r=new pi(n,t),i=new pi(n,t+1),o=[];return this.ea.vt([r,i],(function(t){e.ia(t),o.push(t.key);})),o;},t.prototype.ha=function(){var t=this;this.Zh.forEach((function(e){return t.ia(e);}));},t.prototype.ia=function(t){this.Zh=this.Zh.delete(t),this.ea=this.ea.delete(t);},t.prototype.aa=function(t){var e=new U(new L([])),n=new pi(e,t),r=new pi(e,t+1),i=ft();return this.ea.vt([n,r],(function(t){i=i.add(t.key);})),i;},t.prototype.Mi=function(t){var e=new pi(t,0),n=this.Zh.Dt(e);return null!==n&&t.isEqual(n.key);},t;}(),pi=function(){function t(t,e){this.key=t,this.ua=e;}return t.ta=function(t,e){return U.P(t.key,e.key)||b(t.ua,e.ua);},t.na=function(t,e){return b(t.ua,e.ua)||U.P(t.key,e.key);},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(t,e){if(0!==e.length)throw new D(P.INVALID_ARGUMENT,'Function '+t+'() does not support arguments, but was called with '+Oi(e.length,'argument')+'.');}function yi(t,e,n){if(e.length!==n)throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires '+Oi(n,'argument')+', but was called with '+Oi(e.length,'argument')+'.');}function vi(t,e,n){if(e.length<n)throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires at least '+Oi(n,'argument')+', but was called with '+Oi(e.length,'argument')+'.');}function gi(t,e,n,r){if(e.length<n||e.length>r)throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires between '+n+' and '+r+' arguments, but was called with '+Oi(e.length,'argument')+'.');}function mi(t,e,n,r){Ii(t,e,Di(n)+' argument',r);}function _i(t,e,n,r){void 0!==r&&mi(t,e,n,r);}function wi(t,e,n,r){Ii(t,e,n+' option',r);}function bi(t,e,n,r){void 0!==r&&wi(t,e,n,r);}function Ei(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,a=i;s<a.length;s++){var u=a[s];if(u===r)return;o.push(Si(u));}var c=Si(r);throw new D(P.INVALID_ARGUMENT,'Invalid value '+c+' provided to function '+t+'() for option "'+n+'". Acceptable values: '+o.join(', '));}(t,0,n,r,i);}function Ci(t,e,n,r){if(!e.some((function(t){return t===r;})))throw new D(P.INVALID_ARGUMENT,'Invalid value '+Si(r)+' provided to function '+t+'() for its '+Di(n)+' argument. Acceptable values: '+e.join(', '));return r;}function Ii(t,e,n,r){if(!('object'===e?Ti(r):'non-empty string'===e?'string'==typeof r&&''!==r:typeof r===e)){var i=Si(r);throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires its '+n+' to be of type '+e+', but it was: '+i);}}function Ti(t){return'object'==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t));}function Si(t){if(void 0===t)return'undefined';if(null===t)return'null';if('string'==typeof t)return t.length>20&&(t=t.substring(0,20)+'...'),JSON.stringify(t);if('number'==typeof t||'boolean'==typeof t)return''+t;if('object'==typeof t){if(t instanceof Array)return'an array';var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1];}return null;}(t);return e?'a custom '+e+' object':'an object';}return'function'==typeof t?'a function':v();}function Ni(t,e,n){if(void 0===n)throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires a valid '+Di(e)+' argument, but it was undefined.');}function Ai(t,e,n){N(e,(function(e,r){if(n.indexOf(e)<0)throw new D(P.INVALID_ARGUMENT,'Unknown option \''+e+'\' passed to function '+t+'(). Available options: '+n.join(', '));}));}function xi(t,e,n,r){var i=Si(r);return new D(P.INVALID_ARGUMENT,'Function '+t+'() requires its '+Di(n)+' argument to be a '+e+', but it was: '+i);}function Pi(t,e,n){if(n<=0)throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires its '+Di(e)+' argument to be a positive number, but it was: '+n+'.');}function Di(t){switch(t){case 1:return'first';case 2:return'second';case 3:return'third';default:return t+'th';}}function Oi(t,e){return t+' '+e+(1===t?'':'s');}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(){if('undefined'==typeof Uint8Array)throw new D(P.UNIMPLEMENTED,'Uint8Arrays are not available in this environment.');}function ki(){if('undefined'==typeof atob)throw new D(P.UNIMPLEMENTED,'Blobs are unavailable in Firestore in this environment.');}var Li=function(){function t(t){ki(),this.ca=t;}return t.fromBase64String=function(e){yi('Blob.fromBase64String',arguments,1),mi('Blob.fromBase64String','string',1,e),ki();try{return new t(H.fromBase64String(e));}catch(e){throw new D(P.INVALID_ARGUMENT,'Failed to construct Blob from Base64 string: '+e);}},t.fromUint8Array=function(e){if(yi('Blob.fromUint8Array',arguments,1),Ri(),!(e instanceof Uint8Array))throw xi('Blob.fromUint8Array','Uint8Array',1,e);return new t(H.fromUint8Array(e));},t.prototype.toBase64=function(){return yi('Blob.toBase64',arguments,0),ki(),this.ca.toBase64();},t.prototype.toUint8Array=function(){return yi('Blob.toUint8Array',arguments,0),Ri(),this.ca.toUint8Array();},t.prototype.toString=function(){return'Blob(base64: '+this.toBase64()+')';},t.prototype.isEqual=function(t){return this.ca.isEqual(t.ca);},t;}(),Fi=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new D(P.INVALID_ARGUMENT,'Function FieldPath() requires its fieldNames argument to be an array with at least '+Oi(1,'element')+'.');}(0,t);for(var e=0;e<t.length;++e)if(mi('FieldPath','string',e,t[e]),0===t[e].length)throw new D(P.INVALID_ARGUMENT,'Invalid field name at argument $(i + 1). Field names must not be empty.');this.la=new M(t);},Mi=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this;}return i.__extends(e,t),e.documentId=function(){return new e(M.L().N());},e.prototype.isEqual=function(t){if(!(t instanceof e))throw xi('isEqual','FieldPath',1,t);return this.la.isEqual(t.la);},e;}(Fi),Ui=new RegExp('[~\\*/\\[\\]]'),Vi=function(){this._a=this;},ji=function(t){function e(e){var n=this;return(n=t.call(this)||this).fa=e,n;}return i.__extends(e,t),e.prototype.da=function(t){if(2!==t.wa)throw 1===t.wa?t.Ta(this.fa+'() can only appear at the top level of your update data'):t.Ta(this.fa+'() cannot be used with set() unless you pass {merge:true}');return t.Le.push(t.path),null;},e.prototype.isEqual=function(t){return t instanceof e;},e;}(Vi);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qi(t,e,n){return new eo({wa:3,Ea:e.settings.Ea,methodName:t.fa,Ia:n},e.s,e.serializer,e.ignoreUndefinedProperties);}var Bi=function(t){function e(e){var n=this;return(n=t.call(this)||this).fa=e,n;}return i.__extends(e,t),e.prototype.da=function(t){return new Le(t.path,new Se);},e.prototype.isEqual=function(t){return t instanceof e;},e;}(Vi),Wi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).fa=e,r.ma=n,r;}return i.__extends(e,t),e.prototype.da=function(t){var e=qi(this,t,!0),n=this.ma.map((function(t){return ao(t,e);})),r=new Ne(n);return new Le(t.path,r);},e.prototype.isEqual=function(t){return this===t;},e;}(Vi),Qi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).fa=e,r.ma=n,r;}return i.__extends(e,t),e.prototype.da=function(t){var e=qi(this,t,!0),n=this.ma.map((function(t){return ao(t,e);})),r=new xe(n);return new Le(t.path,r);},e.prototype.isEqual=function(t){return this===t;},e;}(Vi),zi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).fa=e,r.Aa=n,r;}return i.__extends(e,t),e.prototype.da=function(t){var e=new De(t.serializer,$t(t.serializer,this.Aa));return new Le(t.path,e);},e.prototype.isEqual=function(t){return this===t;},e;}(Vi),Gi=function(t){function e(){return t.call(this)||this;}return i.__extends(e,t),e.delete=function(){return di('FieldValue.delete',arguments),new Hi(new ji('FieldValue.delete'));},e.serverTimestamp=function(){return di('FieldValue.serverTimestamp',arguments),new Hi(new Bi('FieldValue.serverTimestamp'));},e.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vi('FieldValue.arrayUnion',arguments,1),new Hi(new Wi('FieldValue.arrayUnion',t));},e.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vi('FieldValue.arrayRemove',arguments,1),new Hi(new Qi('FieldValue.arrayRemove',t));},e.increment=function(t){return mi('FieldValue.increment','number',1,t),yi('FieldValue.increment',arguments,1),new Hi(new zi('FieldValue.increment',t));},e;}(Vi),Hi=function(t){function e(e){var n=this;return(n=t.call(this)||this)._a=e,n.fa=e.fa,n;}return i.__extends(e,t),e.prototype.da=function(t){return this._a.da(t);},e.prototype.isEqual=function(t){return t instanceof e&&this._a.isEqual(t._a);},e;}(Gi),Ki=function(){function t(t,e){if(yi('GeoPoint',arguments,2),mi('GeoPoint','number',1,t),mi('GeoPoint','number',2,e),!isFinite(t)||t<-90||t>90)throw new D(P.INVALID_ARGUMENT,'Latitude must be a number between -90 and 90, but was: '+t);if(!isFinite(e)||e<-180||e>180)throw new D(P.INVALID_ARGUMENT,'Longitude must be a number between -180 and 180, but was: '+e);this.Ra=t,this.Pa=e;}return Object.defineProperty(t.prototype,'latitude',{get:function(){return this.Ra;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'longitude',{get:function(){return this.Pa;},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.Ra===t.Ra&&this.Pa===t.Pa;},t.prototype.T=function(t){return b(this.Ra,t.Ra)||b(this.Pa,t.Pa);},t;}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yi(t){return new Ht(t,!0);}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $i=/^__.*__$/,Xi=function(t,e,n){this.Va=t,this.ga=e,this.ya=n;},Ji=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n;}return t.prototype.pa=function(t,e){var n=[];return null!==this.Le?n.push(new Ge(t,this.data,this.Le,e)):n.push(new ze(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Ke(t,this.fieldTransforms)),n;},t;}(),Zi=function(){function t(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n;}return t.prototype.pa=function(t,e){var n=[new Ge(t,this.data,this.Le,e)];return this.fieldTransforms.length>0&&n.push(new Ke(t,this.fieldTransforms)),n;},t;}();function to(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v();}}var eo=function(){function t(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ba(),this.fieldTransforms=i||[],this.Le=o||[];}return Object.defineProperty(t.prototype,'path',{get:function(){return this.settings.path;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'wa',{get:function(){return this.settings.wa;},enumerable:!1,configurable:!0}),t.prototype.va=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le);},t.prototype.Sa=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.va({path:n,Ia:!1});return r.Da(t),r;},t.prototype.Ca=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.va({path:n,Ia:!1});return r.ba(),r;},t.prototype.Fa=function(t){return this.va({path:void 0,Ia:!0});},t.prototype.Ta=function(t){return po(t,this.settings.methodName,this.settings.Na||!1,this.path,this.settings.Ea);},t.prototype.contains=function(t){return void 0!==this.Le.find((function(e){return t.D(e);}))||void 0!==this.fieldTransforms.find((function(e){return t.D(e.field);}));},t.prototype.ba=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Da(this.path.get(t));},t.prototype.Da=function(t){if(0===t.length)throw this.Ta('Document fields must not be empty');if(to(this.wa)&&$i.test(t))throw this.Ta('Document fields cannot begin and end with "__"');},t;}(),no=function(){function t(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||Yi(t);}return t.prototype.$a=function(t,e,n,r){return void 0===r&&(r=!1),new eo({wa:t,methodName:e,Ea:n,path:M.k(),Ia:!1,Na:r},this.s,this.serializer,this.ignoreUndefinedProperties);},t;}();function ro(t,e,n,r,i,o){void 0===o&&(o={});var s=t.$a(o.merge||o.mergeFields?2:0,e,n,i);ho('Data must be an object, but it was:',s,r);var a,u,c=uo(r,s);if(o.merge)a=new ke(s.Le),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=f[l],d=void 0;if(p instanceof Fi)d=p.la;else{if('string'!=typeof p)throw v();d=fo(e,p,n);}if(!s.contains(d))throw new D(P.INVALID_ARGUMENT,'Field \''+d+'\' is specified in your field mask but missing from your input data.');yo(h,d)||h.push(d);}a=new ke(h),u=s.fieldTransforms.filter((function(t){return a.Ke(t.field);}));}else a=null,u=s.fieldTransforms;return new Ji(new Ze(c),a,u);}function io(t,e,n,r){var i=t.$a(1,e,n);ho('Data must be an object, but it was:',i,r);var o=[],s=new tn;N(r,(function(t,r){var a=fo(e,t,n),u=i.Ca(a);if(r instanceof Vi&&r._a instanceof ji)o.push(a);else{var c=ao(r,u);null!=c&&(o.push(a),s.set(a,c));}}));var a=new ke(o);return new Zi(s.ze(),a,i.fieldTransforms);}function oo(t,e,n,r,i,o){var s=t.$a(1,e,n),a=[lo(e,r,n)],u=[i];if(o.length%2!=0)throw new D(P.INVALID_ARGUMENT,'Function '+e+'() needs to be called with an even number of arguments that alternate between field names and values.');for(var c=0;c<o.length;c+=2)a.push(lo(e,o[c])),u.push(o[c+1]);for(var h=[],l=new tn,f=a.length-1;f>=0;--f)if(!yo(h,a[f])){var p=a[f],d=u[f],y=s.Ca(p);if(d instanceof Vi&&d._a instanceof ji)h.push(p);else{var v=ao(d,y);null!=v&&(h.push(p),l.set(p,v));}}var g=new ke(h);return new Zi(l.ze(),g,s.fieldTransforms);}function so(t,e,n,r){return void 0===r&&(r=!1),ao(n,t.$a(r?4:3,e));}function ao(t,e){if(co(t))return ho('Unsupported field value:',e,t),uo(t,e);if(t instanceof Vi)return function(t,e){if(!to(e.wa))throw e.Ta(t.fa+'() can only be used with update() and set()');if(!e.path)throw e.Ta(t.fa+'() is not currently supported inside arrays');var n=t.da(e);n&&e.fieldTransforms.push(n);}(t,e),null;if(e.path&&e.Le.push(e.path),t instanceof Array){if(e.settings.Ia&&4!==e.wa)throw e.Ta('Nested arrays are not supported');return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=ao(o[i],e.Fa(r));null==s&&(s={nullValue:'NULL_VALUE'}),n.push(s),r++;}return{arrayValue:{values:n}};}(t,e);}return function(t,e){if(null===t)return{nullValue:'NULL_VALUE'};if('number'==typeof t)return $t(e.serializer,t);if('boolean'==typeof t)return{booleanValue:t};if('string'==typeof t)return{stringValue:t};if(t instanceof Date){var n=O.fromDate(t);return{timestampValue:Xt(e.serializer,n)};}if(t instanceof O){var r=new O(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Xt(e.serializer,r)};}if(t instanceof Ki)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Li)return{bytesValue:Jt(e.serializer,t)};if(t instanceof Xi){var i=e.s,o=t.Va;if(!o.isEqual(i))throw e.Ta('Document reference is for database '+o.projectId+'/'+o.database+' but should be for database '+i.projectId+'/'+i.database);return{referenceValue:ee(t.Va||e.s,t.ga.path)};}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Ta('Unsupported field value: '+Si(t));}(t,e);}function uo(t,e){var n={};return A(t)?e.path&&e.path.length>0&&e.Le.push(e.path):N(t,(function(t,r){var i=ao(r,e.Sa(t));null!=i&&(n[t]=i);})),{mapValue:{fields:n}};}function co(t){return!('object'!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof O||t instanceof Ki||t instanceof Li||t instanceof Xi||t instanceof Vi);}function ho(t,e,n){if(!co(n)||!Ti(n)){var r=Si(n);throw'an object'===r?e.Ta(t+' a custom object'):e.Ta(t+' '+r);}}function lo(t,e,n){if(e instanceof Fi)return e.la;if('string'==typeof e)return fo(t,e);throw po('Field path arguments must be of type string or FieldPath.',t,!1,void 0,n);}function fo(t,e,n){try{return function(t){if(t.search(Ui)>=0)throw new D(P.INVALID_ARGUMENT,'Invalid field path ('+t+'). Paths must not contain \'~\', \'*\', \'/\', \'[\', or \']\'');try{return new(Mi.bind.apply(Mi,i.__spreadArrays([void 0],t.split('.'))));}catch(e){throw new D(P.INVALID_ARGUMENT,'Invalid field path ('+t+'). Paths must not be empty, begin with \'.\', end with \'.\', or contain \'..\'');}}(e).la;}catch(e){throw po((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n);}var r;}function po(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,a='Function '+e+'() called with invalid data';n&&(a+=' (via `toFirestore()`)');var u='';return(o||s)&&(u+=' (found',o&&(u+=' in field '+r),s&&(u+=' in document '+i),u+=')'),new D(P.INVALID_ARGUMENT,(a+='. ')+t+u);}function yo(t,e){return t.some((function(t){return t.isEqual(e);}));}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vo=function(){function t(t){this.uid=t;}return t.prototype.zr=function(){return null!=this.uid;},t.prototype.ka=function(){return this.zr()?'uid:'+this.uid:'anonymous-user';},t.prototype.isEqual=function(t){return t.uid===this.uid;},t;}();vo.UNAUTHENTICATED=new vo(null),vo.xa=new vo('google-credentials-uid'),vo.Ma=new vo('first-party-uid');
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var go=function(t,e){this.user=e,this.type='OAuth',this.Oa={},this.Oa.Authorization='Bearer '+t;},mo=function(){function t(){this.La=null;}return t.prototype.getToken=function(){return Promise.resolve(null);},t.prototype.Ba=function(){},t.prototype.qa=function(t){this.La=t,t(vo.UNAUTHENTICATED);},t.prototype.Ua=function(){this.La=null;},t;}(),_o=function(){function t(t){var e=this;this.Qa=null,this.currentUser=vo.UNAUTHENTICATED,this.Wa=!1,this.ja=0,this.La=null,this.forceRefresh=!1,this.Qa=function(){e.ja++,e.currentUser=e.Ka(),e.Wa=!0,e.La&&e.La(e.currentUser);},this.ja=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Qa):(this.Qa(null),t.get().then((function(t){e.auth=t,e.Qa&&e.auth.addAuthTokenListener(e.Qa);}),(function(){})));}return t.prototype.getToken=function(){var t=this,e=this.ja,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.ja!==e?(p('FirebaseCredentialsProvider','getToken aborted due to token change.'),t.getToken()):n?(g('string'==typeof n.accessToken),new go(n.accessToken,t.currentUser)):null;})):Promise.resolve(null);},t.prototype.Ba=function(){this.forceRefresh=!0;},t.prototype.qa=function(t){this.La=t,this.Wa&&t(this.currentUser);},t.prototype.Ua=function(){this.auth&&this.auth.removeAuthTokenListener(this.Qa),this.Qa=null,this.La=null;},t.prototype.Ka=function(){var t=this.auth&&this.auth.getUid();return g(null===t||'string'==typeof t),new vo(t);},t;}(),wo=function(){function t(t,e){this.Ga=t,this.za=e,this.type='FirstParty',this.user=vo.Ma;}return Object.defineProperty(t.prototype,'Oa',{get:function(){var t={'X-Goog-AuthUser':this.za},e=this.Ga.auth.Ha([]);return e&&(t.Authorization=e),t;},enumerable:!1,configurable:!0}),t;}(),bo=function(){function t(t,e){this.Ga=t,this.za=e;}return t.prototype.getToken=function(){return Promise.resolve(new wo(this.Ga,this.za));},t.prototype.qa=function(t){t(vo.Ma);},t.prototype.Ua=function(){},t.prototype.Ba=function(){},t;}(),Eo=function(){function t(t,e,n,r,i,o){this.bs=t,this.Ya=n,this.Ja=r,this.Xa=i,this.listener=o,this.state=0,this.Za=0,this.tu=null,this.stream=null,this.$o=new Fn(t,e);}return t.prototype.eu=function(){return 1===this.state||2===this.state||4===this.state;},t.prototype.nu=function(){return 2===this.state;},t.prototype.start=function(){3!==this.state?this.auth():this.su();},t.prototype.stop=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.eu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2];}}));}));},t.prototype.iu=function(){this.state=0,this.$o.reset();},t.prototype.ru=function(){var t=this;this.nu()&&null===this.tu&&(this.tu=this.bs.Os(this.Ya,6e4,(function(){return t.ou();})));},t.prototype.hu=function(t){this.au(),this.stream.send(t);},t.prototype.ou=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.nu()?[2,this.close(0)]:[2];}));}));},t.prototype.au=function(){this.tu&&(this.tu.cancel(),this.tu=null);},t.prototype.close=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(n){switch(n.label){case 0:return this.au(),this.$o.cancel(),this.Za++,3!==t?this.$o.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(d(e.toString()),d('Using maximum backoff delay to prevent overloading the backend.'),this.$o.ks()):e&&e.code===P.UNAUTHENTICATED&&this.Xa.Ba(),null!==this.stream&&(this.uu(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.cu(e)];case 1:return n.sent(),[2];}}));}));},t.prototype.uu=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.lu(this.Za),n=this.Za;this.Xa.getToken().then((function(e){t.Za===n&&t._u(e);}),(function(n){e((function(){var e=new D(P.UNKNOWN,'Fetching auth token failed: '+n.message);return t.fu(e);}));}));},t.prototype._u=function(t){var e=this,n=this.lu(this.Za);this.stream=this.du(t),this.stream.wu((function(){n((function(){return e.state=2,e.listener.wu();}));})),this.stream.cu((function(t){n((function(){return e.fu(t);}));})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t);}));}));},t.prototype.su=function(){var t=this;this.state=4,this.$o.xs((function(){return i.__awaiter(t,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.state=0,this.start(),[2];}));}));}));},t.prototype.fu=function(t){return p('PersistentStream','close with error: '+t),this.stream=null,this.close(3,t);},t.prototype.lu=function(t){var e=this;return function(n){e.bs.cr((function(){return e.Za===t?n():(p('PersistentStream','stream callback skipped by getCloseGuardedDispatcher.'),Promise.resolve());}));};},t;}(),Co=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,'listen_stream_connection_backoff','listen_stream_idle',n,r,o)||this).serializer=i,s;}return i.__extends(e,t),e.prototype.du=function(t){return this.Ja.Tu('Listen',t);},e.prototype.onMessage=function(t){this.$o.reset();var e=function(t,e){var n;if('targetChange'in e){e.targetChange;var r=function(t){return'NO_CHANGE'===t?0:'ADD'===t?1:'REMOVE'===t?2:'CURRENT'===t?3:'RESET'===t?4:v();}(e.targetChange.targetChangeType||'NO_CHANGE'),i=e.targetChange.targetIds||[],o=function(t,e){return t.Oe?(g(void 0===e||'string'==typeof e),H.fromBase64String(e||'')):(g(void 0===e||e instanceof Uint8Array),H.fromUint8Array(e||new Uint8Array));}(t,e.targetChange.resumeToken),s=e.targetChange.cause,a=s&&function(t){var e=void 0===t.code?P.UNKNOWN:Z(t.code);return new D(e,t.message||'');}(s);n=new Et(r,i,o,a||null);}else if('documentChange'in e){e.documentChange;var u=e.documentChange;u.document,u.document.name,u.document.updateTime;var c=ie(t,u.document.name),h=te(u.document.updateTime),l=new Ze({mapValue:{fields:u.document.fields}}),f=new rn(c,h,l,{}),p=u.targetIds||[],d=u.removedTargetIds||[];n=new wt(p,d,f.key,f);}else if('documentDelete'in e){e.documentDelete;var y=e.documentDelete;y.document;var m=ie(t,y.document),_=y.readTime?te(y.readTime):R.min(),w=new on(m,_),b=y.removedTargetIds||[];n=new wt([],b,w.key,w);}else if('documentRemove'in e){e.documentRemove;var E=e.documentRemove;E.document;var C=ie(t,E.document),I=E.removedTargetIds||[];n=new wt([],I,C,null);}else{if(!('filter'in e))return v();e.filter;var T=e.filter;T.targetId;var S=T.count||0,N=new X(S),A=T.targetId;n=new bt(A,N);}return n;}(this.serializer,t),n=function(t){if(!('targetChange'in t))return R.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?R.min():e.readTime?te(e.readTime):R.min();}(t);return this.listener.Eu(e,n);},e.prototype.Iu=function(t){var e={};e.database=ae(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=G(r)?{documents:fe(t,r)}:{query:pe(t,r)}).targetId=e.targetId,e.resumeToken.H()>0&&(n.resumeToken=Jt(t,e.resumeToken)),n;}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return'existence-filter-mismatch';case 2:return'limbo-document';default:return v();}}(0,e.J);return null==n?null:{'goog-listen-tags':n};}(this.serializer,t);n&&(e.labels=n),this.hu(e);},e.prototype.mu=function(t){var e={};e.database=ae(this.serializer),e.removeTarget=t,this.hu(e);},e;}(Eo),Io=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,'write_stream_connection_backoff','write_stream_idle',n,r,o)||this).serializer=i,s.Au=!1,s;}return i.__extends(e,t),Object.defineProperty(e.prototype,'Ru',{get:function(){return this.Au;},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.Au=!1,this.lastStreamToken=void 0,t.prototype.start.call(this);},e.prototype.uu=function(){this.Au&&this.Pu([]);},e.prototype.du=function(t){return this.Ja.Tu('Write',t);},e.prototype.onMessage=function(t){if(g(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Au){this.$o.reset();var e=function(t,e){return t&&t.length>0?(g(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?te(t.updateTime):te(e);n.isEqual(R.min())&&(n=te(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Fe(n,r);}(t,e);}))):[];}(t.writeResults,t.commitTime),n=te(t.commitTime);return this.listener.Vu(n,e);}return g(!t.writeResults||0===t.writeResults.length),this.Au=!0,this.listener.gu();},e.prototype.yu=function(){var t={};t.database=ae(this.serializer),this.hu(t);},e.prototype.Pu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return he(e.serializer,t);}))};this.hu(n);},e;}(Eo),To=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ja=e,i.credentials=n,i.serializer=r,i.pu=!1,i;}return i.__extends(e,t),e.prototype.bu=function(){if(this.pu)throw new D(P.FAILED_PRECONDITION,'The client has already been terminated.');},e.prototype.vu=function(t,e){var n=this;return this.bu(),this.credentials.getToken().then((function(r){return n.Ja.vu(t,e,r);})).catch((function(t){throw t.code===P.UNAUTHENTICATED&&n.credentials.Ba(),t;}));},e.prototype.Su=function(t,e){var n=this;return this.bu(),this.credentials.getToken().then((function(r){return n.Ja.Su(t,e,r);})).catch((function(t){throw t.code===P.UNAUTHENTICATED&&n.credentials.Ba(),t;}));},e;}((function(){this.je=void 0;})),So=function(){function t(t){this.Du=t,this.Cu=new Map,this.mutations=[],this.Fu=!1,this.Nu=null,this.$u=new Set;}return t.prototype.ku=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:if(this.xu(),this.mutations.length>0)throw new D(P.INVALID_ARGUMENT,'Firestore transactions require all reads to be executed before all writes.');return[4,function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:return n=m(t),r={database:ae(n.serializer),documents:e.map((function(t){return re(n.serializer,t);}))},[4,n.Su('BatchGetDocuments',r)];case 1:return o=i.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return'found'in e?function(t,e){g(!!e.found),e.found.name,e.found.updateTime;var n=ie(t,e.found.name),r=te(e.found.updateTime),i=new Ze({mapValue:{fields:e.found.fields}});return new rn(n,r,i,{});}(t,e):'missing'in e?function(t,e){g(!!e.missing),g(!!e.readTime);var n=ie(t,e.missing),r=te(e.readTime);return new on(n,r);}(t,e):v();}(n.serializer,t);s.set(e.key.toString(),e);})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());g(!!e),a.push(e);})),a)];}}));}));}(this.Du,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof on||t instanceof rn?n.Mu(t):v();})),e)];}}));}));},t.prototype.set=function(t,e){this.write(e.pa(t,this.Ue(t))),this.$u.add(t);},t.prototype.update=function(t,e){try{this.write(e.pa(t,this.Ou(t)));}catch(t){this.Nu=t;}this.$u.add(t);},t.prototype.delete=function(t){this.write([new Xe(t,this.Ue(t))]),this.$u.add(t);},t.prototype.commit=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){switch(n.label){case 0:if(this.xu(),this.Nu)throw this.Nu;return t=this.Cu,this.mutations.forEach((function(e){t.delete(e.key.toString());})),t.forEach((function(t,n){var r=new U(L.$(n));e.mutations.push(new Je(r,e.Ue(r)));})),[4,function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r;return i.__generator(this,(function(i){switch(i.label){case 0:return n=m(t),r={database:ae(n.serializer),writes:e.map((function(t){return he(n.serializer,t);}))},[4,n.vu('Commit',r)];case 1:return i.sent(),[2];}}));}));}(this.Du,this.mutations)];case 1:return n.sent(),this.Fu=!0,[2];}}));}));},t.prototype.Mu=function(t){var e;if(t instanceof rn)e=t.version;else{if(!(t instanceof on))throw v();e=R.min();}var n=this.Cu.get(t.key.toString());if(n){if(!e.isEqual(n))throw new D(P.ABORTED,'Document version changed between two reads.');}else this.Cu.set(t.key.toString(),e);},t.prototype.Ue=function(t){var e=this.Cu.get(t.toString());return!this.$u.has(t)&&e?Me.updateTime(e):Me.Qe();},t.prototype.Ou=function(t){var e=this.Cu.get(t.toString());if(!this.$u.has(t)&&e){if(e.isEqual(R.min()))throw new D(P.INVALID_ARGUMENT,'Can\'t update a document that doesn\'t exist.');return Me.updateTime(e);}return Me.exists(!0);},t.prototype.write=function(t){this.xu(),this.mutations=this.mutations.concat(t);},t.prototype.xu=function(){},t;}(),No=function(){function t(t,e){this.mo=t,this.Lu=e,this.state='Unknown',this.Bu=0,this.qu=null,this.Uu=!0;}return t.prototype.Qu=function(){var t=this;0===this.Bu&&(this.Wu('Unknown'),this.qu=this.mo.Os('online_state_timeout',1e4,(function(){return t.qu=null,t.ju('Backend didn\'t respond within 10 seconds.'),t.Wu('Offline'),Promise.resolve();})));},t.prototype.Ku=function(t){'Online'===this.state?this.Wu('Unknown'):(this.Bu++,this.Bu>=1&&(this.Gu(),this.ju('Connection failed 1 times. Most recent error: '+t.toString()),this.Wu('Offline')));},t.prototype.set=function(t){this.Gu(),this.Bu=0,'Online'===t&&(this.Uu=!1),this.Wu(t);},t.prototype.Wu=function(t){t!==this.state&&(this.state=t,this.Lu(t));},t.prototype.ju=function(t){var e='Could not reach Cloud Firestore backend. '+t+'\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.';this.Uu?(d(e),this.Uu=!1):p('OnlineStateTracker',e);},t.prototype.Gu=function(){null!==this.qu&&(this.qu.cancel(),this.qu=null);},t;}(),Ao=function(){function t(t,e,n,r,o){var s=this;this.zu=t,this.Du=e,this.mo=n,this.Hu=[],this.Yu=new Map,this.Ju=null,this.Xu=new Set,this.Zu=o,this.Zu.tc((function(t){n.cr((function(){return i.__awaiter(s,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.ec()?(p('RemoteStore','Restarting streams for network reachability change.'),[4,this.nc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2];}}));}));}));})),this.sc=new No(n,r),this.ic=function(t,e,n){var r=m(t);return new Co(e,r.Ja,r.credentials,r.serializer,n);}(this.Du,n,{wu:this.rc.bind(this),cu:this.oc.bind(this),Eu:this.hc.bind(this)}),this.ac=function(t,e,n){var r=m(t);return new Io(e,r.Ja,r.credentials,r.serializer,n);}(this.Du,n,{wu:this.uc.bind(this),cu:this.cc.bind(this),gu:this.lc.bind(this),Vu:this.Vu.bind(this)});}return t.prototype.start=function(){return this.enableNetwork();},t.prototype.enableNetwork=function(){return this.Xu.delete(0),this._c();},t.prototype._c=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.ec()?(this.fc()?this.dc():this.sc.set('Unknown'),[4,this.wc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2];}}));}));},t.prototype.disableNetwork=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.Xu.add(0),[4,this.Tc()];case 1:return t.sent(),this.sc.set('Offline'),[2];}}));}));},t.prototype.Tc=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.ac.stop()];case 1:return t.sent(),[4,this.ic.stop()];case 2:return t.sent(),this.Hu.length>0&&(p('RemoteStore','Stopping write stream with '+this.Hu.length+' pending writes'),this.Hu=[]),this.Ec(),[2];}}));}));},t.prototype.gr=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return p('RemoteStore','RemoteStore shutting down.'),this.Xu.add(5),[4,this.Tc()];case 1:return t.sent(),this.Zu.gr(),this.sc.set('Unknown'),[2];}}));}));},t.prototype.listen=function(t){this.Yu.has(t.targetId)||(this.Yu.set(t.targetId,t),this.fc()?this.dc():this.ic.nu()&&this.Ic(t));},t.prototype.mc=function(t){this.Yu.delete(t),this.ic.nu()&&this.Ac(t),0===this.Yu.size&&(this.ic.nu()?this.ic.ru():this.ec()&&this.sc.set('Unknown'));},t.prototype.Me=function(t){return this.Yu.get(t)||null;},t.prototype.xe=function(t){return this.Rc.xe(t);},t.prototype.Ic=function(t){this.Ju.de(t.targetId),this.ic.Iu(t);},t.prototype.Ac=function(t){this.Ju.de(t),this.ic.mu(t);},t.prototype.dc=function(){this.Ju=new It(this),this.ic.start(),this.sc.Qu();},t.prototype.fc=function(){return this.ec()&&!this.ic.eu()&&this.Yu.size>0;},t.prototype.ec=function(){return 0===this.Xu.size;},t.prototype.Ec=function(){this.Ju=null;},t.prototype.rc=function(){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(e){return this.Yu.forEach((function(e,n){t.Ic(e);})),[2];}));}));},t.prototype.oc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return this.Ec(),this.fc()?(this.sc.Ku(t),this.dc()):this.sc.set('Unknown'),[2];}));}));},t.prototype.hc=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:if(this.sc.set('Online'),!(t instanceof Et&&2===t.state&&t.cause))return[3,6];i.label=1;case 1:return i.trys.push([1,3,,5]),[4,this.Pc(t)];case 2:return i.sent(),[3,5];case 3:return n=i.sent(),p('RemoteStore','Failed to remove targets %s: %s ',t.targetIds.join(','),n),[4,this.Vc(n)];case 4:return i.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof wt?this.Ju.Pe(t):t instanceof bt?this.Ju.De(t):this.Ju.ye(t),e.isEqual(R.min()))return[3,13];i.label=7;case 7:return i.trys.push([7,11,,13]),[4,this.zu.mi()];case 8:return r=i.sent(),e.o(r)>=0?[4,this.gc(e)]:[3,10];case 9:i.sent(),i.label=10;case 10:return[3,13];case 11:return p('RemoteStore','Failed to raise snapshot:',o=i.sent()),[4,this.Vc(o)];case 12:return i.sent(),[3,13];case 13:return[2];}}));}));},t.prototype.Vc=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n=this;return i.__generator(this,(function(r){switch(r.label){case 0:if(!Gr(t))throw t;return this.Xu.add(1),[4,this.Tc()];case 1:return r.sent(),this.sc.set('Offline'),e||(e=function(){return n.zu.mi();}),this.mo._r((function(){return i.__awaiter(n,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return p('RemoteStore','Retrying IndexedDB access'),[4,e()];case 1:return t.sent(),this.Xu.delete(1),[4,this._c()];case 2:return t.sent(),[2];}}));}));})),[2];}}));}));},t.prototype.yc=function(t){var e=this;return t().catch((function(n){return e.Vc(n,t);}));},t.prototype.gc=function(t){var e=this,n=this.Ju.Ne(t);return n.Qt.forEach((function(n,r){if(n.resumeToken.H()>0){var i=e.Yu.get(r);i&&e.Yu.set(r,i.tt(n.resumeToken,t));}})),n.Wt.forEach((function(t){var n=e.Yu.get(t);if(n){e.Yu.set(t,n.tt(H.Y,n.X)),e.Ac(t);var r=new $(n.target,t,1,n.sequenceNumber);e.Ic(r);}})),this.Rc.Lh(n);},t.prototype.Pc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:e=t.cause,n=0,r=t.targetIds,i.label=1;case 1:return n<r.length?(o=r[n],this.Yu.has(o)?[4,this.Rc.pc(o,e)]:[3,3]):[3,5];case 2:i.sent(),this.Yu.delete(o),this.Ju.removeTarget(o),i.label=3;case 3:i.label=4;case 4:return n++,[3,1];case 5:return[2];}}));}));},t.prototype.wc=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n;return i.__generator(this,(function(r){switch(r.label){case 0:t=this.Hu.length>0?this.Hu[this.Hu.length-1].batchId:-1,r.label=1;case 1:if(!this.bc())return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,this.zu.Qh(t)];case 3:return null===(e=r.sent())?(0===this.Hu.length&&this.ac.ru(),[3,7]):(t=e.batchId,this.vc(e),[3,6]);case 4:return n=r.sent(),[4,this.Vc(n)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return this.Sc()&&this.Dc(),[2];}}));}));},t.prototype.bc=function(){return this.ec()&&this.Hu.length<10;},t.prototype.Cc=function(){return this.Hu.length;},t.prototype.vc=function(t){this.Hu.push(t),this.ac.nu()&&this.ac.Ru&&this.ac.Pu(t.mutations);},t.prototype.Sc=function(){return this.ec()&&!this.ac.eu()&&this.Hu.length>0;},t.prototype.Dc=function(){this.ac.start();},t.prototype.uc=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this.ac.yu(),[2];}));}));},t.prototype.lc=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n;return i.__generator(this,(function(r){for(t=0,e=this.Hu;t<e.length;t++)n=e[t],this.ac.Pu(n.mutations);return[2];}));}));},t.prototype.Vu=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return n=this.Hu.shift(),r=Nn.from(n,t,e),[4,this.yc((function(){return o.Rc.Fc(r);}))];case 1:return i.sent(),[4,this.wc()];case 2:return i.sent(),[2];}}));}));},t.prototype.cc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return t&&this.ac.Ru?[4,this.Nc(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.Sc()&&this.Dc(),[2];}}));}));},t.prototype.Nc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return i.__generator(this,(function(i){switch(i.label){case 0:return J(n=t.code)&&n!==P.ABORTED?(e=this.Hu.shift(),this.ac.iu(),[4,this.yc((function(){return r.Rc.$c(e.batchId,t);}))]):[3,3];case 1:return i.sent(),[4,this.wc()];case 2:i.sent(),i.label=3;case 3:return[2];}}));}));},t.prototype.kc=function(){return new So(this.Du);},t.prototype.nc=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.Xu.add(4),[4,this.Tc()];case 1:return t.sent(),this.sc.set('Unknown'),this.ac.iu(),this.ic.iu(),this.Xu.delete(4),[4,this._c()];case 2:return t.sent(),[2];}}));}));},t.prototype.xc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return this.mo.Wo(),p('RemoteStore','RemoteStore received new credentials'),this.Xu.add(3),[4,this.Tc()];case 1:return e.sent(),this.sc.set('Unknown'),[4,this.Rc.xc(t)];case 2:return e.sent(),this.Xu.delete(3),[4,this._c()];case 3:return e.sent(),[2];}}));}));},t.prototype.Mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return t?(this.Xu.delete(2),[4,this._c()]):[3,2];case 1:return e.sent(),[3,5];case 2:return t?[3,4]:(this.Xu.add(2),[4,this.Tc()]);case 3:e.sent(),this.sc.set('Unknown'),e.label=4;case 4:e.label=5;case 5:return[2];}}));}));},t;}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(t,e){return'firestore_clients_'+t+'_'+e;}function Po(t,e,n){var r='firestore_mutations_'+t+'_'+n;return e.zr()&&(r+='_'+e.uid),r;}function Do(t,e){return'firestore_targets_'+t+'_'+e;}var Oo=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r;}return t.Oc=function(e,n,r){var i=JSON.parse(r),o='object'==typeof i&&-1!==['pending','acknowledged','rejected'].indexOf(i.state)&&(void 0===i.error||'object'==typeof i.error),s=void 0;return o&&i.error&&(o='string'==typeof i.error.message&&'string'==typeof i.error.code)&&(s=new D(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(d('SharedClientState','Failed to parse mutation state for ID \''+n+'\': '+r),null);},t.prototype.Lc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t);},t;}(),Ro=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n;}return t.Oc=function(e,n){var r=JSON.parse(n),i='object'==typeof r&&-1!==['not-current','current','rejected'].indexOf(r.state)&&(void 0===r.error||'object'==typeof r.error),o=void 0;return i&&r.error&&(i='string'==typeof r.error.message&&'string'==typeof r.error.code)&&(o=new D(r.error.code,r.error.message)),i?new t(e,r.state,o):(d('SharedClientState','Failed to parse target state for ID \''+e+'\': '+n),null);},t.prototype.Lc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t);},t;}(),ko=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e;}return t.Oc=function(e,n){for(var r=JSON.parse(n),i='object'==typeof r&&r.activeTargetIds instanceof Array,o=dt(),s=0;i&&s<r.activeTargetIds.length;++s)i=q(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(d('SharedClientState','Failed to parse client data for instance \''+e+'\': '+n),null);},t;}(),Lo=function(){function t(t,e){this.clientId=t,this.onlineState=e;}return t.Oc=function(e){var n=JSON.parse(e);return'object'==typeof n&&-1!==['Unknown','Online','Offline'].indexOf(n.onlineState)&&'string'==typeof n.clientId?new t(n.clientId,n.onlineState):(d('SharedClientState','Failed to parse online state: '+e),null);},t;}(),Fo=function(){function t(){this.activeTargetIds=dt();}return t.prototype.Bc=function(t){this.activeTargetIds=this.activeTargetIds.add(t);},t.prototype.qc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t);},t.prototype.Lc=function(){var t={activeTargetIds:this.activeTargetIds.F(),updateTimeMs:Date.now()};return JSON.stringify(t);},t;}(),Mo=function(){function t(t,e,n,r,i){this.window=t,this.bs=e,this.persistenceKey=n,this.Uc=r,this.Rc=null,this.Lu=null,this.Ps=null,this.Qc=this.Wc.bind(this),this.jc=new tt(b),this.or=!1,this.Kc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');this.storage=this.window.localStorage,this.currentUser=i,this.Gc=xo(this.persistenceKey,this.Uc),this.zc=function(t){return'firestore_sequence_number_'+t;}(this.persistenceKey),this.jc=this.jc.nt(this.Uc,new Fo),this.Hc=new RegExp('^firestore_clients_'+o+'_([^_]*)$'),this.Yc=new RegExp('^firestore_mutations_'+o+'_(\\d+)(?:_(.*))?$'),this.Jc=new RegExp('^firestore_targets_'+o+'_(\\d+)$'),this.Xc=function(t){return'firestore_online_state_'+t;}(this.persistenceKey),this.window.addEventListener('storage',this.Qc);}return t.Hi=function(t){return!(!t||!t.localStorage);},t.prototype.start=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,u,c,h,l,f=this;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.Rc.Sr()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Uc&&(o=this.getItem(xo(this.persistenceKey,r)))&&(s=ko.Oc(r,o))&&(this.jc=this.jc.nt(s.clientId,s));for(this.Zc(),(a=this.storage.getItem(this.Xc))&&(u=this.tl(a))&&this.el(u),c=0,h=this.Kc;c<h.length;c++)l=h[c],this.Wc(l);return this.Kc=[],this.window.addEventListener('unload',(function(){return f.gr();})),this.or=!0,[2];}}));}));},t.prototype.ys=function(t){this.setItem(this.zc,JSON.stringify(t));},t.prototype.nl=function(){return this.sl(this.jc);},t.prototype.il=function(t){var e=!1;return this.jc.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0);})),e;},t.prototype.rl=function(t){this.ol(t,'pending');},t.prototype.hl=function(t,e,n){this.ol(t,e,n),this.al(t);},t.prototype.ul=function(t){var e='not-current';if(this.il(t)){var n=this.storage.getItem(Do(this.persistenceKey,t));if(n){var r=Ro.Oc(t,n);r&&(e=r.state);}}return this.cl.Bc(t),this.Zc(),e;},t.prototype.ll=function(t){this.cl.qc(t),this.Zc();},t.prototype._l=function(t){return this.cl.activeTargetIds.has(t);},t.prototype.fl=function(t){this.removeItem(Do(this.persistenceKey,t));},t.prototype.dl=function(t,e,n){this.wl(t,e,n);},t.prototype.Ch=function(t,e,n){var r=this;e.forEach((function(t){r.al(t);})),this.currentUser=t,n.forEach((function(t){r.rl(t);}));},t.prototype.Tl=function(t){this.El(t);},t.prototype.gr=function(){this.or&&(this.window.removeEventListener('storage',this.Qc),this.removeItem(this.Gc),this.or=!1);},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return p('SharedClientState','READ',t,e),e;},t.prototype.setItem=function(t,e){p('SharedClientState','SET',t,e),this.storage.setItem(t,e);},t.prototype.removeItem=function(t){p('SharedClientState','REMOVE',t),this.storage.removeItem(t);},t.prototype.Wc=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(p('SharedClientState','EVENT',n.key,n.newValue),n.key===this.Gc)return void d('Received WebStorage notification for local change. Another client might have garbage-collected our state');this.bs._r((function(){return i.__awaiter(e,void 0,void 0,(function(){var t,e,r,o,s,a;return i.__generator(this,(function(i){if(this.or){if(null!==n.key)if(this.Hc.test(n.key)){if(null==n.newValue)return t=this.Il(n.key),[2,this.ml(t,null)];if(e=this.Al(n.key,n.newValue))return[2,this.ml(e.clientId,e)];}else if(this.Yc.test(n.key)){if(null!==n.newValue&&(r=this.Rl(n.key,n.newValue)))return[2,this.Pl(r)];}else if(this.Jc.test(n.key)){if(null!==n.newValue&&(o=this.Vl(n.key,n.newValue)))return[2,this.gl(o)];}else if(n.key===this.Xc){if(null!==n.newValue&&(s=this.tl(n.newValue)))return[2,this.el(s)];}else n.key===this.zc&&(a=function(t){var e=kn.ps;if(null!=t)try{var n=JSON.parse(t);g('number'==typeof n),e=n;}catch(t){d('SharedClientState','Failed to read sequence number from WebStorage',t);}return e;}(n.newValue))!==kn.ps&&this.Ps(a);}else this.Kc.push(n);return[2];}));}));}));}},Object.defineProperty(t.prototype,'cl',{get:function(){return this.jc.get(this.Uc);},enumerable:!1,configurable:!0}),t.prototype.Zc=function(){this.setItem(this.Gc,this.cl.Lc());},t.prototype.ol=function(t,e,n){var r=new Oo(this.currentUser,t,e,n),i=Po(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Lc());},t.prototype.al=function(t){var e=Po(this.persistenceKey,this.currentUser,t);this.removeItem(e);},t.prototype.El=function(t){var e={clientId:this.Uc,onlineState:t};this.storage.setItem(this.Xc,JSON.stringify(e));},t.prototype.wl=function(t,e,n){var r=Do(this.persistenceKey,t),i=new Ro(t,e,n);this.setItem(r,i.Lc());},t.prototype.Il=function(t){var e=this.Hc.exec(t);return e?e[1]:null;},t.prototype.Al=function(t,e){var n=this.Il(t);return ko.Oc(n,e);},t.prototype.Rl=function(t,e){var n=this.Yc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Oo.Oc(new vo(i),r,e);},t.prototype.Vl=function(t,e){var n=this.Jc.exec(t),r=Number(n[1]);return Ro.Oc(r,e);},t.prototype.tl=function(t){return Lo.Oc(t);},t.prototype.Pl=function(t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.Rc.yl(t.batchId,t.state,t.error)]:(p('SharedClientState','Ignoring mutation for non-active user '+t.user.uid),[2]);}));}));},t.prototype.gl=function(t){return this.Rc.pl(t.targetId,t.state,t.error);},t.prototype.ml=function(t,e){var n=this,r=e?this.jc.nt(t,e):this.jc.remove(t),i=this.sl(this.jc),o=this.sl(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t);})),i.forEach((function(t){o.has(t)||a.push(t);})),this.Rc.bl(s,a).then((function(){n.jc=r;}));},t.prototype.el=function(t){this.jc.get(t.clientId)&&this.Lu(t.onlineState);},t.prototype.sl=function(t){var e=dt();return t.forEach((function(t,n){e=e.Ct(n.activeTargetIds);})),e;},t;}(),Uo=function(){function t(){this.vl=new Fo,this.Sl={},this.Rc=null,this.Lu=null,this.Ps=null;}return t.prototype.rl=function(t){},t.prototype.hl=function(t,e,n){},t.prototype.ul=function(t){return this.vl.Bc(t),this.Sl[t]||'not-current';},t.prototype.dl=function(t,e,n){this.Sl[t]=e;},t.prototype.ll=function(t){this.vl.qc(t);},t.prototype._l=function(t){return this.vl.activeTargetIds.has(t);},t.prototype.fl=function(t){delete this.Sl[t];},t.prototype.nl=function(){return this.vl.activeTargetIds;},t.prototype.il=function(t){return this.vl.activeTargetIds.has(t);},t.prototype.start=function(){return this.vl=new Fo,Promise.resolve();},t.prototype.Ch=function(t,e,n){},t.prototype.Tl=function(t){},t.prototype.gr=function(){},t.prototype.ys=function(t){},t;}(),Vo=function(t){this.key=t;},jo=function(t){this.key=t;},qo=function(){function t(t,e){this.query=t,this.Dl=e,this.Cl=null,this.Ht=!1,this.Fl=ft(),this.Lt=ft(),this.Nl=fn(t),this.$l=new yt(this.Nl);}return Object.defineProperty(t.prototype,'kl',{get:function(){return this.Dl;},enumerable:!1,configurable:!0}),t.prototype.xl=function(t,e){var n=this,r=e?e.Ml:new vt,i=e?e.$l:this.$l,o=e?e.Lt:this.Lt,s=i,a=!1,u=this.query.In()&&i.size===this.query.limit?i.last():null,c=this.query.mn()&&i.size===this.query.limit?i.first():null;if(t.ot((function(t,e){var h=i.get(t),l=e instanceof rn?e:null;l&&(l=ln(n.query,l)?l:null);var f=!!h&&n.Lt.has(h.key),p=!!l&&(l.Ge||n.Lt.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data().isEqual(l.data())?f!==p&&(r.track({type:3,doc:l}),d=!0):n.Ol(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.Nl(l,u)>0||c&&n.Nl(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)));})),this.query.In()||this.query.mn())for(;s.size>this.query.limit;){var h=this.query.In()?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h});}return{$l:s,Ml:r,Ll:a,Lt:o};},t.prototype.Ol=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge;},t.prototype.Jn=function(t,e,n){var r=this,i=this.$l;this.$l=t.$l,this.Lt=t.Lt;var o=t.Ml.Mt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v();}};return n(t)-n(e);}(t.type,e.type)||r.Nl(t.doc,e.doc);})),this.Bl(n);var s=e?this.ql():[],a=0===this.Fl.size&&this.Ht?1:0,u=a!==this.Cl;return this.Cl=a,0!==o.length||u?{snapshot:new gt(this.query,t.$l,i,o,t.Lt,0===a,u,!1),Ul:s}:{Ul:s};},t.prototype.Ql=function(t){return this.Ht&&'Offline'===t?(this.Ht=!1,this.Jn({$l:this.$l,Ml:new vt,Lt:this.Lt,Ll:!1},!1)):{Ul:[]};},t.prototype.Wl=function(t){return!this.Dl.has(t)&&!!this.$l.has(t)&&!this.$l.get(t).Ge;},t.prototype.Bl=function(t){var e=this;t&&(t.Yt.forEach((function(t){return e.Dl=e.Dl.add(t);})),t.Jt.forEach((function(t){})),t.Xt.forEach((function(t){return e.Dl=e.Dl.delete(t);})),this.Ht=t.Ht);},t.prototype.ql=function(){var t=this;if(!this.Ht)return[];var e=this.Fl;this.Fl=ft(),this.$l.forEach((function(e){t.Wl(e.key)&&(t.Fl=t.Fl.add(e.key));}));var n=[];return e.forEach((function(e){t.Fl.has(e)||n.push(new jo(e));})),this.Fl.forEach((function(t){e.has(t)||n.push(new Vo(t));})),n;},t.prototype.jl=function(t){this.Dl=t.zh,this.Fl=ft();var e=this.xl(t.documents);return this.Jn(e,!0);},t.prototype.Kl=function(){return gt.Ut(this.query,this.$l,this.Lt,0===this.Cl);},t;}(),Bo=function(){function t(t,e,n,r){this.mo=t,this.Du=e,this.updateFunction=n,this.Po=r,this.Gl=5,this.$o=new Fn(this.mo,'transaction_retry');}return t.prototype.run=function(){this.zl();},t.prototype.zl=function(){var t=this;this.$o.xs((function(){return i.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return i.__generator(this,(function(r){return t=new So(this.Du),(e=this.Hl(t))&&e.then((function(e){n.mo.cr((function(){return t.commit().then((function(){n.Po.resolve(e);})).catch((function(t){n.Yl(t);}));}));})).catch((function(t){n.Yl(t);})),[2];}));}));}));},t.prototype.Hl=function(t){try{var e=this.updateFunction(t);return!V(e)&&e.catch&&e.then?e:(this.Po.reject(Error('Transaction callback must return a Promise')),null);}catch(t){return this.Po.reject(t),null;}},t.prototype.Yl=function(t){var e=this;this.Gl>0&&this.Jl(t)?(this.Gl-=1,this.mo.cr((function(){return e.zl(),Promise.resolve();}))):this.Po.reject(t);},t.prototype.Jl=function(t){if('FirebaseError'===t.name){var e=t.code;return'aborted'===e||'failed-precondition'===e||!J(e);}return!1;},t;}(),Wo=function(t,e,n){this.query=t,this.targetId=e,this.view=n;},Qo=function(t){this.key=t,this.Xl=!1;},zo=function(){function t(t,e,n,r,i,o){this.zu=t,this.Zl=e,this.Du=n,this.t_=r,this.currentUser=i,this.e_=o,this.n_=null,this.s_=new x((function(t){return cn(t);}),un),this.i_=new Map,this.r_=[],this.o_=new tt(U.P),this.h_=new Map,this.a_=new fi,this.u_={},this.c_=new Map,this.l_=sr.di(),this.onlineState='Unknown';}return Object.defineProperty(t.prototype,'__',{get:function(){return!0;},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){this.n_=t;},t.prototype.listen=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_('listen()'),(r=this.s_.get(t))?(e=r.targetId,this.t_.ul(e),n=r.view.Kl(),[3,4]):[3,1];case 1:return[4,this.zu.jh(t.We())];case 2:return o=i.sent(),s=this.t_.ul(o.targetId),e=o.targetId,[4,this.d_(t,e,'current'===s)];case 3:n=i.sent(),this.__&&this.Zl.listen(o),i.label=4;case 4:return[2,n];}}));}));},t.prototype.d_=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o,s,a,u,c;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.zu.Gh(t,!0)];case 1:return r=i.sent(),o=new qo(t,r.zh),s=o.xl(r.documents),a=_t.zt(e,n&&'Offline'!==this.onlineState),u=o.Jn(s,this.__,a),this.w_(e,u.Ul),c=new Wo(t,e,o),[2,(this.s_.set(t,c),this.i_.has(e)?this.i_.get(e).push(t):this.i_.set(e,[t]),u.snapshot)];}}));}));},t.prototype.mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_('unlisten()'),e=this.s_.get(t),(n=this.i_.get(e.targetId)).length>1?[2,(this.i_.set(e.targetId,n.filter((function(e){return!un(e,t);}))),void this.s_.delete(t))]:this.__?(this.t_.ll(e.targetId),this.t_.il(e.targetId)?[3,2]:[4,this.zu.Kh(e.targetId,!1).then((function(){r.t_.fl(e.targetId),r.Zl.mc(e.targetId),r.T_(e.targetId);})).catch(li)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.T_(e.targetId),[4,this.zu.Kh(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2];}}));}));},t.prototype.write=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:this.f_('write()'),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.zu.kh(t)];case 2:return n=i.sent(),this.t_.rl(n.batchId),this.E_(n.batchId,e),[4,this.I_(n.Un)];case 3:return i.sent(),[4,this.Zl.wc()];case 4:return i.sent(),[3,6];case 5:return r=i.sent(),o=ei(r,'Failed to persist write'),e.reject(o),[3,6];case 6:return[2];}}));}));},t.prototype.runTransaction=function(t,e,n){new Bo(t,this.Du,e,n).run();},t.prototype.Lh=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:this.f_('applyRemoteEvent()'),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zu.Lh(t)];case 2:return e=r.sent(),t.Qt.forEach((function(t,e){var r=n.h_.get(e);r&&(g(t.Yt.size+t.Jt.size+t.Xt.size<=1),t.Yt.size>0?r.Xl=!0:t.Jt.size>0?g(r.Xl):t.Xt.size>0&&(g(r.Xl),r.Xl=!1));})),[4,this.I_(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,li(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2];}}));}));},t.prototype.Ql=function(t,e){this.f_('applyOnlineStateChange()');var n=[];this.s_.forEach((function(e,r){var i=r.view.Ql(t);i.snapshot&&n.push(i.snapshot);})),this.n_.m_(t),this.n_.Eu(n),this.onlineState=t;},t.prototype.pc=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,a,u=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_('rejectListens()'),this.t_.dl(t,'rejected',e),n=this.h_.get(t),(r=n&&n.key)?(o=(o=new tt(U.P)).nt(r,new on(r,R.min())),s=ft().add(r),a=new mt(R.min(),new Map,new rt(b),o,s),[4,this.Lh(a)]):[3,2];case 1:return i.sent(),this.o_=this.o_.remove(r),this.h_.delete(t),this.A_(),[3,4];case 2:return[4,this.zu.Kh(t,!1).then((function(){return u.T_(t,e);})).catch(li)];case 3:i.sent(),i.label=4;case 4:return[2];}}));}));},t.prototype.Fc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n;return i.__generator(this,(function(r){switch(r.label){case 0:this.f_('applySuccessfulWrite()'),e=t.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zu.xh(t)];case 2:return n=r.sent(),this.R_(e,null),this.P_(e),this.t_.hl(e,'acknowledged'),[4,this.I_(n)];case 3:return r.sent(),[3,6];case 4:return[4,li(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2];}}));}));},t.prototype.$c=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n;return i.__generator(this,(function(r){switch(r.label){case 0:this.f_('rejectFailedWrite()'),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zu.Oh(t)];case 2:return n=r.sent(),this.R_(t,e),this.P_(t),this.t_.hl(t,'rejected',e),[4,this.I_(n)];case 3:return r.sent(),[3,6];case 4:return[4,li(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2];}}));}));},t.prototype.V_=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:this.Zl.ec()||p('SyncEngine','The network is disabled. The task returned by \'awaitPendingWrites()\' will not complete until the network is enabled.'),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.zu.to()];case 2:return-1===(e=i.sent())?[2,void t.resolve()]:((n=this.c_.get(e)||[]).push(t),this.c_.set(e,n),[3,4]);case 3:return r=i.sent(),o=ei(r,'Initialization of waitForPendingWrites() operation failed'),t.reject(o),[3,4];case 4:return[2];}}));}));},t.prototype.P_=function(t){(this.c_.get(t)||[]).forEach((function(t){t.resolve();})),this.c_.delete(t);},t.prototype.g_=function(t){this.c_.forEach((function(e){e.forEach((function(e){e.reject(new D(P.CANCELLED,t));}));})),this.c_.clear();},t.prototype.E_=function(t,e){var n=this.u_[this.currentUser.ka()];n||(n=new tt(b)),n=n.nt(t,e),this.u_[this.currentUser.ka()]=n;},t.prototype.R_=function(t,e){var n=this.u_[this.currentUser.ka()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.u_[this.currentUser.ka()]=n;}},t.prototype.T_=function(t,e){var n=this;void 0===e&&(e=null),this.t_.ll(t);for(var r=0,i=this.i_.get(t);r<i.length;r++){var o=i[r];this.s_.delete(o),e&&this.n_.y_(o,e);}this.i_.delete(t),this.__&&this.a_.oa(t).forEach((function(t){n.a_.Mi(t)||n.p_(t);}));},t.prototype.p_=function(t){var e=this.o_.get(t);null!==e&&(this.Zl.mc(e),this.o_=this.o_.remove(t),this.h_.delete(e),this.A_());},t.prototype.w_=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Vo?(this.a_.Fi(i.key,t),this.b_(i)):i instanceof jo?(p('SyncEngine','Document no longer in limbo: '+i.key),this.a_.$i(i.key,t),this.a_.Mi(i.key)||this.p_(i.key)):v();}},t.prototype.b_=function(t){var e=t.key;this.o_.get(e)||(p('SyncEngine','New document in limbo: '+e),this.r_.push(e),this.A_());},t.prototype.A_=function(){for(;this.r_.length>0&&this.o_.size<this.e_;){var t=this.r_.shift(),e=this.l_.next();this.h_.set(e,new Qo(t)),this.o_=this.o_.nt(t,e),this.Zl.listen(new $(an.hn(t.path).We(),e,2,kn.ps));}},t.prototype.v_=function(){return this.o_;},t.prototype.S_=function(){return this.r_;},t.prototype.I_=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return n=[],r=[],o=[],this.s_.forEach((function(i,a){o.push(Promise.resolve().then((function(){var e=a.view.xl(t);return e.Ll?s.zu.Gh(a.query,!1).then((function(t){var n=t.documents;return a.view.xl(n,e);})):e;})).then((function(t){var i=e&&e.Qt.get(a.targetId),o=a.view.Jn(t,s.__,i);if(s.w_(a.targetId,o.Ul),o.snapshot){s.__&&s.t_.dl(a.targetId,o.snapshot.fromCache?'not-current':'current'),n.push(o.snapshot);var u=Rn.Rs(a.targetId,o.snapshot);r.push(u);}})));})),[4,Promise.all(o)];case 1:return i.sent(),this.n_.Eu(n),[4,this.zu.Uh(r)];case 2:return i.sent(),[2];}}));}));},t.prototype.f_=function(t){},t.prototype.xc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return this.currentUser.isEqual(t)?[3,3]:(p('SyncEngine','User change. New user:',t.ka()),[4,this.zu.Ch(t)]);case 1:return e=n.sent(),this.currentUser=t,this.g_('\'waitForPendingWrites\' promise is rejected due to a user change.'),this.t_.Ch(t,e.Nh,e.$h),[4,this.I_(e.Fh)];case 2:n.sent(),n.label=3;case 3:return[2];}}));}));},t.prototype.enableNetwork=function(){return this.Zl.enableNetwork();},t.prototype.disableNetwork=function(){return this.Zl.disableNetwork();},t.prototype.xe=function(t){var e=this.h_.get(t);if(e&&e.Xl)return ft().add(e.key);var n=ft(),r=this.i_.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.s_.get(s);n=n.Ct(a.view.kl);}return n;},t;}();function Go(t,e,n,r,i,o){return new zo(t,e,n,r,i,o);}var Ho=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,o,s)||this).zu=e,a.D_=void 0,a;}return i.__extends(e,t),Object.defineProperty(e.prototype,'__',{get:function(){return!0===this.D_;},enumerable:!1,configurable:!0}),e.prototype.enableNetwork=function(){return this.zu.ur(!0),t.prototype.enableNetwork.call(this);},e.prototype.disableNetwork=function(){return this.zu.ur(!1),t.prototype.disableNetwork.call(this);},e.prototype.C_=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n;return i.__generator(this,(function(r){switch(r.label){case 0:return[4,this.zu.Gh(t.query,!0)];case 1:return e=r.sent(),n=t.view.jl(e),[2,(this.D_&&this.w_(t.targetId,n.Ul),n)];}}));}));},e.prototype.Ql=function(e,n){this.__&&0===n&&(t.prototype.Ql.call(this,e,n),this.t_.Tl(e)),this.__||1!==n||t.prototype.Ql.call(this,e,n);},e.prototype.yl=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r;return i.__generator(this,(function(i){switch(i.label){case 0:return this.f_('applyBatchState()'),[4,this.zu.Yh(t)];case 1:return null===(r=i.sent())?[3,6]:'pending'!==e?[3,3]:[4,this.Zl.wc()];case 2:return i.sent(),[3,4];case 3:'acknowledged'===e||'rejected'===e?(this.R_(t,n||null),this.zu.Jh(t)):v(),i.label=4;case 4:return[4,this.I_(r)];case 5:return i.sent(),[3,7];case 6:p('SyncEngine','Cannot apply mutation batch with id: '+t),i.label=7;case 7:return[2];}}));}));},e.prototype.Mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,a,u,c=this;return i.__generator(this,(function(i){switch(i.label){case 0:return!0!==t||!0===this.D_?[3,3]:(e=this.t_.nl(),[4,this.F_(e.F(),!0)]);case 1:return n=i.sent(),this.D_=!0,[4,this.Zl.Mc(!0)];case 2:for(i.sent(),r=0,o=n;r<o.length;r++)s=o[r],this.Zl.listen(s);return[3,7];case 3:return!1!==t||!1===this.D_?[3,7]:(a=[],u=Promise.resolve(),this.i_.forEach((function(t,e){c.t_._l(e)?a.push(e):u=u.then((function(){return c.T_(e),c.zu.Kh(e,!0);})),c.Zl.mc(e);})),[4,u]);case 4:return i.sent(),[4,this.F_(a,!1)];case 5:return i.sent(),this.N_(),this.D_=!1,[4,this.Zl.Mc(!1)];case 6:i.sent(),i.label=7;case 7:return[2];}}));}));},e.prototype.N_=function(){var t=this;this.h_.forEach((function(e,n){t.Zl.mc(n);})),this.a_.ha(),this.h_=new Map,this.o_=new tt(U.P);},e.prototype.F_=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,a,u,c,h,l,f,p,d;return i.__generator(this,(function(i){switch(i.label){case 0:e=[],n=[],r=0,o=t,i.label=1;case 1:return r<o.length?(s=o[r],a=void 0,(u=this.i_.get(s))&&0!==u.length?[4,this.zu.jh(u[0].We())]:[3,7]):[3,13];case 2:a=i.sent(),c=0,h=u,i.label=3;case 3:return c<h.length?(l=h[c],f=this.s_.get(l),[4,this.C_(f)]):[3,6];case 4:(p=i.sent()).snapshot&&n.push(p.snapshot),i.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,this.zu.Xh(s)];case 8:return d=i.sent(),[4,this.zu.jh(d)];case 9:return a=i.sent(),[4,this.d_(this.k_(d),s,!1)];case 10:i.sent(),i.label=11;case 11:e.push(a),i.label=12;case 12:return r++,[3,1];case 13:return[2,(this.n_.Eu(n),e)];}}));}));},e.prototype.k_=function(t){return new an(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,'F',t.startAt,t.endAt);},e.prototype.Sr=function(){return this.zu.Sr();},e.prototype.pl=function(t,e,n){return i.__awaiter(this,void 0,void 0,(function(){var r,o;return i.__generator(this,(function(i){switch(i.label){case 0:return this.D_?(p('SyncEngine','Ignoring unexpected query state notification.'),[3,8]):[3,1];case 1:if(!this.i_.has(t))return[3,8];switch(e){case'current':case'not-current':return[3,2];case'rejected':return[3,5];}return[3,7];case 2:return[4,this.zu.si()];case 3:return r=i.sent(),o=mt.Gt(t,'current'===e),[4,this.I_(r,o)];case 4:return i.sent(),[3,8];case 5:return[4,this.zu.Kh(t,!0)];case 6:return i.sent(),this.T_(t,n),[3,8];case 7:v(),i.label=8;case 8:return[2];}}));}));},e.prototype.bl=function(t,e){return i.__awaiter(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l,f,d=this;return i.__generator(this,(function(y){switch(y.label){case 0:if(!this.D_)return[3,10];n=0,r=t,y.label=1;case 1:return n<r.length?(o=r[n],this.i_.has(o)?(p('SyncEngine','Adding an already active target '+o),[3,5]):[4,this.zu.Xh(o)]):[3,6];case 2:return s=y.sent(),[4,this.zu.jh(s)];case 3:return a=y.sent(),[4,this.d_(this.k_(s),a.targetId,!1)];case 4:y.sent(),this.Zl.listen(a),y.label=5;case 5:return n++,[3,1];case 6:u=function(t){return i.__generator(this,(function(e){switch(e.label){case 0:return c.i_.has(t)?[4,c.zu.Kh(t,!1).then((function(){d.Zl.mc(t),d.T_(t);})).catch(li)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2];}}));},c=this,h=0,l=e,y.label=7;case 7:return h<l.length?(f=l[h],[5,u(f)]):[3,10];case 8:y.sent(),y.label=9;case 9:return h++,[3,7];case 10:return[2];}}));}));},e;}(zo),Ko=function(){this.x_=void 0,this.listeners=[];},Yo=function(){function t(t){this.Rc=t,this.M_=new x((function(t){return cn(t);}),un),this.onlineState='Unknown',this.O_=new Set,this.Rc.subscribe(this);}return t.prototype.listen=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:if(e=t.query,n=!1,(r=this.M_.get(e))||(n=!0,r=new Ko),!n)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),o=r,[4,this.Rc.listen(e)];case 2:return o.x_=i.sent(),[3,4];case 3:return s=i.sent(),a=ei(s,'Initialization of query \''+hn(t.query)+'\' failed'),[2,void t.onError(a)];case 4:return this.M_.set(e,r),r.listeners.push(t),t.Ql(this.onlineState),r.x_&&t.L_(r.x_)&&this.B_(),[2];}}));}));},t.prototype.mc=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return i.__generator(this,(function(i){return e=t.query,n=!1,(r=this.M_.get(e))&&(o=r.listeners.indexOf(t))>=0&&(r.listeners.splice(o,1),n=0===r.listeners.length),n?[2,(this.M_.delete(e),this.Rc.mc(e))]:[2];}));}));},t.prototype.Eu=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.M_.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].L_(i)&&(e=!0);s.x_=i;}}e&&this.B_();},t.prototype.y_=function(t,e){var n=this.M_.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.M_.delete(t);},t.prototype.m_=function(t){this.onlineState=t;var e=!1;this.M_.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].Ql(t)&&(e=!0);})),e&&this.B_();},t.prototype.q_=function(t){this.O_.add(t),t.next();},t.prototype.U_=function(t){this.O_.delete(t);},t.prototype.B_=function(){this.O_.forEach((function(t){t.next();}));},t;}(),$o=function(){function t(t,e,n){this.query=t,this.Q_=e,this.W_=!1,this.j_=null,this.onlineState='Unknown',this.options=n||{};}return t.prototype.L_=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i);}t=new gt(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.Bt,!0);}var o=!1;return this.W_?this.K_(t)&&(this.Q_.next(t),o=!0):this.G_(t,this.onlineState)&&(this.z_(t),o=!0),this.j_=t,o;},t.prototype.onError=function(t){this.Q_.error(t);},t.prototype.Ql=function(t){this.onlineState=t;var e=!1;return this.j_&&!this.W_&&this.G_(this.j_,t)&&(this.z_(this.j_),e=!0),e;},t.prototype.G_=function(t,e){if(!t.fromCache)return!0;var n='Offline'!==e;return!(this.options.H_&&n||t.docs._()&&'Offline'!==e);},t.prototype.K_=function(t){if(t.docChanges.length>0)return!0;var e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges;},t.prototype.z_=function(t){t=gt.Ut(t.query,t.docs,t.Lt,t.fromCache),this.W_=!0,this.Q_.next(t);},t;}(),Xo=function(){function t(){}return t.prototype.Dh=function(t){this.Y_=t;},t.prototype._s=function(t,e,n,r){var i=this;return e.En()||n.isEqual(R.min())?this.J_(t,e):this.Y_.us(t,r).next((function(o){var a=i.X_(e,o);return(e.In()||e.mn())&&i.Ll(e.nn,a,r,n)?i.J_(t,e):(f()<=s.LogLevel.DEBUG&&p('IndexFreeQueryEngine','Re-using previous result from %s to execute query: %s',n.toString(),hn(e)),i.Y_._s(t,e,n).next((function(t){return a.forEach((function(e){t=t.nt(e.key,e);})),t;})));}));},t.prototype.X_=function(t,e){var n=new rt(fn(t));return e.forEach((function(e,r){r instanceof rn&&ln(t,r)&&(n=n.add(r));})),n;},t.prototype.Ll=function(t,e,n,r){if(n.size!==e.size)return!0;var i='F'===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.o(r)>0);},t.prototype.J_=function(t,e){return f()<=s.LogLevel.DEBUG&&p('IndexFreeQueryEngine','Using full collection scan to execute query:',hn(e)),this.Y_._s(t,e,R.min());},t;}(),Jo=function(){function t(t,e){this.ss=t,this.wi=e,this.ns=[],this.Z_=1,this.tf=new rt(pi.ta);}return t.prototype.Hr=function(t){return An.resolve(0===this.ns.length);},t.prototype.Yr=function(t,e,n,r){var i=this.Z_;this.Z_++,this.ns.length>0&&this.ns[this.ns.length-1];var o=new Sn(i,e,n,r);this.ns.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.tf=this.tf.add(new pi(u.key,i)),this.ss.Us(t,u.key.path.p());}return An.resolve(o);},t.prototype.Jr=function(t,e){return An.resolve(this.ef(e));},t.prototype.Zr=function(t,e){var n=e+1,r=this.nf(n),i=r<0?0:r;return An.resolve(this.ns.length>i?this.ns[i]:null);},t.prototype.to=function(){return An.resolve(0===this.ns.length?-1:this.Z_-1);},t.prototype.eo=function(t){return An.resolve(this.ns.slice());},t.prototype.os=function(t,e){var n=this,r=new pi(e,0),i=new pi(e,Number.POSITIVE_INFINITY),o=[];return this.tf.vt([r,i],(function(t){var e=n.ef(t.ua);o.push(e);})),An.resolve(o);},t.prototype.ls=function(t,e){var n=this,r=new rt(b);return e.forEach((function(t){var e=new pi(t,0),i=new pi(t,Number.POSITIVE_INFINITY);n.tf.vt([e,i],(function(t){r=r.add(t.ua);}));})),An.resolve(this.sf(r));},t.prototype.Es=function(t,e){var n=e.path,r=n.length+1,i=n;U.W(i)||(i=i.child(''));var o=new pi(new U(i),0),s=new rt(b);return this.tf.St((function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.ua)),!0);}),o),An.resolve(this.sf(s));},t.prototype.sf=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.ef(t);null!==r&&n.push(r);})),n;},t.prototype.so=function(t,e){var n=this;g(0===this.if(e.batchId,'removed')),this.ns.shift();var r=this.tf;return An.forEach(e.mutations,(function(i){var o=new pi(i.key,e.batchId);return r=r.delete(o),n.wi.qr(t,i.key);})).next((function(){n.tf=r;}));},t.prototype.io=function(t){},t.prototype.Mi=function(t,e){var n=new pi(e,0),r=this.tf.Dt(n);return An.resolve(e.isEqual(r&&r.key));},t.prototype.ro=function(t){return this.ns.length,An.resolve();},t.prototype.if=function(t,e){return this.nf(t);},t.prototype.nf=function(t){return 0===this.ns.length?0:t-this.ns[0].batchId;},t.prototype.ef=function(t){var e=this.nf(t);return e<0||e>=this.ns.length?null:this.ns[e];},t;}(),Zo=function(){function t(t,e){this.ss=t,this.rf=e,this.docs=new tt(U.P),this.size=0;}return t.prototype.jn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.rf(e);return this.docs=this.docs.nt(r,{Ys:e,size:s,readTime:n}),this.size+=s-o,this.ss.Us(t,r.path.p());},t.prototype.Gn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size);},t.prototype.zn=function(t,e){var n=this.docs.get(e);return An.resolve(n?n.Ys:null);},t.prototype.getEntries=function(t,e){var n=this,r=at();return e.forEach((function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Ys:null);})),An.resolve(r);},t.prototype._s=function(t,e,n){for(var r=ct(),i=new U(e.path.child('')),o=this.docs.ut(i);o.wt();){var s=o.dt(),a=s.key,u=s.value,c=u.Ys,h=u.readTime;if(!e.path.D(a.path))break;h.o(n)<=0||c instanceof rn&&ln(e,c)&&(r=r.nt(c.key,c));}return An.resolve(r);},t.prototype.hf=function(t,e){return An.forEach(this.docs,(function(t){return e(t);}));},t.prototype.oi=function(e){return new t.hi(this);},t.prototype.ui=function(t){return An.resolve(this.size);},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zo.hi=function(t){function e(e){var n=this;return(n=t.call(this)||this).ci=e,n;}return i.__extends(e,t),e.prototype.Jn=function(t){var e=this,n=[];return this.Un.forEach((function(r,i){i?n.push(e.ci.jn(t,i,e.readTime)):e.ci.Gn(r);})),An.Bn(n);},e.prototype.Hn=function(t,e){return this.ci.zn(t,e);},e.prototype.Yn=function(t,e){return this.ci.getEntries(t,e);},e;}(xn);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ts=function(){function t(t){this.persistence=t,this.af=new x((function(t){return Q(t);}),z),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.uf=0,this.cf=new fi,this.targetCount=0,this.lf=sr.fi();}return t.prototype.pe=function(t,e){return this.af.forEach((function(t,n){return e(n);})),An.resolve();},t.prototype.mi=function(t){return An.resolve(this.lastRemoteSnapshotVersion);},t.prototype.Ai=function(t){return An.resolve(this.uf);},t.prototype.Ti=function(t){return this.highestTargetId=this.lf.next(),An.resolve(this.highestTargetId);},t.prototype.Ri=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.uf&&(this.uf=e),An.resolve();},t.prototype.Vi=function(t){this.af.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.lf=new sr(e),this.highestTargetId=e),t.sequenceNumber>this.uf&&(this.uf=t.sequenceNumber);},t.prototype.Pi=function(t,e){return this.Vi(e),this.targetCount+=1,An.resolve();},t.prototype.yi=function(t,e){return this.Vi(e),An.resolve();},t.prototype.pi=function(t,e){return this.af.delete(e.target),this.cf.oa(e.targetId),this.targetCount-=1,An.resolve();},t.prototype.vi=function(t,e,n){var r=this,i=0,o=[];return this.af.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.af.delete(s),o.push(r.bi(t,a.targetId)),i++);})),An.Bn(o).next((function(){return i;}));},t.prototype.Si=function(t){return An.resolve(this.targetCount);},t.prototype.Di=function(t,e){var n=this.af.get(e)||null;return An.resolve(n);},t.prototype.Ci=function(t,e,n){return this.cf.sa(e,n),An.resolve();},t.prototype.Ni=function(t,e,n){this.cf.ra(e,n);var r=this.persistence.wi,i=[];return r&&e.forEach((function(e){i.push(r.qr(t,e));})),An.Bn(i);},t.prototype.bi=function(t,e){return this.cf.oa(e),An.resolve();},t.prototype.ki=function(t,e){var n=this.cf.aa(e);return An.resolve(n);},t.prototype.Mi=function(t,e){return An.resolve(this.cf.Mi(e));},t;}(),es=function(){function t(t){var e=this;this._f={},this.Ui=new kn(0),this.Qi=!1,this.Qi=!0,this.wi=t(this),this.Ji=new ts(this),this.ss=new qn,this.es=new Zo(this.ss,(function(t){return e.wi.ff(t);}));}return t.prototype.start=function(){return Promise.resolve();},t.prototype.gr=function(){return this.Qi=!1,Promise.resolve();},Object.defineProperty(t.prototype,'or',{get:function(){return this.Qi;},enumerable:!1,configurable:!0}),t.prototype.hr=function(){},t.prototype.$r=function(){return this.ss;},t.prototype.Dr=function(t){var e=this._f[t.ka()];return e||(e=new Jo(this.ss,this.wi),this._f[t.ka()]=e),e;},t.prototype.Fr=function(){return this.Ji;},t.prototype.Nr=function(){return this.es;},t.prototype.runTransaction=function(t,e,n){var r=this;p('MemoryPersistence','Starting transaction:',t);var i=new ns(this.Ui.next());return this.wi.df(),n(i).next((function(t){return r.wi.wf(i).next((function(){return t;}));})).On().then((function(t){return i.ts(),t;}));},t.prototype.Tf=function(t,e){return An.qn(Object.values(this._f).map((function(n){return function(){return n.Mi(t,e);};})));},t;}(),ns=function(t){function e(e){var n=this;return(n=t.call(this)||this).Li=e,n;}return i.__extends(e,t),e;}(Dn),rs=function(){function t(t){this.persistence=t,this.Ef=new fi,this.If=null;}return t.mf=function(e){return new t(e);},Object.defineProperty(t.prototype,'Af',{get:function(){if(this.If)return this.If;throw v();},enumerable:!1,configurable:!0}),t.prototype.Fi=function(t,e,n){return this.Ef.Fi(n,e),this.Af.delete(n),An.resolve();},t.prototype.$i=function(t,e,n){return this.Ef.$i(n,e),this.Af.add(n),An.resolve();},t.prototype.qr=function(t,e){return this.Af.add(e),An.resolve();},t.prototype.removeTarget=function(t,e){var n=this;this.Ef.oa(e.targetId).forEach((function(t){return n.Af.add(t);}));var r=this.persistence.Fr();return r.ki(t,e.targetId).next((function(t){t.forEach((function(t){return n.Af.add(t);}));})).next((function(){return r.pi(t,e);}));},t.prototype.df=function(){this.If=new Set;},t.prototype.wf=function(t){var e=this,n=this.persistence.Nr().oi();return An.forEach(this.Af,(function(r){return e.Rf(t,r).next((function(t){t||n.Gn(r);}));})).next((function(){return e.If=null,n.apply(t);}));},t.prototype.jr=function(t,e){var n=this;return this.Rf(t,e).next((function(t){t?n.Af.delete(e):n.Af.add(e);}));},t.prototype.ff=function(t){return 0;},t.prototype.Rf=function(t,e){var n=this;return An.qn([function(){return An.resolve(n.Ef.Mi(e));},function(){return n.persistence.Fr().Mi(t,e);},function(){return n.persistence.Tf(t,e);}]);},t;}(),is=function(){function t(t){this.Pf=t.Pf,this.Vf=t.Vf;}return t.prototype.wu=function(t){this.gf=t;},t.prototype.cu=function(t){this.yf=t;},t.prototype.onMessage=function(t){this.pf=t;},t.prototype.close=function(){this.Vf();},t.prototype.send=function(t){this.Pf(t);},t.prototype.bf=function(){this.gf();},t.prototype.vf=function(t){this.yf(t);},t.prototype.Sf=function(t){this.pf(t);},t;}(),os={BatchGetDocuments:'batchGet',Commit:'commit'},ss='gl-js/ fire/'+h,as=function(){function t(t){this.s=t.s;var e=t.ssl?'https':'http';this.Df=e+'://'+t.host,this.forceLongPolling=t.forceLongPolling;}return t.prototype.Cf=function(t,e){if(e)for(var n in e.Oa)e.Oa.hasOwnProperty(n)&&(t[n]=e.Oa[n]);t['X-Goog-Api-Client']=ss;},t.prototype.vu=function(t,e,n){var r=this,i=this.Ff(t);return new Promise((function(o,s){var a=new u.XhrIo;a.listenOnce(u.EventType.COMPLETE,(function(){try{switch(a.getLastErrorCode()){case u.ErrorCode.NO_ERROR:var e=a.getResponseJson();p('Connection','XHR received:',JSON.stringify(e)),o(e);break;case u.ErrorCode.TIMEOUT:p('Connection','RPC "'+t+'" timed out'),s(new D(P.DEADLINE_EXCEEDED,'Request time out'));break;case u.ErrorCode.HTTP_ERROR:var n=a.getStatus();if(p('Connection','RPC "'+t+'" failed with status:',n,'response text:',a.getResponseText()),n>0){var r=a.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=t.toLowerCase().replace('_','-');return Object.values(P).indexOf(e)>=0?e:P.UNKNOWN;}(r.status);s(new D(i,r.message));}else s(new D(P.UNKNOWN,'Server responded with status '+a.getStatus()));}else p('Connection','RPC "'+t+'" failed'),s(new D(P.UNAVAILABLE,'Connection failed.'));break;default:v();}}finally{p('Connection','RPC "'+t+'" completed.');}}));var c=Object.assign({},e);delete c.database;var h=JSON.stringify(c);p('Connection','XHR sending: ',i+' '+h);var l={'Content-Type':'text/plain'};r.Cf(l,n),a.send(i,'POST',h,l,15);}));},t.prototype.Su=function(t,e,n){return this.vu(t,e,n);},t.prototype.Tu=function(t,e){var n=[this.Df,'/','google.firestore.v1.Firestore','/',t,'/channel'],r=u.createWebChannelTransport(),o={httpSessionIdParam:'gsessionid',initMessageHeaders:{},messageUrlParams:{database:'projects/'+this.s.projectId+'/databases/'+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Cf(o.initMessageHeaders,e),a.isMobileCordova()||a.isReactNative()||a.isElectron()||a.isIE()||a.isUWP()||a.isBrowserExtension()||(o.httpHeadersOverwriteParam='$httpHeaders');var c=n.join('');p('Connection','Creating WebChannel: '+c+' '+o);var f=r.createWebChannel(c,o),d=!1,v=!1,m=new is({Pf:function(t){v?p('Connection','Not sending because WebChannel is closed:',t):(d||(p('Connection','Opening WebChannel transport.'),f.open(),d=!0),p('Connection','WebChannel sending:',t),f.send(t));},Vf:function(){return f.close();}}),_=function(t,e){f.listen(t,(function(t){try{e(t);}catch(t){setTimeout((function(){throw t;}),0);}}));};return _(u.WebChannel.EventType.OPEN,(function(){v||p('Connection','WebChannel transport opened.');})),_(u.WebChannel.EventType.CLOSE,(function(){v||(v=!0,p('Connection','WebChannel transport closed'),m.vf());})),_(u.WebChannel.EventType.ERROR,(function(t){v||(v=!0,function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=s.LogLevel.WARN){var r=e.map(y);l.warn.apply(l,i.__spreadArrays(['Firestore ('+h+'): '+t],r));}}('Connection','WebChannel transport errored:',t),m.vf(new D(P.UNAVAILABLE,'The operation could not be completed')));})),_(u.WebChannel.EventType.MESSAGE,(function(t){var e;if(!v){var n=t.data[0];g(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){p('Connection','WebChannel received error:',i);var o=i.status,s=function(t){var e=K[t];if(void 0!==e)return Z(e);}(o),a=i.message;void 0===s&&(s=P.INTERNAL,a='Unknown error status: '+o+' with message '+i.message),v=!0,m.vf(new D(s,a)),f.close();}else p('Connection','WebChannel received:',n),m.Sf(n);}})),setTimeout((function(){m.bf();}),0),m;},t.prototype.Ff=function(t){var e=os[t];return this.Df+'/v1/projects/'+this.s.projectId+'/databases/'+this.s.database+'/documents:'+e;},t;}(),us=function(){function t(){var t=this;this.Nf=function(){return t.$f();},this.kf=function(){return t.xf();},this.Mf=[],this.Of();}return t.prototype.tc=function(t){this.Mf.push(t);},t.prototype.gr=function(){window.removeEventListener('online',this.Nf),window.removeEventListener('offline',this.kf);},t.prototype.Of=function(){window.addEventListener('online',this.Nf),window.addEventListener('offline',this.kf);},t.prototype.$f=function(){p('ConnectivityMonitor','Network connectivity changed: AVAILABLE');for(var t=0,e=this.Mf;t<e.length;t++)(0,e[t])(0);},t.prototype.xf=function(){p('ConnectivityMonitor','Network connectivity changed: UNAVAILABLE');for(var t=0,e=this.Mf;t<e.length;t++)(0,e[t])(1);},t.Hi=function(){return'undefined'!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener;},t;}(),cs=function(){function t(){}return t.prototype.tc=function(t){},t.prototype.gr=function(){},t;}(),hs='You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.',ls=function(){function t(){}return t.prototype.initialize=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e=this;return i.__generator(this,(function(n){switch(n.label){case 0:return this.t_=this.Lf(t),this.persistence=this.Bf(t),[4,this.persistence.start()];case 1:return n.sent(),this.qf=this.Uf(t),this.zu=this.Qf(t),this.Zl=this.Wf(t),this.Rc=this.jf(t),this.Kf=this.Gf(t),this.t_.Lu=function(t){return e.Rc.Ql(t,1);},this.Zl.Rc=this.Rc,[4,this.zu.start()];case 2:return n.sent(),[4,this.t_.start()];case 3:return n.sent(),[4,this.Zl.start()];case 4:return n.sent(),[4,this.Zl.Mc(this.Rc.__)];case 5:return n.sent(),[2];}}));}));},t.prototype.Gf=function(t){return new Yo(this.Rc);},t.prototype.Uf=function(t){return null;},t.prototype.Qf=function(t){return ci(this.persistence,new Xo,t.zf);},t.prototype.Bf=function(t){if(t.Yf.Hf)throw new D(P.FAILED_PRECONDITION,hs);return new es(rs.mf);},t.prototype.Wf=function(t){var e=this;return new Ao(this.zu,t.Du,t.mo,(function(t){return e.Rc.Ql(t,0);}),us.Hi()?new us:new cs);},t.prototype.Lf=function(t){return new Uo;},t.prototype.jf=function(t){return Go(this.zu,this.Zl,t.Du,this.t_,t.zf,t.e_);},t.prototype.clearPersistence=function(t,e){throw new D(P.FAILED_PRECONDITION,hs);},t;}(),fs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return i.__extends(e,t),e.prototype.initialize=function(e){return i.__awaiter(this,void 0,void 0,(function(){var n=this;return i.__generator(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,this.persistence.rr((function(t){return i.__awaiter(n,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return[4,this.Rc.Mc(t)];case 1:return e.sent(),this.qf&&(t&&!this.qf.or?this.qf.start(this.zu):t||this.qf.stop()),[2];}}));}));}))];case 2:return r.sent(),[2];}}));}));},e.prototype.Qf=function(t){return e=this.persistence,n=new Xo,r=t.zf,new hi(e,n,r);var e,n,r;},e.prototype.jf=function(t){var e,n,r,i,o,s,a=(e=this.zu,n=this.Zl,r=t.Du,i=this.t_,o=t.zf,s=t.e_,new Ho(e,n,r,i,o,s));return this.t_ instanceof Mo&&(this.t_.Rc=a),a;},e.prototype.Lf=function(t){if(t.Yf.Hf&&t.Yf.synchronizeTabs){var e=Jr();if(!Mo.Hi(e))throw new D(P.UNIMPLEMENTED,'IndexedDB persistence is only available on platforms that support LocalStorage.');var n=mr(t.Jf.s,t.Jf.persistenceKey);return new Mo(e,t.mo,n,t.clientId,t.zf);}return new Uo;},e;}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return i.__extends(e,t),e.prototype.Qf=function(t){return ci(this.persistence,new Xo,t.zf);},e.prototype.jf=function(t){return Go(this.zu,this.Zl,t.Du,this.t_,t.zf,t.e_);},e.prototype.Uf=function(t){var e=this.persistence.wi.xr;return new si(e,t.mo);},e.prototype.Bf=function(t){var e=mr(t.Jf.s,t.Jf.persistenceKey),n=Yi(t.Jf.s);return new pr(t.Yf.synchronizeTabs,e,t.clientId,oi.oh(t.Yf.cacheSizeBytes),t.mo,Jr(),'undefined'!=typeof document?document:null,n,this.t_,t.Yf.qi);},e.prototype.Lf=function(t){return new Uo;},e.prototype.clearPersistence=function(t,e){return function(t){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return Wr.Hi()?(e=t+'main',[4,Wr.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2];}}));}));}(mr(t,e));},e;}(ls)),ps=function(){function t(t,e){this.credentials=t,this.mo=e,this.clientId=w.t();}return t.prototype.start=function(t,e,n){var r=this;this.bu(),this.Jf=t;var i=new Ln,o=new Ln,s=!1;return this.credentials.qa((function(t){if(!s)return s=!0,p('FirestoreClient','Initializing. user=',t.uid),r.Xf(e,n,t,o).then(i.resolve,i.reject);r.mo._r((function(){return r.Zl.xc(t);}));})),this.mo.cr((function(){return i.promise;})),o.promise;},t.prototype.enableNetwork=function(){var t=this;return this.bu(),this.mo.enqueue((function(){return t.Rc.enableNetwork();}));},t.prototype.Xf=function(t,e,n,r){return i.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,c,h=this;return i.__generator(this,(function(l){switch(l.label){case 0:return l.trys.push([0,3,,4]),[4,(c=this.Jf,Promise.resolve(new as(c)))];case 1:return o=l.sent(),s=Yi(this.Jf.s),a=function(t,e,n){return new To(t,e,n);}(o,this.credentials,s),[4,t.initialize({mo:this.mo,Jf:this.Jf,Du:a,clientId:this.clientId,zf:n,e_:100,Yf:e})];case 2:return l.sent(),this.persistence=t.persistence,this.t_=t.t_,this.zu=t.zu,this.Zl=t.Zl,this.Rc=t.Rc,this.qf=t.qf,this.Zf=t.Kf,this.persistence.hr((function(){return i.__awaiter(h,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2];}}));}));})),r.resolve(),[3,4];case 3:if(u=l.sent(),r.reject(u),!this.td(u))throw u;return[2,(console.warn('Error enabling offline persistence. Falling back to persistence disabled: '+u),this.Xf(new ls,{Hf:!1},n,r))];case 4:return[2];}}));}));},t.prototype.td=function(t){return'FirebaseError'===t.name?t.code===P.FAILED_PRECONDITION||t.code===P.UNIMPLEMENTED:!('undefined'!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code;},t.prototype.bu=function(){if(this.mo.xo)throw new D(P.FAILED_PRECONDITION,'The client has already been terminated.');},t.prototype.disableNetwork=function(){var t=this;return this.bu(),this.mo.enqueue((function(){return t.Rc.disableNetwork();}));},t.prototype.terminate=function(){var t=this;return this.mo.qo((function(){return i.__awaiter(t,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.qf&&this.qf.stop(),[4,this.Zl.gr()];case 1:return t.sent(),[4,this.t_.gr()];case 2:return t.sent(),[4,this.persistence.gr()];case 3:return t.sent(),this.credentials.Ua(),[2];}}));}));}));},t.prototype.waitForPendingWrites=function(){var t=this;this.bu();var e=new Ln;return this.mo.cr((function(){return t.Rc.V_(e);})),e.promise;},t.prototype.listen=function(t,e,n){var r=this;this.bu();var i=new $o(t,e,n);return this.mo.cr((function(){return r.Zf.listen(i);})),i;},t.prototype.mc=function(t){var e=this;this.ed||this.mo.cr((function(){return e.Zf.mc(t);}));},t.prototype.nd=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:return this.bu(),e=new Ln,[4,this.mo.enqueue((function(){return i.__awaiter(n,void 0,void 0,(function(){var n,r,o;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.zu.Wh(t)];case 1:return(n=i.sent())instanceof rn?e.resolve(n):n instanceof on?e.resolve(null):e.reject(new D(P.UNAVAILABLE,'Failed to get document from cache. (However, this document may exist on the server. Run again without setting \'source\' in the GetOptions to attempt to retrieve the document from the server.)')),[3,3];case 2:return r=i.sent(),o=ei(r,'Failed to get document \''+t+' from cache'),e.reject(o),[3,3];case 3:return[2];}}));}));}))];case 1:return[2,(r.sent(),e.promise)];}}));}));},t.prototype.sd=function(t){return i.__awaiter(this,void 0,void 0,(function(){var e,n=this;return i.__generator(this,(function(r){switch(r.label){case 0:return this.bu(),e=new Ln,[4,this.mo.enqueue((function(){return i.__awaiter(n,void 0,void 0,(function(){var n,r,o,s,a,u;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.zu.Gh(t,!0)];case 1:return n=i.sent(),r=new qo(t,n.zh),o=r.xl(n.documents),s=r.Jn(o,!1),e.resolve(s.snapshot),[3,3];case 2:return a=i.sent(),u=ei(a,'Failed to execute query \''+t+' against cache'),e.reject(u),[3,3];case 3:return[2];}}));}));}))];case 1:return[2,(r.sent(),e.promise)];}}));}));},t.prototype.write=function(t){var e=this;this.bu();var n=new Ln;return this.mo.cr((function(){return e.Rc.write(t,n);})),n.promise;},t.prototype.s=function(){return this.Jf.s;},t.prototype.q_=function(t){var e=this;this.bu(),this.mo.cr((function(){return e.Zf.q_(t),Promise.resolve();}));},t.prototype.U_=function(t){var e=this;this.ed||this.mo.cr((function(){return e.Zf.U_(t),Promise.resolve();}));},Object.defineProperty(t.prototype,'ed',{get:function(){return this.mo.xo;},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.bu();var n=new Ln;return this.mo.cr((function(){return e.Rc.runTransaction(e.mo,t,n),Promise.resolve();})),n.promise;},t;}(),ds=function(){function t(t){this.observer=t,this.muted=!1;}return t.prototype.next=function(t){this.rd(this.observer.next,t);},t.prototype.error=function(t){this.rd(this.observer.error,t);},t.prototype.od=function(){this.muted=!0;},t.prototype.rd=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e);}),0);},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ys(t){return function(t,e){if('object'!=typeof t||null===t)return!1;for(var n=t,r=0,i=['next','error','complete'];r<i.length;r++){var o=i[r];if(o in n&&'function'==typeof n[o])return!0;}return!1;}(t);}var vs=function(){function t(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.hd=n,this.ad=r;}return t.prototype.ud=function(t){switch(Pt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Mt(t.integerValue||t.doubleValue);case 3:return this.ld(t.timestampValue);case 4:return this._d(t);case 5:return t.stringValue;case 6:return new Li(Ut(t.bytesValue));case 7:return this.fd(t.referenceValue);case 8:return this.dd(t.geoPointValue);case 9:return this.wd(t.arrayValue);case 10:return this.Td(t.mapValue);default:throw v();}},t.prototype.Td=function(t){var e=this,n={};return N(t.fields||{},(function(t,r){n[t]=e.ud(r);})),n;},t.prototype.dd=function(t){return new Ki(Mt(t.latitude),Mt(t.longitude));},t.prototype.wd=function(t){var e=this;return(t.values||[]).map((function(t){return e.ud(t);}));},t.prototype._d=function(t){switch(this.hd){case'previous':var e=function t(e){var n=e.mapValue.fields.__previous_value__;return Nt(n)?t(n):n;}(t);return null==e?null:this.ud(e);case'estimate':return this.ld(At(t));default:return null;}},t.prototype.ld=function(t){var e=Ft(t),n=new O(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate();},t.prototype.fd=function(t){var e=L.$(t);g(be(e));var n=new T(e.get(1),e.get(3)),r=new U(e.g(5));return n.isEqual(this.s)||d('Document '+r+' contains a document reference within a different database ('+n.projectId+'/'+n.database+') which is not supported. It will be treated as a reference in the current database ('+this.s.projectId+'/'+this.s.database+') instead.'),this.ad(r);},t;}(),gs=oi.uh,ms=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new D(P.INVALID_ARGUMENT,'Can\'t provide ssl option if host option is not set');this.host='firestore.googleapis.com',this.ssl=!0;}else wi('settings','non-empty string','host',t.host),this.host=t.host,bi('settings','boolean','ssl',t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Ai('settings',t,['host','ssl','credentials','timestampsInSnapshots','cacheSizeBytes','experimentalForceLongPolling','ignoreUndefinedProperties']),bi('settings','object','credentials',t.credentials),this.credentials=t.credentials,bi('settings','boolean','timestampsInSnapshots',t.timestampsInSnapshots),bi('settings','boolean','ignoreUndefinedProperties',t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?d('The setting \'timestampsInSnapshots: true\' is no longer required and should be removed.'):!1===t.timestampsInSnapshots&&d('Support for \'timestampsInSnapshots: false\' will be removed soon. You must update your code to handle Timestamp objects.'),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,bi('settings','number','cacheSizeBytes',t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=oi._h;else{if(t.cacheSizeBytes!==gs&&t.cacheSizeBytes<oi.lh)throw new D(P.INVALID_ARGUMENT,'cacheSizeBytes must be at least '+oi.lh);this.cacheSizeBytes=t.cacheSizeBytes;}bi('settings','boolean','experimentalForceLongPolling',t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i;}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties;},t;}(),_s=function(){function t(e,n,r){var o=this;if(void 0===r&&(r=new ls),this.Ed=null,this.Id=new ti,this.INTERNAL={delete:function(){return i.__awaiter(o,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return this.md(),[4,this.Ad.terminate()];case 1:return t.sent(),[2];}}));}));}},'object'==typeof e.options){var s=e;this.Ed=s,this.Va=t.Rd(s),this.Pd=s.name,this.Vd=new _o(n);}else{var a=e;if(!a.projectId)throw new D(P.INVALID_ARGUMENT,'Must provide projectId');this.Va=new T(a.projectId,a.database),this.Pd='[DEFAULT]',this.Vd=new mo;}this.gd=r,this.yd=new ms({});}return Object.defineProperty(t.prototype,'pd',{get:function(){return this.bd||(this.bd=new no(this.Va,this.yd.ignoreUndefinedProperties)),this.bd;},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){yi('Firestore.settings',arguments,1),mi('Firestore.settings','object',1,t);var e=new ms(t);if(this.Ad&&!this.yd.isEqual(e))throw new D(P.FAILED_PRECONDITION,'Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.');this.yd=e,void 0!==e.credentials&&(this.Vd=function(t){if(!t)return new mo;switch(t.type){case'gapi':var e=t.vd;return g(!('object'!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new bo(e,t.za||'0');case'provider':return t.vd;default:throw new D(P.INVALID_ARGUMENT,'makeCredentialsProvider failed due to invalid credential type');}}(e.credentials));},t.prototype.enableNetwork=function(){return this.md(),this.Ad.enableNetwork();},t.prototype.disableNetwork=function(){return this.md(),this.Ad.disableNetwork();},t.prototype.enablePersistence=function(t){var e,n;if(this.Ad)throw new D(P.FAILED_PRECONDITION,'Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.');var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&d('The \'experimentalTabSynchronization\' setting will be removed. Use \'synchronizeTabs\' instead.'),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new D(P.INVALID_ARGUMENT,'The \'experimentalForceOwningTab\' setting cannot be used with \'synchronizeTabs\'.');return this.Sd(this.gd,{Hf:!0,cacheSizeBytes:this.yd.cacheSizeBytes,synchronizeTabs:r,qi:i});},t.prototype.clearPersistence=function(){return i.__awaiter(this,void 0,void 0,(function(){var t,e=this;return i.__generator(this,(function(n){if(void 0!==this.Ad&&!this.Ad.ed)throw new D(P.FAILED_PRECONDITION,'Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.');return t=new Ln,[2,(this.Id.Mo((function(){return i.__awaiter(e,void 0,void 0,(function(){var e;return i.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.gd.clearPersistence(this.Va,this.Pd)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2];}}));}));})),t.promise)];}));}));},t.prototype.terminate=function(){return this.app._removeServiceInstance('firestore'),this.INTERNAL.delete();},Object.defineProperty(t.prototype,'Dd',{get:function(){return this.md(),this.Ad.ed;},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.md(),this.Ad.waitForPendingWrites();},t.prototype.onSnapshotsInSync=function(t){if(this.md(),ys(t))return ws(this.Ad,t);mi('Firestore.onSnapshotsInSync','function',1,t);var e={next:t};return ws(this.Ad,e);},t.prototype.md=function(){return this.Ad||this.Sd(new ls,{Hf:!1}),this.Ad;},t.prototype.Cd=function(){return new I(this.Va,this.Pd,this.yd.host,this.yd.ssl,this.yd.forceLongPolling);},t.prototype.Sd=function(t,e){var n=this.Cd();return this.Ad=new ps(this.Vd,this.Id),this.Ad.start(n,t,e);},t.Rd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,'projectId'))throw new D(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if(!n||'string'!=typeof n)throw new D(P.INVALID_ARGUMENT,'projectId must be a string in FirebaseApp.options');return new T(n);},Object.defineProperty(t.prototype,'app',{get:function(){if(!this.Ed)throw new D(P.FAILED_PRECONDITION,'Firestore was not initialized using the Firebase SDK. \'app\' is not available');return this.Ed;},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return yi('Firestore.collection',arguments,1),mi('Firestore.collection','non-empty string',1,t),this.md(),new Os(L.$(t),this,null);},t.prototype.doc=function(t){return yi('Firestore.doc',arguments,1),mi('Firestore.doc','non-empty string',1,t),this.md(),Cs.Fd(L.$(t),this,null);},t.prototype.collectionGroup=function(t){if(yi('Firestore.collectionGroup',arguments,1),mi('Firestore.collectionGroup','non-empty string',1,t),t.indexOf('/')>=0)throw new D(P.INVALID_ARGUMENT,'Invalid collection ID \''+t+'\' passed to function Firestore.collectionGroup(). Collection IDs must not contain \'/\'.');return this.md(),new xs(new an(L.k(),t),this,null);},t.prototype.runTransaction=function(t){var e=this;return yi('Firestore.runTransaction',arguments,1),mi('Firestore.runTransaction','function',1,t),this.md().transaction((function(n){return t(new bs(e,n));}));},t.prototype.batch=function(){return this.md(),new Es(this);},Object.defineProperty(t,'logLevel',{get:function(){switch(f()){case s.LogLevel.DEBUG:return'debug';case s.LogLevel.ERROR:return'error';case s.LogLevel.SILENT:return'silent';case s.LogLevel.WARN:return'warn';case s.LogLevel.INFO:return'info';case s.LogLevel.VERBOSE:return'verbose';default:return'error';}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;yi('Firestore.setLogLevel',arguments,1),Ci('setLogLevel',['debug','error','silent','warn','info','verbose'],1,t),e=t,l.setLogLevel(e);},t.prototype.Nd=function(){return this.yd.timestampsInSnapshots;},t;}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ws(t,e){var n=new ds({next:function(){e.next&&e.next();},error:function(t){throw v();}});return t.q_(n),function(){n.od(),t.U_(n);};}var bs=function(){function t(t,e){this.$d=t,this.kd=e;}return t.prototype.get=function(t){var e=this;yi('Transaction.get',arguments,1);var n=Fs('Transaction.get',t,this.$d);return this.kd.ku([n.ga]).then((function(t){if(!t||1!==t.length)return v();var r=t[0];if(r instanceof on)return new Ss(e.$d,n.ga,null,!1,!1,n.ya);if(r instanceof rn)return new Ss(e.$d,n.ga,r,!1,!1,n.ya);throw v();}));},t.prototype.set=function(t,e,n){gi('Transaction.set',arguments,2,3);var r=Fs('Transaction.set',t,this.$d);n=Rs('Transaction.set',n);var i=Us(r.ya,e,n),o=ro(this.$d.pd,'Transaction.set',r.ga,i,null!==r.ya,n);return this.kd.set(r.ga,o),this;},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return'string'==typeof e||e instanceof Mi?(vi('Transaction.update',arguments,3),r=Fs('Transaction.update',t,this.$d),i=oo(this.$d.pd,'Transaction.update',r.ga,e,n,o)):(yi('Transaction.update',arguments,2),r=Fs('Transaction.update',t,this.$d),i=io(this.$d.pd,'Transaction.update',r.ga,e)),this.kd.update(r.ga,i),this;},t.prototype.delete=function(t){yi('Transaction.delete',arguments,1);var e=Fs('Transaction.delete',t,this.$d);return this.kd.delete(e.ga),this;},t;}(),Es=function(){function t(t){this.$d=t,this.xd=[],this.Md=!1;}return t.prototype.set=function(t,e,n){gi('WriteBatch.set',arguments,2,3),this.Od();var r=Fs('WriteBatch.set',t,this.$d);n=Rs('WriteBatch.set',n);var i=Us(r.ya,e,n),o=ro(this.$d.pd,'WriteBatch.set',r.ga,i,null!==r.ya,n);return this.xd=this.xd.concat(o.pa(r.ga,Me.Qe())),this;},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Od(),'string'==typeof e||e instanceof Mi?(vi('WriteBatch.update',arguments,3),r=Fs('WriteBatch.update',t,this.$d),i=oo(this.$d.pd,'WriteBatch.update',r.ga,e,n,o)):(yi('WriteBatch.update',arguments,2),r=Fs('WriteBatch.update',t,this.$d),i=io(this.$d.pd,'WriteBatch.update',r.ga,e)),this.xd=this.xd.concat(i.pa(r.ga,Me.exists(!0))),this;},t.prototype.delete=function(t){yi('WriteBatch.delete',arguments,1),this.Od();var e=Fs('WriteBatch.delete',t,this.$d);return this.xd=this.xd.concat(new Xe(e.ga,Me.Qe())),this;},t.prototype.commit=function(){return this.Od(),this.Md=!0,this.xd.length>0?this.$d.md().write(this.xd):Promise.resolve();},t.prototype.Od=function(){if(this.Md)throw new D(P.FAILED_PRECONDITION,'A write batch can no longer be used after commit() has been called.');},t;}(),Cs=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.Va,e,r)||this).ga=e,i.firestore=n,i.ya=r,i.Ad=i.firestore.md(),i;}return i.__extends(e,t),e.Fd=function(t,n,r){if(t.length%2!=0)throw new D(P.INVALID_ARGUMENT,'Invalid document reference. Document references must have an even number of segments, but '+t.N()+' has '+t.length);return new e(new U(t),n,r);},Object.defineProperty(e.prototype,'id',{get:function(){return this.ga.path.S();},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,'parent',{get:function(){return new Os(this.ga.path.p(),this.firestore,this.ya);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,'path',{get:function(){return this.ga.path.N();},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){if(yi('DocumentReference.collection',arguments,1),mi('DocumentReference.collection','non-empty string',1,t),!t)throw new D(P.INVALID_ARGUMENT,'Must provide a non-empty collection name to collection()');var e=L.$(t);return new Os(this.ga.path.child(e),this.firestore,null);},e.prototype.isEqual=function(t){if(!(t instanceof e))throw xi('isEqual','DocumentReference',1,t);return this.firestore===t.firestore&&this.ga.isEqual(t.ga)&&this.ya===t.ya;},e.prototype.set=function(t,e){gi('DocumentReference.set',arguments,1,2),e=Rs('DocumentReference.set',e);var n=Us(this.ya,t,e),r=ro(this.firestore.pd,'DocumentReference.set',this.ga,n,null!==this.ya,e);return this.Ad.write(r.pa(this.ga,Me.Qe()));},e.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return'string'==typeof t||t instanceof Mi?(vi('DocumentReference.update',arguments,2),n=oo(this.firestore.pd,'DocumentReference.update',this.ga,t,e,r)):(yi('DocumentReference.update',arguments,1),n=io(this.firestore.pd,'DocumentReference.update',this.ga,t)),this.Ad.write(n.pa(this.ga,Me.exists(!0)));},e.prototype.delete=function(){return yi('DocumentReference.delete',arguments,0),this.Ad.write([new Xe(this.ga,Me.Qe())]);},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];gi('DocumentReference.onSnapshot',arguments,1,4);var s={includeMetadataChanges:!1},a=0;'object'!=typeof i[a]||ys(i[a])||(Ai('DocumentReference.onSnapshot',s=i[a],['includeMetadataChanges']),bi('DocumentReference.onSnapshot','boolean','includeMetadataChanges',s.includeMetadataChanges),a++);var u={includeMetadataChanges:s.includeMetadataChanges};if(ys(i[a])){var c=i[a];i[a]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[a+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[a+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c);}else mi('DocumentReference.onSnapshot','function',a,i[a]),_i('DocumentReference.onSnapshot','function',a+1,i[a+1]),_i('DocumentReference.onSnapshot','function',a+2,i[a+2]);var h={next:function(t){i[a]&&i[a](r.Ld(t));},error:i[a+1],complete:i[a+2]};return Is(this.Ad,this.ga,u,h);},e.prototype.get=function(t){var e=this;return gi('DocumentReference.get',arguments,0,1),Ls('DocumentReference.get',t),t&&'cache'===t.source?this.firestore.md().nd(this.ga).then((function(t){return new Ss(e.firestore,e.ga,t,!0,t instanceof rn&&t.Ge,e.ya);})):function(t,e,n){var r=new Ln,i=Is(t,e,{includeMetadataChanges:!0,H_:!0},{next:function(t){i();var o=t.docs.has(e);!o&&t.fromCache?r.reject(new D(P.UNAVAILABLE,'Failed to get document because the client is offline.')):o&&t.fromCache&&n&&'server'===n.source?r.reject(new D(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(t);},error:function(t){return r.reject(t);}});return r.promise;}(this.Ad,this.ga,t).then((function(t){return e.Ld(t);}));},e.prototype.withConverter=function(t){return new e(this.ga,this.firestore,t);},e.prototype.Ld=function(t){var e=t.docs.get(this.ga);return new Ss(this.firestore,this.ga,e,t.fromCache,t.hasPendingWrites,this.ya);},e;}(Xi);function Is(t,e,n,r){var i=function(t){console.error('Uncaught Error in onSnapshot:',t);};r.error&&(i=r.error.bind(r));var o=new ds({next:function(t){r.next&&r.next(t);},error:i}),s=t.listen(an.hn(e.path),o,n);return function(){o.od(),t.mc(s);};}var Ts=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e;}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache;},t;}(),Ss=function(){function t(t,e,n,r,i,o){this.$d=t,this.ga=e,this.Bd=n,this.qd=r,this.Ud=i,this.ya=o;}return t.prototype.data=function(t){var e=this;if(gi('DocumentSnapshot.data',arguments,0,1),t=ks('DocumentSnapshot.data',t),this.Bd){if(this.ya){var n=new Ns(this.$d,this.ga,this.Bd,this.qd,this.Ud,null);return this.ya.fromFirestore(n,t);}return new vs(this.$d.Va,this.$d.Nd(),t.serverTimestamps||'none',(function(t){return new Cs(t,e.$d,null);})).ud(this.Bd.tn());}},t.prototype.get=function(t,e){var n=this;if(gi('DocumentSnapshot.get',arguments,1,2),e=ks('DocumentSnapshot.get',e),this.Bd){var r=this.Bd.data().field(lo('DocumentSnapshot.get',t,this.ga));if(null!==r)return new vs(this.$d.Va,this.$d.Nd(),e.serverTimestamps||'none',(function(t){return new Cs(t,n.$d,n.ya);})).ud(r);}},Object.defineProperty(t.prototype,'id',{get:function(){return this.ga.path.S();},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'ref',{get:function(){return new Cs(this.ga,this.$d,this.ya);},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'exists',{get:function(){return null!==this.Bd;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'metadata',{get:function(){return new Ts(this.Ud,this.qd);},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw xi('isEqual','DocumentSnapshot',1,e);return this.$d===e.$d&&this.qd===e.qd&&this.ga.isEqual(e.ga)&&(null===this.Bd?null===e.Bd:this.Bd.isEqual(e.Bd))&&this.ya===e.ya;},t;}(),Ns=function(t){function e(){return null!==t&&t.apply(this,arguments)||this;}return i.__extends(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e);},e;}(Ss);function As(t){if(t.mn()&&0===t.en.length)throw new D(P.UNIMPLEMENTED,'limitToLast() queries require specifying at least one orderBy() clause');}var xs=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.Va,n.pd,e)||this).Qd=e,i.firestore=n,i.ya=r,i;}return i.__extends(e,t),e.prototype.where=function(t,n,r){yi('Query.where',arguments,3),Ni('Query.where',3,r);var i=Ci('Query.where',['<','<=','==','>=','>','array-contains','in','array-contains-any'],2,n),o=lo('Query.where',t),s=this.Wd(o,i,r);return new e(this.Qd.cn(s),this.firestore,this.ya);},e.prototype.orderBy=function(t,n){var r;if(gi('Query.orderBy',arguments,1,2),_i('Query.orderBy','non-empty string',2,n),void 0===n||'asc'===n)r='asc';else{if('desc'!==n)throw new D(P.INVALID_ARGUMENT,'Function Query.orderBy() has unknown direction \''+n+'\', expected \'asc\' or \'desc\'.');r='desc';}var i=lo('Query.orderBy',t),o=this.zd(i,r);return new e(this.Qd.ln(o),this.firestore,this.ya);},e.prototype.limit=function(t){return yi('Query.limit',arguments,1),mi('Query.limit','number',1,t),Pi('Query.limit',1,t),new e(this.Qd._n(t),this.firestore,this.ya);},e.prototype.limitToLast=function(t){return yi('Query.limitToLast',arguments,1),mi('Query.limitToLast','number',1,t),Pi('Query.limitToLast',1,t),new e(this.Qd.fn(t),this.firestore,this.ya);},e.prototype.startAt=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi('Query.startAt',arguments,1);var i=this.Zd('Query.startAt',t,n,!0);return new e(this.Qd.dn(i),this.firestore,this.ya);},e.prototype.startAfter=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi('Query.startAfter',arguments,1);var i=this.Zd('Query.startAfter',t,n,!1);return new e(this.Qd.dn(i),this.firestore,this.ya);},e.prototype.endBefore=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi('Query.endBefore',arguments,1);var i=this.Zd('Query.endBefore',t,n,!0);return new e(this.Qd.wn(i),this.firestore,this.ya);},e.prototype.endAt=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];vi('Query.endAt',arguments,1);var i=this.Zd('Query.endAt',t,n,!1);return new e(this.Qd.wn(i),this.firestore,this.ya);},e.prototype.isEqual=function(t){if(!(t instanceof e))throw xi('isEqual','Query',1,t);return this.firestore===t.firestore&&un(this.Qd,t.Qd)&&this.ya===t.ya;},e.prototype.withConverter=function(t){return new e(this.Qd,this.firestore,t);},e.prototype.Zd=function(t,e,n,r){if(Ni(t,1,e),e instanceof Ss)return yi(t,i.__spreadArrays([e],n),1),this.Yd(t,e.Bd,r);var o=[e].concat(n);return this.Jd(t,o,r);},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];gi('Query.onSnapshot',arguments,1,4);var s={},a=0;if('object'!=typeof i[a]||ys(i[a])||(Ai('Query.onSnapshot',s=i[a],['includeMetadataChanges']),bi('Query.onSnapshot','boolean','includeMetadataChanges',s.includeMetadataChanges),a++),ys(i[a])){var u=i[a];i[a]=null===(t=u.next)||void 0===t?void 0:t.bind(u),i[a+1]=null===(e=u.error)||void 0===e?void 0:e.bind(u),i[a+2]=null===(n=u.complete)||void 0===n?void 0:n.bind(u);}else mi('Query.onSnapshot','function',a,i[a]),_i('Query.onSnapshot','function',a+1,i[a+1]),_i('Query.onSnapshot','function',a+2,i[a+2]);var c={next:function(t){i[a]&&i[a](new Ds(r.firestore,r.Qd,t,r.ya));},error:i[a+1],complete:i[a+2]};return As(this.Qd),Ps(this.firestore.md(),this.Qd,s,c);},e.prototype.get=function(t){var e=this;gi('Query.get',arguments,0,1),Ls('Query.get',t),As(this.Qd);var n=this.firestore.md();return(t&&'cache'===t.source?n.sd(this.Qd):function(t,e,n){var r=new Ln,i=Ps(t,e,{includeMetadataChanges:!0,H_:!0},{next:function(t){i(),t.fromCache&&n&&'server'===n.source?r.reject(new D(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(t);},error:function(t){return r.reject(t);}});return r.promise;}(n,this.Qd,t)).then((function(t){return new Ds(e.firestore,e.Qd,t,e.ya);}));},e;}(function(){function t(t,e,n){this.Va=t,this.pd=e,this.Qd=n;}return t.prototype.Wd=function(t,e,n){var r;if(t.O()){if('array-contains'===e||'array-contains-any'===e)throw new D(P.INVALID_ARGUMENT,'Invalid Query. You can\'t perform \''+e+'\' queries on FieldPath.documentId().');if('in'===e){this.jd(n,e);for(var i=[],o=0,s=n;o<s.length;o++){var a=s[o];i.push(this.Kd(a));}r={arrayValue:{values:i}};}else r=this.Kd(n);}else'in'!==e&&'array-contains-any'!==e||this.jd(n,e),r=so(this.pd,'Query.where',n,'in'===e);var u=pn.create(t,e,r);return this.Gd(u),u;},t.prototype.zd=function(t,e){if(null!==this.Qd.startAt)throw new D(P.INVALID_ARGUMENT,'Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().');if(null!==this.Qd.endAt)throw new D(P.INVALID_ARGUMENT,'Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().');var n=new Cn(t,e);return this.Hd(n),n;},t.prototype.Yd=function(t,e,n){if(!e)throw new D(P.NOT_FOUND,'Can\'t use a DocumentSnapshot that doesn\'t exist for '+t+'().');for(var r=[],i=0,o=this.Qd.orderBy;i<o.length;i++){var s=o[i];if(s.field.O())r.push(Vt(this.Va,e.key));else{var a=e.field(s.field);if(Nt(a))throw new D(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var u=s.field.N();throw new D(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field \''+u+'\' (used as the orderBy) does not exist.');}r.push(a);}}return new _n(r,n);},t.prototype.Jd=function(t,e,n){var r=this.Qd.en;if(e.length>r.length)throw new D(P.INVALID_ARGUMENT,'Too many arguments provided to '+t+'(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses');for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.O()){if('string'!=typeof s)throw new D(P.INVALID_ARGUMENT,'Invalid query. Expected a string for document ID in '+t+'(), but got a '+typeof s);if(!this.Qd.Vn()&&-1!==s.indexOf('/'))throw new D(P.INVALID_ARGUMENT,'Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to '+t+'() must be a plain document ID, but \''+s+'\' contains a slash.');var a=this.Qd.path.child(L.$(s));if(!U.W(a))throw new D(P.INVALID_ARGUMENT,'Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to '+t+'() must result in a valid document path, but \''+a+'\' is not because it contains an odd number of segments.');var u=new U(a);i.push(Vt(this.Va,u));}else{var c=so(this.pd,t,s);i.push(c);}}return new _n(i,n);},t.prototype.Kd=function(t){if('string'==typeof t){if(''===t)throw new D(P.INVALID_ARGUMENT,'Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.');if(!this.Qd.Vn()&&-1!==t.indexOf('/'))throw new D(P.INVALID_ARGUMENT,'Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but \''+t+'\' contains a \'/\' character.');var e=this.Qd.path.child(L.$(t));if(!U.W(e))throw new D(P.INVALID_ARGUMENT,'Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but \''+e+'\' is not because it has an odd number of segments ('+e.length+').');return Vt(this.Va,new U(e));}if(t instanceof Xi)return Vt(this.Va,t.ga);throw new D(P.INVALID_ARGUMENT,'Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: '+Si(t)+'.');},t.prototype.jd=function(t,e){if(!Array.isArray(t)||0===t.length)throw new D(P.INVALID_ARGUMENT,'Invalid Query. A non-empty array is required for \''+e.toString()+'\' filters.');if(t.length>10)throw new D(P.INVALID_ARGUMENT,'Invalid Query. \''+e.toString()+'\' filters support a maximum of 10 elements in the value array.');if(t.indexOf(null)>=0)throw new D(P.INVALID_ARGUMENT,'Invalid Query. \''+e.toString()+'\' filters cannot contain \'null\' in the value array.');if(t.filter((function(t){return Number.isNaN(t);})).length>0)throw new D(P.INVALID_ARGUMENT,'Invalid Query. \''+e.toString()+'\' filters cannot contain \'NaN\' in the value array.');},t.prototype.Gd=function(t){if(t instanceof pn){var e=['array-contains','array-contains-any'],n=['in','array-contains-any'],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.An()){var o=this.Qd.an();if(null!==o&&!o.isEqual(t.field))throw new D(P.INVALID_ARGUMENT,'Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on \''+o.toString()+'\' and \''+t.field.toString()+'\'');var s=this.Qd.un();null!==s&&this.Xd(t.field,s);}else if(i||r){var a=null;if(i&&(a=this.Qd.Rn(n)),null===a&&r&&(a=this.Qd.Rn(e)),null!==a)throw a===t.op?new D(P.INVALID_ARGUMENT,'Invalid query. You cannot use more than one \''+t.op.toString()+'\' filter.'):new D(P.INVALID_ARGUMENT,'Invalid query. You cannot use \''+t.op.toString()+'\' filters with \''+a.toString()+'\' filters.');}}},t.prototype.Hd=function(t){if(null===this.Qd.un()){var e=this.Qd.an();null!==e&&this.Xd(e,t.field);}},t.prototype.Xd=function(t,e){if(!e.isEqual(t))throw new D(P.INVALID_ARGUMENT,'Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field \''+t.toString()+'\' and so you must also use \''+t.toString()+'\' as your first Query.orderBy(), but your first Query.orderBy() is on field \''+e.toString()+'\' instead.');},t;}());function Ps(t,e,n,r){var i=function(t){console.error('Uncaught Error in onSnapshot:',t);};r.error&&(i=r.error.bind(r));var o=new ds({next:function(t){r.next&&r.next(t);},error:i}),s=t.listen(e,o,n);return function(){o.od(),t.mc(s);};}var Ds=function(){function t(t,e,n,r){this.$d=t,this.tw=e,this.ew=n,this.ya=r,this.nw=null,this.sw=null,this.metadata=new Ts(n.hasPendingWrites,n.fromCache);}return Object.defineProperty(t.prototype,'docs',{get:function(){var t=[];return this.forEach((function(e){return t.push(e);})),t;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'empty',{get:function(){return this.ew.docs._();},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,'size',{get:function(){return this.ew.docs.size;},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;gi('QuerySnapshot.forEach',arguments,1,2),mi('QuerySnapshot.forEach','function',1,t),this.ew.docs.forEach((function(r){t.call(e,n.iw(r,n.metadata.fromCache,n.ew.Lt.has(r.key)));}));},Object.defineProperty(t.prototype,'query',{get:function(){return new xs(this.tw,this.$d,this.ya);},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(Ai('QuerySnapshot.docChanges',t,['includeMetadataChanges']),bi('QuerySnapshot.docChanges','boolean','includeMetadataChanges',t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.ew.qt)throw new D(P.INVALID_ARGUMENT,'To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().');return this.nw&&this.sw===e||(this.nw=function(t,e,n){if(t.Ot._()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Lt.has(e.doc.key));return e.doc,{type:'added',doc:i,oldIndex:-1,newIndex:r++};}));}var i=t.Ot;return t.docChanges.filter((function(t){return e||3!==t.type;})).map((function(e){var r=n(e.doc,t.fromCache,t.Lt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:Ms(e.type),doc:r,oldIndex:o,newIndex:s};}));}(this.ew,e,this.iw.bind(this)),this.sw=e),this.nw;},t.prototype.isEqual=function(e){if(!(e instanceof t))throw xi('isEqual','QuerySnapshot',1,e);return this.$d===e.$d&&un(this.tw,e.tw)&&this.ew.isEqual(e.ew)&&this.ya===e.ya;},t.prototype.iw=function(t,e,n){return new Ns(this.$d,t.key,t,e,n,this.ya);},t;}(),Os=function(t){function e(e,n,r){var i=this;if((i=t.call(this,an.hn(e),n,r)||this).rw=e,e.length%2!=1)throw new D(P.INVALID_ARGUMENT,'Invalid collection reference. Collection references must have an odd number of segments, but '+e.N()+' has '+e.length);return i;}return i.__extends(e,t),Object.defineProperty(e.prototype,'id',{get:function(){return this.Qd.path.S();},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,'parent',{get:function(){var t=this.Qd.path.p();return t._()?null:new Cs(new U(t),this.firestore,null);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,'path',{get:function(){return this.Qd.path.N();},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){gi('CollectionReference.doc',arguments,0,1),0===arguments.length&&(t=w.t()),mi('CollectionReference.doc','non-empty string',1,t);var e=L.$(t);return Cs.Fd(this.Qd.path.child(e),this.firestore,this.ya);},e.prototype.add=function(t){yi('CollectionReference.add',arguments,1),mi('CollectionReference.add','object',1,this.ya?this.ya.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e;}));},e.prototype.withConverter=function(t){return new e(this.rw,this.firestore,t);},e;}(xs);function Rs(t,e){if(void 0===e)return{merge:!1};if(Ai(t,e,['merge','mergeFields']),bi(t,'boolean','merge',e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires its '+e+' option to be an array, but it was: '+Si(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new D(P.INVALID_ARGUMENT,'Function '+t+'() requires all '+e+' elements to be a string or a FieldPath, but the value at index '+o+' was: '+Si(r[o]));}(t,'mergeFields',0,r,(function(t){return'string'==typeof t||t instanceof Mi;}));}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new D(P.INVALID_ARGUMENT,'Invalid options passed to function '+t+'(): You cannot specify both "merge" and "mergeFields".');return e;}function ks(t,e){return void 0===e?{}:(Ai(t,e,['serverTimestamps']),Ei(t,0,'serverTimestamps',e.serverTimestamps,['estimate','previous','none']),e);}function Ls(t,e){_i(t,'object',1,e),e&&(Ai(t,e,['source']),Ei(t,0,'source',e.source,['default','server','cache']));}function Fs(t,e,n){if(e instanceof Xi){if(e.firestore!==n)throw new D(P.INVALID_ARGUMENT,'Provided document reference is from a different Firestore instance.');return e;}throw xi(t,'DocumentReference',1,e);}function Ms(t){switch(t){case 0:return'added';case 2:case 3:return'modified';case 1:return'removed';default:return v();}}function Us(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e;}var Vs={Firestore:_s,GeoPoint:Ki,Timestamp:O,Blob:Li,Transaction:bs,WriteBatch:Es,DocumentReference:Cs,DocumentSnapshot:Ss,Query:xs,QueryDocumentSnapshot:Ns,QuerySnapshot:Ds,CollectionReference:Os,FieldPath:Mi,FieldValue:Gi,setLogLevel:_s.setLogLevel,CACHE_SIZE_UNLIMITED:gs};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function js(t){!function(t,e){t.INTERNAL.registerComponent(new c.Component('firestore',(function(t){return function(t,e){return new _s(t,e,new fs);}(t.getProvider('app').getImmediate(),t.getProvider('auth-internal'));}),'PUBLIC').setServiceProps(Object.assign({},Vs)));}(t),t.registerVersion('@firebase/firestore','1.16.1');}js(o),e.__PRIVATE_registerFirestore=js;}).call(this,n(7));},function(t,e,n){'use strict';n.r(e),function(t){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function r(t){var e='function'==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&'number'==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t};}};throw new TypeError(e?'Object is not iterable.':'Symbol.iterator is not defined.');}n.d(e,'ErrorCode',(function(){return Xn;})),n.d(e,'EventType',(function(){return Jn;})),n.d(e,'WebChannel',(function(){return Zn;})),n.d(e,'XhrIo',(function(){return tr;})),n.d(e,'createWebChannelTransport',(function(){return $n;}));var i,o='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:void 0!==t?t:'undefined'!=typeof self?self:{},s=s||{},a=o||self;function u(){}function c(t){var e=typeof t;if('object'==e){if(!t)return'null';if(t instanceof Array)return'array';if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if('[object Window]'==n)return'object';if('[object Array]'==n||'number'==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable('splice'))return'array';if('[object Function]'==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable('call'))return'function';}else if('function'==e&&void 0===t.call)return'object';return e;}function h(t){var e=c(t);return'array'==e||'object'==e&&'number'==typeof t.length;}function l(t){var e=typeof t;return'object'==e&&null!=t||'function'==e;}var f='closure_uid_'+(1e9*Math.random()>>>0),p=0;function d(t,e,n){return t.call.apply(t.bind,arguments);}function y(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n);};}return function(){return t.apply(e,arguments);};}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf('native code')?d:y).apply(null,arguments);}function g(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e);};}var m=Date.now||function(){return+new Date;};function _(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t;}function w(){this.j=this.j,this.i=this.i;}w.prototype.j=!1,w.prototype.da=function(){if(!this.j&&(this.j=!0,this.C(),0))(function(t){Object.prototype.hasOwnProperty.call(t,f)&&t[f]||(t[f]=++p);})(this);},w.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()();};var b=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0);}:function(t,e){if('string'==typeof t)return'string'!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1;},E=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n);}:function(t,e,n){for(var r=t.length,i='string'==typeof t?t.split(''):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t);};function C(t){return Array.prototype.concat.apply([],arguments);}function I(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n;}return[];}function T(t){return/^[\s\xa0]*$/.test(t);}var S,N=String.prototype.trim?function(t){return t.trim();}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1];};function A(t,e){return-1!=t.indexOf(e);}function x(t,e){return t<e?-1:t>e?1:0;}t:{var P=a.navigator;if(P){var D=P.userAgent;if(D){S=D;break t;}}S='';}function O(t,e,n){for(var r in t)e.call(n,t[r],r,t);}function R(t){var e={};for(var n in t)e[n]=t[n];return e;}var k='constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf'.split(' ');function L(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<k.length;o++)n=k[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);}}function F(t){return F[' '](t),t;}F[' ']=u;var M,U,V=A(S,'Opera'),j=A(S,'Trident')||A(S,'MSIE'),q=A(S,'Edge'),B=q||j,W=A(S,'Gecko')&&!(A(S.toLowerCase(),'webkit')&&!A(S,'Edge'))&&!(A(S,'Trident')||A(S,'MSIE'))&&!A(S,'Edge'),Q=A(S.toLowerCase(),'webkit')&&!A(S,'Edge');function z(){var t=a.document;return t?t.documentMode:void 0;}t:{var G='',H=(U=S,W?/rv:([^\);]+)(\)|;)/.exec(U):q?/Edge\/([\d\.]+)/.exec(U):j?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(U):Q?/WebKit\/(\S+)/.exec(U):V?/(?:Version)[ \/]?(\S+)/.exec(U):void 0);if(H&&(G=H?H[1]:''),j){var K=z();if(null!=K&&K>parseFloat(G)){M=String(K);break t;}}M=G;}var Y,$={};function X(t){return function(t,e){var n=$;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);}(t,(function(){for(var e=0,n=N(String(M)).split('.'),r=N(String(t)).split('.'),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||'',a=r[o]||'';do{if(s=/(\d*)(\D*)(.*)/.exec(s)||['','','',''],a=/(\d*)(\D*)(.*)/.exec(a)||['','','',''],0==s[0].length&&0==a[0].length)break;e=x(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||x(0==s[2].length,0==a[2].length)||x(s[2],a[2]),s=s[3],a=a[3];}while(0==e);}return 0<=e;}));}if(a.document&&j){var J=z();Y=J||(parseInt(M,10)||void 0);}else Y=void 0;var Z=Y,tt=!j||9<=Number(Z),et=j&&!X('9'),nt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},'passive',{get:function(){t=!0;}});try{a.addEventListener('test',u,e),a.removeEventListener('test',u,e);}catch(t){}return t;}();function rt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1;}function it(t,e){if(rt.call(this,t?t.type:''),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key='',this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType='',this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(W){t:{try{F(e.nodeName);var i=!0;break t;}catch(t){}i=!1;}i||(e=null);}}else'mouseover'==n?e=t.fromElement:'mouseout'==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||'',this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType='string'==typeof t.pointerType?t.pointerType:ot[t.pointerType]||'',this.c=t,t.defaultPrevented&&this.b();}}rt.prototype.b=function(){this.defaultPrevented=!0;},_(it,rt);var ot={2:'touch',3:'pen',4:'mouse'};it.prototype.b=function(){it.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,et)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1);}catch(t){}};var st='closure_listenable_'+(1e6*Math.random()|0),at=0;function ut(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++at,this.V=this.X=!1;}function ct(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null;}function ht(t){this.src=t,this.a={},this.b=0;}function lt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=b(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ct(e),0==t.a[n].length&&(delete t.a[n],t.b--));}}function ft(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i;}return-1;}ht.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=ft(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new ut(e,this.src,o,!!r,i)).X=n,t.push(e)),e;};var pt='closure_lm_'+(1e6*Math.random()|0),dt={};function yt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null;}r=Ct(r);return e&&e[st]?e.sa(n,r,l(i)?!!i.capture:!!i,o):vt(e,n,r,!0,i,o);}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)yt(t,e[o],n,r,i);return null;}return n=Ct(n),t&&t[st]?t.ra(e,n,l(r)?!!r.capture:!!r,i):vt(t,e,n,!1,r,i);}function vt(t,e,n,r,i,o){if(!e)throw Error('Invalid event type');var s=l(i)?!!i.capture:!!i;if(s&&!tt)return null;var a=bt(t);if(a||(t[pt]=a=new ht(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=wt,e=tt?function(n){return t.call(e.src,e.listener,n);}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n;};return e;}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)nt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(mt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error('addEventListener and attachEvent are unavailable.');t.addListener(r);}return n;}function gt(t){if('number'!=typeof t&&t&&!t.V){var e=t.src;if(e&&e[st])lt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(mt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=bt(e))?(lt(n,t),0==n.b&&(n.src=null,e[pt]=null)):ct(t);}}}function mt(t){return t in dt?dt[t]:dt[t]='on'+t;}function _t(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&gt(t),n.call(r,e);}function wt(t,e){if(t.V)return!0;if(!tt){if(!e)t:{e=['window','event'];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t;}e=n;}return _t(t,e=new it(e,this));}return _t(t,new it(e,this));}function bt(t){return(t=t[pt])instanceof ht?t:null;}var Et='__closure_events_fn_'+(1e9*Math.random()>>>0);function Ct(t){return'function'==c(t)?t:(t[Et]||(t[Et]=function(e){return t.handleEvent(e);}),t[Et]);}function It(){w.call(this),this.c=new ht(this),this.J=this,this.A=null;}function Tt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.V&&s.capture==n){var a=s.listener,u=s.aa||s.src;s.X&&lt(t.c,s),i=!1!==a.call(u,r)&&i;}}return i&&!r.defaultPrevented;}_(It,w),It.prototype[st]=!0,(i=It.prototype).addEventListener=function(t,e,n,r){yt(this,t,e,n,r);},i.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=l(i)?!!i.capture:!!i,r=Ct(r),e&&e[st]?(e=e.c,(n=String(n).toString())in e.a&&(-1<(r=ft(s=e.a[n],r,i,o))&&(ct(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--)))):e&&(e=bt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=ft(n,r,i,o)),(r=-1<e?n[e]:null)&&gt(r));}(this,t,e,n,r);},i.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if('string'==typeof t)t=new rt(t,n);else if(t instanceof rt)t.target=t.target||n;else{var i=t;L(t=new rt(r,n),i);}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Tt(s,r,!0,t)&&i;}if(i=Tt(s=t.a=n,r,!0,t)&&i,i=Tt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Tt(s=t.a=e[o],r,!1,t)&&i;return i;},i.C=function(){if(It.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)ct(n[r]);delete e.a[t],e.b--;}}this.A=null;},i.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r);},i.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r);};var St=a.JSON.stringify;function Nt(){this.b=this.a=null;}var At,xt=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null;}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t;},t;}())((function(){return new Dt;}),(function(t){t.reset();}),100);function Pt(){var t=Lt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e;}function Dt(){this.next=this.b=this.a=null;}function Ot(t){a.setTimeout((function(){throw t;}),0);}function Rt(t,e){At||function(){var t=a.Promise.resolve(void 0);At=function(){t.then(Ft);};}(),kt||(At(),kt=!0),Lt.add(t,e);}Nt.prototype.add=function(t,e){var n=xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n;},Dt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null;},Dt.prototype.reset=function(){this.next=this.b=this.a=null;};var kt=!1,Lt=new Nt;function Ft(){for(var t;t=Pt();){try{t.a.call(t.b);}catch(t){Ot(t);}var e=xt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t);}kt=!1;}function Mt(t,e){It.call(this),this.b=t||1,this.a=e||a,this.f=v(this.Ua,this),this.g=m();}function Ut(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null);}function Vt(t,e,n){if('function'==c(t))n&&(t=v(t,n));else{if(!t||'function'!=typeof t.handleEvent)throw Error('Invalid listener argument');t=v(t.handleEvent,t);}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0);}function jt(t,e,n){w.call(this),this.f=null!=n?v(t,n):t,this.c=e,this.b=v(this.Pa,this),this.a=[];}function qt(t){t.T=Vt(t.b,t.c),t.f.apply(null,t.a);}function Bt(t){w.call(this),this.b=t,this.a={};}_(Mt,It),(i=Mt.prototype).Z=!1,i.L=null,i.Ua=function(){if(this.Z){var t=m()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent('tick'),this.Z&&(Ut(this),this.start()));}},i.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=m());},i.C=function(){Mt.M.C.call(this),Ut(this),delete this.a;},_(jt,w),(i=jt.prototype).ba=!1,i.T=null,i.Ia=function(t){this.a=arguments,this.T?this.ba=!0:qt(this);},i.C=function(){jt.M.C.call(this),this.T&&(a.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[]);},i.Pa=function(){this.T=null,this.ba&&(this.ba=!1,qt(this));},_(Bt,w);var Wt=[];function Qt(t,e,n,r){Array.isArray(n)||(n&&(Wt[0]=n.toString()),n=Wt);for(var i=0;i<n.length;i++){var o=yt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o;}}function zt(t){O(t.a,(function(t,e){this.a.hasOwnProperty(e)&&gt(t);}),t),t.a={};}function Gt(){}Bt.prototype.C=function(){Bt.M.C.call(this),zt(this);},Bt.prototype.handleEvent=function(){throw Error('EventHandler.handleEvent not implemented');};var Ht=null;function Kt(){return Ht=Ht||new It;}function Yt(t){rt.call(this,'serverreachability',t);}function $t(t){var e=Kt();e.dispatchEvent(new Yt(e,t));}function Xt(t){rt.call(this,'statevent',t);}function Jt(t){var e=Kt();e.dispatchEvent(new Xt(e,t));}function Zt(t){rt.call(this,'timingevent',t);}function te(t,e){if('function'!=c(t))throw Error('Fn must not be null and must be a function');return a.setTimeout((function(){t();}),e);}_(Yt,rt),_(Xt,rt),_(Zt,rt);var ee={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},ne={Xa:'complete',kb:'success',Aa:'error',za:'abort',ib:'ready',jb:'readystatechange',TIMEOUT:'timeout',eb:'incrementaldata',hb:'progress',Za:'downloadprogress',lb:'uploadprogress'};function re(){}function ie(t){var e;return(e=t.a)||(e=t.a={}),e;}function oe(){}re.prototype.a=null;var se,ae={OPEN:'a',Wa:'b',Aa:'c',fb:'d'};function ue(){rt.call(this,'d');}function ce(){rt.call(this,'c');}function he(){}function le(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new Bt(this),this.N=fe,t=B?125:void 0,this.O=new Mt(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1;}_(ue,rt),_(ce,rt),_(he,re),se=new he;var fe=45e3,pe={},de={};function ye(t,e,n){t.B=1,t.f=Me(De(e)),t.j=n,t.F=!0,ve(t,null);}function ve(t,e){t.s=m(),_e(t),t.A=De(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),$e(n.b,'t',r),t.w=0,t.a=Bn(t.g,t.g.w?e:null),0<t.J&&(t.D=new jt(v(t.ya,t,t.a),t.J)),Qt(t.G,t.a,'readystatechange',t.Sa),e=t.m?R(t.m):{},t.j?(t.v||(t.v='POST'),e['Content-Type']='application/x-www-form-urlencoded',t.a.$(t.A,t.v,t.j,e)):(t.v='GET',t.a.$(t.A,t.v,null,e)),$t(1);}function ge(t,e,n){for(var r=!0;!t.l&&t.w<n.length;){var i=me(t,n);if(i==de){4==e&&(t.c=4,Jt(14),r=!1);break;}if(i==pe){t.c=4,Jt(15),r=!1;break;}Ie(t,i);}4==e&&0==n.length&&(t.c=1,Jt(16),r=!1),t.b=t.b&&r,r||(Ce(t),Ee(t));}function me(t,e){var n=t.w,r=e.indexOf('\n',n);return-1==r?de:(n=Number(e.substring(n,r)),isNaN(n)?pe:(r+=1)+n>e.length?de:(e=e.substr(r,n),t.w=r+n,e));}function _e(t){t.P=m()+t.N,we(t,t.N);}function we(t,e){if(null!=t.h)throw Error('WatchDog timer not null');t.h=te(v(t.Qa,t),e);}function be(t){t.h&&(a.clearTimeout(t.h),t.h=null);}function Ee(t){0==t.g.u||t.l||Mn(t.g,t);}function Ce(t){be(t);var e=t.D;e&&'function'==typeof e.da&&e.da(),t.D=null,Ut(t.O),zt(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da());}function Ie(t,e){try{var n=t.g;if(0!=n.u&&(n.a==t||rn(n.b,t)))if(n.A=t.H,!t.o&&rn(n.b,t)&&3==n.u){try{var r=n.ja.a.parse(e);}catch(t){r=null;}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.i){if(n.a){if(!(n.a.s+3e3<t.s))break t;Fn(n),n.a.cancel(),n.a=null;}Ln(n),Jt(18);}}else n.ia=i[1],0<n.ia-n.G&&37500>i[2]&&n.U&&0==n.m&&!n.l&&(n.l=te(v(n.Na,n),6e3));if(1>=nn(n.b)&&n.O){try{n.O();}catch(t){}n.O=void 0;}}else Vn(n,11);}else if((t.o||n.a==t)&&Fn(n),!T(e))for(e=r=n.ja.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.G=i[0],i=i[1],2==n.u)if('c'==i[0]){n.B=i[1],n.R=i[2];var o=i[3];null!=o&&(n.oa=o);var s=i[5];null!=s&&'number'==typeof s&&0<s&&(n.D=1.5*s);var a=n,u=t.a;if(u){var c=u.a?u.a.getResponseHeader('X-Client-Wire-Protocol'):null;if(c){var h=a.b;!h.a&&(A(c,'spdy')||A(c,'quic')||A(c,'h2'))&&(h.f=h.g,h.a=new Set,h.b&&(on(h,h.b),h.b=null));}if(a.s){var l=u.a?u.a.getResponseHeader('X-HTTP-Session-Id'):null;l&&(a.ha=l,Fe(a.v,a.s,l));}}n.u=3,n.c&&n.c.na();var f=t;if((a=n).ea=qn(a,a.w?a.R:null,a.P),f.o){sn(a.b,f);var p=f,d=a.D;d&&p.setTimeout(d),p.h&&(be(p),_e(p)),a.a=f;}else kn(a);0<n.f.length&&Pn(n);}else'stop'!=i[0]&&'close'!=i[0]||Vn(n,7);else 3==n.u&&('stop'==i[0]||'close'==i[0]?'stop'==i[0]?Vn(n,7):Nn(n):'noop'!=i[0]&&n.c&&n.c.ma(i),n.m=0);$t(4);}catch(t){}}function Te(t,e){if(t.forEach&&'function'==typeof t.forEach)t.forEach(e,void 0);else if(h(t)||'string'==typeof t)E(t,e,void 0);else{if(t.K&&'function'==typeof t.K)var n=t.K();else if(t.I&&'function'==typeof t.I)n=void 0;else if(h(t)||'string'==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i);}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&'function'==typeof t.I)return t.I();if('string'==typeof t)return t.split('');if(h(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e;}for(r in e=[],n=0,t)e[n++]=t[r];return e;}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t);}}function Se(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error('Uneven number of arguments');for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1]);}else if(t)if(t instanceof Se)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r]);}function Ne(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ae(t.b,r)&&(t.a[n++]=r),e++;}t.a.length=n;}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ae(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n;}}function Ae(t,e){return Object.prototype.hasOwnProperty.call(t,e);}(i=le.prototype).setTimeout=function(t){this.N=t;},i.Sa=function(t){t=t.target;var e=this.D;e&&3==Cn(t)?e.Ia():this.ya(t);},i.ya=function(t){try{if(t==this.a)t:{var e=Cn(this.a),n=this.a.qa(),r=this.a.S();if(!(3>e||3==e&&!B&&!this.a.Y())){this.l||4!=e||7==n||$t(8==n||0>=r?3:2),be(this);var i=this.a.S();this.H=i;var o=this.a.Y();if(this.b=200==i){if(this.R&&!this.o){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader('X-HTTP-Initial-Response'):null)&&!T(s)){var u=s;break e;}}u=null;}if(!u){this.b=!1,this.c=3,Jt(12),Ce(this),Ee(this);break t;}this.o=!0,Ie(this,u);}this.F?(ge(this,e,o),B&&this.b&&3==e&&(Qt(this.G,this.O,'tick',this.Ra),this.O.start())):Ie(this,o),4==e&&Ce(this),this.b&&!this.l&&(4==e?Mn(this.g,this):(this.b=!1,_e(this)));}else 400==i&&0<o.indexOf('Unknown SID')?(this.c=3,Jt(12)):(this.c=0,Jt(13)),Ce(this),Ee(this);}}}catch(t){}},i.Ra=function(){if(this.a){var t=Cn(this.a),e=this.a.Y();this.w<e.length&&(be(this),ge(this,t,e),this.b&&4!=t&&_e(this));}},i.cancel=function(){this.l=!0,Ce(this);},i.Qa=function(){this.h=null;var t=m();0<=t-this.P?(2!=this.B&&($t(3),Jt(17)),Ce(this),this.c=2,Ee(this)):we(this,this.P-t);},(i=Se.prototype).I=function(){Ne(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t;},i.K=function(){return Ne(this),this.a.concat();},i.get=function(t,e){return Ae(this.b,t)?this.b[t]:e;},i.set=function(t,e){Ae(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e;},i.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this);}};var xe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Pe(t,e){if(this.c=this.j=this.f='',this.h=null,this.i=this.g='',this.a=!1,t instanceof Pe){this.a=void 0!==e?e:t.a,Oe(this,t.f),this.j=t.j,Re(this,t.c),ke(this,t.h),this.g=t.g,e=t.b;var n=new Ge;n.c=e.c,e.a&&(n.a=new Se(e.a),n.b=e.b),Le(this,n),this.i=t.i;}else t&&(n=String(t).match(xe))?(this.a=!!e,Oe(this,n[1]||'',!0),this.j=Ue(n[2]||''),Re(this,n[3]||'',!0),ke(this,n[4]),this.g=Ue(n[5]||'',!0),Le(this,n[6]||'',!0),this.i=Ue(n[7]||'')):(this.a=!!e,this.b=new Ge(null,this.a));}function De(t){return new Pe(t);}function Oe(t,e,n){t.f=n?Ue(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,''));}function Re(t,e,n){t.c=n?Ue(e,!0):e;}function ke(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error('Bad port number '+e);t.h=e;}else t.h=null;}function Le(t,e,n){e instanceof Ge?(t.b=e,function(t,e){e&&!t.f&&(He(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ke(this,e),$e(this,n,t));}),t)),t.f=e;}(t.b,t.a)):(n||(e=Ve(e,Qe)),t.b=new Ge(e,t.a));}function Fe(t,e,n){t.b.set(e,n);}function Me(t){return Fe(t,'zx',Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^m()).toString(36)),t;}function Ue(t,e){return t?e?decodeURI(t.replace(/%25/g,'%2525')):decodeURIComponent(t):'';}function Ve(t,e,n){return'string'==typeof t?(t=encodeURI(t).replace(e,je),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,'%$1')),t):null;}function je(t){return'%'+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16);}Pe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ve(e,qe,!0),':');var n=this.c;return(n||'file'==e)&&(t.push('//'),(e=this.j)&&t.push(Ve(e,qe,!0),'@'),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,'%$1')),null!=(n=this.h)&&t.push(':',String(n))),(n=this.g)&&(this.c&&'/'!=n.charAt(0)&&t.push('/'),t.push(Ve(n,'/'==n.charAt(0)?We:Be,!0))),(n=this.b.toString())&&t.push('?',n),(n=this.i)&&t.push('#',Ve(n,ze)),t.join('');};var qe=/[#\/\?@]/g,Be=/[#\?:]/g,We=/[#\?]/g,Qe=/[#\?@]/g,ze=/#/g;function Ge(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e;}function He(t){t.a||(t.a=new Se,t.b=0,t.c&&function(t,e){if(t){t=t.split('&');for(var n=0;n<t.length;n++){var r=t[n].indexOf('='),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1);}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g,' ')):'');}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g,' ')),n);})));}function Ke(t,e){He(t),e=Xe(t,e),Ae(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ae((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ne(t)));}function Ye(t,e){return He(t),e=Xe(t,e),Ae(t.a.b,e);}function $e(t,e,n){Ke(t,e),0<n.length&&(t.c=null,t.a.set(Xe(t,e),I(n)),t.b+=n.length);}function Xe(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e;}function Je(t,e){this.b=t,this.a=e;}function Ze(t){this.g=t||tn,a.PerformanceNavigationTiming?t=0<(t=a.performance.getEntriesByType('navigation')).length&&('hq'==t[0].nextHopProtocol||'h2'==t[0].nextHopProtocol):t=!!(a.ca&&a.ca.ua&&a.ca.ua()&&a.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[];}(i=Ge.prototype).add=function(t,e){He(this),this.c=null,t=Xe(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this;},i.forEach=function(t,e){He(this),this.a.forEach((function(n,r){E(n,(function(n){t.call(e,n,r,this);}),this);}),this);},i.K=function(){He(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n;},i.I=function(t){He(this);var e=[];if('string'==typeof t)Ye(this,t)&&(e=C(e,this.a.get(Xe(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=C(e,t[n]);}return e;},i.set=function(t,e){return He(this),this.c=null,Ye(this,t=Xe(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this;},i.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e;},i.toString=function(){if(this.c)return this.c;if(!this.a)return'';for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.I(r);for(var o=0;o<r.length;o++){var s=i;''!==r[o]&&(s+='='+encodeURIComponent(String(r[o]))),t.push(s);}}return this.c=t.join('&');};var tn=10;function en(t){return!!t.b||!!t.a&&t.a.size>=t.f;}function nn(t){return t.b?1:t.a?t.a.size:0;}function rn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e);}function on(t,e){t.a?t.a.add(e):t.b=e;}function sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e);}function an(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null!=t.a&&0!==t.a.size){var i=t.c;try{for(var o=r(t.a.values()),s=o.next();!s.done;s=o.next()){var a=s.value;i=i.concat(a.i);}}catch(t){e={error:t};}finally{try{s&&!s.done&&(n=o.return)&&n.call(o);}finally{if(e)throw e.error;}}return i;}return I(t.c);}function un(){}function cn(){this.a=new un;}function hn(t,e,n){var r=n||'';try{Te(t,(function(t,n){var i=t;l(t)&&(i=St(t)),e.push(r+n+'='+encodeURIComponent(i));}));}catch(t){throw e.push(r+'type='+encodeURIComponent('_badmap')),t;}}function ln(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r);}catch(t){}}Ze.prototype.cancel=function(){var t,e;if(this.c=an(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=r(this.a.values()),i=n.next();!i.done;i=n.next()){i.value.cancel();}}catch(e){t={error:e};}finally{try{i&&!i.done&&(e=n.return)&&e.call(n);}finally{if(t)throw t.error;}}this.a.clear();}},un.prototype.stringify=function(t){return a.JSON.stringify(t,void 0);},un.prototype.parse=function(t){return a.JSON.parse(t,void 0);};var fn=a.JSON.parse;function pn(t){It.call(this),this.headers=new Se,this.G=t||null,this.b=!1,this.s=this.a=null,this.D='',this.h=0,this.f='',this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=dn,this.B=this.F=!1;}_(pn,It);var dn='',yn=/^https?$/i,vn=['POST','PUT'];function gn(t){return'content-type'==t.toLowerCase();}function mn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,_n(t),bn(t);}function _n(t){t.v||(t.v=!0,t.dispatchEvent('complete'),t.dispatchEvent('error'));}function wn(t){if(t.b&&void 0!==s&&(!t.s[1]||4!=Cn(t)||2!=t.S()))if(t.l&&4==Cn(t))Vt(t.va,0,t);else if(t.dispatchEvent('readystatechange'),4==Cn(t)){t.b=!1;try{var e,n=t.S();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1;}if(!(e=r)){var i;if(i=0===n){var o=String(t.D).match(xe)[1]||null;if(!o&&a.self&&a.self.location){var u=a.self.location.protocol;o=u.substr(0,u.length-1);}i=!yn.test(o?o.toLowerCase():'');}e=i;}if(e)t.dispatchEvent('complete'),t.dispatchEvent('success');else{t.h=6;try{var c=2<Cn(t)?t.a.statusText:'';}catch(t){c='';}t.f=c+' ['+t.S()+']',_n(t);}}finally{bn(t);}}}function bn(t,e){if(t.a){En(t);var n=t.a,r=t.s[0]?u:null;t.a=null,t.s=null,e||t.dispatchEvent('ready');try{n.onreadystatechange=r;}catch(t){}}}function En(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(a.clearTimeout(t.m),t.m=null);}function Cn(t){return t.a?t.a.readyState:0;}function In(t,e,n){t:{for(r in n){var r=!1;break t;}r=!0;}r||(n=function(t){var e='';return O(t,(function(t,n){e+=n,e+=':',e+=t,e+='\r\n';})),e;}(n),'string'==typeof t?null!=n&&encodeURIComponent(String(n)):Fe(t,e,n));}function Tn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e;}function Sn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Tn('failFast',!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Tn('baseRetryDelayMs',5e3,t),this.Ga=Tn('retryDelaySeedMs',1e4,t),this.Da=Tn('forwardChannelMaxRetries',2,t),this.ga=Tn('forwardChannelRequestTimeoutMs',2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B='',this.b=new Ze(t&&t.concurrentRequestLimit),this.ja=new cn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0;}function Nn(t){if(An(t),3==t.u){var e=t.H++,n=De(t.v);Fe(n,'SID',t.B),Fe(n,'RID',e),Fe(n,'TYPE','terminate'),On(t,n),(e=new le(t,e,void 0)).B=2,e.f=Me(De(n)),n=!1,a.navigator&&a.navigator.sendBeacon&&(n=a.navigator.sendBeacon(e.f.toString(),'')),!n&&a.Image&&((new Image).src=e.f,n=!0),n||(e.a=Bn(e.g,null),e.a.$(e.f)),e.s=m(),_e(e);}jn(t);}function An(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(a.clearTimeout(t.i),t.i=null),Fn(t),t.b.cancel(),t.g&&('number'==typeof t.g&&a.clearTimeout(t.g),t.g=null);}function xn(t,e){t.f.push(new Je(t.Fa++,e)),3==t.u&&Pn(t);}function Pn(t){en(t.b)||t.g||(t.g=!0,Rt(t.xa,t),t.o=0);}function Dn(t,e){var n;n=e?e.W:t.H++;var r=De(t.v);Fe(r,'SID',t.B),Fe(r,'RID',n),Fe(r,'AID',t.G),On(t,r),t.h&&t.j&&In(r,t.h,t.j),n=new le(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Rn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),on(t.b,n),ye(n,r,e);}function On(t,e){t.c&&Te({},(function(t,n){Fe(e,n,t);}));}function Rn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?v(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=['count='+n];-1==o?0<n?(o=i[0].b,s.push('ofs='+o)):o=0:s.push('ofs='+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{hn(h,s,'req'+c+'_');}catch(t){r&&r(h);}}if(a){r=s.join('&');break t;}}return t=t.f.splice(0,n),e.i=t,r;}function kn(t){t.a||t.i||(t.J=1,Rt(t.wa,t),t.m=0);}function Ln(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=te(v(t.wa,t),Un(t,t.m)),t.m++,!0);}function Fn(t){null!=t.l&&(a.clearTimeout(t.l),t.l=null);}function Mn(t,e){var n=null;if(t.a==e){Fn(t),t.a=null;var r=2;}else{if(!rn(t.b,e))return;n=e.i,sn(t.b,e),r=1;}if(t.A=e.H,0!=t.u)if(e.b)if(1==r){n=e.j?e.j.length:0,e=m()-e.s;var i=t.o;(r=Kt()).dispatchEvent(new Zt(r,n,e,i)),Pn(t);}else kn(t);else if(3==(i=e.c)||0==i&&0<t.A||!(1==r&&function(t,e){return!(nn(t.b)>=t.b.f-(t.g?1:0))&&(t.g?(t.f=e.i.concat(t.f),!0):!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da))&&(t.g=te(v(t.xa,t,e),Un(t,t.o)),t.o++,!0));}(t,e)||2==r&&Ln(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Vn(t,5);break;case 4:Vn(t,10);break;case 3:Vn(t,6);break;default:Vn(t,2);}}function Un(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e;}function Vn(t,e){if(2==e){var n=null;t.c&&(n=null);var r=v(t.Ta,t);n||(n=new Pe('//www.google.com/images/cleardot.gif'),a.location&&'http'==a.location.protocol||Oe(n,'https'),Me(n)),function(t,e){var n=new Gt;if(a.Image){var r=new Image;r.onload=g(ln,n,r,'TestLoadImage: loaded',!0,e),r.onerror=g(ln,n,r,'TestLoadImage: error',!1,e),r.onabort=g(ln,n,r,'TestLoadImage: abort',!1,e),r.ontimeout=g(ln,n,r,'TestLoadImage: timeout',!1,e),a.setTimeout((function(){r.ontimeout&&r.ontimeout();}),1e4),r.src=t;}else e(!1);}(n.toString(),r);}else Jt(2);t.u=0,t.c&&t.c.la(e),jn(t),An(t);}function jn(t){t.u=0,t.A=-1,t.c&&(0==an(t.b).length&&0==t.f.length||(t.b.c.length=0,I(t.f),t.f.length=0),t.c.ka());}function qn(t,e,n){var r=function(t){return t instanceof Pe?De(t):new Pe(t,void 0);}(n);if(''!=r.c)e&&Re(r,e+'.'+r.c),ke(r,r.h);else{var i=a.location;r=function(t,e,n,r){var i=new Pe(null,void 0);return t&&Oe(i,t),e&&Re(i,e),n&&ke(i,n),r&&(i.g=r),i;}(i.protocol,e?e+'.'+i.hostname:i.hostname,+i.port,n);}return t.N&&O(t.N,(function(t,e){Fe(r,e,t);})),e=t.s,n=t.ha,e&&n&&Fe(r,e,n),Fe(r,'VER',t.oa),On(t,r),r;}function Bn(t,e){if(e&&!t.w)throw Error('Can\'t create secondary domain capable XhrIo object.');return(e=new pn(t.Ea)).F=t.w,e;}function Wn(){}function Qn(){if(j&&!(10<=Number(Z)))throw Error('Environmental error: no available transport.');}function zn(t,e){It.call(this),this.a=new Sn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t['X-Client-Protocol']='webchannel':t={'X-Client-Protocol':'webchannel'}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t['X-WebChannel-Content-Type']=e.messageContentType:t={'X-WebChannel-Content-Type':e.messageContentType}),e&&e.pa&&(t?t['X-WebChannel-Client-Profile']=e.pa:t={'X-WebChannel-Client-Profile':e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!T(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!T(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Kn(this);}function Gn(t){ue.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t;}t=void 0;}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e;}else this.data=t;}function Hn(){ce.call(this),this.status=1;}function Kn(t){this.a=t;}(i=pn.prototype).$=function(t,e,n,r){if(this.a)throw Error('[goog.net.XhrIo] Object is active with another request='+this.D+'; newUri='+t);e=e?e.toUpperCase():'GET',this.D=t,this.f='',this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?ie(this.G):ie(se),this.a.onreadystatechange=v(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1;}catch(t){return void mn(this,t);}t=n||'';var i=new Se(this.headers);r&&Te(r,(function(t,e){i.set(e,t);})),r=function(t){t:{for(var e=gn,n=t.length,r='string'==typeof t?t.split(''):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t;}e=-1;}return 0>e?null:'string'==typeof t?t.charAt(e):t[e];}(i.K()),n=a.FormData&&t instanceof a.FormData,!(0<=b(vn,e))||r||n||i.set('Content-Type','application/x-www-form-urlencoded;charset=utf-8'),i.forEach((function(t,e){this.a.setRequestHeader(e,t);}),this),this.H&&(this.a.responseType=this.H),'withCredentials'in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{En(this),0<this.o&&((this.B=function(t){return j&&X(9)&&'number'==typeof t.timeout&&void 0!==t.ontimeout;}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=v(this.ta,this)):this.m=Vt(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1;}catch(t){mn(this,t);}},i.ta=function(){void 0!==s&&this.a&&(this.f='Timed out after '+this.o+'ms, aborting',this.h=8,this.dispatchEvent('timeout'),this.abort(8));},i.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent('complete'),this.dispatchEvent('abort'),bn(this));},i.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),bn(this,!0)),pn.M.C.call(this);},i.va=function(){this.j||(this.w||this.l||this.g?wn(this):this.Oa());},i.Oa=function(){wn(this);},i.S=function(){try{return 2<Cn(this)?this.a.status:-1;}catch(t){return-1;}},i.Y=function(){try{return this.a?this.a.responseText:'';}catch(t){return'';}},i.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),fn(e);}},i.qa=function(){return this.h;},i.Ma=function(){return'string'==typeof this.f?this.f:String(this.f);},(i=Sn.prototype).oa=8,i.u=1,i.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random());var e,n=new le(this,t=this.H++,void 0),r=this.j;if(this.F&&(r?L(r=R(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o='__data__'in o.a&&'string'==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t;}if(4096===e||i===this.f.length-1){e=i+1;break t;}}e=1e3;}else e=1e3;e=Rn(this,n,e),Fe(i=De(this.v),'RID',t),Fe(i,'CVER',22),this.s&&Fe(i,'X-HTTP-Session-Id',this.s),On(this,i),this.h&&r&&In(i,this.h,r),on(this.b,n),this.fa?(Fe(i,'$req',e),Fe(i,'SID','null'),n.R=!0,ye(n,i,null)):ye(n,i,e),this.u=2;}}else 3==this.u&&(t?Dn(this,t):0==this.f.length||en(this.b)||Dn(this));},i.wa=function(){this.i=null,this.a=new le(this,'rpc',this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=De(this.ea);Fe(t,'RID','rpc'),Fe(t,'SID',this.B),Fe(t,'CI',this.U?'0':'1'),Fe(t,'AID',this.G),On(this,t),Fe(t,'TYPE','xmlhttp'),this.h&&this.j&&In(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=Me(De(t)),e.j=null,e.F=!0,ve(e,n);},i.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,Ln(this),Jt(19));},i.Ta=function(t){Jt(t?2:1);},(i=Wn.prototype).na=function(){},i.ma=function(){},i.la=function(){},i.ka=function(){},i.Ha=function(){},Qn.prototype.a=function(t,e){return new zn(t,e);},_(zn,It),(i=zn.prototype).addEventListener=function(t,e,n,r){zn.M.addEventListener.call(this,t,e,n,r);},i.removeEventListener=function(t,e,n,r){zn.M.removeEventListener.call(this,t,e,n,r);},i.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;Jt(0),t.P=e,t.N=n||{},t.U=t.W,t.v=qn(t,null,t.P),Pn(t);},i.close=function(){Nn(this.a);},i.La=function(t){if('string'==typeof t){var e={};e.__data__=t,xn(this.a,e);}else this.g?((e={}).__data__=St(t),xn(this.a,e)):xn(this.a,t);},i.C=function(){this.a.c=null,delete this.f,Nn(this.a),delete this.a,zn.M.C.call(this);},_(Gn,ue),_(Hn,ce),_(Kn,Wn),Kn.prototype.na=function(){this.a.dispatchEvent('a');},Kn.prototype.ma=function(t){this.a.dispatchEvent(new Gn(t));},Kn.prototype.la=function(t){this.a.dispatchEvent(new Hn(t));},Kn.prototype.ka=function(){this.a.dispatchEvent('b');},Qn.prototype.createWebChannel=Qn.prototype.a,zn.prototype.send=zn.prototype.La,zn.prototype.open=zn.prototype.Ka,zn.prototype.close=zn.prototype.close,ee.NO_ERROR=0,ee.TIMEOUT=8,ee.HTTP_ERROR=6,ne.COMPLETE='complete',oe.EventType=ae,ae.OPEN='a',ae.CLOSE='b',ae.ERROR='c',ae.MESSAGE='d',It.prototype.listen=It.prototype.ra,pn.prototype.listenOnce=pn.prototype.sa,pn.prototype.getLastError=pn.prototype.Ma,pn.prototype.getLastErrorCode=pn.prototype.qa,pn.prototype.getStatus=pn.prototype.S,pn.prototype.getResponseJson=pn.prototype.Ja,pn.prototype.getResponseText=pn.prototype.Y,pn.prototype.send=pn.prototype.$;var Yn={createWebChannelTransport:function(){return new Qn;},ErrorCode:ee,EventType:ne,WebChannel:oe,XhrIo:pn},$n=Yn.createWebChannelTransport,Xn=Yn.ErrorCode,Jn=Yn.EventType,Zn=Yn.WebChannel,tr=Yn.XhrIo;e.default=Yn;}.call(this,n(8));},function(t,e,n){'use strict';n.r(e);n(10),n(11);var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t;}).apply(this,arguments);};function i(t){if(t instanceof Array){var e=[];return t.forEach((function(t){e.push(t);})),e.map((function(t){return i(t);}));}if('object'==typeof t&&t!=={}){var n=r({},t);return Object.keys(n).forEach((function(t){n[t]=i(n[t]);})),n;}return t;}var o=n(1),s=n.n(o);var a=function(){function t(t,e,n){this.label=t,this.action=e,this.args=void 0,this.metadata={},this.artifacts={extra:[]},this.eventType=void 0,this.complex=!1,this.prov=n;}return t.prototype.addLabel=function(t){return this.label=t,this;},t.prototype.addAction=function(t){return this.action=t,this;},t.prototype.addArgs=function(t){return this.args=t,this;},t.prototype.addMetadata=function(t){return this.metadata=t,this;},t.prototype.addArtifacts=function(t){return this.artifacts=t,this;},t.prototype.addExtra=function(t){return this.artifacts.extra.push({time:Date.now(),e:t}),this;},t.prototype.addEventType=function(t){return this.eventType=t,this;},t.prototype.alwaysStoreState=function(t){return this.complex=t,this;},t.prototype.isEphemeral=function(t){return this.ephemeral=t,this;},t.prototype.applyAction=function(){this.prov.applyAction(this.label,this.action,this.args,this.metadata,this.artifacts,this.eventType,this.complex,this.ephemeral);},t;}();n(2).applyChange;function u(t){return'parent'in t&&'state'in t;}function c(t){return'diffs'in t;}function h(t){return'parent'in t;}function l(){var t=(new Date).getTime();return t+=(new Date).valueOf(),'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),('x'===e?n:3&n|8).toString(16);}));}function f(){return(new Date).getTime();}var p=n(2).diff;function d(t,e){return p(t,e);}var y=function(){return(y=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t;}).apply(this,arguments);},v=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r;},g=n(2).applyChange;function m(t,e){var n=i(t),r=t.nodes[e];if(!r)throw new Error('No such node exists');return n.current=r.id,n;}var _='GLOBAL',w='ARTIFACT';function b(){var t={},e={};return{addGlobalObserver:function(e){t[_]||(t[_]=[]),t[_].push(e);},addObserver:function(e,n){var r=e.join('|');t[r]||(t[r]=[]),t[r].push(n);},addArtifactObserver:function(t){e[w]||(e[w]=[]),e[w].push(t);},callEvents:function(n,r,i){if(h(i)&&function(t){if(e[w]&&e[w].length>0&&h(t)&&t.artifacts.extra){var n=t.artifacts.extra||[];e[w].forEach((function(t){return t(n);}));}}(i),0!==n.length){!function(e){t[_]&&t[_].length>0&&t[_].forEach((function(t){return t(e);}));}(r);var o=[];n.forEach((function(e){var n=e.path,i=[],s=n.join('|');o.includes(s)||(o.push(s),n.forEach((function(t){0===i.length?i.push(t):i.push([i.reverse()[0],t].join('|'));})),i.reverse().forEach((function(e){t[e]&&t[e].forEach((function(t){return t(r);}));})));}));}}};}var E=function(){return(E=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t;}).apply(this,arguments);},C=n(2).applyChange,I=n(9).decompressFromEncodedURIComponent,T=n(9).compressToEncodedURIComponent;function S(t,e,n,r){void 0===e&&(e=!0),void 0===n&&(n=!1);var o,p,_,w,S,N,A,x,P=(o=t,_={id:l(),label:'Root',metadata:{createdOn:f(),type:'Root'},children:[],state:o,getState:function(){return o;},ephemeral:!1,bookmarked:!1},{nodes:(p={},p[_.id]=_,p),root:_.id,current:_.id}),D=i(t),O=b(),R=void 0;function k(t){var e=P.nodes[P.current].getState(),n=d(t,e);O.callEvents(n||[],e,P.nodes[P.current]);}function L(t,e,n){P=function(t,e,n){var r=i(t),o=r.current,s=(i(t.nodes[o].getState()),t.nodes[o]),a=void 0,c='',p=!0;h(s)?u(s)?(a=s.getState(),c=s.id):(a=t.nodes[s.lastStateNode].getState(),c=s.lastStateNode):(p=!1,a=s.getState(),c=s.id);var y=n,v=t.current,m=d(a,y);void 0===m&&(m=[]),p&&Object.keys(a).length/2<m.length&&(p=!1);var _=p?function(t,e,n,o){return{id:l(),label:'Import Node',metadata:{createdOn:f()},artifacts:{diffs:n,extra:[]},parent:t,children:[],lastStateNode:e,diffs:n,getState:function(){var t=i(r.nodes[e].getState()),o=n;return 0===o.length?t:(o.forEach((function(e){g(t,null,e);})),t);},ephemeral:!1,bookmarked:!1};}(v,c,m):function(t,e,n,r){return{id:l(),label:'Import Node',metadata:{createdOn:f()},artifacts:{diffs:n,extra:[]},parent:t,children:[],state:e,getState:function(){return e;},ephemeral:!1,bookmarked:!1};}(v,y,m);return r.nodes[_.id]=_,r.nodes[o].children.push(_.id),r.current=_.id,r;}(P,0,t),void 0!==e&&(P.nodes[P.current].label=e),void 0!==n&&(P.nodes[P.current].metadata=n);}function F(t){if(e){var n=new URL(window.location.href),r=new URLSearchParams(n.search);r.delete('provState');r.set('provState',t),window.history.replaceState({},'',n.pathname+'?'+r);}}function M(t){var e={},n=P.nodes[P.current].getState();t?Object.keys(n).forEach((function(t){var r,i=D[t],o=n[t];JSON.stringify(i)!==JSON.stringify(o)&&(e=E(E({},e),((r={})[t]=n[t],r)));})):e=E({},n);var r=e;return''+T(JSON.stringify(r));}return n&&r&&(A=r,x=0===s.a.apps.length?s.a.initializeApp(A):s.a.app(),R={config:A,app:x,db:s.a.database(x)},S=null==R?void 0:R.db,N=[],w=function(t){for(var e=''+t.root,n=[],r=0,i=Object.keys(t.nodes);r<i.length;r++){var o=i[r];N.includes(o)||(n.push(o),N.push(o));}n.forEach((function(n){var r=JSON.parse(JSON.stringify(t.nodes[n]));S.ref(e+'/nodes/'+n).set(r).then((function(){Date.now(),t.current;})).catch((function(t){throw console.log(t),new Error('Something went wrong while logging.');}));}));}),{graph:function(){return i(P);},current:function(){return i(P.nodes[P.current]);},root:function(){return i(P.nodes[P.root]);},addAction:function(t,e){return new a(t,e,this);},applyAction:function(t,e,r,o,s,a,c,p){void 0===o&&(o={}),void 0===c&&(c=!1),void 0===p&&(p=!1);var m=i(P.nodes[P.current].getState());return a&&(o.type=a),P=function(t,e,n,r,o,s,a,c){void 0===c&&(c={});var p=i(t),m=p.current,_=i(t.nodes[m].getState()),w=t.nodes[m],b=void 0,E='',C=!0;h(w)?u(w)?(b=w.getState(),E=w.id):(b=t.nodes[w.lastStateNode].getState(),E=w.lastStateNode):(C=!1,b=w.getState(),E=w.id);var I=s?n.apply(void 0,v([_],s)):n(_),T=t.current,S=d(b,I);void 0===S&&(S=[]),C&&Object.keys(b).length/2<S.length&&(C=!1);var N=C&&!r?function(t,n,r,o){return{id:l(),label:e,metadata:y({createdOn:f()},a),artifacts:y({diffs:r,extra:[]},c),parent:t,children:[],lastStateNode:n,diffs:r,getState:function(){var t=i(p.nodes[n].getState()),e=r;return 0===e.length?t:(e.forEach((function(e){g(t,null,e);})),t);},ephemeral:o,bookmarked:!1};}(T,E,S,o):function(t,n,r,i){return{id:l(),label:e,metadata:y({createdOn:f()},a),artifacts:y({diffs:r,extra:[]},c),parent:t,children:[],state:n,getState:function(){return n;},ephemeral:i,bookmarked:!1};}(T,I,S,o);return p.nodes[N.id]=N,p.nodes[m].children.push(N.id),p.current=N.id,p;}(P,t,e,c,p,r,o,s),k(m),F(M(!1)),n&&w(P),P.nodes[P.current].getState();},goToNode:function(t){var e=i(P.nodes[P.current].getState());P=m(P,t),k(e),F(M(!1));},addExtraToNodeArtifact:function(t,e){P=function(t,e,n){var r=i(t),o=r.nodes[e];if(!h(o))throw new Error('Cannot add artifacts to Root Node');return o.artifacts.extra.push({time:f(),e:n}),r;}(P,t,e),O.callEvents([],P.nodes[t].getState(),P.nodes[t]);},addAnnotationToNode:function(t,e){P=function(t,e,n){var r=i(t),o=r.nodes[e];if(!h(o))throw new Error('Cannot add annotation to Root Node');return o.artifacts.annotation=n,r;}(P,t,e),O.callEvents([],P.nodes[t].getState(),P.nodes[t]);},getExtraFromArtifact:function(t){return function(t,e){var n=t.nodes[e];if(h(n))return n.artifacts.extra;throw new Error('Root does not have artifacts');}(P,t);},goBackOneStep:function(){var t=i(P.nodes[P.current].getState()),e=P.nodes[P.current];if(!h(e))throw new Error('Already at root');P=m(P,e.parent),k(t),F(M(!1));},goBackNSteps:function(t){for(var e=i(P.nodes[P.current].getState()),n=t,r=i(P);t>0;){var o=r.nodes[r.current];if(!h(o))throw new Error('Cannot go back '+n+' steps. Reached root after '+(n-t)+' steps');r=m(P,o.parent),t--;}P=r,k(e),F(M(!1));},goBackToNonEphemeral:function(){for(var t=i(P.nodes[P.current].getState()),e=i(P),n=e.nodes[e.current];;){if(!h(n)){e=m(e,e.root);break;}if(!(e=m(P,n.parent)).nodes[e.current].ephemeral)break;n=e.nodes[e.current];}P=e,k(t),F(M(!1));},goForwardToNonEphemeral:function(){for(var t=i(P.nodes[P.current].getState()),e=i(P),n=e.nodes[e.current];;){if(!(n.children.length>0))throw new Error('Already at the latest node in this branch or no non ephemeral nodes later');if(!(e=m(e,n.children.reverse()[0])).nodes[e.current].ephemeral)break;n=e.nodes[e.current];}P=e,k(t),F(M(!1));},goForwardOneStep:function(){var t=i(P.nodes[P.current].getState()),e=P.nodes[P.current];if(!(e.children.length>0))throw new Error('Already at the latest node in this branch');P=m(P,e.children.reverse()[0]),k(t),F(M(!1));},reset:function(){var t=i(P.nodes[P.current].getState());P=m(P,P.root),k(t),F(M(!1));},done:function(){if(e){var t=i(P.nodes[P.current].getState());!function(){if(!window||!window.location||!window.location.href)throw new Error('Please use in a browser environment, or set loadFromUrl parameter in initProvenance to false');var t=new URL(window.location.href),e=new URLSearchParams(t.search);if(null!==e.get('provState')){var n=e.get('provState');L(JSON.parse(I(n)));}}(),k(t);}},addObserver:function(t,e){var n=P.nodes[P.current].getState();t.forEach((function(e){if(!Object.keys(n).includes(e))throw new Error('Path '+t.join('.')+' does not exist');n=n[e];})),O.addObserver(t,e);},addGlobalObserver:function(t){O.addGlobalObserver(t);},addArtifactObserver:function(t){O.addArtifactObserver(t);},exportState:function(t){return void 0===t&&(t=!1),M(t);},importState:function(t){var e=i(P.nodes[P.current].getState()),n=JSON.parse(I(t.replace('||','')));L(E(E({},P.nodes[P.current].getState()),n)),k(e);},importLinearStates:function(t,e,n){for(var r=0;r<t.length;r++){var o=i(P.nodes[P.current].getState());void 0!==e&&void 0!==n?L(t[r],e[r],n[r]):L(t[r]),k(o);}},exportProvenanceGraph:function(){return JSON.stringify(P);},getDiffFromNode:function(t){var e=P.nodes[t];if(h(e)){var n=d(P.nodes[e.parent].getState(),e.getState());return void 0===n?[]:n;}return console.log('Cannot get diff from root node'),[];},setBookmark:function(t,e){P.nodes[t].bookmarked=e;},getBookmark:function(t){return P.nodes[t].bookmarked;},importProvenanceGraph:function(t){var e=i(P.nodes[P.current].getState());P=JSON.parse(t);var n=function(t){var e=P.nodes[t];if(!c(e)){var n=i(e.state);e.getState=function(){return n;};}c(e)&&(e.getState=function(){var t=i(P.nodes[e.lastStateNode].state),n=e.diffs;return 0===n.length?t:(n.forEach((function(e){C(t,null,e);})),t);});};for(var r in P.nodes)n(r);k(e);}};}n.d(e,'initProvenance',(function(){return S;})),n.d(e,'isStateNode',(function(){return u;})),n.d(e,'isChildNode',(function(){return h;})),n.d(e,'isDiffNode',(function(){return c;}));}]);}));
